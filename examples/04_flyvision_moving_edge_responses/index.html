
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://flyvis.github.io/examples/04_flyvision_moving_edge_responses/">
      
      
        <link rel="prev" href="../03_flyvision_flash_responses/">
      
      
        <link rel="next" href="../05_flyvision_umap_and_clustering_models/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.38">
    
    
      
        <title>Moving Edge Responses - Flyvis Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8c3ca2c6.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#moving-edge-responses" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      



<header class="md-header md-header--shadow" data-md-component="header">
    <nav class="md-header__inner md-grid" aria-label="Header">
        <a href="../.." title="Flyvis Documentation"
            class="md-header__button md-logo" aria-label="Flyvis Documentation" data-md-component="logo">
            
<img id="flyvis-logo-light" src="../../images/flyvis_logo_light@150ppi.webp" alt="logo">
<img id="flyvis-logo-dark" src="../../images/flyvis_logo_dark@150ppi.webp" alt="logo">

        </a>
        <label class="md-header__button md-icon" for="__drawer">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
        </label>
        <div class="md-header__title" data-md-component="header-title">
            <div class="md-header__ellipsis">
                <div class="md-header__topic">
                    <span class="md-ellipsis">
                    </span>
                </div>
                <div class="md-header__topic" data-md-component="header-topic">
                    <span class="md-ellipsis">
                    </span>
                </div>
            </div>
        </div>
        
        
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="purple"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
        
        
        
        <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
        
        
        
        <label class="md-header__button md-icon" for="__search">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
        
        <div class="md-header__source">
            <a href="https://github.com/turagalab/flyvis" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
        </div>
        
    </nav>
    
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Flyvis Documentation"
      class="md-nav__button md-logo" aria-label="Flyvis Documentation" data-md-component="logo">
      
<img id="flyvis-logo-light" src="../../images/flyvis_logo_light@150ppi.webp" alt="logo">
<img id="flyvis-logo-dark" src="../../images/flyvis_logo_dark@150ppi.webp" alt="logo">

    </a>
    <div class="md-nav__social">
      <div class="md-social">
  
    
    
    
    
    <a href="mailto:janne.lappalainen@uni-tuebingen.de?cc=jakob.macke@uni-tuebingen.de,turagas@janelia.hhmi.org" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l217.6 163.2c11.4 8.5 27 8.5 38.4 0l217.6-163.2c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 176v208c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V176L294.4 339.2a63.9 63.9 0 0 1-76.8 0z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/turagalab/flyvis" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.nature.com/articles/s41586-024-07939-3" target="_blank" rel="noopener" title="www.nature.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M96 96c0-35.3 28.7-64 64-64h288c35.3 0 64 28.7 64 64v320c0 35.3-28.7 64-64 64H80c-44.2 0-80-35.8-80-80V128c0-17.7 14.3-32 32-32s32 14.3 32 32v272c0 8.8 7.2 16 16 16s16-7.2 16-16zm64 24v80c0 13.3 10.7 24 24 24h112c13.3 0 24-10.7 24-24v-80c0-13.3-10.7-24-24-24H184c-13.3 0-24 10.7-24 24m208-8c0 8.8 7.2 16 16 16h48c8.8 0 16-7.2 16-16s-7.2-16-16-16h-48c-8.8 0-16 7.2-16 16m0 96c0 8.8 7.2 16 16 16h48c8.8 0 16-7.2 16-16s-7.2-16-16-16h-48c-8.8 0-16 7.2-16 16m-208 96c0 8.8 7.2 16 16 16h256c8.8 0 16-7.2 16-16s-7.2-16-16-16H176c-8.8 0-16 7.2-16 16m0 96c0 8.8 7.2 16 16 16h256c8.8 0 16-7.2 16-16s-7.2-16-16-16H176c-8.8 0-16 7.2-16 16"/></svg>
    </a>
  
</div>
    </div>
    Flyvis Documentation
  </label>
  
  <div class="md-nav__source">
    <a href="https://github.com/turagalab/flyvis" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
  </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
    
    
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
    
    
  
  
  
  
    <li class="md-nav__item">
      <a href="../../install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

    
    
    
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Command Line Interface
  </span>
  

      </a>
    </li>
  

    
    
    
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_flyvision_connectome/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Explore the Connectome
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02_flyvision_optic_flow_task/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Train the Network
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03_flyvision_flash_responses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flash Responses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Moving Edge Responses
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Moving Edge Responses
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#moving-edge-stimuli" class="md-nav__link">
    <span class="md-ellipsis">
      Moving edge stimuli
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#moving-edge-response" class="md-nav__link">
    <span class="md-ellipsis">
      Moving edge response
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Moving edge response">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#response-traces" class="md-nav__link">
    <span class="md-ellipsis">
      Response traces
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#direction-selectivity-index-dsi" class="md-nav__link">
    <span class="md-ellipsis">
      Direction selectivity index (DSI)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dsi-and-tuning-curve-correlation" class="md-nav__link">
    <span class="md-ellipsis">
      DSI and tuning curve correlation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ensemble-responses" class="md-nav__link">
    <span class="md-ellipsis">
      Ensemble responses
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ensemble responses">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#response-traces_1" class="md-nav__link">
    <span class="md-ellipsis">
      Response traces
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#direction-selectivity-index-dsi_1" class="md-nav__link">
    <span class="md-ellipsis">
      Direction selectivity index (DSI)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dsi-correlation" class="md-nav__link">
    <span class="md-ellipsis">
      DSI correlation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05_flyvision_umap_and_clustering_models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ensemble Clustering
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06_flyvision_maximally_excitatory_stimuli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Maximally Excitatory Stimuli
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07_flyvision_providing_custom_stimuli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom Stimuli
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
    
    
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Main Results
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Main Results
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../figure_01_fly_visual_system/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Figure 1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../figure_02_simple_stimuli_responses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Figure 2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../figure_03_naturalistic_stimuli_responses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Figure 3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../figure_04_mechanisms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Figure 4
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
    
    
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/connectome/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Connectomes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/network/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Network
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/network_view/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NetworkView
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/ensemble_view/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EnsembleView
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/sintel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sintel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/tasks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Task
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/decoder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Decoder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/solver/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Training
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flash_responses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flash Responses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/moving_stimulus_responses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Moving Stimulus Responses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/ensemble_clustering/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ensemble Clustering
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/optimal_stimuli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Optimal Stimuli
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_13" >
        
          
          <label class="md-nav__link" for="__nav_6_13" id="__nav_6_13_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Miscelleanous
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_13">
            <span class="md-nav__icon md-icon"></span>
            Miscelleanous
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/rendering/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rendering
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/augmentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hex Augmentations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/datasets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Datasets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Utils
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/visualization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visualizations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/animations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Animations
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_14" >
        
          
          <label class="md-nav__link" for="__nav_6_14" id="__nav_6_14_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CLI Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_14">
            <span class="md-nav__icon md-icon"></span>
            CLI Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Command Line Interface
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/flyvis_cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CLI Entry Point
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/hydra_default_config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hydra Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_14_4" >
        
          
          <label class="md-nav__link" for="__nav_6_14_4" id="__nav_6_14_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Training
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_14_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_14_4">
            <span class="md-nav__icon md-icon"></span>
            Training
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/training/train_single/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run Training for Single Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/training/train/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch Ensemble Training on Compute Cloud
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_14_5" >
        
          
          <label class="md-nav__link" for="__nav_6_14_5" id="__nav_6_14_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Validation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_14_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_14_5">
            <span class="md-nav__icon md-icon"></span>
            Validation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/validation/val_single/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run Validation for Single Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/validation/validate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch Ensemble Validation on Compute Cloud
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_14_6" >
        
          
          <label class="md-nav__link" for="__nav_6_14_6" id="__nav_6_14_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Analysis
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_14_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_14_6">
            <span class="md-nav__icon md-icon"></span>
            Analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/analysis/synthetic_recordings_single/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run Synthetic Recordings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/analysis/record/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch Synthetic Recordings on Compute Cloud
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/analysis/ensemble_analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run Ensemble Analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/analysis/analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch Ensemble Analysis on Compute Cloud
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_14_7" >
        
          
          <label class="md-nav__link" for="__nav_6_14_7" id="__nav_6_14_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Notebook
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_14_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_14_7">
            <span class="md-nav__icon md-icon"></span>
            Notebook
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/analysis/notebook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run Notebook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/analysis/notebook_per_ensemble/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch Notebook Per Ensemble on Compute Cloud
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/analysis/notebook_per_model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch Notebook Per Model on Compute Cloud
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/download_pretrained_models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Download
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
    
    
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contribute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

    
    
    
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ
  </span>
  

      </a>
    </li>
  

    
    
    
  
  
  
  
    <li class="md-nav__item">
      <a href="../../acknowledgements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Acknowledgements
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#moving-edge-stimuli" class="md-nav__link">
    <span class="md-ellipsis">
      Moving edge stimuli
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#moving-edge-response" class="md-nav__link">
    <span class="md-ellipsis">
      Moving edge response
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Moving edge response">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#response-traces" class="md-nav__link">
    <span class="md-ellipsis">
      Response traces
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#direction-selectivity-index-dsi" class="md-nav__link">
    <span class="md-ellipsis">
      Direction selectivity index (DSI)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dsi-and-tuning-curve-correlation" class="md-nav__link">
    <span class="md-ellipsis">
      DSI and tuning curve correlation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ensemble-responses" class="md-nav__link">
    <span class="md-ellipsis">
      Ensemble responses
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ensemble responses">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#response-traces_1" class="md-nav__link">
    <span class="md-ellipsis">
      Response traces
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#direction-selectivity-index-dsi_1" class="md-nav__link">
    <span class="md-ellipsis">
      Direction selectivity index (DSI)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dsi-correlation" class="md-nav__link">
    <span class="md-ellipsis">
      DSI correlation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="moving-edge-responses">Moving edge responses<a class="headerlink" href="#moving-edge-responses" title="Permanent link">&para;</a></h1>
<p>This notebook introduces moving edge responses and the direction selectivity index (DSI). The DSI measures motion selectivity of cells to visual input.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># basic imports</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">torch</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.dpi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span>
</code></pre></div>
<h2 id="moving-edge-stimuli">Moving edge stimuli<a class="headerlink" href="#moving-edge-stimuli" title="Permanent link">&para;</a></h2>
<p>To elicit moving edge responses and characterise the motion selectivity of neurons, experimenters show an ON or OFF edge moving in different cardinal directions. We generate and render these stimuli with the <code>MovingEdge</code> dataset.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># import dataset and visualization helper</span>
<span class="kn">from</span> <span class="nn">flyvision.datasets.moving_bar</span> <span class="kn">import</span> <span class="n">MovingEdge</span>
<span class="kn">from</span> <span class="nn">flyvision.analysis.animations.hexscatter</span> <span class="kn">import</span> <span class="n">HexScatter</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># initialize dataset</span>
<span class="c1"># make the dataset</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">MovingEdge</span><span class="p">(</span>
    <span class="n">offsets</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">],</span>  <span class="c1"># offset of bar from center in 1 * radians(2.25) led size</span>
    <span class="n">intensities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># intensity of bar</span>
    <span class="n">speeds</span><span class="o">=</span><span class="p">[</span><span class="mi">19</span><span class="p">],</span>  <span class="c1"># speed of bar in 1 * radians(5.8) / s</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>  <span class="c1"># height of moving bar in 1 * radians(2.25) led size</span>
    <span class="n">post_pad_mode</span><span class="o">=</span><span class="s2">&quot;continue&quot;</span><span class="p">,</span>  <span class="c1"># for post-stimulus period, continue with the last frame of the stimulus</span>
    <span class="n">t_pre</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># duration of pre-stimulus period</span>
    <span class="n">t_post</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># duration of post-stimulus period</span>
    <span class="n">dt</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">200</span><span class="p">,</span>  <span class="c1"># temporal resolution of rendered video</span>
    <span class="n">angles</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">30</span><span class="p">)),</span>  <span class="c1"># motion direction (orthogonal to edge)</span>
<span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># view stimulus parameters</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">arg_df</span>
<span class="c1"># the dataset has four samples, one corresponding to each row</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>angle</th>
      <th>width</th>
      <th>intensity</th>
      <th>t_stim</th>
      <th>speed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>80</td>
      <td>0</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>80</td>
      <td>1</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>2</th>
      <td>30</td>
      <td>80</td>
      <td>0</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>3</th>
      <td>30</td>
      <td>80</td>
      <td>1</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>4</th>
      <td>60</td>
      <td>80</td>
      <td>0</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>5</th>
      <td>60</td>
      <td>80</td>
      <td>1</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>6</th>
      <td>90</td>
      <td>80</td>
      <td>0</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>7</th>
      <td>90</td>
      <td>80</td>
      <td>1</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>8</th>
      <td>120</td>
      <td>80</td>
      <td>0</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>9</th>
      <td>120</td>
      <td>80</td>
      <td>1</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>10</th>
      <td>150</td>
      <td>80</td>
      <td>0</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>11</th>
      <td>150</td>
      <td>80</td>
      <td>1</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>12</th>
      <td>180</td>
      <td>80</td>
      <td>0</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>13</th>
      <td>180</td>
      <td>80</td>
      <td>1</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>14</th>
      <td>210</td>
      <td>80</td>
      <td>0</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>15</th>
      <td>210</td>
      <td>80</td>
      <td>1</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>16</th>
      <td>240</td>
      <td>80</td>
      <td>0</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>17</th>
      <td>240</td>
      <td>80</td>
      <td>1</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>18</th>
      <td>270</td>
      <td>80</td>
      <td>0</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>19</th>
      <td>270</td>
      <td>80</td>
      <td>1</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>20</th>
      <td>300</td>
      <td>80</td>
      <td>0</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>21</th>
      <td>300</td>
      <td>80</td>
      <td>1</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>22</th>
      <td>330</td>
      <td>80</td>
      <td>0</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>23</th>
      <td>330</td>
      <td>80</td>
      <td>1</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><code><span class="c1"># visualize single sample</span>
<span class="c1"># %#matplotlib notebook</span>
<span class="n">animation</span> <span class="o">=</span> <span class="n">HexScatter</span><span class="p">(</span>
    <span class="n">dataset</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="kc">None</span><span class="p">,</span> <span class="p">::</span><span class="mi">25</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>  <span class="c1"># intensity=1, radius=6</span>
<span class="n">animation</span><span class="o">.</span><span class="n">animate_in_notebook</span><span class="p">()</span>
</code></pre></div>
<p><img alt="png" src="../04_flyvision_moving_edge_responses_files/04_flyvision_moving_edge_responses_7_0.png" /></p>
<h2 id="moving-edge-response">Moving edge response<a class="headerlink" href="#moving-edge-response" title="Permanent link">&para;</a></h2>
<p>Now that we have generated the stimulus, we can use it to drive a trained connectome-constrained network.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvision</span> <span class="kn">import</span> <span class="n">results_dir</span>
<span class="kn">from</span> <span class="nn">flyvision.network</span> <span class="kn">import</span> <span class="n">NetworkView</span>

<span class="c1"># model are already sorted by task error</span>
<span class="c1"># we take the best task-performing model from the pre-sorted ensemble</span>
<span class="n">network_view</span> <span class="o">=</span> <span class="n">NetworkView</span><span class="p">(</span><span class="n">results_dir</span> <span class="o">/</span> <span class="s2">&quot;flow/0000/000&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[2024-10-14 21:01:17] network_view:125 Initialized network view at /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/000
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">stims_and_resps</span> <span class="o">=</span> <span class="n">network_view</span><span class="o">.</span><span class="n">moving_edge_responses</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</code></pre></div>
<p>We&rsquo;ve now computed network moving edge responses for all cells in the network.</p>
<h3 id="response-traces">Response traces<a class="headerlink" href="#response-traces" title="Permanent link">&para;</a></h3>
<p>We can plot single-cell response traces with <code>stims_and_resps['responses'].custom.plot_traces()</code>. Here, we plot responses of T4c cells to edges with intensity 1 (ON edges).</p>
<div class="highlight"><pre><span></span><code><span class="n">stims_and_resps</span><span class="p">[</span><span class="s2">&quot;responses&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">cell_type</span><span class="o">=</span><span class="s2">&quot;T4c&quot;</span><span class="p">,</span> <span class="n">intensity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="s2">&quot;&gt;-0.5,&lt;1.0&quot;</span>
<span class="p">)</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">plot_traces</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">legend_labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;T4c responses to moving edge&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>Text(0.5, 1.0, &#39;T4c responses to moving edge&#39;)
</code></pre></div>

<p><img alt="png" src="../04_flyvision_moving_edge_responses_files/04_flyvision_moving_edge_responses_13_1.png" /></p>
<h3 id="direction-selectivity-index-dsi">Direction selectivity index (DSI)<a class="headerlink" href="#direction-selectivity-index-dsi" title="Permanent link">&para;</a></h3>
<p>The <strong>Direction Selectivity Index (DSI)</strong> quantifies a cell&rsquo;s preference for stimuli moving in a particular direction.</p>
<p>The DSI is derived from the following steps:
1. Obtain the neuron&rsquo;s peak responses to stimuli moving in different directions <span class="arithmatex">\(\theta\)</span> and at different speeds <span class="arithmatex">\(S\)</span>.
2. Rectify these peak responses to ensure they are non-negative.
3. Compute the DSI using the equation:</p>
<div class="arithmatex">\[
DSI_{t_i}(I) = \frac{1}{\lvert S \rvert} \sum_{S \in S} \left\lvert \frac{\sum_{\theta \in \Theta} r^{peak}_{t_{central}}(I, S, \theta) e^{i\theta}}{\max_{I \in I} \left\lvert \sum_{\theta \in \Theta} r^{peak}_{t_{central}}(I, S, \theta) \right\rvert} \right\rvert
\]</div>
<p>Where:
- <span class="arithmatex">\(DSI_{t_i}(I)\)</span> is the Direction Selectivity Index for cell type <span class="arithmatex">\(t_i\)</span> at stimulus intensity <span class="arithmatex">\(I\)</span>.
- <span class="arithmatex">\(\lvert S \rvert\)</span> is the number of different speeds at which stimuli are moved.
- <span class="arithmatex">\(r^{peak}_{t_{central}}(I, S, \theta)\)</span> represents the rectified peak response of the central cell in hexagonal space of a cell type, for a given stimulus intensity <span class="arithmatex">\(I\)</span>, speed <span class="arithmatex">\(S\)</span>, and direction <span class="arithmatex">\(\theta\)</span>.
- <span class="arithmatex">\(\theta\)</span> is varied across all tested directions <span class="arithmatex">\(\Theta\)</span>.
- <span class="arithmatex">\(e^{i\theta}\)</span> introduces the directional component by weighting the response by the complex exponential of the angle of movement.
- The denominator normalizes the responses, ensuring that DSI values range from 0 to 1.</p>
<p>The DSI values range from 0 to 1. A DSI of 0 indicates no directional preference, while a DSI of 1 indicates a strong preference for a specific direction.</p>
<p>For the T4c cell plotted before, we can see that it preferentially responds to ON edges moving at an angle of 60 degrees, so we expect to see a large DSI.</p>
<p>We compute the DSI with <code>flyvision.analysis.direction_selectivity_index</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvision.analysis.moving_bar_responses</span> <span class="kn">import</span> <span class="n">direction_selectivity_index</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># get DSI for T4c cell</span>
<span class="n">dsis</span> <span class="o">=</span> <span class="n">direction_selectivity_index</span><span class="p">(</span><span class="n">stims_and_resps</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;T4c DSI: </span><span class="si">{</span><span class="n">dsis</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cell_type</span><span class="o">=</span><span class="s1">&#39;T4c&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">intensity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>T4c DSI: 0.63
</code></pre></div>

<p>We compute the preferred direction of the cell with <code>flyvision.analysis.preferred_direction</code> (this is the direction that the tuning lobe points towards). We would expect the preferred direction to be around 60 degrees based on the response traces.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvision.analysis.moving_bar_responses</span> <span class="kn">import</span> <span class="n">preferred_direction</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">pds</span> <span class="o">=</span> <span class="n">preferred_direction</span><span class="p">(</span><span class="n">stims_and_resps</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;T4c preferred direction: </span><span class="si">{</span><span class="n">pds</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cell_type</span><span class="o">=</span><span class="s1">&#39;T4c&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">intensity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">180</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> degrees&quot;</span>
<span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>T4c preferred direction: 56.24 degrees
</code></pre></div>

<p>We can also inspect the direction selecity of a cell type visually, by plotting the angular tuning with <code>plot_angular_tuning</code>.</p>
<p>Here we see clearly how the cell is tuned to stimuli moving at a 60 degree angle.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvision.analysis.moving_bar_responses</span> <span class="kn">import</span> <span class="n">plot_angular_tuning</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">plot_angular_tuning</span><span class="p">(</span><span class="n">stims_and_resps</span><span class="p">,</span> <span class="n">cell_type</span><span class="o">=</span><span class="s2">&quot;T4c&quot;</span><span class="p">,</span> <span class="n">intensity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>(&lt;Figure size 300x300 with 1 Axes&gt;, &lt;PolarAxes: &gt;)
</code></pre></div>

<p><img alt="png" src="../04_flyvision_moving_edge_responses_files/04_flyvision_moving_edge_responses_23_1.png" /></p>
<h3 id="dsi-and-tuning-curve-correlation">DSI  and tuning curve correlation<a class="headerlink" href="#dsi-and-tuning-curve-correlation" title="Permanent link">&para;</a></h3>
<p>With the <code>dsi()</code> function we can also compute DSIs for every cell type at once. Since the selectivity of some cell types have been determined experimentally, we can then compare our model to experimental findings by computing the correlation between the model DSIs for known cell types with their expected motion selectivity.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvision.analysis.moving_bar_responses</span> <span class="kn">import</span> <span class="n">dsi_correlation_to_known</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">dsi_corr</span> <span class="o">=</span> <span class="n">dsi_correlation_to_known</span><span class="p">(</span><span class="n">direction_selectivity_index</span><span class="p">(</span><span class="n">stims_and_resps</span><span class="p">))</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DSI correlation = </span><span class="si">{</span><span class="n">dsi_corr</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s2"> .2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>DSI correlation =  0.89
</code></pre></div>

<p>Further, for certain cell types, their actual tuning curves have also been measured experimentally, so we can correlate our model cell&rsquo;s tuning to the true values. For T4c, the cell is known to tune to stimuli moving at 90 degrees, so the correlation should be relatively high.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvision.analysis.moving_bar_responses</span> <span class="kn">import</span> <span class="n">correlation_to_known_tuning_curves</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">corrs</span> <span class="o">=</span> <span class="n">correlation_to_known_tuning_curves</span><span class="p">(</span><span class="n">stims_and_resps</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;T4c tuning curve correlation = </span><span class="si">{</span><span class="n">corrs</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cell_type</span><span class="o">=</span><span class="s1">&#39;T4c&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">intensity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>T4c tuning curve correlation = 0.54
</code></pre></div>

<p>In fact, tuning curves for all T4 and T5 cells have been measured, so we can compute the correlation for all 8 cell types.</p>
<div class="highlight"><pre><span></span><code><span class="n">t4_corrs</span> <span class="o">=</span> <span class="n">corrs</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cell_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;T4a&quot;</span><span class="p">,</span> <span class="s2">&quot;T4b&quot;</span><span class="p">,</span> <span class="s2">&quot;T4c&quot;</span><span class="p">,</span> <span class="s2">&quot;T4d&quot;</span><span class="p">],</span> <span class="n">intensity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">t5_corrs</span> <span class="o">=</span> <span class="n">corrs</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cell_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;T5a&quot;</span><span class="p">,</span> <span class="s2">&quot;T5b&quot;</span><span class="p">,</span> <span class="s2">&quot;T5c&quot;</span><span class="p">,</span> <span class="s2">&quot;T5d&quot;</span><span class="p">],</span> <span class="n">intensity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;T4 tuning curve correlations: </span><span class="si">{</span><span class="n">t4_corrs</span><span class="o">.</span><span class="n">cell_type</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">t4_corrs</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>T4 tuning curve correlations: [&#39;T4a&#39; &#39;T4b&#39; &#39;T4c&#39; &#39;T4d&#39;]
[0.93699979 0.71944939 0.53721792 0.85661064]
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;T5 tuning curve correlations: </span><span class="si">{</span><span class="n">t5_corrs</span><span class="o">.</span><span class="n">cell_type</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">t5_corrs</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>T5 tuning curve correlations: [&#39;T5a&#39; &#39;T5b&#39; &#39;T5c&#39; &#39;T5d&#39;]
[0.84125431 0.90320943 0.94956469 0.90100505]
</code></pre></div>

<p>So, the model yields accurate predictions for all T4 and T5 cell types.</p>
<h2 id="ensemble-responses">Ensemble responses<a class="headerlink" href="#ensemble-responses" title="Permanent link">&para;</a></h2>
<p>Now we can compare motion selectivity properties across an ensemble of trained models. First we need to again simulate the network responses.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvision</span> <span class="kn">import</span> <span class="n">EnsembleView</span>

<span class="n">ensemble</span> <span class="o">=</span> <span class="n">EnsembleView</span><span class="p">(</span><span class="n">results_dir</span> <span class="o">/</span> <span class="s2">&quot;flow/0000&quot;</span><span class="p">)</span>
<span class="c1"># choose best 10</span>
<span class="n">ensemble</span> <span class="o">=</span> <span class="n">ensemble</span><span class="p">[</span><span class="n">ensemble</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[:</span><span class="mi">10</span><span class="p">]]</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>Loading ensemble:   0%|          | 0/50 [00:00&lt;?, ?it/s]


[2024-10-14 21:01:40] ensemble:166 Loaded 50 networks.



Loading ensemble:   0%|          | 0/10 [00:00&lt;?, ?it/s]


[2024-10-14 21:01:46] ensemble:166 Loaded 10 networks.
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="o">%%</span><span class="n">capture</span>
<span class="n">stims_and_resps</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">moving_edge_responses</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">)</span>
</code></pre></div>
<h3 id="response-traces_1">Response traces<a class="headerlink" href="#response-traces_1" title="Permanent link">&para;</a></h3>
<p>We can once again plot response traces for a single cell type.</p>
<p>We subtract the initial value of each trace and divide by the max as the network neuron activities are in arbitrary units.</p>
<p>We plot only T4c responses to ON edges moving at a 90-degree angle.</p>
<div class="highlight"><pre><span></span><code><span class="n">responses</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">stims_and_resps</span><span class="p">[</span><span class="s2">&quot;responses&quot;</span><span class="p">]</span>
    <span class="o">-</span> <span class="n">stims_and_resps</span><span class="p">[</span><span class="s2">&quot;responses&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">responses</span> <span class="o">=</span> <span class="n">responses</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;frame&quot;</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">responses</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">cell_type</span><span class="o">=</span><span class="s2">&quot;T4c&quot;</span><span class="p">,</span>
    <span class="n">intensity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">time</span><span class="o">=</span><span class="s2">&quot;&gt;-0.5,&lt;1.0&quot;</span><span class="p">,</span>
    <span class="n">angle</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">plot_traces</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:blue&quot;</span><span class="p">),</span> <span class="n">legend_labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;network_id&quot;</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>&lt;Axes: xlabel=&#39;time&#39;, ylabel=&#39;responses&#39;&gt;
</code></pre></div>

<p><img alt="png" src="../04_flyvision_moving_edge_responses_files/04_flyvision_moving_edge_responses_43_1.png" /></p>
<p>Though for most networks T4c responses are correctly predicted to the stimuli, there are some networks in the ensemble with different responses.</p>
<h3 id="direction-selectivity-index-dsi_1">Direction selectivity index (DSI)<a class="headerlink" href="#direction-selectivity-index-dsi_1" title="Permanent link">&para;</a></h3>
<p>We can also compute direction selectivity indices for each network in the ensemble.</p>
<div class="highlight"><pre><span></span><code><span class="n">dsis</span> <span class="o">=</span> <span class="n">direction_selectivity_index</span><span class="p">(</span><span class="n">stims_and_resps</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">dsis</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cell_type</span><span class="o">=</span><span class="s2">&quot;T4c&quot;</span><span class="p">,</span> <span class="n">intensity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;T4c DSI distribution&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Number of networks&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>Text(0, 0.5, &#39;Number of networks&#39;)
</code></pre></div>

<p><img alt="png" src="../04_flyvision_moving_edge_responses_files/04_flyvision_moving_edge_responses_47_1.png" /></p>
<p>Most networks in this group recover some direction selectivity for T4c. We can also plot the distribution of DSIs per cell type for both ON and OFF-edge stimuli across the ensemble.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvision.analysis.moving_bar_responses</span> <span class="kn">import</span> <span class="n">dsi_violins_on_and_off</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">dsi_violins_on_and_off</span><span class="p">(</span>
    <span class="n">dsis</span><span class="p">,</span>
    <span class="n">dsis</span><span class="o">.</span><span class="n">cell_type</span><span class="p">,</span>
    <span class="n">bold_output_type_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">output_cell_types</span><span class="o">=</span><span class="n">ensemble</span><span class="p">[</span><span class="n">ensemble</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="o">.</span><span class="n">connectome</span><span class="o">.</span><span class="n">output_cell_types</span><span class="p">[:]</span>
    <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">],</span>
    <span class="n">color_known_types</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">scatter_best_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">scatter_best_color</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;Blues&quot;</span><span class="p">)(</span><span class="mf">1.0</span><span class="p">),</span>
<span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../04_flyvision_moving_edge_responses_files/04_flyvision_moving_edge_responses_49_0.png" /></p>
<h3 id="dsi-correlation">DSI correlation<a class="headerlink" href="#dsi-correlation" title="Permanent link">&para;</a></h3>
<p>Lastly, we look at the correlations to ground-truth DSIs and tuning curves across the ensemble. This provides us with a high-level understanding of the accuracy of known motion tuning predictions.</p>
<div class="highlight"><pre><span></span><code><span class="n">dsi_corr</span> <span class="o">=</span> <span class="n">dsi_correlation_to_known</span><span class="p">(</span><span class="n">direction_selectivity_index</span><span class="p">(</span><span class="n">stims_and_resps</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">tuning_corrs</span> <span class="o">=</span> <span class="n">correlation_to_known_tuning_curves</span><span class="p">(</span><span class="n">stims_and_resps</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">t4_corrs</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">tuning_corrs</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cell_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;T4a&quot;</span><span class="p">,</span> <span class="s2">&quot;T4b&quot;</span><span class="p">,</span> <span class="s2">&quot;T4c&quot;</span><span class="p">,</span> <span class="s2">&quot;T4d&quot;</span><span class="p">],</span> <span class="n">intensity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="s2">&quot;neuron&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">t5_corrs</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">tuning_corrs</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cell_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;T5a&quot;</span><span class="p">,</span> <span class="s2">&quot;T5b&quot;</span><span class="p">,</span> <span class="s2">&quot;T5c&quot;</span><span class="p">,</span> <span class="s2">&quot;T5d&quot;</span><span class="p">],</span> <span class="n">intensity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="s2">&quot;neuron&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">dsi_corr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">t4_corrs</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">t5_corrs</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>((10,), (10,), (10,))
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvision.analysis.visualization.plots</span> <span class="kn">import</span> <span class="n">violin_groups</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">violin_groups</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">dsi_corr</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">t4_corrs</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">t5_corrs</span><span class="o">.</span><span class="n">values</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:],</span>
    <span class="p">[</span><span class="s2">&quot;DSI&quot;</span><span class="p">,</span> <span class="s2">&quot;T4 tuning&quot;</span><span class="p">,</span> <span class="s2">&quot;T5 tuning&quot;</span><span class="p">],</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;correlation&quot;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">1.8</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span>
    <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">colors</span><span class="o">=</span><span class="p">[</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;Dark2&quot;</span><span class="p">)(</span><span class="mf">0.125</span><span class="p">),</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;Dark2&quot;</span><span class="p">)(</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;Dark2&quot;</span><span class="p">)(</span><span class="mf">0.25</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">color_by</span><span class="o">=</span><span class="s2">&quot;experiments&quot;</span><span class="p">,</span>
    <span class="n">scatter_edge_color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
    <span class="n">scatter_radius</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">violin_alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../04_flyvision_moving_edge_responses_files/04_flyvision_moving_edge_responses_55_0.png" /></p>
<!-- ... Models in general have very good match to known single-neuron tuning properties, with median correlation around $0.8$. -->












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
    
    <div class="md-footer-meta md-typeset">
        <div class="md-footer-meta__inner md-grid">
            <div class="md-copyright">
    
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
        Material for MkDocs
    </a>
    
    
    <div class="md-copyright__highlight">
        Lappalainen &copy 2024
    </div>
    
</div>
        </div>
    </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "navigation.instant", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.top"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.d6f25eb3.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>