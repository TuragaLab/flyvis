
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://flyvis.github.io/examples/02_flyvision_optic_flow_task/">
      
      
        <link rel="prev" href="../01_flyvision_connectome/">
      
      
        <link rel="next" href="../03_flyvision_flash_responses/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.44">
    
    
      
        <title>Train the Network - Flyvis Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#optic-flow-task" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      



<header class="md-header md-header--shadow" data-md-component="header">
    <nav class="md-header__inner md-grid" aria-label="Header">
        <a href="../.." title="Flyvis Documentation"
            class="md-header__button md-logo" aria-label="Flyvis Documentation" data-md-component="logo">
            
<img id="flyvis-logo-light" src="../../images/flyvis_logo_light@150ppi.webp" alt="logo">
<img id="flyvis-logo-dark" src="../../images/flyvis_logo_dark@150ppi.webp" alt="logo">

        </a>
        <label class="md-header__button md-icon" for="__drawer">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
        </label>
        <div class="md-header__title" data-md-component="header-title">
            <div class="md-header__ellipsis">
                <div class="md-header__topic">
                    <span class="md-ellipsis">
                    </span>
                </div>
                <div class="md-header__topic" data-md-component="header-topic">
                    <span class="md-ellipsis">
                    </span>
                </div>
            </div>
        </div>
        
        
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="purple"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
        
        
        
        <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
        
        
        
        <label class="md-header__button md-icon" for="__search">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
        
        <div class="md-header__source">
            <a href="https://github.com/turagalab/flyvis" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
        </div>
        
    </nav>
    
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Flyvis Documentation"
      class="md-nav__button md-logo" aria-label="Flyvis Documentation" data-md-component="logo">
      
<img id="flyvis-logo-light" src="../../images/flyvis_logo_light@150ppi.webp" alt="logo">
<img id="flyvis-logo-dark" src="../../images/flyvis_logo_dark@150ppi.webp" alt="logo">

    </a>
    <div class="md-nav__social">
      <div class="md-social">
  
    
    
    
    
    <a href="mailto:janne.lappalainen@uni-tuebingen.de?cc=jakob.macke@uni-tuebingen.de,turagas@janelia.hhmi.org" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l217.6 163.2c11.4 8.5 27 8.5 38.4 0l217.6-163.2c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 176v208c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V176L294.4 339.2a63.9 63.9 0 0 1-76.8 0z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/turagalab/flyvis" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.nature.com/articles/s41586-024-07939-3" target="_blank" rel="noopener" title="www.nature.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M96 96c0-35.3 28.7-64 64-64h288c35.3 0 64 28.7 64 64v320c0 35.3-28.7 64-64 64H80c-44.2 0-80-35.8-80-80V128c0-17.7 14.3-32 32-32s32 14.3 32 32v272c0 8.8 7.2 16 16 16s16-7.2 16-16zm64 24v80c0 13.3 10.7 24 24 24h112c13.3 0 24-10.7 24-24v-80c0-13.3-10.7-24-24-24H184c-13.3 0-24 10.7-24 24m208-8c0 8.8 7.2 16 16 16h48c8.8 0 16-7.2 16-16s-7.2-16-16-16h-48c-8.8 0-16 7.2-16 16m0 96c0 8.8 7.2 16 16 16h48c8.8 0 16-7.2 16-16s-7.2-16-16-16h-48c-8.8 0-16 7.2-16 16m-208 96c0 8.8 7.2 16 16 16h256c8.8 0 16-7.2 16-16s-7.2-16-16-16H176c-8.8 0-16 7.2-16 16m0 96c0 8.8 7.2 16 16 16h256c8.8 0 16-7.2 16-16s-7.2-16-16-16H176c-8.8 0-16 7.2-16 16"/></svg>
    </a>
  
</div>
    </div>
    Flyvis Documentation
  </label>
  
  <div class="md-nav__source">
    <a href="https://github.com/turagalab/flyvis" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
  </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
    
    
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
    
    
  
  
  
  
    <li class="md-nav__item">
      <a href="../../install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

    
    
    
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_flyvision_connectome/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Explore the Connectome
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Train the Network
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03_flyvision_flash_responses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flash Responses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04_flyvision_moving_edge_responses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Moving Edge Responses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05_flyvision_umap_and_clustering_models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ensemble Clustering
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06_flyvision_maximally_excitatory_stimuli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Maximally Excitatory Stimuli
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07_flyvision_providing_custom_stimuli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom Stimuli
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
    
    
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Main Results
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Main Results
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../figure_01_fly_visual_system/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Figure 1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../figure_02_simple_stimuli_responses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Figure 2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../figure_03_naturalistic_stimuli_responses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Figure 3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../figure_04_mechanisms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Figure 4
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
    
    
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/connectome/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Connectomes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/network/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Network
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/network_view/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NetworkView
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/ensemble_view/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EnsembleView
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/sintel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sintel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/tasks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Task
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/decoder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Decoder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/solver/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Training
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flash_responses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flash Responses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/moving_stimulus_responses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Moving Stimulus Responses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/ensemble_clustering/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ensemble Clustering
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/optimal_stimuli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Optimal Stimuli
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_13" >
        
          
          <label class="md-nav__link" for="__nav_5_13" id="__nav_5_13_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Miscelleanous
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_13">
            <span class="md-nav__icon md-icon"></span>
            Miscelleanous
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/rendering/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rendering
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/augmentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hex Augmentations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/datasets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Datasets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Utils
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/visualization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visualizations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/animations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Animations
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_14" >
        
          
          <label class="md-nav__link" for="__nav_5_14" id="__nav_5_14_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CLI Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_14">
            <span class="md-nav__icon md-icon"></span>
            CLI Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Command Line Interface
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/flyvis_cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CLI Entry Point
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/hydra_default_config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hydra Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_14_4" >
        
          
          <label class="md-nav__link" for="__nav_5_14_4" id="__nav_5_14_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Training
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_14_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_14_4">
            <span class="md-nav__icon md-icon"></span>
            Training
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/training/train_single/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run Training for Single Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/training/train/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch Ensemble Training on Compute Cloud
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_14_5" >
        
          
          <label class="md-nav__link" for="__nav_5_14_5" id="__nav_5_14_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Validation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_14_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_14_5">
            <span class="md-nav__icon md-icon"></span>
            Validation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/validation/val_single/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run Validation for Single Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/validation/validate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch Ensemble Validation on Compute Cloud
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_14_6" >
        
          
          <label class="md-nav__link" for="__nav_5_14_6" id="__nav_5_14_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Analysis
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_14_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_14_6">
            <span class="md-nav__icon md-icon"></span>
            Analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/analysis/synthetic_recordings_single/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run Synthetic Recordings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/analysis/record/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch Synthetic Recordings on Compute Cloud
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/analysis/ensemble_analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run Ensemble Analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/analysis/analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch Ensemble Analysis on Compute Cloud
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_14_7" >
        
          
          <label class="md-nav__link" for="__nav_5_14_7" id="__nav_5_14_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Notebook
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_14_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_14_7">
            <span class="md-nav__icon md-icon"></span>
            Notebook
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/analysis/notebook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run Notebook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/analysis/notebook_per_ensemble/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch Notebook Per Ensemble on Compute Cloud
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/analysis/notebook_per_model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch Notebook Per Model on Compute Cloud
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/download_pretrained_models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Download
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
    
    
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contribute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

    
    
    
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ
  </span>
  

      </a>
    </li>
  

    
    
    
  
  
  
  
    <li class="md-nav__item">
      <a href="../../acknowledgements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Acknowledgements
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="optic-flow-task">Optic flow task<a class="headerlink" href="#optic-flow-task" title="Permanent link">&para;</a></h1>
<p>This notebook illustrates the optic flow task and how to use it with our pretrained fly visual system model and decoder.</p>
<h1 id="the-sintel-dataset">The Sintel dataset<a class="headerlink" href="#the-sintel-dataset" title="Permanent link">&para;</a></h1>
<p>We use the Sintel dataset to train our models as described in the paper. More infos about the Sintel dataset can be found on the official Sintel website: <a href="http://sintel.is.tue.mpg.de/">http://sintel.is.tue.mpg.de/</a>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">torch</span>

<span class="kn">from</span> <span class="nn">flyvis.datasets.sintel</span> <span class="kn">import</span> <span class="n">MultiTaskSintel</span>
<span class="kn">from</span> <span class="nn">flyvis.analysis.animations.sintel</span> <span class="kn">import</span> <span class="n">SintelSample</span>
</code></pre></div>
<p>The class <code>MultiTaskSintel</code> loads, preprocesses, renders, and augments the sintel data. It adheres to the pytorch dataset primitive. It provides the interface to the input data and the output data for the flyvis networks. Note: the fly-eye rendering we use here, we introduce in the notebook on creating custom stimuli already.</p>
<p>This is the full setting:</p>
<div class="highlight"><pre><span></span><code><span class="n">dataset</span> <span class="o">=</span> <span class="n">MultiTaskSintel</span><span class="p">(</span>
    <span class="n">tasks</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;flow&quot;</span><span class="p">],</span>
    <span class="n">boxfilter</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">13</span><span class="p">),</span>
    <span class="c1"># Because the fly eye rendering is square</span>
    <span class="c1"># and sintel is wide, we can crop sintel</span>
    <span class="c1"># in width and render three sequences from one.</span>
    <span class="c1"># This allows us to statically augment our dataset</span>
    <span class="c1"># a bit already before we proceed with the random augmentations.</span>
    <span class="c1"># We end up with 3 * 23 sequences.</span>
    <span class="n">vertical_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">n_frames</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span>
    <span class="n">center_crop_fraction</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">augment</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="c1"># From sequences with more than n_frames, we randomly sample the start frame.</span>
    <span class="n">random_temporal_crop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">all_frames</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="c1"># We resample movie frames to the effective framerate given by 1/dt</span>
    <span class="n">resampling</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="c1"># We interpolate the flow arrows to 1/dt.</span>
    <span class="n">interpolate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="c1"># We flip with equal probability (using one flip-axis).</span>
    <span class="n">p_flip</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">flip_axes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="c1"># We rotate with equal probability (using five fold rotation symmetry of the hex-grid).</span>
    <span class="n">p_rot</span><span class="o">=</span><span class="mi">5</span> <span class="o">/</span> <span class="mi">6</span><span class="p">,</span>
    <span class="c1"># We randomly adjust contrast and brightness.</span>
    <span class="n">contrast_std</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">brightness_std</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="c1"># We add random white noise pixelweise.</span>
    <span class="n">gaussian_white_noise</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span>
    <span class="n">gamma_std</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">_init_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">unittest</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[2024-12-08 19:30:46] sintel_utils:331 Found Sintel at ../flyvis/data/SintelDataSet
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># The `dataset.arg_df` tracks the sequence index, identity etc.</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">arg_df</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>index</th>
      <th>original_index</th>
      <th>name</th>
      <th>original_n_frames</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>sequence_00_alley_1_split_00</td>
      <td>50</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0</td>
      <td>sequence_00_alley_1_split_01</td>
      <td>50</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>0</td>
      <td>sequence_00_alley_1_split_02</td>
      <td>50</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>1</td>
      <td>sequence_01_alley_2_split_00</td>
      <td>50</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>1</td>
      <td>sequence_01_alley_2_split_01</td>
      <td>50</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>64</th>
      <td>64</td>
      <td>21</td>
      <td>sequence_21_temple_2_split_01</td>
      <td>50</td>
    </tr>
    <tr>
      <th>65</th>
      <td>65</td>
      <td>21</td>
      <td>sequence_21_temple_2_split_02</td>
      <td>50</td>
    </tr>
    <tr>
      <th>66</th>
      <td>66</td>
      <td>22</td>
      <td>sequence_22_temple_3_split_00</td>
      <td>50</td>
    </tr>
    <tr>
      <th>67</th>
      <td>67</td>
      <td>22</td>
      <td>sequence_22_temple_3_split_01</td>
      <td>50</td>
    </tr>
    <tr>
      <th>68</th>
      <td>68</td>
      <td>22</td>
      <td>sequence_22_temple_3_split_02</td>
      <td>50</td>
    </tr>
  </tbody>
</table>
<p>69 rows × 4 columns</p>
</div>

<h2 id="single-sample">Single sample<a class="headerlink" href="#single-sample" title="Permanent link">&para;</a></h2>
<p>First, let&rsquo;s chunk this into smaller digestable pieces.</p>
<div class="highlight"><pre><span></span><code><span class="n">dataset</span> <span class="o">=</span> <span class="n">MultiTaskSintel</span><span class="p">(</span>
    <span class="n">tasks</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;flow&quot;</span><span class="p">],</span>
    <span class="n">boxfilter</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">13</span><span class="p">),</span>
    <span class="n">vertical_splits</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">24</span><span class="p">,</span>
    <span class="n">augment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[2024-12-08 19:30:51] sintel_utils:331 Found Sintel at ../flyvis/data/SintelDataSet
</code></pre></div>

<p>The first sample. For the target, the pixel-accurate motion vectors, the color indicates the direction of motion of the respective input pixel. The saturation indicates the magnitude of motion.</p>
<div class="highlight"><pre><span></span><code><span class="n">lum</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;lum&quot;</span><span class="p">]</span>
<span class="n">flow</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;flow&quot;</span><span class="p">]</span>

<span class="n">animation</span> <span class="o">=</span> <span class="n">SintelSample</span><span class="p">(</span><span class="n">lum</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">flow</span><span class="p">[</span><span class="kc">None</span><span class="p">])</span>
<span class="n">animation</span><span class="o">.</span><span class="n">animate_in_notebook</span><span class="p">()</span>
</code></pre></div>
<p><img alt="png" src="../02_flyvision_optic_flow_task_files/02_flyvision_optic_flow_task_11_0.png" /></p>
<p>Sintel has more groundtruth annotations. We support depth and flow because we know with some confidence that these are relevant for the fly.</p>
<div class="highlight"><pre><span></span><code><span class="n">dataset</span> <span class="o">=</span> <span class="n">MultiTaskSintel</span><span class="p">(</span>
    <span class="n">tasks</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">],</span>
    <span class="n">boxfilter</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">13</span><span class="p">),</span>
    <span class="n">vertical_splits</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">24</span><span class="p">,</span>
    <span class="n">augment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[2024-12-08 19:30:58] sintel_utils:331 Found Sintel at ../flyvis/data/SintelDataSet
[2024-12-08 19:30:58] sintel_utils:331 Found Sintel at ../flyvis/data/SintelDataSet
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">lum1</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;lum&quot;</span><span class="p">]</span>
<span class="n">depth1</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;depth&quot;</span><span class="p">]</span>

<span class="n">animation</span> <span class="o">=</span> <span class="n">SintelSample</span><span class="p">(</span><span class="n">lum1</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">depth1</span><span class="p">[</span><span class="kc">None</span><span class="p">])</span>
<span class="n">animation</span><span class="o">.</span><span class="n">animate_in_notebook</span><span class="p">()</span>
</code></pre></div>
<p><img alt="png" src="../02_flyvision_optic_flow_task_files/02_flyvision_optic_flow_task_14_0.png" /></p>
<h1 id="augmenting-the-dataset-step-by-step">Augmenting the dataset step-by-step<a class="headerlink" href="#augmenting-the-dataset-step-by-step" title="Permanent link">&para;</a></h1>
<p>We apply rich augmentations to the dataset of naturalistic sequences because the dataset is otherwise relatively small. This might lead to overfitting to, e.g., predicting motion mostly into well-represented directons or of objects of specific contrasts etc. Using rich augmentations, we &lsquo;ask&rsquo; the network to generalize better and invariantly compute motion regardless of direction, contrast, brightness, pixel noise, temporal appearance etc.</p>
<h2 id="vertical-splits">Vertical splits<a class="headerlink" href="#vertical-splits" title="Permanent link">&para;</a></h2>
<p>First, we split each sequence into three sequences vertically to leverage a wider extent of the video than if we would only render the center. We precompute these renderings.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvis.analysis.visualization.plots</span> <span class="kn">import</span> <span class="n">quick_hex_scatter</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">dataset</span> <span class="o">=</span> <span class="n">MultiTaskSintel</span><span class="p">(</span>
    <span class="n">tasks</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;flow&quot;</span><span class="p">],</span>
    <span class="n">boxfilter</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">13</span><span class="p">),</span>
    <span class="n">vertical_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">24</span><span class="p">,</span>
    <span class="n">augment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[2024-12-08 19:31:04] sintel_utils:331 Found Sintel at ../flyvis/data/SintelDataSet
</code></pre></div>

<p>Sintel has 23 movie sequences originally.</p>
<div class="highlight"><pre><span></span><code><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">arg_df</span><span class="o">.</span><span class="n">original_index</span><span class="p">))</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>23
</code></pre></div>

<p>Each original sequence is 436 pixel in height times 1024 pixel in width in cartesian coordinates.</p>
<div class="highlight"><pre><span></span><code><span class="n">sequence</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">cartesian_sequence</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">vertical_splits</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">center_crop_fraction</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sequence</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>(1, 49, 436, 1024)
</code></pre></div>

<p>With the vertical crops, we end up with 3 * 23 sequences. The <code>dataset.arg_df</code> tracks the sequence index, identity etc.</p>
<div class="highlight"><pre><span></span><code><span class="n">dataset</span><span class="o">.</span><span class="n">arg_df</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>index</th>
      <th>original_index</th>
      <th>name</th>
      <th>original_n_frames</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>sequence_00_alley_1_split_00</td>
      <td>50</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0</td>
      <td>sequence_00_alley_1_split_01</td>
      <td>50</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>0</td>
      <td>sequence_00_alley_1_split_02</td>
      <td>50</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>1</td>
      <td>sequence_01_alley_2_split_00</td>
      <td>50</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>1</td>
      <td>sequence_01_alley_2_split_01</td>
      <td>50</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>64</th>
      <td>64</td>
      <td>21</td>
      <td>sequence_21_temple_2_split_01</td>
      <td>50</td>
    </tr>
    <tr>
      <th>65</th>
      <td>65</td>
      <td>21</td>
      <td>sequence_21_temple_2_split_02</td>
      <td>50</td>
    </tr>
    <tr>
      <th>66</th>
      <td>66</td>
      <td>22</td>
      <td>sequence_22_temple_3_split_00</td>
      <td>50</td>
    </tr>
    <tr>
      <th>67</th>
      <td>67</td>
      <td>22</td>
      <td>sequence_22_temple_3_split_01</td>
      <td>50</td>
    </tr>
    <tr>
      <th>68</th>
      <td>68</td>
      <td>22</td>
      <td>sequence_22_temple_3_split_02</td>
      <td>50</td>
    </tr>
  </tbody>
</table>
<p>69 rows × 4 columns</p>
</div>

<div class="highlight"><pre><span></span><code><span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sequence</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">binary_r</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../02_flyvision_optic_flow_task_files/02_flyvision_optic_flow_task_27_0.png" /></p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">quick_hex_scatter</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;lum&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">quick_hex_scatter</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;lum&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">quick_hex_scatter</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;lum&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../02_flyvision_optic_flow_task_files/02_flyvision_optic_flow_task_28_0.png" /></p>
<h2 id="random-temporal-crops">Random temporal crops<a class="headerlink" href="#random-temporal-crops" title="Permanent link">&para;</a></h2>
<p>We train on 19 frames ~ 792ms movie. Most sequences have 49 frames. To use the whole temporal content, we stochastically sample start and end frame ~ ((1, 19), (2, 20), &hellip;, (31, 49)).</p>
<div class="highlight"><pre><span></span><code><span class="n">dataset</span> <span class="o">=</span> <span class="n">MultiTaskSintel</span><span class="p">(</span>
    <span class="n">tasks</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;flow&quot;</span><span class="p">],</span>
    <span class="n">boxfilter</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">13</span><span class="p">),</span>
    <span class="n">vertical_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">n_frames</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">24</span><span class="p">,</span>
    <span class="n">augment</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">random_temporal_crop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">all_frames</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">resampling</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">interpolate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">p_flip</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">p_rot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">contrast_std</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">brightness_std</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">gaussian_white_noise</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[2024-12-08 19:31:14] sintel_utils:331 Found Sintel at ../flyvis/data/SintelDataSet
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># These two samples from the same original sequence should have stochastically different start and end frames.</span>
<span class="n">lum1</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;lum&#39;</span><span class="p">]</span>
<span class="n">lum2</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;lum&#39;</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">animation</span> <span class="o">=</span> <span class="n">SintelSample</span><span class="p">(</span><span class="n">lum1</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">lum2</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">title2</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">)</span>
<span class="n">animation</span><span class="o">.</span><span class="n">animate_in_notebook</span><span class="p">()</span>
</code></pre></div>
<p><img alt="png" src="../02_flyvision_optic_flow_task_files/02_flyvision_optic_flow_task_33_0.png" /></p>
<h2 id="flips-and-rotations">Flips and rotations<a class="headerlink" href="#flips-and-rotations" title="Permanent link">&para;</a></h2>
<p>Next, we flip stochastically across 2 axes and or rotate a random number of times around the center. We implement this to be fast to do so at runtime.</p>
<div class="highlight"><pre><span></span><code><span class="n">dataset</span> <span class="o">=</span> <span class="n">MultiTaskSintel</span><span class="p">(</span>
    <span class="n">tasks</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;flow&quot;</span><span class="p">],</span>
    <span class="n">boxfilter</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">13</span><span class="p">),</span>
    <span class="n">vertical_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">n_frames</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">24</span><span class="p">,</span>
    <span class="n">augment</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">random_temporal_crop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">all_frames</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">resampling</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">interpolate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">p_flip</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">p_rot</span><span class="o">=</span><span class="mi">5</span> <span class="o">/</span> <span class="mi">6</span><span class="p">,</span>
    <span class="n">contrast_std</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">brightness_std</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">gaussian_white_noise</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[2024-12-08 19:31:22] sintel_utils:331 Found Sintel at ../flyvis/data/SintelDataSet
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># These two samples from the same original sequence should have stochastically different orientation.</span>
<span class="n">lum1</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;lum&#39;</span><span class="p">]</span>
<span class="n">lum2</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;lum&#39;</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">animation</span> <span class="o">=</span> <span class="n">SintelSample</span><span class="p">(</span><span class="n">lum1</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">lum2</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">title2</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">)</span>
<span class="n">animation</span><span class="o">.</span><span class="n">animate_in_notebook</span><span class="p">()</span>
</code></pre></div>
<p><img alt="png" src="../02_flyvision_optic_flow_task_files/02_flyvision_optic_flow_task_38_0.png" /></p>
<p>Flow vectors need to be flipped and rotated accordingly.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># These two samples from the same original sequence should have stochastically different orientation.</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">lum1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;lum&#39;</span><span class="p">]</span>
<span class="n">flow1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;flow&#39;</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">animation</span> <span class="o">=</span> <span class="n">SintelSample</span><span class="p">(</span><span class="n">lum1</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">flow1</span><span class="p">[</span><span class="kc">None</span><span class="p">])</span>
<span class="n">animation</span><span class="o">.</span><span class="n">animate_in_notebook</span><span class="p">()</span>
</code></pre></div>
<p><img alt="png" src="../02_flyvision_optic_flow_task_files/02_flyvision_optic_flow_task_41_0.png" /></p>
<h2 id="further-augmentations">Further augmentations<a class="headerlink" href="#further-augmentations" title="Permanent link">&para;</a></h2>
<p>Besides that, we also augment the input with random contrasts and brightnesses and random gaussian pixel noise, while the motion stays the same. This pretends that the same motion takes place under different illumination conditions and signal to noise ratios.</p>
<div class="highlight"><pre><span></span><code><span class="n">dataset</span> <span class="o">=</span> <span class="n">MultiTaskSintel</span><span class="p">(</span>
    <span class="n">tasks</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;flow&quot;</span><span class="p">],</span>
    <span class="n">boxfilter</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">13</span><span class="p">),</span>
    <span class="n">vertical_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">n_frames</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">24</span><span class="p">,</span>
    <span class="n">augment</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">random_temporal_crop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">all_frames</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">resampling</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">interpolate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">p_flip</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">p_rot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">contrast_std</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">brightness_std</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">gaussian_white_noise</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[2024-12-08 19:31:35] sintel_utils:331 Found Sintel at ../flyvis/data/SintelDataSet
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># These two samples from the same original sequence have</span>
<span class="c1"># stochastically different contrast, brightness and pixel-wise noise.</span>
<span class="n">lum1</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;lum&#39;</span><span class="p">]</span>
<span class="n">lum2</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;lum&#39;</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">animation</span> <span class="o">=</span> <span class="n">SintelSample</span><span class="p">(</span><span class="n">lum1</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">lum2</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">title2</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">)</span>
<span class="n">animation</span><span class="o">.</span><span class="n">animate_in_notebook</span><span class="p">()</span>
</code></pre></div>
<p><img alt="png" src="../02_flyvision_optic_flow_task_files/02_flyvision_optic_flow_task_46_0.png" /></p>
<h1 id="framerate-of-the-dataset-and-integration-time-step">Framerate of the dataset and integration time step<a class="headerlink" href="#framerate-of-the-dataset-and-integration-time-step" title="Permanent link">&para;</a></h1>
<p>The Sintel dataset is originally rendered at 24 frames per second, i.e., one frame every 42ms. The fruit fly neurons are able to respond to temporal differences as fast as 5-20ms. Therefore, we resample every frame multiple times to pretend that the movie was originally sampled at such a faster framerate. For the motion fields, we interpolate flow vectors in time instead of resampling them, which hopefully gives a better learning signal to the network. We have to trade-off speed of the numerical integration and memory consumption during optimization with the simulation accuracy by choosing time steps between 5-20ms. We chose to train networks at the upper bount of 20ms and evaluate them more accurately at 5-10ms.</p>
<div class="highlight"><pre><span></span><code><span class="n">dataset</span> <span class="o">=</span> <span class="n">MultiTaskSintel</span><span class="p">(</span>
    <span class="n">tasks</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;flow&quot;</span><span class="p">],</span>
    <span class="n">boxfilter</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">13</span><span class="p">),</span>
    <span class="n">vertical_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">n_frames</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">augment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">resampling</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">interpolate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[2024-12-08 19:31:42] sintel_utils:331 Found Sintel at ../flyvis/data/SintelDataSet
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># Now, every input frame appears twice and target frames are interpolated.</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">lum1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;lum&#39;</span><span class="p">]</span>
<span class="n">flow1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;flow&#39;</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">animation</span> <span class="o">=</span> <span class="n">SintelSample</span><span class="p">(</span><span class="n">lum1</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">flow1</span><span class="p">[</span><span class="kc">None</span><span class="p">])</span>
<span class="n">animation</span><span class="o">.</span><span class="n">animate_in_notebook</span><span class="p">()</span>
</code></pre></div>
<p><img alt="png" src="../02_flyvision_optic_flow_task_files/02_flyvision_optic_flow_task_51_0.png" /></p>
<h1 id="computing-responses-to-the-sintel-data">Computing responses to the Sintel data<a class="headerlink" href="#computing-responses-to-the-sintel-data" title="Permanent link">&para;</a></h1>
<p>Before we get to training a network, we look at a few responses to these type of sequences of individual neurons.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvis.network</span> <span class="kn">import</span> <span class="n">NetworkView</span><span class="p">,</span> <span class="n">Network</span>
<span class="kn">from</span> <span class="nn">flyvis.utils.activity_utils</span> <span class="kn">import</span> <span class="n">LayerActivity</span>

<span class="kn">from</span> <span class="nn">flyvis.datasets.sintel</span> <span class="kn">import</span> <span class="n">MultiTaskSintel</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># new network instance</span>
<span class="n">network</span> <span class="o">=</span> <span class="n">Network</span><span class="p">()</span>

<span class="c1"># Alternative: uncomment to use a pretrained network</span>
<span class="c1"># network_view = NetworkView(results_dir / &quot;flow/0000/000&quot;)</span>
<span class="c1"># network = network_view.init_network(network)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[2024-12-08 19:31:59] network:222 Initialized network with NumberOfParams(free=734, fixed=2959) parameters.
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">layer_activity</span> <span class="o">=</span> <span class="n">LayerActivity</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">network</span><span class="o">.</span><span class="n">connectome</span><span class="p">,</span> <span class="n">keepref</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">dataset</span> <span class="o">=</span> <span class="n">MultiTaskSintel</span><span class="p">(</span>
    <span class="n">tasks</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;flow&quot;</span><span class="p">],</span>
    <span class="n">boxfilter</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">13</span><span class="p">),</span>
    <span class="n">vertical_splits</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">n_frames</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">augment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">resampling</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">interpolate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[2024-12-08 19:32:04] sintel_utils:331 Found Sintel at ../flyvis/data/SintelDataSet
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">stationary_state</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">fade_in_state</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;lum&quot;</span><span class="p">][[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">responses</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span>
    <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;lum&quot;</span><span class="p">][</span><span class="kc">None</span><span class="p">],</span> <span class="n">dataset</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="n">initial_state</span><span class="o">=</span><span class="n">stationary_state</span>
<span class="p">)</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">layer_activity</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">layer_activity</span><span class="o">.</span><span class="n">central</span><span class="o">.</span><span class="n">T4c</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dataset</span><span class="o">.</span><span class="n">dt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;time in s&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;voltage (a.u.)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;response of central T4c cell&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>Text(0.5, 1.0, &#39;response of central T4c cell&#39;)
</code></pre></div>

<p><img alt="png" src="../02_flyvision_optic_flow_task_files/02_flyvision_optic_flow_task_59_1.png" /></p>
<h1 id="decoding-the-task-from-neural-activity">Decoding the task from neural activity<a class="headerlink" href="#decoding-the-task-from-neural-activity" title="Permanent link">&para;</a></h1>
<p>We need to predict the pixel-accurate flow field that Sintel gives us. For that we decode the voltages of a bunch of cell types. The decoder and the network are trained end-to-end. Here an example of a forward pass through the whole pipeline in code.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvis.datasets.sintel</span> <span class="kn">import</span> <span class="n">MultiTaskSintel</span>
<span class="kn">from</span> <span class="nn">flyvis.task.decoder</span> <span class="kn">import</span> <span class="n">DecoderGAVP</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">network</span> <span class="o">=</span> <span class="n">Network</span><span class="p">()</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[2024-12-08 19:32:15] network:222 Initialized network with NumberOfParams(free=734, fixed=2959) parameters.
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">decoder</span> <span class="o">=</span> <span class="n">DecoderGAVP</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">connectome</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[2024-12-08 19:32:20] decoder:282 Initialized decoder with NumberOfParams(free=7427, fixed=0) parameters.
[2024-12-08 19:32:20] decoder:283 DecoderGAVP(
  (base): Sequential(
    (0): Conv2dHexSpace(34, 8, kernel_size=(5, 5), stride=(1, 1), padding=(2, 2))
    (1): BatchNorm2d(8, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (2): Softplus(beta=1, threshold=20)
    (3): Dropout(p=0.5, inplace=False)
  )
  (decoder): Sequential(
    (0): Conv2dHexSpace(8, 3, kernel_size=(5, 5), stride=(1, 1), padding=(2, 2))
  )
  (head): Sequential()
)
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">dataset</span> <span class="o">=</span> <span class="n">MultiTaskSintel</span><span class="p">(</span>
    <span class="n">tasks</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;flow&quot;</span><span class="p">],</span>
    <span class="n">boxfilter</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">13</span><span class="p">),</span>
    <span class="n">vertical_splits</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">all_frames</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">augment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">resampling</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">interpolate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[2024-12-08 19:32:20] sintel_utils:331 Found Sintel at ../flyvis/data/SintelDataSet
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">data</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">lum</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;lum&quot;</span><span class="p">]</span>
<span class="n">flow</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;flow&quot;</span><span class="p">]</span>

<span class="n">stationary_state</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">fade_in_state</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="n">lum</span><span class="p">[[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">responses</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">lum</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">dataset</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="n">initial_state</span><span class="o">=</span><span class="n">stationary_state</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">y_pred</span> <span class="o">=</span> <span class="n">decoder</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span>
</code></pre></div>
<p>We predict motion with an untrained decoder from an untrained network with randomly initialized parameters.
We do not expect this to work.</p>
<div class="highlight"><pre><span></span><code><span class="n">animation</span> <span class="o">=</span> <span class="n">SintelSample</span><span class="p">(</span><span class="n">lum</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">flow</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">prediction</span><span class="o">=</span><span class="n">y_pred</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">())</span>
<span class="n">animation</span><span class="o">.</span><span class="n">animate_in_notebook</span><span class="p">(</span><span class="n">frames</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])[::</span><span class="mi">10</span><span class="p">])</span>
</code></pre></div>
<p><img alt="png" src="../02_flyvision_optic_flow_task_files/02_flyvision_optic_flow_task_68_0.png" /></p>
<div class="highlight"><pre><span></span><code><span class="p">((</span><span class="n">y_pred</span> <span class="o">-</span> <span class="n">flow</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sqrt</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>tensor(0.9877, device=&#39;cuda:0&#39;, grad_fn=&lt;MeanBackward0&gt;)
</code></pre></div>

<h1 id="training-network-and-decoder-on-a-single-batch">Training network and decoder on a single batch<a class="headerlink" href="#training-network-and-decoder-on-a-single-batch" title="Permanent link">&para;</a></h1>
<p>We now train the network on a single batch to validate that the pipeline works. We do not expect these networks to generalize their function.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">tqdm.notebook</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">torch.optim</span> <span class="kn">import</span> <span class="n">Adam</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span>

<span class="kn">from</span> <span class="nn">flyvis.network</span> <span class="kn">import</span> <span class="n">Network</span>
<span class="kn">from</span> <span class="nn">flyvis.task.decoder</span> <span class="kn">import</span> <span class="n">DecoderGAVP</span>

<span class="kn">from</span> <span class="nn">flyvis.datasets.sintel</span> <span class="kn">import</span> <span class="n">MultiTaskSintel</span>
<span class="kn">from</span> <span class="nn">flyvis.task.objectives</span> <span class="kn">import</span> <span class="n">l2norm</span><span class="p">,</span> <span class="n">epe</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">network</span> <span class="o">=</span> <span class="n">Network</span><span class="p">()</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[2024-12-08 19:32:37] network:222 Initialized network with NumberOfParams(free=734, fixed=2959) parameters.
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">decoder</span> <span class="o">=</span> <span class="n">DecoderGAVP</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">connectome</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[2024-12-08 19:32:42] decoder:282 Initialized decoder with NumberOfParams(free=7427, fixed=0) parameters.
[2024-12-08 19:32:42] decoder:283 DecoderGAVP(
  (base): Sequential(
    (0): Conv2dHexSpace(34, 8, kernel_size=(5, 5), stride=(1, 1), padding=(2, 2))
    (1): BatchNorm2d(8, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (2): Softplus(beta=1, threshold=20)
    (3): Dropout(p=0.5, inplace=False)
  )
  (decoder): Sequential(
    (0): Conv2dHexSpace(8, 3, kernel_size=(5, 5), stride=(1, 1), padding=(2, 2))
  )
  (head): Sequential()
)
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">dataset</span> <span class="o">=</span> <span class="n">MultiTaskSintel</span><span class="p">(</span>
    <span class="n">tasks</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;flow&quot;</span><span class="p">],</span>
    <span class="n">boxfilter</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">13</span><span class="p">),</span>
    <span class="n">vertical_splits</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">n_frames</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">augment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">resampling</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">interpolate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[2024-12-08 19:32:42] sintel_utils:331 Found Sintel at ../flyvis/data/SintelDataSet
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">t_pre</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">50</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">train_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">optimizer</span> <span class="o">=</span> <span class="n">Adam</span><span class="p">((</span><span class="o">*</span><span class="n">network</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="o">*</span><span class="n">decoder</span><span class="o">.</span><span class="n">parameters</span><span class="p">()),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">batch</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">train_loader</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">loss_fn</span> <span class="o">=</span> <span class="n">epe</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">epochs</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">initial_state</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">steady_state</span><span class="p">(</span><span class="n">t_pre</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>

<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">)):</span>
    <span class="n">lum</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s2">&quot;lum&quot;</span><span class="p">]</span>
    <span class="n">flow</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s2">&quot;flow&quot;</span><span class="p">]</span>

    <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
    <span class="n">network</span><span class="o">.</span><span class="n">stimulus</span><span class="o">.</span><span class="n">zero</span><span class="p">()</span>
    <span class="n">network</span><span class="o">.</span><span class="n">stimulus</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="n">lum</span><span class="p">)</span>

    <span class="n">activity</span> <span class="o">=</span> <span class="n">network</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">stimulus</span><span class="p">(),</span> <span class="n">dt</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">50</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">initial_state</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">decoder</span><span class="p">(</span><span class="n">activity</span><span class="p">)</span>

    <span class="n">batch_error</span> <span class="o">=</span> <span class="n">loss_fn</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">flow</span><span class="p">)</span>
    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">batch_error</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
    <span class="n">batch_error</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
    <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">e</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Epoch </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">batch_error</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>  0%|          | 0/1000 [00:00&lt;?, ?it/s]


Epoch 0: 10.636537551879883
Epoch 10: 10.621147155761719
Epoch 20: 10.607827186584473
Epoch 30: 10.599922180175781
Epoch 40: 10.590510368347168
Epoch 50: 10.582784652709961
Epoch 60: 10.57673168182373
Epoch 70: 10.57288932800293
Epoch 80: 10.56686019897461
Epoch 90: 10.563536643981934
Epoch 100: 10.561113357543945
Epoch 110: 10.557619094848633
Epoch 120: 10.553178787231445
Epoch 130: 10.550191879272461
Epoch 140: 10.545988082885742
Epoch 150: 10.545486450195312
Epoch 160: 10.54134464263916
Epoch 170: 10.540717124938965
Epoch 180: 10.537071228027344
Epoch 190: 10.53472900390625
Epoch 200: 10.531929016113281
Epoch 210: 10.529220581054688
Epoch 220: 10.526920318603516
Epoch 230: 10.524316787719727
Epoch 240: 10.522162437438965
Epoch 250: 10.519787788391113
Epoch 260: 10.518158912658691
Epoch 270: 10.516519546508789
Epoch 280: 10.513129234313965
Epoch 290: 10.511229515075684
Epoch 300: 10.509740829467773
Epoch 310: 10.506508827209473
Epoch 320: 10.505179405212402
Epoch 330: 10.502842903137207
Epoch 340: 10.5007963180542
Epoch 350: 10.497834205627441
Epoch 360: 10.496322631835938
Epoch 370: 10.495060920715332
Epoch 380: 10.493014335632324
Epoch 390: 10.491446495056152
Epoch 400: 10.48892879486084
Epoch 410: 10.489540100097656
Epoch 420: 10.485395431518555
Epoch 430: 10.483999252319336
Epoch 440: 10.481637954711914
Epoch 450: 10.47884464263916
Epoch 460: 10.478631019592285
Epoch 470: 10.476183891296387
Epoch 480: 10.475756645202637
Epoch 490: 10.473572731018066
Epoch 500: 10.471808433532715
Epoch 510: 10.471207618713379
Epoch 520: 10.468792915344238
Epoch 530: 10.466946601867676
Epoch 540: 10.465457916259766
Epoch 550: 10.462742805480957
Epoch 560: 10.462434768676758
Epoch 570: 10.460104942321777
Epoch 580: 10.457630157470703
Epoch 590: 10.456503868103027
Epoch 600: 10.454134941101074
Epoch 610: 10.453128814697266
Epoch 620: 10.450531959533691
Epoch 630: 10.448619842529297
Epoch 640: 10.446551322937012
Epoch 650: 10.444059371948242
Epoch 660: 10.44367504119873
Epoch 670: 10.437813758850098
Epoch 680: 10.437586784362793
Epoch 690: 10.436905860900879
Epoch 700: 10.432501792907715
Epoch 710: 10.430790901184082
Epoch 720: 10.428460121154785
Epoch 730: 10.423649787902832
Epoch 740: 10.42512321472168
Epoch 750: 10.422974586486816
Epoch 760: 10.418354034423828
Epoch 770: 10.41611099243164
Epoch 780: 10.413171768188477
Epoch 790: 10.408281326293945
Epoch 800: 10.405777931213379
Epoch 810: 10.401845932006836
Epoch 820: 10.395087242126465
Epoch 830: 10.390754699707031
Epoch 840: 10.386748313903809
Epoch 850: 10.381792068481445
Epoch 860: 10.376413345336914
Epoch 870: 10.371747016906738
Epoch 880: 10.367315292358398
Epoch 890: 10.363433837890625
Epoch 900: 10.357799530029297
Epoch 910: 10.35655403137207
Epoch 920: 10.350890159606934
Epoch 930: 10.347064971923828
Epoch 940: 10.342965126037598
Epoch 950: 10.339473724365234
Epoch 960: 10.334851264953613
Epoch 970: 10.330768585205078
Epoch 980: 10.325502395629883
Epoch 990: 10.32119369506836
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[&lt;matplotlib.lines.Line2D at 0x7f0b0d0730a0&gt;]
</code></pre></div>

<p><img alt="png" src="../02_flyvision_optic_flow_task_files/02_flyvision_optic_flow_task_80_1.png" /></p>
<p>We expect that the prediction from this overfitted network on the sample it was trained on is ok.</p>
<div class="highlight"><pre><span></span><code><span class="n">data</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">lum</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;lum&quot;</span><span class="p">]</span>
<span class="n">flow</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;flow&quot;</span><span class="p">]</span>

<span class="n">stationary_state</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">fade_in_state</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="n">lum</span><span class="p">[[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">responses</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">lum</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">dataset</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="n">initial_state</span><span class="o">=</span><span class="n">stationary_state</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">y_pred</span> <span class="o">=</span> <span class="n">decoder</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">animation</span> <span class="o">=</span> <span class="n">SintelSample</span><span class="p">(</span><span class="n">lum</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">flow</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">prediction</span><span class="o">=</span><span class="n">y_pred</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">())</span>
<span class="n">animation</span><span class="o">.</span><span class="n">animate_in_notebook</span><span class="p">()</span>
</code></pre></div>
<p><img alt="png" src="../02_flyvision_optic_flow_task_files/02_flyvision_optic_flow_task_84_0.png" /></p>
<div class="highlight"><pre><span></span><code><span class="p">((</span><span class="n">y_pred</span> <span class="o">-</span> <span class="n">flow</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sqrt</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>tensor(0.7563, device=&#39;cuda:0&#39;, grad_fn=&lt;MeanBackward0&gt;)
</code></pre></div>

<h1 id="evaluating-trained-networks">Evaluating trained networks<a class="headerlink" href="#evaluating-trained-networks" title="Permanent link">&para;</a></h1>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvis</span> <span class="kn">import</span> <span class="n">results_dir</span>
<span class="kn">from</span> <span class="nn">flyvis.network</span> <span class="kn">import</span> <span class="n">NetworkView</span>
<span class="kn">from</span> <span class="nn">flyvis.utils.activity_utils</span> <span class="kn">import</span> <span class="n">LayerActivity</span>

<span class="kn">from</span> <span class="nn">flyvis.datasets.sintel</span> <span class="kn">import</span> <span class="n">MultiTaskSintel</span>
<span class="kn">from</span> <span class="nn">flyvis.task.decoder</span> <span class="kn">import</span> <span class="n">DecoderGAVP</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># we load the best task-performing model from the presorted ensemble</span>
<span class="n">network_view</span> <span class="o">=</span> <span class="n">NetworkView</span><span class="p">(</span><span class="n">results_dir</span> <span class="o">/</span> <span class="s2">&quot;flow/0000/000&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[2024-12-08 19:34:48] network_view:122 Initialized network view at ../flyvis/data/results/flow/0000/000
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">network</span> <span class="o">=</span> <span class="n">network_view</span><span class="o">.</span><span class="n">init_network</span><span class="p">()</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[2024-12-08 19:34:56] network:222 Initialized network with NumberOfParams(free=734, fixed=2959) parameters.
[2024-12-08 19:34:56] chkpt_utils:36 Recovered network state.
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">network_view</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">decoder</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>Namespace(
  flow = Namespace(
    type = &#39;DecoderGAVP&#39;,
    shape = [8, 2],
    kernel_size = 5,
    const_weight = 0.001,
    n_out_features = None,
    p_dropout = 0.5
  )
)
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">decoder</span> <span class="o">=</span> <span class="n">network_view</span><span class="o">.</span><span class="n">init_decoder</span><span class="p">()[</span><span class="s2">&quot;flow&quot;</span><span class="p">]</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[2024-12-08 19:35:01] decoder:282 Initialized decoder with NumberOfParams(free=7427, fixed=0) parameters.
[2024-12-08 19:35:01] decoder:283 DecoderGAVP(
  (base): Sequential(
    (0): Conv2dHexSpace(34, 8, kernel_size=(5, 5), stride=(1, 1), padding=(2, 2))
    (1): BatchNorm2d(8, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (2): Softplus(beta=1, threshold=20)
    (3): Dropout(p=0.5, inplace=False)
  )
  (decoder): Sequential(
    (0): Conv2dHexSpace(8, 3, kernel_size=(5, 5), stride=(1, 1), padding=(2, 2))
  )
  (head): Sequential()
)
[2024-12-08 19:35:01] chkpt_utils:65 Recovered flow decoder state.
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">dataset</span> <span class="o">=</span> <span class="n">MultiTaskSintel</span><span class="p">(</span>
    <span class="n">tasks</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;flow&quot;</span><span class="p">],</span>
    <span class="n">boxfilter</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">13</span><span class="p">),</span>
    <span class="n">vertical_splits</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">all_frames</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">n_frames</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">augment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">resampling</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">interpolate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[2024-12-08 19:35:01] sintel_utils:331 Found Sintel at ../flyvis/data/SintelDataSet
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">dataset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
<span class="n">lum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;lum&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">])</span>
<span class="n">flow</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;flow&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">])</span>

<span class="n">stationary_state</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">fade_in_state</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="n">lum</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">responses</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">lum</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="n">initial_state</span><span class="o">=</span><span class="n">stationary_state</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">y_pred</span> <span class="o">=</span> <span class="n">decoder</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span>
</code></pre></div>
<p>We expect this network to generalize across sequences. This network sees motion into all directions.</p>
<div class="highlight"><pre><span></span><code><span class="n">animation</span> <span class="o">=</span> <span class="n">SintelSample</span><span class="p">(</span><span class="n">lum</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">prediction</span><span class="o">=</span><span class="n">y_pred</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">())</span>
<span class="n">animation</span><span class="o">.</span><span class="n">animate_in_notebook</span><span class="p">()</span>
</code></pre></div>
<p><img alt="png" src="../02_flyvision_optic_flow_task_files/02_flyvision_optic_flow_task_96_0.png" /></p>
<p>We expect the accuracy is not as good as the overfitted example because this network generalized across the whole-dataset.</p>
<div class="highlight"><pre><span></span><code><span class="p">((</span><span class="n">y_pred</span> <span class="o">-</span> <span class="n">flow</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sqrt</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>tensor(6.4274, device=&#39;cuda:0&#39;, grad_fn=&lt;MeanBackward0&gt;)
</code></pre></div>

<h1 id="evaluating-ensembles">Evaluating ensembles<a class="headerlink" href="#evaluating-ensembles" title="Permanent link">&para;</a></h1>
<p>Last, we evaluated the task error of the 50 trained networks on a held out set of sequences. We evaluated the task error across all checkpoints during training and show the minimal one in the histrogram below. This checkpoint we analyse with respect to it&rsquo;s tuning predictions as shown in the next notebooks.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvis</span> <span class="kn">import</span> <span class="n">EnsembleView</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">ensemble</span> <span class="o">=</span> <span class="n">EnsembleView</span><span class="p">(</span><span class="s2">&quot;flow/0000&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>Loading ensemble:   0%|          | 0/50 [00:00&lt;?, ?it/s]


[2024-12-08 19:35:21] ensemble:166 Loaded 50 networks.
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">ensemble</span><span class="o">.</span><span class="n">task_error_histogram</span><span class="p">()</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>(&lt;Figure size 300x300 with 1 Axes&gt;,
 &lt;Axes: xlabel=&#39;task error&#39;, ylabel=&#39;number models&#39;&gt;)
</code></pre></div>

<p><img alt="png" src="../02_flyvision_optic_flow_task_files/02_flyvision_optic_flow_task_103_1.png" /></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
    
    <div class="md-footer-meta md-typeset">
        <div class="md-footer-meta__inner md-grid">
            <div class="md-copyright">
    
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
        Material for MkDocs
    </a>
    
    
    <div class="md-copyright__highlight">
        Lappalainen &copy 2024
    </div>
    
</div>
        </div>
    </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "navigation.instant", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.top"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>