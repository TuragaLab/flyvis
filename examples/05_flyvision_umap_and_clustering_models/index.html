
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://flyvis.github.io/examples/05_flyvision_umap_and_clustering_models/">
      
      
        <link rel="prev" href="../04_flyvision_moving_edge_responses/">
      
      
        <link rel="next" href="../06_flyvision_maximally_excitatory_stimuli/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.38">
    
    
      
        <title>Ensemble Clustering - Flyvis Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8c3ca2c6.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cluster-analysis-based-on-naturalistic-stimuli-responses" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      



<header class="md-header md-header--shadow" data-md-component="header">
    <nav class="md-header__inner md-grid" aria-label="Header">
        <a href="../.." title="Flyvis Documentation"
            class="md-header__button md-logo" aria-label="Flyvis Documentation" data-md-component="logo">
            
<img id="flyvis-logo-light" src="../../images/flyvis_logo_light@150ppi.webp" alt="logo">
<img id="flyvis-logo-dark" src="../../images/flyvis_logo_dark@150ppi.webp" alt="logo">

        </a>
        <label class="md-header__button md-icon" for="__drawer">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
        </label>
        <div class="md-header__title" data-md-component="header-title">
            <div class="md-header__ellipsis">
                <div class="md-header__topic">
                    <span class="md-ellipsis">
                    </span>
                </div>
                <div class="md-header__topic" data-md-component="header-topic">
                    <span class="md-ellipsis">
                    </span>
                </div>
            </div>
        </div>
        
        
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="purple"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
        
        
        
        <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
        
        
        
        <label class="md-header__button md-icon" for="__search">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
        
        <div class="md-header__source">
            <a href="https://github.com/turagalab/flyvis" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
        </div>
        
    </nav>
    
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Flyvis Documentation"
      class="md-nav__button md-logo" aria-label="Flyvis Documentation" data-md-component="logo">
      
<img id="flyvis-logo-light" src="../../images/flyvis_logo_light@150ppi.webp" alt="logo">
<img id="flyvis-logo-dark" src="../../images/flyvis_logo_dark@150ppi.webp" alt="logo">

    </a>
    <div class="md-nav__social">
      <div class="md-social">
  
    
    
    
    
    <a href="mailto:janne.lappalainen@uni-tuebingen.de?cc=jakob.macke@uni-tuebingen.de,turagas@janelia.hhmi.org" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l217.6 163.2c11.4 8.5 27 8.5 38.4 0l217.6-163.2c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 176v208c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V176L294.4 339.2a63.9 63.9 0 0 1-76.8 0z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/turagalab/flyvis" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.nature.com/articles/s41586-024-07939-3" target="_blank" rel="noopener" title="www.nature.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M96 96c0-35.3 28.7-64 64-64h288c35.3 0 64 28.7 64 64v320c0 35.3-28.7 64-64 64H80c-44.2 0-80-35.8-80-80V128c0-17.7 14.3-32 32-32s32 14.3 32 32v272c0 8.8 7.2 16 16 16s16-7.2 16-16zm64 24v80c0 13.3 10.7 24 24 24h112c13.3 0 24-10.7 24-24v-80c0-13.3-10.7-24-24-24H184c-13.3 0-24 10.7-24 24m208-8c0 8.8 7.2 16 16 16h48c8.8 0 16-7.2 16-16s-7.2-16-16-16h-48c-8.8 0-16 7.2-16 16m0 96c0 8.8 7.2 16 16 16h48c8.8 0 16-7.2 16-16s-7.2-16-16-16h-48c-8.8 0-16 7.2-16 16m-208 96c0 8.8 7.2 16 16 16h256c8.8 0 16-7.2 16-16s-7.2-16-16-16H176c-8.8 0-16 7.2-16 16m0 96c0 8.8 7.2 16 16 16h256c8.8 0 16-7.2 16-16s-7.2-16-16-16H176c-8.8 0-16 7.2-16 16"/></svg>
    </a>
  
</div>
    </div>
    Flyvis Documentation
  </label>
  
  <div class="md-nav__source">
    <a href="https://github.com/turagalab/flyvis" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
  </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
    
    
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
    
    
  
  
  
  
    <li class="md-nav__item">
      <a href="../../install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

    
    
    
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Command Line Interface
  </span>
  

      </a>
    </li>
  

    
    
    
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_flyvision_connectome/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Explore the Connectome
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02_flyvision_optic_flow_task/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Train the Network
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03_flyvision_flash_responses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flash Responses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04_flyvision_moving_edge_responses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Moving Edge Responses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Ensemble Clustering
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06_flyvision_maximally_excitatory_stimuli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Maximally Excitatory Stimuli
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07_flyvision_providing_custom_stimuli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom Stimuli
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
    
    
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Main Results
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Main Results
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../figure_01_fly_visual_system/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Figure 1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../figure_02_simple_stimuli_responses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Figure 2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../figure_03_naturalistic_stimuli_responses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Figure 3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../figure_04_mechanisms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Figure 4
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
    
    
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/connectome/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Connectomes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/network/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Network
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/network_view/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NetworkView
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/ensemble_view/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EnsembleView
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/sintel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sintel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/tasks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Task
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/decoder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Decoder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/solver/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Training
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flash_responses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flash Responses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/moving_stimulus_responses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Moving Stimulus Responses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/ensemble_clustering/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ensemble Clustering
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/optimal_stimuli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Optimal Stimuli
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_13" >
        
          
          <label class="md-nav__link" for="__nav_6_13" id="__nav_6_13_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Miscelleanous
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_13">
            <span class="md-nav__icon md-icon"></span>
            Miscelleanous
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/rendering/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rendering
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/augmentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hex Augmentations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/datasets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Datasets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Utils
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/visualization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visualizations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/animations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Animations
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_14" >
        
          
          <label class="md-nav__link" for="__nav_6_14" id="__nav_6_14_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CLI Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_14">
            <span class="md-nav__icon md-icon"></span>
            CLI Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Command Line Interface
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/flyvis_cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CLI Entry Point
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/hydra_default_config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hydra Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_14_4" >
        
          
          <label class="md-nav__link" for="__nav_6_14_4" id="__nav_6_14_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Training
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_14_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_14_4">
            <span class="md-nav__icon md-icon"></span>
            Training
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/training/train_single/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run Training for Single Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/training/train/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch Ensemble Training on Compute Cloud
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_14_5" >
        
          
          <label class="md-nav__link" for="__nav_6_14_5" id="__nav_6_14_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Validation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_14_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_14_5">
            <span class="md-nav__icon md-icon"></span>
            Validation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/validation/val_single/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run Validation for Single Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/validation/validate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch Ensemble Validation on Compute Cloud
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_14_6" >
        
          
          <label class="md-nav__link" for="__nav_6_14_6" id="__nav_6_14_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Analysis
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_14_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_14_6">
            <span class="md-nav__icon md-icon"></span>
            Analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/analysis/synthetic_recordings_single/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run Synthetic Recordings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/analysis/record/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch Synthetic Recordings on Compute Cloud
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/analysis/ensemble_analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run Ensemble Analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/analysis/analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch Ensemble Analysis on Compute Cloud
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_14_7" >
        
          
          <label class="md-nav__link" for="__nav_6_14_7" id="__nav_6_14_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Notebook
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_14_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_14_7">
            <span class="md-nav__icon md-icon"></span>
            Notebook
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/analysis/notebook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run Notebook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/analysis/notebook_per_ensemble/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch Notebook Per Ensemble on Compute Cloud
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/analysis/notebook_per_model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch Notebook Per Model on Compute Cloud
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/flyvis_cli/download_pretrained_models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Download
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
    
    
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contribute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

    
    
    
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ
  </span>
  

      </a>
    </li>
  

    
    
    
  
  
  
  
    <li class="md-nav__item">
      <a href="../../acknowledgements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Acknowledgements
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="cluster-analysis-based-on-naturalistic-stimuli-responses">Cluster analysis based on naturalistic stimuli responses<a class="headerlink" href="#cluster-analysis-based-on-naturalistic-stimuli-responses" title="Permanent link">&para;</a></h1>
<p>This notebook illustrates how to cluster the models of an ensemble after nonlinear dimensionality reduction on their predicted responses to naturalistic stimuli. This can be done for any cell type. Here we provide a detailed example focusing on clustering based on T4c responses.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># basic imports</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">torch</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span>
</code></pre></div>
<h1 id="naturalistic-stimuli-dataset-sintel">Naturalistic stimuli dataset (Sintel)<a class="headerlink" href="#naturalistic-stimuli-dataset-sintel" title="Permanent link">&para;</a></h1>
<p>We load the dataset with our custom augmentations. The dataset contains movie sequences from the publicly available computer-animated movie Sintel rendered to the hexagonal lattice structure of the fly eye. For a more detailed introduction to the dataset class and parameters see the notebook on the optic flow task.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">flyvision</span>
<span class="kn">from</span> <span class="nn">flyvision.datasets.sintel</span> <span class="kn">import</span> <span class="n">AugmentedSintel</span>
<span class="kn">from</span> <span class="nn">flyvision.analysis.animations</span> <span class="kn">import</span> <span class="n">HexScatter</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">100</span>  <span class="c1"># can be changed for other temporal resolutions</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">AugmentedSintel</span><span class="p">(</span>
    <span class="n">tasks</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;lum&quot;</span><span class="p">],</span>
    <span class="n">interpolate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">boxfilter</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;extent&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="s1">&#39;kernel_size&#39;</span><span class="p">:</span> <span class="mi">13</span><span class="p">},</span>
    <span class="n">temporal_split</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># view stimulus parameters</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">arg_df</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>original_index</th>
      <th>vertical_split_index</th>
      <th>temporal_split_index</th>
      <th>frames</th>
      <th>flip_ax</th>
      <th>n_rot</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>sequence_00_alley_1_split_00</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>19</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>sequence_00_alley_1_split_00</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>19</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>sequence_00_alley_1_split_00</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>19</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>sequence_00_alley_1_split_00</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>19</td>
      <td>0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>sequence_00_alley_1_split_00</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>19</td>
      <td>0</td>
      <td>4</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2263</th>
      <td>sequence_22_temple_3_split_02</td>
      <td>22</td>
      <td>68</td>
      <td>188</td>
      <td>19</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2264</th>
      <td>sequence_22_temple_3_split_02</td>
      <td>22</td>
      <td>68</td>
      <td>188</td>
      <td>19</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2265</th>
      <td>sequence_22_temple_3_split_02</td>
      <td>22</td>
      <td>68</td>
      <td>188</td>
      <td>19</td>
      <td>1</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2266</th>
      <td>sequence_22_temple_3_split_02</td>
      <td>22</td>
      <td>68</td>
      <td>188</td>
      <td>19</td>
      <td>1</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2267</th>
      <td>sequence_22_temple_3_split_02</td>
      <td>22</td>
      <td>68</td>
      <td>188</td>
      <td>19</td>
      <td>1</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
<p>2268 rows Ã— 7 columns</p>
</div>

<div class="highlight"><pre><span></span><code><span class="n">sequence</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;lum&quot;</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># one sequence contains 80 frames with 721 hexals each</span>
<span class="n">sequence</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>torch.Size([80, 1, 721])
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">animation</span> <span class="o">=</span> <span class="n">HexScatter</span><span class="p">(</span><span class="n">sequence</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">animation</span><span class="o">.</span><span class="n">animate_in_notebook</span><span class="p">(</span><span class="n">frames</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
</code></pre></div>
<p><img alt="png" src="../05_flyvision_umap_and_clustering_models_files/05_flyvision_umap_and_clustering_models_9_0.png" /></p>
<h1 id="ensemble-responses-to-naturalistic-sequences">Ensemble responses to naturalistic sequences<a class="headerlink" href="#ensemble-responses-to-naturalistic-sequences" title="Permanent link">&para;</a></h1>
<p>We compute the responses of all models in the stored ensemble to the augmented Sintel dataset.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># We load the ensemble trained on the optic flow task</span>
<span class="n">ensemble</span> <span class="o">=</span> <span class="n">flyvision</span><span class="o">.</span><span class="n">EnsembleView</span><span class="p">(</span><span class="s2">&quot;flow/0000&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>Loading ensemble:   0%|          | 0/50 [00:00&lt;?, ?it/s]


[2024-10-14 21:02:31] ensemble:166 Loaded 50 networks.
</code></pre></div>

<p>We use <code>ensemble.naturalistic_stimuli_responses</code> to return responses of all networks within the ensemble.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># alternatively, specify indices of sequences to load</span>
<span class="c1"># stims_and_resps = ensemble.naturalistic_stimuli_responses(indices=np.arange(5))</span>
<span class="c1"># or load all sequences</span>
<span class="n">stims_and_resps</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">naturalistic_stimuli_responses</span><span class="p">()</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[2024-10-14 21:02:41] network:222 Initialized network with NumberOfParams(free=734, fixed=2959) parameters.
[2024-10-14 21:02:41] chkpt_utils:35 Recovered network state.
[2024-10-14 21:02:46] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 21:06:00] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/007/__cache__/flyvision/analysis/stimulus_responses/compute_responses/62f12e60e448f187eb7c3c597ad40084/output.h5
[2024-10-14 21:06:07] chkpt_utils:35 Recovered network state.
[2024-10-14 21:06:11] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 21:09:23] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/008/__cache__/flyvision/analysis/stimulus_responses/compute_responses/57f443b19940e708cd13ea4c8c285770/output.h5
[2024-10-14 21:09:29] chkpt_utils:35 Recovered network state.
[2024-10-14 21:09:34] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 21:12:50] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/009/__cache__/flyvision/analysis/stimulus_responses/compute_responses/8c63fb5782e9c87881de4ef9f68a9794/output.h5
[2024-10-14 21:12:56] chkpt_utils:35 Recovered network state.
[2024-10-14 21:13:00] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 21:16:16] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/010/__cache__/flyvision/analysis/stimulus_responses/compute_responses/b70bd43513f96a8ca2149b4b707cf55b/output.h5
[2024-10-14 21:16:22] chkpt_utils:35 Recovered network state.
[2024-10-14 21:16:27] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 21:19:43] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/011/__cache__/flyvision/analysis/stimulus_responses/compute_responses/0a2bc829a7f7a299dd597db764831509/output.h5
[2024-10-14 21:19:49] chkpt_utils:35 Recovered network state.
[2024-10-14 21:19:53] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 21:23:09] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/012/__cache__/flyvision/analysis/stimulus_responses/compute_responses/89d8b0766a56e2e8c9ab4019b752b186/output.h5
[2024-10-14 21:23:15] chkpt_utils:35 Recovered network state.
[2024-10-14 21:23:19] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 21:26:32] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/013/__cache__/flyvision/analysis/stimulus_responses/compute_responses/8e4ab5f546dddc67d4e5d818a5ce98fb/output.h5
[2024-10-14 21:26:38] chkpt_utils:35 Recovered network state.
[2024-10-14 21:26:43] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 21:29:55] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/014/__cache__/flyvision/analysis/stimulus_responses/compute_responses/ec463cad10d3570261974dd49b2f39b4/output.h5
[2024-10-14 21:30:01] chkpt_utils:35 Recovered network state.
[2024-10-14 21:30:06] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 21:33:19] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/015/__cache__/flyvision/analysis/stimulus_responses/compute_responses/9f12efdac08bb4ec43d6cfa2b410cb84/output.h5
[2024-10-14 21:33:25] chkpt_utils:35 Recovered network state.
[2024-10-14 21:33:29] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 21:36:42] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/016/__cache__/flyvision/analysis/stimulus_responses/compute_responses/b766af72495270e849c173fe33059a52/output.h5
[2024-10-14 21:36:48] chkpt_utils:35 Recovered network state.
[2024-10-14 21:36:52] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 21:40:05] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/017/__cache__/flyvision/analysis/stimulus_responses/compute_responses/547d8627bc643f80104e95aa70946f87/output.h5
[2024-10-14 21:40:11] chkpt_utils:35 Recovered network state.
[2024-10-14 21:40:16] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 21:43:29] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/018/__cache__/flyvision/analysis/stimulus_responses/compute_responses/e8623ea69603f974a7b3b8d5eadb3673/output.h5
[2024-10-14 21:43:35] chkpt_utils:35 Recovered network state.
[2024-10-14 21:43:39] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 21:46:51] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/019/__cache__/flyvision/analysis/stimulus_responses/compute_responses/25481e4909d43c99cf38eadd2587310e/output.h5
[2024-10-14 21:46:57] chkpt_utils:35 Recovered network state.
[2024-10-14 21:47:02] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 21:50:15] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/020/__cache__/flyvision/analysis/stimulus_responses/compute_responses/fbfc463c7bc43fd02c29dd9d621674ac/output.h5
[2024-10-14 21:50:21] chkpt_utils:35 Recovered network state.
[2024-10-14 21:50:25] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 21:53:39] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/021/__cache__/flyvision/analysis/stimulus_responses/compute_responses/47879cefa1cb64fad137fa3abcef9f72/output.h5
[2024-10-14 21:53:45] chkpt_utils:35 Recovered network state.
[2024-10-14 21:53:49] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 21:57:01] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/022/__cache__/flyvision/analysis/stimulus_responses/compute_responses/a95a2b7ddef91af37031848d7003b1f3/output.h5
[2024-10-14 21:57:08] chkpt_utils:35 Recovered network state.
[2024-10-14 21:57:12] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 22:00:25] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/023/__cache__/flyvision/analysis/stimulus_responses/compute_responses/48f1e15295ea1bd1ecd10d16406b2290/output.h5
[2024-10-14 22:00:31] chkpt_utils:35 Recovered network state.
[2024-10-14 22:00:36] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 22:03:48] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/024/__cache__/flyvision/analysis/stimulus_responses/compute_responses/6174edb2564849ef913daa0a8b68b9ec/output.h5
[2024-10-14 22:03:54] chkpt_utils:35 Recovered network state.
[2024-10-14 22:03:58] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 22:07:11] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/025/__cache__/flyvision/analysis/stimulus_responses/compute_responses/dc7c7535c7861e19b3ecab2cf7122136/output.h5
[2024-10-14 22:07:17] chkpt_utils:35 Recovered network state.
[2024-10-14 22:07:22] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 22:10:36] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/026/__cache__/flyvision/analysis/stimulus_responses/compute_responses/0f442e5e698f56a7df6a03ed8f7000a9/output.h5
[2024-10-14 22:10:42] chkpt_utils:35 Recovered network state.
[2024-10-14 22:10:46] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 22:14:00] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/027/__cache__/flyvision/analysis/stimulus_responses/compute_responses/cca57252f75a3f13eb6d01f1bf8d47c7/output.h5
[2024-10-14 22:14:06] chkpt_utils:35 Recovered network state.
[2024-10-14 22:14:11] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 22:17:24] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/028/__cache__/flyvision/analysis/stimulus_responses/compute_responses/438a5c4c26cf00e96e592fa3b05b8d46/output.h5
[2024-10-14 22:17:30] chkpt_utils:35 Recovered network state.
[2024-10-14 22:17:35] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 22:20:48] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/029/__cache__/flyvision/analysis/stimulus_responses/compute_responses/04c9bf7d4e1e29bd6c0e192faa3be95e/output.h5
[2024-10-14 22:20:54] chkpt_utils:35 Recovered network state.
[2024-10-14 22:20:58] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 22:24:12] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/030/__cache__/flyvision/analysis/stimulus_responses/compute_responses/f8ad0bbdc84d745bd24435f409659e18/output.h5
[2024-10-14 22:24:18] chkpt_utils:35 Recovered network state.
[2024-10-14 22:24:24] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 22:27:38] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/031/__cache__/flyvision/analysis/stimulus_responses/compute_responses/feb22aa77c3a671a7742cd26d19729b5/output.h5
[2024-10-14 22:27:44] chkpt_utils:35 Recovered network state.
[2024-10-14 22:27:48] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 22:31:02] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/032/__cache__/flyvision/analysis/stimulus_responses/compute_responses/3b7c08a1383d3077532a4435c16e9132/output.h5
[2024-10-14 22:31:08] chkpt_utils:35 Recovered network state.
[2024-10-14 22:31:12] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 22:34:26] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/033/__cache__/flyvision/analysis/stimulus_responses/compute_responses/3e014da9460072b9e468d5d4db901c36/output.h5
[2024-10-14 22:34:32] chkpt_utils:35 Recovered network state.
[2024-10-14 22:34:36] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 22:37:49] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/034/__cache__/flyvision/analysis/stimulus_responses/compute_responses/2f053e975330c272ea7e10e3f096a66f/output.h5
[2024-10-14 22:37:55] chkpt_utils:35 Recovered network state.
[2024-10-14 22:38:00] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 22:41:12] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/035/__cache__/flyvision/analysis/stimulus_responses/compute_responses/ff0bbe4777ee636da504d0c4edfd5846/output.h5
[2024-10-14 22:41:19] chkpt_utils:35 Recovered network state.
[2024-10-14 22:41:23] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 22:44:35] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/036/__cache__/flyvision/analysis/stimulus_responses/compute_responses/a8e6ccb3a83d8ea15533bd088bd59ef2/output.h5
[2024-10-14 22:44:41] chkpt_utils:35 Recovered network state.
[2024-10-14 22:44:46] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 22:47:59] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/037/__cache__/flyvision/analysis/stimulus_responses/compute_responses/e7a08d9c9dc1504228836eb499c33fb1/output.h5
[2024-10-14 22:48:05] chkpt_utils:35 Recovered network state.
[2024-10-14 22:48:09] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 22:51:22] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/038/__cache__/flyvision/analysis/stimulus_responses/compute_responses/1ff54cbc099f81f052a5661fc26d000a/output.h5
[2024-10-14 22:51:28] chkpt_utils:35 Recovered network state.
[2024-10-14 22:51:32] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 22:54:46] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/039/__cache__/flyvision/analysis/stimulus_responses/compute_responses/50bc9a814ddfb1fd6f4ccb5a8093534d/output.h5
[2024-10-14 22:54:52] chkpt_utils:35 Recovered network state.
[2024-10-14 22:54:56] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 22:58:10] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/040/__cache__/flyvision/analysis/stimulus_responses/compute_responses/ac5a53daa316bd164892a45b48fbcbf3/output.h5
[2024-10-14 22:58:16] chkpt_utils:35 Recovered network state.
[2024-10-14 22:58:21] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 23:01:33] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/041/__cache__/flyvision/analysis/stimulus_responses/compute_responses/dea4830713214750326ad2c0f74f43b4/output.h5
[2024-10-14 23:01:39] chkpt_utils:35 Recovered network state.
[2024-10-14 23:01:44] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 23:04:57] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/042/__cache__/flyvision/analysis/stimulus_responses/compute_responses/28f107cb005216c0c70c85156602badb/output.h5
[2024-10-14 23:05:03] chkpt_utils:35 Recovered network state.
[2024-10-14 23:05:07] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 23:08:24] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/043/__cache__/flyvision/analysis/stimulus_responses/compute_responses/9a536865e85de3f3bf6c7c0f51c48a68/output.h5
[2024-10-14 23:08:30] chkpt_utils:35 Recovered network state.
[2024-10-14 23:08:35] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 23:11:47] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/044/__cache__/flyvision/analysis/stimulus_responses/compute_responses/9dadf5ce41ea13977a03bf250f47182a/output.h5
[2024-10-14 23:11:53] chkpt_utils:35 Recovered network state.
[2024-10-14 23:11:58] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 23:15:12] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/045/__cache__/flyvision/analysis/stimulus_responses/compute_responses/7c5005bd1893429e6cf5fbd05351bd85/output.h5
[2024-10-14 23:15:18] chkpt_utils:35 Recovered network state.
[2024-10-14 23:15:22] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 23:18:37] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/046/__cache__/flyvision/analysis/stimulus_responses/compute_responses/cf1f47a50bfb0f93400c60652dd8a353/output.h5
[2024-10-14 23:18:43] chkpt_utils:35 Recovered network state.
[2024-10-14 23:18:48] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 23:22:01] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/047/__cache__/flyvision/analysis/stimulus_responses/compute_responses/babe9286fd9940a1d8f3910e35d166cb/output.h5
[2024-10-14 23:22:07] chkpt_utils:35 Recovered network state.
[2024-10-14 23:22:12] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 23:25:24] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/048/__cache__/flyvision/analysis/stimulus_responses/compute_responses/e2331bf2e28ee218ea340438d3b3e966/output.h5
[2024-10-14 23:25:30] chkpt_utils:35 Recovered network state.
[2024-10-14 23:25:35] network:757 Computing 2268 stimulus responses.



Batch:   0%|          | 0/567 [00:00&lt;?, ?it/s]


[2024-10-14 23:28:47] xarray_joblib_backend:54 Store item /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/049/__cache__/flyvision/analysis/stimulus_responses/compute_responses/2a0503ab856cbb6d9206e77684949b55/output.h5
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># recommended to only run with precomputed responses using the record script</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">responses_norm</span><span class="p">()</span>
<span class="n">responses</span> <span class="o">=</span> <span class="n">stims_and_resps</span><span class="p">[</span><span class="s2">&quot;responses&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">norm</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">responses</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cell_type</span><span class="o">=</span><span class="s2">&quot;T4c&quot;</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">plot_traces</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:blue&quot;</span><span class="p">,</span> <span class="n">add_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;T4c responses to naturalistic stimuli&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>Text(0.5, 1.0, &#39;T4c responses to naturalistic stimuli&#39;)
</code></pre></div>

<p><img alt="png" src="../05_flyvision_umap_and_clustering_models_files/05_flyvision_umap_and_clustering_models_15_1.png" /></p>
<p>We see that the across models of the ensemble the predictions for T4c vary. Our goal is to understand the underlying structure in those variations.</p>
<h2 id="nonlinear-dimensionality-reduction-umap-and-gaussian-mixtures">Nonlinear dimensionality reduction (UMAP) and Gaussian Mixtures<a class="headerlink" href="#nonlinear-dimensionality-reduction-umap-and-gaussian-mixtures" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvision.analysis.clustering</span> <span class="kn">import</span> <span class="n">EnsembleEmbedding</span><span class="p">,</span> <span class="n">get_cluster_to_indices</span>
<span class="kn">from</span> <span class="nn">flyvision.utils.activity_utils</span> <span class="kn">import</span> <span class="n">CentralActivity</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># specify parameters for umap embedding</span>

<span class="n">embedding_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;min_dist&quot;</span><span class="p">:</span> <span class="mf">0.105</span><span class="p">,</span>
    <span class="s2">&quot;spread&quot;</span><span class="p">:</span> <span class="mf">9.0</span><span class="p">,</span>
    <span class="s2">&quot;n_neighbors&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;random_state&quot;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
    <span class="s2">&quot;n_epochs&quot;</span><span class="p">:</span> <span class="mi">1500</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
<p>We compute the UMAP embedding of the ensemble based on the T4c responses of the single models to the single sequence for illustration.</p>
<div class="highlight"><pre><span></span><code><span class="n">central_responses</span> <span class="o">=</span> <span class="n">CentralActivity</span><span class="p">(</span><span class="n">responses</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">connectome</span><span class="o">=</span><span class="n">ensemble</span><span class="o">.</span><span class="n">connectome</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">embedding</span> <span class="o">=</span> <span class="n">EnsembleEmbedding</span><span class="p">(</span><span class="n">central_responses</span><span class="p">)</span>
<span class="n">t4c_embedding</span> <span class="o">=</span> <span class="n">embedding</span><span class="p">(</span><span class="s2">&quot;T4c&quot;</span><span class="p">,</span> <span class="n">embedding_kwargs</span><span class="o">=</span><span class="n">embedding_kwargs</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[2024-10-14 23:29:06] clustering:482 reshaped X from (50, 2268, 80) to (50, 181440)
/home/lappalainenj@hhmi.org/miniconda3/envs/flyvision/lib/python3.9/site-packages/umap/umap_.py:1356: RuntimeWarning: divide by zero encountered in power
  return 1.0 / (1.0 + a * x ** (2 * b))
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">task_error</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">task_error</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">embeddingplot</span> <span class="o">=</span> <span class="n">t4c_embedding</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">colors</span><span class="o">=</span><span class="n">task_error</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../05_flyvision_umap_and_clustering_models_files/05_flyvision_umap_and_clustering_models_24_0.png" /></p>
<p>Each of these scatterpoints in 2d represents a single time series plotted above.</p>
<p>We fit a Gaussian Mixture of 2 to 5 components to this embedding to label the clusters. We select the final number of Gaussian Mixture components that minimize the Bayesian Information Criterion (BIC).</p>
<div class="highlight"><pre><span></span><code><span class="c1"># specifiy parameters for Gaussian Mixture</span>

<span class="n">gm_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;range_n_clusters&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
    <span class="s2">&quot;n_init&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s2">&quot;max_iter&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="s2">&quot;random_state&quot;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
    <span class="s2">&quot;tol&quot;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">gm_clustering</span> <span class="o">=</span> <span class="n">t4c_embedding</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">gaussian_mixture</span><span class="p">(</span><span class="o">**</span><span class="n">gm_kwargs</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">embeddingplot</span> <span class="o">=</span> <span class="n">gm_clustering</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">task_error</span><span class="o">=</span><span class="n">task_error</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">task_error</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../05_flyvision_umap_and_clustering_models_files/05_flyvision_umap_and_clustering_models_28_0.png" /></p>
<p>We can use the labels to disambiguate the time series data that we plotted above. We expect that these labels aggregate similar time series together and different time series separately.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">mcolors</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">cluster_to_indices</span> <span class="o">=</span> <span class="n">get_cluster_to_indices</span><span class="p">(</span>
    <span class="n">embeddingplot</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">embedding</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span>
    <span class="n">embeddingplot</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span>
    <span class="n">ensemble</span><span class="o">.</span><span class="n">task_error</span><span class="p">(),</span>
<span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cluster_to_indices</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">color</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mcolors</span><span class="o">.</span><span class="n">TABLEAU_COLORS</span><span class="o">.</span><span class="n">values</span><span class="p">())}</span>
<span class="k">for</span> <span class="n">cluster_id</span><span class="p">,</span> <span class="n">indices</span> <span class="ow">in</span> <span class="n">cluster_to_indices</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">responses</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">network_id</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="n">cell_type</span><span class="o">=</span><span class="s2">&quot;T4c&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">plot_traces</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span>
        <span class="n">plot_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">],</span> <span class="n">add_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">]),</span>
    <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cluster </span><span class="si">{</span><span class="n">cluster_id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../05_flyvision_umap_and_clustering_models_files/05_flyvision_umap_and_clustering_models_32_0.png" /></p>
<p>The clustering has led us to three qualitatively distinct predictions from the ensemble for this cell and sequence. This is a first lead for an underlying structure in these predictions. We will get an even better estimate once we use more sequences for the clustering.</p>
<h1 id="using-the-clustering-to-discover-tuning-predictions-in-responses-to-simple-stimuli">Using the clustering to discover tuning predictions in responses to simple stimuli<a class="headerlink" href="#using-the-clustering-to-discover-tuning-predictions-in-responses-to-simple-stimuli" title="Permanent link">&para;</a></h1>
<p>We expect that the clustering based on naturalistic stimuli will also disambiguate the different tuning predictions from different models for simple stimuli.</p>
<div class="highlight"><pre><span></span><code><span class="n">cluster_to_indices</span> <span class="o">=</span> <span class="n">get_cluster_to_indices</span><span class="p">(</span>
    <span class="n">embeddingplot</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">embedding</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span>
    <span class="n">embeddingplot</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span>
    <span class="n">ensemble</span><span class="o">.</span><span class="n">task_error</span><span class="p">(),</span>
<span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># define different colormaps for clusters</span>
<span class="n">cluster_colors</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">CMAPS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Blues_r&quot;</span><span class="p">,</span> <span class="s2">&quot;Reds_r&quot;</span><span class="p">,</span> <span class="s2">&quot;Greens_r&quot;</span><span class="p">,</span> <span class="s2">&quot;Oranges_r&quot;</span><span class="p">,</span> <span class="s2">&quot;Purples_r&quot;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">cluster_id</span> <span class="ow">in</span> <span class="n">cluster_to_indices</span><span class="p">:</span>
    <span class="n">cluster_colors</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">task_error</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">CMAPS</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">])</span><span class="o">.</span><span class="n">colors</span>
</code></pre></div>
<h2 id="clustered-voltage-responses-to-moving-edges">Clustered voltage responses to moving edges<a class="headerlink" href="#clustered-voltage-responses-to-moving-edges" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvision.analysis.moving_bar_responses</span> <span class="kn">import</span> <span class="n">plot_angular_tuning</span>
<span class="kn">from</span> <span class="nn">flyvision.analysis.visualization</span> <span class="kn">import</span> <span class="n">plt_utils</span>
<span class="kn">from</span> <span class="nn">flyvision.utils.color_utils</span> <span class="kn">import</span> <span class="n">color_to_cmap</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">stims_and_resps_moving_edge</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">moving_edge_responses</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># invariant to different magnitudes of responses, only to assess direction tuning</span>
<span class="n">stims_and_resps_moving_edge</span><span class="p">[</span><span class="s2">&quot;responses&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
    <span class="n">stims_and_resps_moving_edge</span><span class="p">[</span><span class="s2">&quot;responses&quot;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;frame&quot;</span><span class="p">))</span>

<span class="c1"># relative to the norm of the responses to naturalistic stimuli (used for averaging)</span>
<span class="c1"># stims_and_resps_moving_edge[&#39;responses&#39;] /= (norm + 1e-6)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cluster_to_indices</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">color</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mcolors</span><span class="o">.</span><span class="n">TABLEAU_COLORS</span><span class="o">.</span><span class="n">values</span><span class="p">())}</span>
<span class="k">for</span> <span class="n">cluster_id</span><span class="p">,</span> <span class="n">indices</span> <span class="ow">in</span> <span class="n">cluster_to_indices</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">stims_and_resps_moving_edge</span><span class="p">[</span><span class="s1">&#39;responses&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">network_id</span><span class="o">=</span><span class="n">indices</span><span class="p">)</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="n">cell_type</span><span class="o">=</span><span class="s2">&quot;T4c&quot;</span><span class="p">,</span> <span class="n">intensity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">90</span>
    <span class="p">)</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">plot_traces</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span>
        <span class="n">plot_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">],</span> <span class="n">add_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">]),</span>
    <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cluster </span><span class="si">{</span><span class="n">cluster_id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../05_flyvision_umap_and_clustering_models_files/05_flyvision_umap_and_clustering_models_42_0.png" /></p>
<div class="highlight"><pre><span></span><code><span class="n">plot_angular_tuning</span><span class="p">(</span>
    <span class="n">stims_and_resps_moving_edge</span><span class="p">,</span>
    <span class="s2">&quot;T4c&quot;</span><span class="p">,</span>
    <span class="n">intensity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>(&lt;Figure size 300x300 with 1 Axes&gt;, &lt;PolarAxes: &gt;)
</code></pre></div>

<p><img alt="png" src="../05_flyvision_umap_and_clustering_models_files/05_flyvision_umap_and_clustering_models_43_1.png" /></p>
<div class="highlight"><pre><span></span><code><span class="n">tabcolors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mcolors</span><span class="o">.</span><span class="n">TABLEAU_COLORS</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">ensemble</span><span class="o">.</span><span class="n">task_error</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">color_to_cmap</span><span class="p">(</span><span class="n">tabcolors</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">])</span><span class="o">.</span><span class="n">reversed</span><span class="p">())</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span>
        <span class="n">indices</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">cluster_id</span><span class="p">,</span> <span class="n">indices</span> <span class="ow">in</span> <span class="n">cluster_to_indices</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
    <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cluster_to_indices</span><span class="p">),</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;projection&quot;</span><span class="p">:</span> <span class="s2">&quot;polar&quot;</span><span class="p">},</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">cluster_id</span><span class="p">,</span> <span class="n">indices</span> <span class="ow">in</span> <span class="n">cluster_to_indices</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">plot_angular_tuning</span><span class="p">(</span>
        <span class="n">stims_and_resps_moving_edge</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">network_id</span><span class="o">=</span><span class="n">indices</span><span class="p">),</span>
        <span class="s2">&quot;T4c&quot;</span><span class="p">,</span>
        <span class="n">intensity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">],</span>
        <span class="n">zorder</span><span class="o">=</span><span class="n">ensemble</span><span class="o">.</span><span class="n">zorder</span><span class="p">()[</span><span class="n">indices</span><span class="p">],</span>
        <span class="n">groundtruth</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">cluster_id</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">plt_utils</span><span class="o">.</span><span class="n">add_cluster_marker</span><span class="p">(</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">plt_utils</span><span class="o">.</span><span class="n">get_marker</span><span class="p">(</span><span class="n">cluster_id</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cluster </span><span class="si">{</span><span class="n">cluster_id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../05_flyvision_umap_and_clustering_models_files/05_flyvision_umap_and_clustering_models_44_0.png" /></p>
<p>As we can see here, the models predict clustered neural responses.</p>
<h1 id="load-precomputed-umap-and-clustering">Load precomputed umap and clustering<a class="headerlink" href="#load-precomputed-umap-and-clustering" title="Permanent link">&para;</a></h1>
<p>Due to the computational requirement of recording and embedding all responses and for consistency we also show how to use the precomputed embeddings and clusterings from the paper.</p>
<div class="highlight"><pre><span></span><code><span class="n">cell_type</span> <span class="o">=</span> <span class="s2">&quot;T4c&quot;</span>
<span class="n">clustering</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">clustering</span><span class="p">(</span><span class="n">cell_type</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[2024-10-14 23:29:47] clustering:835 Loaded T4c embedding and clustering from /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/umap_and_clustering
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">task_error</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">task_error</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">embeddingplot</span> <span class="o">=</span> <span class="n">clustering</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">task_error</span><span class="o">=</span><span class="n">task_error</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">task_error</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../05_flyvision_umap_and_clustering_models_files/05_flyvision_umap_and_clustering_models_50_0.png" /></p>
<p>With this embedding and clustering one can proceed in the same way as above to plot the tunings.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
    
    <div class="md-footer-meta md-typeset">
        <div class="md-footer-meta__inner md-grid">
            <div class="md-copyright">
    
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
        Material for MkDocs
    </a>
    
    
    <div class="md-copyright__highlight">
        Lappalainen &copy 2024
    </div>
    
</div>
        </div>
    </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "navigation.instant", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.top"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.d6f25eb3.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>