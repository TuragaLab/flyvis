
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="http://turagas-ws4:8010/reference/moving_stimulus_responses/">
      
      
        <link rel="prev" href="../flash_responses/">
      
      
        <link rel="next" href="../ensemble_clustering/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.38">
    
    
      
        <title>Moving Stimulus Responses - Flyvis Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8c3ca2c6.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#moving-stimulus-responses" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      



<header class="md-header md-header--shadow" data-md-component="header">
    <nav class="md-header__inner md-grid" aria-label="Header">
        <a href="../.." title="Flyvis Documentation"
            class="md-header__button md-logo" aria-label="Flyvis Documentation" data-md-component="logo">
            
<img id="flyvis-logo-light" src="../../images/flyvis_logo_light@150ppi.webp" alt="logo">
<img id="flyvis-logo-dark" src="../../images/flyvis_logo_dark@150ppi.webp" alt="logo">

        </a>
        <label class="md-header__button md-icon" for="__drawer">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
        </label>
        <div class="md-header__title" data-md-component="header-title">
            <div class="md-header__ellipsis">
                <div class="md-header__topic">
                    <span class="md-ellipsis">
                    </span>
                </div>
                <div class="md-header__topic" data-md-component="header-topic">
                    <span class="md-ellipsis">
                    </span>
                </div>
            </div>
        </div>
        
        
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="purple"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
        
        
        
        <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
        
        
        
        <label class="md-header__button md-icon" for="__search">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
        
    </nav>
    
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Flyvis Documentation"
      class="md-nav__button md-logo" aria-label="Flyvis Documentation" data-md-component="logo">
      
<img id="flyvis-logo-light" src="../../images/flyvis_logo_light@150ppi.webp" alt="logo">
<img id="flyvis-logo-dark" src="../../images/flyvis_logo_dark@150ppi.webp" alt="logo">

    </a>
    <div class="md-nav__social">
      <div class="md-social">
  
    
    
    
    
    <a href="mailto:janne.lappalainen@uni-tuebingen.de?cc=jakob.macke@uni-tuebingen.de,turagas@janelia.hhmi.org" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l217.6 163.2c11.4 8.5 27 8.5 38.4 0l217.6-163.2c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 176v208c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V176L294.4 339.2a63.9 63.9 0 0 1-76.8 0z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/turagalab/flyvis" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.nature.com/articles/s41586-024-07939-3" target="_blank" rel="noopener" title="www.nature.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M96 96c0-35.3 28.7-64 64-64h288c35.3 0 64 28.7 64 64v320c0 35.3-28.7 64-64 64H80c-44.2 0-80-35.8-80-80V128c0-17.7 14.3-32 32-32s32 14.3 32 32v272c0 8.8 7.2 16 16 16s16-7.2 16-16zm64 24v80c0 13.3 10.7 24 24 24h112c13.3 0 24-10.7 24-24v-80c0-13.3-10.7-24-24-24H184c-13.3 0-24 10.7-24 24m208-8c0 8.8 7.2 16 16 16h48c8.8 0 16-7.2 16-16s-7.2-16-16-16h-48c-8.8 0-16 7.2-16 16m0 96c0 8.8 7.2 16 16 16h48c8.8 0 16-7.2 16-16s-7.2-16-16-16h-48c-8.8 0-16 7.2-16 16m-208 96c0 8.8 7.2 16 16 16h256c8.8 0 16-7.2 16-16s-7.2-16-16-16H176c-8.8 0-16 7.2-16 16m0 96c0 8.8 7.2 16 16 16h256c8.8 0 16-7.2 16-16s-7.2-16-16-16H176c-8.8 0-16 7.2-16 16"/></svg>
    </a>
  
</div>
    </div>
    Flyvis Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
    
    
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
    
    
  
  
  
  
    <li class="md-nav__item">
      <a href="../../install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

    
    
    
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/01_flyvision_connectome/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Explore the Connectome
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/02_flyvision_optic_flow_task/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Train the Network
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/03_flyvision_flash_responses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flash Responses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/04_flyvision_moving_edge_responses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Moving Edge Responses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/05_flyvision_umap_and_clustering_models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ensemble Clustering
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/06_flyvision_maximally_excitatory_stimuli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Maximally Excitatory Stimuli
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/07_flyvision_providing_custom_stimuli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom Stimuli
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
    
    
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Main Results
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Main Results
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/figure_01_fly_visual_system/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Figure 1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/figure_02_simple_stimuli_responses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Figure 2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/figure_03_naturalistic_stimuli_responses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Figure 3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/figure_04_mechanisms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Figure 4
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
    
    
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../connectome/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Connectomes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../network/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Network
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../network_view/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NetworkView
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ensemble_view/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EnsembleView
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sintel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sintel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tasks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Task
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../decoder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Decoder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../solver/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Training
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../flash_responses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flash Responses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Moving Stimulus Responses
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Moving Stimulus Responses
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#rendering" class="md-nav__link">
    <span class="md-ellipsis">
      Rendering
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rendering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.RenderedOffsets" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RenderedOffsets
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datasets" class="md-nav__link">
    <span class="md-ellipsis">
      Datasets
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Datasets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;MovingBar
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" MovingBar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.dt" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;dt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.t_pre" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;t_pre
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.t_post" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;t_post
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.time" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;time
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.get_sequence_id_from_arguments" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_sequence_id_from_arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.get" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.get_item" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_item
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.mask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;mask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.stimulus" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;stimulus
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.stimulus_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;stimulus_parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.sample_shape" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;sample_shape
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.time_to_center" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;time_to_center
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.get_time_with_origin_at_onset" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_time_with_origin_at_onset
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.get_time_with_origin_at_center" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_time_with_origin_at_center
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.stimulus_cartoon" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;stimulus_cartoon
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingEdge" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;MovingEdge
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#response-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Response Analysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Response Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;moving_bar_responses
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" moving_bar_responses">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.peak_responses" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;peak_responses
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.get_time_masks" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_time_masks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.peak_responses_angular" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;peak_responses_angular
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.direction_selectivity_index" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;direction_selectivity_index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.prepare_dsi_data" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;prepare_dsi_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.dsi_violins" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;dsi_violins
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.dsi_violins_on_and_off" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;dsi_violins_on_and_off
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.dsi_correlation_to_known" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;dsi_correlation_to_known
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.correlation_to_known_tuning_curves" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;correlation_to_known_tuning_curves
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.get_known_tuning_curves" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_known_tuning_curves
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.preferred_direction" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;preferred_direction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.angular_distance_to_known" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;angular_distance_to_known
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.angular_distances" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;angular_distances
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.simple_angle_distance" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;simple_angle_distance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.plot_angular_tuning" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;plot_angular_tuning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.plot_T4_tuning" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;plot_T4_tuning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.plot_T5_tuning" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;plot_T5_tuning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.mask_between_seconds" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;mask_between_seconds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.time_window" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;time_window
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#current-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Current Analysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Current Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;MovingEdgeCurrentView
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" MovingEdgeCurrentView">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.on" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;on
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.off" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;off
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.init_currents" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;init_currents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.init_responses" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;init_responses
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.init_time" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;init_time
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.divide_by_given_norm" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;divide_by_given_norm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.at_contrast" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;at_contrast
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.at_angle" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;at_angle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.at_position" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;at_position
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.between_seconds" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;between_seconds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.model_selection" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;model_selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.sorting" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;sorting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.filter_cell_types_by_contribution" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;filter_cell_types_by_contribution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.filter_source_types" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;filter_source_types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.signs" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;signs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.sum_over_cells" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;sum_over_cells
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_spatial_contribution" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;plot_spatial_contribution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_spatial_contribution_grid" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;plot_spatial_contribution_grid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_spatial_filter" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;plot_spatial_filter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_spatial_filter_grid" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;plot_spatial_filter_grid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.view" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;view
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.subtract_baseline" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;subtract_baseline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.subtract_mean" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;subtract_mean
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.standardize" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;standardize
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.standardize_over_time_and_pd_nd" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;standardize_over_time_and_pd_nd
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.init_colors" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;init_colors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.color" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;color
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.zorder" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;zorder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.ylims" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;ylims
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_response" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;plot_response
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_response_pc_nc" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;plot_response_pc_nc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_temporal_contributions" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;plot_temporal_contributions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_temporal_contributions_pc_nc" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;plot_temporal_contributions_pc_nc
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ensemble_clustering/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ensemble Clustering
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../optimal_stimuli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Optimal Stimuli
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_13" >
        
          
          <label class="md-nav__link" for="__nav_5_13" id="__nav_5_13_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Miscelleanous
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_13">
            <span class="md-nav__icon md-icon"></span>
            Miscelleanous
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rendering/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rendering
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../augmentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hex Augmentations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../datasets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Datasets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Utils
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visualizations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../animations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Animations
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_14" >
        
          
          <label class="md-nav__link" for="__nav_5_14" id="__nav_5_14_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Scripts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_14">
            <span class="md-nav__icon md-icon"></span>
            Scripts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scripts/scripts/download_pretrained_models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Download
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_14_2" >
        
          
          <label class="md-nav__link" for="__nav_5_14_2" id="__nav_5_14_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Training
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_14_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_14_2">
            <span class="md-nav__icon md-icon"></span>
            Training
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scripts/training/train_single/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run Training for Single Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scripts/training/train/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch Ensemble Training on Cluster
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_14_3" >
        
          
          <label class="md-nav__link" for="__nav_5_14_3" id="__nav_5_14_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Validation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_14_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_14_3">
            <span class="md-nav__icon md-icon"></span>
            Validation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scripts/validation/val_single/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run Validation for Single Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scripts/validation/validate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch Ensemble Validation on Cluster
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_14_4" >
        
          
          <label class="md-nav__link" for="__nav_5_14_4" id="__nav_5_14_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Analysis
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_14_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_14_4">
            <span class="md-nav__icon md-icon"></span>
            Analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scripts/analysis/synthetic_recordings_single/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run Synthetic Recordings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scripts/analysis/record/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch Synthetic Recordings on Cluster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scripts/analysis/ensemble_analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run Ensemble Analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scripts/analysis/analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch Ensemble Analysis on Cluster
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_14_5" >
        
          
          <label class="md-nav__link" for="__nav_5_14_5" id="__nav_5_14_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Notebook
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_14_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_14_5">
            <span class="md-nav__icon md-icon"></span>
            Notebook
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scripts/analysis/notebook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run Notebook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scripts/analysis/notebook_per_ensemble/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch Notebook Per Ensemble on Cluster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scripts/analysis/notebook_per_model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch Notebook Per Model on Cluster
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scripts/scripts/pipeline_manager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pipeline Manager
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
    
    
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contribute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

    
    
    
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ
  </span>
  

      </a>
    </li>
  

    
    
    
  
  
  
  
    <li class="md-nav__item">
      <a href="../../acknowledgements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Acknowledgements
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#rendering" class="md-nav__link">
    <span class="md-ellipsis">
      Rendering
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rendering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.RenderedOffsets" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RenderedOffsets
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datasets" class="md-nav__link">
    <span class="md-ellipsis">
      Datasets
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Datasets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;MovingBar
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" MovingBar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.dt" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;dt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.t_pre" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;t_pre
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.t_post" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;t_post
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.time" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;time
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.get_sequence_id_from_arguments" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_sequence_id_from_arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.get" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.get_item" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_item
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.mask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;mask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.stimulus" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;stimulus
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.stimulus_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;stimulus_parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.sample_shape" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;sample_shape
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.time_to_center" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;time_to_center
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.get_time_with_origin_at_onset" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_time_with_origin_at_onset
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.get_time_with_origin_at_center" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_time_with_origin_at_center
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingBar.stimulus_cartoon" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;stimulus_cartoon
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.datasets.moving_bar.MovingEdge" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;MovingEdge
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#response-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Response Analysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Response Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;moving_bar_responses
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" moving_bar_responses">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.peak_responses" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;peak_responses
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.get_time_masks" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_time_masks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.peak_responses_angular" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;peak_responses_angular
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.direction_selectivity_index" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;direction_selectivity_index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.prepare_dsi_data" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;prepare_dsi_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.dsi_violins" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;dsi_violins
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.dsi_violins_on_and_off" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;dsi_violins_on_and_off
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.dsi_correlation_to_known" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;dsi_correlation_to_known
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.correlation_to_known_tuning_curves" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;correlation_to_known_tuning_curves
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.get_known_tuning_curves" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_known_tuning_curves
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.preferred_direction" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;preferred_direction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.angular_distance_to_known" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;angular_distance_to_known
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.angular_distances" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;angular_distances
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.simple_angle_distance" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;simple_angle_distance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.plot_angular_tuning" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;plot_angular_tuning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.plot_T4_tuning" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;plot_T4_tuning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.plot_T5_tuning" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;plot_T5_tuning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.mask_between_seconds" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;mask_between_seconds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_bar_responses.time_window" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;time_window
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#current-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Current Analysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Current Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;MovingEdgeCurrentView
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" MovingEdgeCurrentView">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.on" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;on
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.off" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;off
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.init_currents" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;init_currents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.init_responses" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;init_responses
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.init_time" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;init_time
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.divide_by_given_norm" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;divide_by_given_norm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.at_contrast" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;at_contrast
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.at_angle" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;at_angle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.at_position" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;at_position
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.between_seconds" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;between_seconds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.model_selection" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;model_selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.sorting" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;sorting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.filter_cell_types_by_contribution" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;filter_cell_types_by_contribution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.filter_source_types" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;filter_source_types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.signs" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;signs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.sum_over_cells" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;sum_over_cells
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_spatial_contribution" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;plot_spatial_contribution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_spatial_contribution_grid" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;plot_spatial_contribution_grid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_spatial_filter" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;plot_spatial_filter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_spatial_filter_grid" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;plot_spatial_filter_grid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.view" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;view
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.subtract_baseline" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;subtract_baseline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.subtract_mean" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;subtract_mean
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.standardize" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;standardize
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.standardize_over_time_and_pd_nd" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;standardize_over_time_and_pd_nd
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.init_colors" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;init_colors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.color" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;color
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.zorder" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;zorder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.ylims" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;ylims
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_response" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;plot_response
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_response_pc_nc" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;plot_response_pc_nc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_temporal_contributions" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;plot_temporal_contributions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_temporal_contributions_pc_nc" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;plot_temporal_contributions_pc_nc
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="moving-stimulus-responses">Moving Stimulus Responses<a class="headerlink" href="#moving-stimulus-responses" title="Permanent link">&para;</a></h1>
<h2 id="rendering">Rendering<a class="headerlink" href="#rendering" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h3 id="flyvision.datasets.moving_bar.RenderedOffsets" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">flyvision.datasets.moving_bar.RenderedOffsets</span>


<a href="#flyvision.datasets.moving_bar.RenderedOffsets" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="datamate.Directory">Directory</span></code></p>


        <p>Rendered offsets for the moving bar stimulus.</p>
<p>This class precomputes the offsets for moving bar (edge) stimuli and stores them
in a directory. At runtime, the offsets are resampled to efficiently generate
stimuli with different durations and temporal resolutions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>offsets</code></td>
            <td>
                  <code>list[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of offset values.</p>
              </div>
            </td>
            <td>
                  <code>list(range(-10, 11))</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>angles</code></td>
            <td>
                  <code>list[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of angle values in degrees.</p>
              </div>
            </td>
            <td>
                  <code>[0, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>widths</code></td>
            <td>
                  <code>list[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of width values.</p>
              </div>
            </td>
            <td>
                  <code>[1, 2, 4]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>intensities</code></td>
            <td>
                  <code>list[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of intensity values.</p>
              </div>
            </td>
            <td>
                  <code>[0, 1]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>led_width</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Width of LED in radians.</p>
              </div>
            </td>
            <td>
                  <code><span title="numpy.radians">radians</span>(2.25)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>height</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Height of the bar in radians.</p>
              </div>
            </td>
            <td>
                  <code><span title="numpy.radians">radians</span>(2.25) * 9</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>n_bars</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of bars.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>bg_intensity</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Background intensity.</p>
              </div>
            </td>
            <td>
                  <code>0.5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>bar_loc_horizontal</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Horizontal location of the bar in radians.</p>
              </div>
            </td>
            <td>
                  <code><span title="numpy.radians">radians</span>(90)</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.datasets.moving_bar.RenderedOffsets.offsets">offsets</span></code></td>
            <td>
                  <code>ArrayFile</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Rendered offsets for different stimulus parameters.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>flyvision/datasets/moving_bar.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@root</span><span class="p">(</span><span class="n">renderings_dir</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">RenderedOffsets</span><span class="p">(</span><span class="n">Directory</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Rendered offsets for the moving bar stimulus.</span>

<span class="sd">    This class precomputes the offsets for moving bar (edge) stimuli and stores them</span>
<span class="sd">    in a directory. At runtime, the offsets are resampled to efficiently generate</span>
<span class="sd">    stimuli with different durations and temporal resolutions.</span>

<span class="sd">    Args:</span>
<span class="sd">        offsets: List of offset values.</span>
<span class="sd">        angles: List of angle values in degrees.</span>
<span class="sd">        widths: List of width values.</span>
<span class="sd">        intensities: List of intensity values.</span>
<span class="sd">        led_width: Width of LED in radians.</span>
<span class="sd">        height: Height of the bar in radians.</span>
<span class="sd">        n_bars: Number of bars.</span>
<span class="sd">        bg_intensity: Background intensity.</span>
<span class="sd">        bar_loc_horizontal: Horizontal location of the bar in radians.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        offsets (ArrayFile): Rendered offsets for different stimulus parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">offsets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">)),</span>
        <span class="n">angles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">330</span><span class="p">],</span>
        <span class="n">widths</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
        <span class="n">intensities</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">led_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">2.25</span><span class="p">),</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">2.25</span><span class="p">)</span> <span class="o">*</span> <span class="mi">9</span><span class="p">,</span>
        <span class="n">n_bars</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">bg_intensity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">bar_loc_horizontal</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">90</span><span class="p">),</span>
    <span class="p">):</span>
        <span class="n">eye</span> <span class="o">=</span> <span class="n">HexEye</span><span class="p">(</span><span class="mi">721</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">widths</span><span class="p">,</span> <span class="n">intensities</span><span class="p">))</span>

        <span class="n">sequences</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">_tqdm</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;building stimuli&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">angles</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">width</span> <span class="ow">in</span> <span class="n">widths</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">intensity</span> <span class="ow">in</span> <span class="n">intensities</span><span class="p">:</span>
                    <span class="n">offset_bars</span> <span class="o">=</span> <span class="n">eye</span><span class="o">.</span><span class="n">render_offset_bars</span><span class="p">(</span>
                        <span class="n">bar_width_rad</span><span class="o">=</span><span class="n">width</span> <span class="o">*</span> <span class="n">led_width</span><span class="p">,</span>
                        <span class="n">bar_height_rad</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
                        <span class="n">n_bars</span><span class="o">=</span><span class="n">n_bars</span><span class="p">,</span>
                        <span class="n">offsets</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">offsets</span><span class="p">)</span> <span class="o">*</span> <span class="n">led_width</span><span class="p">,</span>
                        <span class="n">bar_intensity</span><span class="o">=</span><span class="n">intensity</span><span class="p">,</span>
                        <span class="n">bg_intensity</span><span class="o">=</span><span class="n">bg_intensity</span><span class="p">,</span>
                        <span class="n">moving_angle</span><span class="o">=</span><span class="n">angle</span><span class="p">,</span>
                        <span class="n">bar_loc_horizontal</span><span class="o">=</span><span class="n">bar_loc_horizontal</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">sequences</span><span class="p">[(</span><span class="n">angle</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)]</span> <span class="o">=</span> <span class="n">offset_bars</span>
                    <span class="n">_tqdm</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

        <span class="n">_tqdm</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offsets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">sequences</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">])</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div><h2 id="datasets">Datasets<a class="headerlink" href="#datasets" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h3 id="flyvision.datasets.moving_bar.MovingBar" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">flyvision.datasets.moving_bar.MovingBar</span>


<a href="#flyvision.datasets.moving_bar.MovingBar" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="flyvision.datasets.datasets.StimulusDataset" href="../datasets/#flyvision.datasets.datasets.StimulusDataset">StimulusDataset</a></code></p>


        <p>Moving bar stimulus.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>widths</code></td>
            <td>
                  <code>list[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Width of the bar in half ommatidia.</p>
              </div>
            </td>
            <td>
                  <code>[1, 2, 4]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>offsets</code></td>
            <td>
                  <code>tuple[int, int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>First and last offset to the central column in half ommatidia.</p>
              </div>
            </td>
            <td>
                  <code>(-10, 11)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>intensities</code></td>
            <td>
                  <code>list[float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Intensity of the bar.</p>
              </div>
            </td>
            <td>
                  <code>[0, 1]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>speeds</code></td>
            <td>
                  <code>list[float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Speed of the bar in half ommatidia per second.</p>
              </div>
            </td>
            <td>
                  <code>[2.4, 4.8, 9.7, 13, 19, 25]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>height</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Height of the bar in half ommatidia.</p>
              </div>
            </td>
            <td>
                  <code>9</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>dt</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time step in seconds.</p>
              </div>
            </td>
            <td>
                  <code>1 / 200</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>device</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device to store the stimulus.</p>
              </div>
            </td>
            <td>
                  <code><span title="flyvision.device">device</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>bar_loc_horizontal</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Horizontal location of the bar in radians from left to
right of image plane. np.radians(90) is the center.</p>
              </div>
            </td>
            <td>
                  <code><span title="numpy.radians">radians</span>(90)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>post_pad_mode</code></td>
            <td>
                  <code><span title="typing_extensions.Literal">Literal</span>[&#39;continue&#39;, &#39;value&#39;, &#39;reflect&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Padding mode after the stimulus. One of &lsquo;continue&rsquo;, &lsquo;value&rsquo;,
&lsquo;reflect&rsquo;. If &lsquo;value&rsquo; the padding is filled with <code>bg_intensity</code>.</p>
              </div>
            </td>
            <td>
                  <code>&#39;value&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>t_pre</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time before the stimulus in seconds.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>t_post</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time after the stimulus in seconds.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>build_stim_on_init</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Build the stimulus on initialization.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>shuffle_offsets</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shuffle the offsets to remove spatio-temporal correlation.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>seed</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Seed for the random state.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>angles</code></td>
            <td>
                  <code>list[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of angles in degrees.</p>
              </div>
            </td>
            <td>
                  <code>[0, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330]</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.datasets.moving_bar.MovingBar.config">config</span></code></td>
            <td>
                  <code><span title="datamate.Namespace">Namespace</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration parameters.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.datasets.moving_bar.MovingBar.omm_width">omm_width</span></code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Width of ommatidium in radians.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.datasets.moving_bar.MovingBar.led_width">led_width</span></code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Width of LED in radians.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.datasets.moving_bar.MovingBar.angles">angles</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of angles in degrees.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.datasets.moving_bar.MovingBar.widths">widths</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of widths in half ommatidia.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.datasets.moving_bar.MovingBar.offsets">offsets</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of offsets in half ommatidia.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.datasets.moving_bar.MovingBar.intensities">intensities</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of intensities.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.datasets.moving_bar.MovingBar.speeds">speeds</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of speeds in half ommatidia per second.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.datasets.moving_bar.MovingBar.bg_intensity">bg_intensity</span></code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Background intensity.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.datasets.moving_bar.MovingBar.n_bars">n_bars</span></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of bars.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.datasets.moving_bar.MovingBar.bar_loc_horizontal">bar_loc_horizontal</span></code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Horizontal location of bar in radians.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.datasets.moving_bar.MovingBar.t_stim">t_stim</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Stimulation times for each speed.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.datasets.moving_bar.MovingBar.t_stim_max">t_stim_max</span></code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum stimulation time.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.datasets.moving_bar.MovingBar.height">height</span></code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Height of bar in radians.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.datasets.moving_bar.MovingBar.post_pad_mode">post_pad_mode</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Padding mode after the stimulus.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.datasets.moving_bar.MovingBar.arg_df">arg_df</span></code></td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame of stimulus parameters.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.datasets.moving_bar.MovingBar.arg_group_df">arg_group_df</span></code></td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Grouped DataFrame of stimulus parameters.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.datasets.moving_bar.MovingBar.device">device</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device for storing stimuli.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.datasets.moving_bar.MovingBar.shuffle_offsets">shuffle_offsets</span></code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to shuffle offsets.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.datasets.moving_bar.MovingBar.randomstate">randomstate</span></code></td>
            <td>
                  <code><span title="numpy.random.RandomState">RandomState</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random state for shuffling.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>flyvision/datasets/moving_bar.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MovingBar</span><span class="p">(</span><span class="n">StimulusDataset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Moving bar stimulus.</span>

<span class="sd">    Args:</span>
<span class="sd">        widths: Width of the bar in half ommatidia.</span>
<span class="sd">        offsets: First and last offset to the central column in half ommatidia.</span>
<span class="sd">        intensities: Intensity of the bar.</span>
<span class="sd">        speeds: Speed of the bar in half ommatidia per second.</span>
<span class="sd">        height: Height of the bar in half ommatidia.</span>
<span class="sd">        dt: Time step in seconds.</span>
<span class="sd">        device: Device to store the stimulus.</span>
<span class="sd">        bar_loc_horizontal: Horizontal location of the bar in radians from left to</span>
<span class="sd">            right of image plane. np.radians(90) is the center.</span>
<span class="sd">        post_pad_mode: Padding mode after the stimulus. One of &#39;continue&#39;, &#39;value&#39;,</span>
<span class="sd">            &#39;reflect&#39;. If &#39;value&#39; the padding is filled with `bg_intensity`.</span>
<span class="sd">        t_pre: Time before the stimulus in seconds.</span>
<span class="sd">        t_post: Time after the stimulus in seconds.</span>
<span class="sd">        build_stim_on_init: Build the stimulus on initialization.</span>
<span class="sd">        shuffle_offsets: Shuffle the offsets to remove spatio-temporal correlation.</span>
<span class="sd">        seed: Seed for the random state.</span>
<span class="sd">        angles: List of angles in degrees.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        config (Namespace): Configuration parameters.</span>
<span class="sd">        omm_width (float): Width of ommatidium in radians.</span>
<span class="sd">        led_width (float): Width of LED in radians.</span>
<span class="sd">        angles (np.ndarray): Array of angles in degrees.</span>
<span class="sd">        widths (np.ndarray): Array of widths in half ommatidia.</span>
<span class="sd">        offsets (np.ndarray): Array of offsets in half ommatidia.</span>
<span class="sd">        intensities (np.ndarray): Array of intensities.</span>
<span class="sd">        speeds (np.ndarray): Array of speeds in half ommatidia per second.</span>
<span class="sd">        bg_intensity (float): Background intensity.</span>
<span class="sd">        n_bars (int): Number of bars.</span>
<span class="sd">        bar_loc_horizontal (float): Horizontal location of bar in radians.</span>
<span class="sd">        t_stim (np.ndarray): Stimulation times for each speed.</span>
<span class="sd">        t_stim_max (float): Maximum stimulation time.</span>
<span class="sd">        height (float): Height of bar in radians.</span>
<span class="sd">        post_pad_mode (str): Padding mode after the stimulus.</span>
<span class="sd">        arg_df (pd.DataFrame): DataFrame of stimulus parameters.</span>
<span class="sd">        arg_group_df (pd.DataFrame): Grouped DataFrame of stimulus parameters.</span>
<span class="sd">        device (str): Device for storing stimuli.</span>
<span class="sd">        shuffle_offsets (bool): Whether to shuffle offsets.</span>
<span class="sd">        randomstate (np.random.RandomState): Random state for shuffling.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">arg_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">widths</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
        <span class="n">offsets</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
        <span class="n">intensities</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">speeds</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.4</span><span class="p">,</span> <span class="mf">4.8</span><span class="p">,</span> <span class="mf">9.7</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">25</span><span class="p">],</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span>
        <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">200</span><span class="p">,</span>
        <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">flyvision</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
        <span class="n">bar_loc_horizontal</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">90</span><span class="p">),</span>
        <span class="n">post_pad_mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;continue&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;reflect&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span>
        <span class="n">t_pre</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">t_post</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">build_stim_on_init</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">shuffle_offsets</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">angles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">330</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># HexEye parameter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">omm_width</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">5.8</span><span class="p">)</span>  <span class="c1"># radians(5.8 degree)</span>

        <span class="c1"># Monitor parameter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">led_width</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">2.25</span><span class="p">)</span>  <span class="c1"># Gruntman et al. 2018</span>

        <span class="n">_locals</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">({</span>
            <span class="n">arg</span><span class="p">:</span> <span class="n">_locals</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;widths&quot;</span><span class="p">,</span>
                <span class="s2">&quot;offsets&quot;</span><span class="p">,</span>
                <span class="s2">&quot;intensities&quot;</span><span class="p">,</span>
                <span class="s2">&quot;speeds&quot;</span><span class="p">,</span>
                <span class="s2">&quot;height&quot;</span><span class="p">,</span>
                <span class="s2">&quot;bar_loc_horizontal&quot;</span><span class="p">,</span>
                <span class="s2">&quot;shuffle_offsets&quot;</span><span class="p">,</span>
                <span class="s2">&quot;post_pad_mode&quot;</span><span class="p">,</span>
                <span class="s2">&quot;t_pre&quot;</span><span class="p">,</span>
                <span class="s2">&quot;t_post&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dt&quot;</span><span class="p">,</span>
                <span class="s2">&quot;angles&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">})</span>

        <span class="c1"># Stim parameter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">widths</span><span class="p">)</span>  <span class="c1"># half ommatidia</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">offsets</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offsets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">*</span><span class="n">offsets</span><span class="p">)</span>  <span class="c1"># half ommatidia</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">offsets</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">offsets</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="p">)</span>  <span class="c1"># t_stim assumes spacing of 1 corresponding to 2.25 deg</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offsets</span> <span class="o">=</span> <span class="n">offsets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intensities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">intensities</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speeds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">speeds</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bg_intensity</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_bars</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bar_loc_horizontal</span> <span class="o">=</span> <span class="n">bar_loc_horizontal</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">t_stim</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offsets</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">led_width</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speeds</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">omm_width</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_stim_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_stim</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_speed_to_t_stim</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speeds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_stim</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">led_width</span> <span class="o">*</span> <span class="n">height</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">post_pad_mode</span> <span class="o">=</span> <span class="n">post_pad_mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t_pre</span> <span class="o">=</span> <span class="n">t_pre</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t_post</span> <span class="o">=</span> <span class="n">t_post</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">*</span><span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">product</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">widths</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">intensities</span><span class="p">,</span>
                    <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_stim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">speeds</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arg_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">params</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="s2">&quot;intensity&quot;</span><span class="p">,</span> <span class="s2">&quot;t_stim&quot;</span><span class="p">,</span> <span class="s2">&quot;speed&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">arg_group_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="s2">&quot;intensity&quot;</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shuffle_offsets</span> <span class="o">=</span> <span class="n">shuffle_offsets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">randomstate</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shuffle_offsets</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">randomstate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dt</span> <span class="o">=</span> <span class="n">dt</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_built</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">build_stim_on_init</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_resample</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_built</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Time step in seconds.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_dt&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="nd">@dt</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">dt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dt</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dt</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_built</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_resample</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Cannot override dt=</span><span class="si">%s</span><span class="s2"> because responses with dt=</span><span class="si">%s</span><span class="s2"> are initialized. &quot;</span>
            <span class="s2">&quot;Keeping dt=</span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span>
            <span class="n">value</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dt</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dt</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;Config:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;Stimulus parameter:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg_df</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">t_pre</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Time before stimulus onset in seconds.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_t_pre</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">t_post</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Time after stimulus offset in seconds.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_t_post</span>

    <span class="k">def</span> <span class="nf">_build</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build the stimulus.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wrap</span> <span class="o">=</span> <span class="n">RenderedOffsets</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">angles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">,</span>
                <span class="n">widths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">widths</span><span class="p">,</span>
                <span class="n">intensities</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">intensities</span><span class="p">,</span>
                <span class="n">offsets</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">offsets</span><span class="p">,</span>
                <span class="n">led_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">led_width</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                <span class="n">n_bars</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_bars</span><span class="p">,</span>
                <span class="n">bg_intensity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bg_intensity</span><span class="p">,</span>
                <span class="n">bar_loc_horizontal</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bar_loc_horizontal</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_offsets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wrap</span><span class="o">.</span><span class="n">offsets</span><span class="p">[:],</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_built</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_resample</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Resample the stimulus at runtime.&quot;&quot;&quot;</span>
        <span class="c1"># resampling at runtime to allow for changing dt and to save GB of</span>
        <span class="c1"># storage.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indices</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">speed</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_stim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">speeds</span><span class="p">):</span>
            <span class="n">sequence</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">resample</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_offsets</span><span class="p">,</span>
                <span class="n">t</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span>
                <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
                <span class="n">return_indices</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shuffle_offsets</span><span class="p">:</span>
                <span class="c1"># breakpoint()</span>
                <span class="n">sequence</span> <span class="o">=</span> <span class="n">shuffle</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">randomstate</span><span class="p">)</span>
            <span class="n">sequence</span> <span class="o">=</span> <span class="n">pad</span><span class="p">(</span>
                <span class="n">sequence</span><span class="p">,</span>
                <span class="n">t</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_pre</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;start&quot;</span><span class="p">,</span>
                <span class="n">fill</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bg_intensity</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">sequence</span> <span class="o">=</span> <span class="n">pad</span><span class="p">(</span>
                <span class="n">sequence</span><span class="p">,</span>
                <span class="n">t</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_pre</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_post</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;end&quot;</span><span class="p">,</span>
                <span class="n">pad_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">post_pad_mode</span><span class="p">,</span>
                <span class="n">fill</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bg_intensity</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># Because we fix the distance that the bar moves but vary speeds we</span>
            <span class="c1"># have different stimulation times. To make all sequences equal</span>
            <span class="c1"># length for storing them in a single tensor, we pad them with nans</span>
            <span class="c1"># based on the maximal stimulation time (slowest speed). The nans</span>
            <span class="c1"># can later be removed before processing the traces.</span>
            <span class="n">sequence</span> <span class="o">=</span> <span class="n">pad</span><span class="p">(</span>
                <span class="n">sequence</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">t_stim_max</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_pre</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_post</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;end&quot;</span><span class="p">,</span>
                <span class="n">fill</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="p">[</span><span class="n">speed</span><span class="p">]</span> <span class="o">=</span> <span class="n">sequence</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="n">speed</span><span class="p">]</span> <span class="o">=</span> <span class="n">indices</span>

    <span class="k">def</span> <span class="nf">_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">intensity</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">speed</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the key for a specific stimulus configuration.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;angle==</span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; &amp; width==</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; &amp; intensity == </span><span class="si">{</span><span class="n">intensity</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; &amp; speed == </span><span class="si">{</span><span class="n">speed</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;angle: </span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2">, width: </span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s2">, intensity: </span><span class="si">{</span><span class="n">intensity</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;speed: </span><span class="si">{</span><span class="n">speed</span><span class="si">}</span><span class="s2"> invalid.&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">get_sequence_id_from_arguments</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">intensity</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">speed</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get sequence ID from stimulus arguments.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stimulus_index</span><span class="p">(</span><span class="nb">locals</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get parameters for a given key.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="k">def</span> <span class="nf">_group_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">intensity</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get group key for a specific stimulus configuration.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg_group_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;angle==</span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2">&quot;</span> <span class="sa">f</span><span class="s2">&quot; &amp; width==</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s2">&quot;</span> <span class="sa">f</span><span class="s2">&quot; &amp; intensity == </span><span class="si">{</span><span class="n">intensity</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_group_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get group parameters for a given key.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg_group_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">intensity</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">speed</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get stimulus for specific parameters.&quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">speed</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get stimulus for a specific key.&quot;&quot;&quot;</span>
        <span class="n">angle</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="p">[</span><span class="n">speed</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_group_key</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">mask</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">angle</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">intensity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">speed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">t_stim</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a mask for specific stimulus parameters.&quot;&quot;&quot;</span>
        <span class="c1"># 22x faster than df.query</span>
        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg_df</span><span class="o">.</span><span class="n">values</span>

        <span class="k">def</span> <span class="nf">iterparam</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">and_condition</span><span class="p">):</span>
            <span class="n">condition</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
                    <span class="n">_new</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">p</span>
                    <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span><span class="n">_new</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2"> not in dataset.&quot;</span>
                    <span class="n">condition</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">_new</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_new</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">param</span>
                <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span><span class="n">_new</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> not in dataset.&quot;</span>
                <span class="n">condition</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">_new</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">condition</span> <span class="o">&amp;</span> <span class="n">and_condition</span>

        <span class="n">condition</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">angle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">condition</span> <span class="o">=</span> <span class="n">iterparam</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="s2">&quot;angle&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">condition</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">condition</span> <span class="o">=</span> <span class="n">iterparam</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">condition</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">intensity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">condition</span> <span class="o">=</span> <span class="n">iterparam</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="s2">&quot;intensity&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">condition</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t_stim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">condition</span> <span class="o">=</span> <span class="n">iterparam</span><span class="p">(</span><span class="n">t_stim</span><span class="p">,</span> <span class="s2">&quot;t_stim&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">condition</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">speed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">condition</span> <span class="o">=</span> <span class="n">iterparam</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span> <span class="s2">&quot;speed&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">condition</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">condition</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Time array for the stimulus.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">t_pre</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_stim_max</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_post</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">stimulus</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">angle</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">intensity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">speed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">pre_stim</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">post_stim</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get stimulus for specific parameters.</span>

<span class="sd">        Args:</span>
<span class="sd">            angle: Angle of the bar.</span>
<span class="sd">            width: Width of the bar.</span>
<span class="sd">            intensity: Intensity of the bar.</span>
<span class="sd">            speed: Speed of the bar.</span>
<span class="sd">            pre_stim: Include pre-stimulus period.</span>
<span class="sd">            post_stim: Include post-stimulus period.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Stimulus array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">speed</span><span class="p">)</span>
        <span class="n">stim</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">][:,</span> <span class="mi">360</span><span class="p">]</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">post_stim</span><span class="p">:</span>
            <span class="n">stim</span> <span class="o">=</span> <span class="n">filter_post</span><span class="p">([</span><span class="n">stim</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_post</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pre_stim</span><span class="p">:</span>
            <span class="n">stim</span> <span class="o">=</span> <span class="n">filter_pre</span><span class="p">(</span><span class="n">stim</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_pre</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">stim</span>

    <span class="k">def</span> <span class="nf">stimulus_parameters</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">angle</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">intensity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">speed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get stimulus parameters.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">_number_to_list</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
            <span class="n">returns</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
                    <span class="n">returns</span> <span class="o">+=</span> <span class="p">([</span><span class="n">arg</span><span class="p">],)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">returns</span> <span class="o">+=</span> <span class="p">(</span><span class="n">arg</span><span class="p">,)</span>
            <span class="k">return</span> <span class="n">returns</span>

        <span class="n">angle</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">intensity</span> <span class="o">=</span> <span class="n">_number_to_list</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">angle</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">width</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">widths</span>
        <span class="n">intensity</span> <span class="o">=</span> <span class="n">intensity</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensities</span>
        <span class="n">speed</span> <span class="o">=</span> <span class="n">speed</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">speeds</span>
        <span class="k">return</span> <span class="n">angle</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">speed</span>

    <span class="k">def</span> <span class="nf">sample_shape</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">angle</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">intensity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">speed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get shape of stimulus sample for given parameters.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="p">[</span><span class="n">angle</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="n">width</span> <span class="o">=</span> <span class="p">[</span><span class="n">width</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="n">speed</span> <span class="o">=</span> <span class="p">[</span><span class="n">speed</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="p">[</span><span class="n">intensity</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">angle</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">width</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">widths</span>
        <span class="n">intensity</span> <span class="o">=</span> <span class="n">intensity</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensities</span>
        <span class="n">speed</span> <span class="o">=</span> <span class="n">speed</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">speeds</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">width</span><span class="p">),</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">intensity</span><span class="p">),</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">speed</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">time_to_center</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate time for bar to reach center at given speed.&quot;&quot;&quot;</span>
        <span class="c1"># Note: time = distance / velocity, i.e.</span>
        <span class="c1">#     time = (n_leds * led_width) / (speed * omm_width)</span>
        <span class="c1">#     with speed in ommatidia / s.</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">offsets</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">led_width</span> <span class="o">/</span> <span class="p">(</span><span class="n">speed</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">omm_width</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_time_with_origin_at_onset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get time array with origin at stimulus onset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">t_pre</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t_stim_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_pre</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_post</span><span class="p">,</span>
            <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_stim_max</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
            <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_post</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
            <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_pre</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_time_with_origin_at_center</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get time array with origin where bar reaches central column.&quot;&quot;&quot;</span>
        <span class="n">time_to_center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_to_center</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
        <span class="n">n_steps</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_stim_max</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
            <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_post</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
            <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_pre</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_pre</span> <span class="o">+</span> <span class="n">time_to_center</span><span class="p">),</span>
            <span class="n">n_steps</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_pre</span> <span class="o">+</span> <span class="n">time_to_center</span><span class="p">),</span>
            <span class="n">n_steps</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">stimulus_cartoon</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">intensity</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">speed</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">time_after_stimulus_onset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">fig</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ax</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">facecolor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;#000000&quot;</span><span class="p">,</span>
        <span class="n">cmap</span><span class="p">:</span> <span class="n">Colormap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">,</span>
        <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">vmin</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">vmax</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">edgecolor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="n">central_hex_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;#2f7cb9&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a cartoon representation of the stimulus.&quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">init_plot</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

        <span class="n">time</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">t_pre</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_stim_max</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_post</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_pre</span>
        <span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">time</span> <span class="o">-</span> <span class="n">time_after_stimulus_onset</span><span class="p">))</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">quick_hex_scatter</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="n">angle</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="n">speed</span><span class="p">,</span> <span class="n">intensity</span><span class="o">=</span><span class="n">intensity</span><span class="p">)</span>
            <span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
            <span class="o">.</span><span class="n">numpy</span><span class="p">()[</span><span class="n">index</span><span class="p">],</span>
            <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
            <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
            <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">max_extent</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">rotation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span> <span class="o">-</span> <span class="mi">90</span><span class="p">)),</span>
                <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span> <span class="o">-</span> <span class="mi">90</span><span class="p">)),</span>
            <span class="p">],</span>
            <span class="p">[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span> <span class="o">-</span> <span class="mi">90</span><span class="p">)),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span> <span class="o">-</span> <span class="mi">90</span><span class="p">)),</span>
            <span class="p">],</span>
        <span class="p">])</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">rotation</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">rotation</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span>
            <span class="o">*</span><span class="n">x</span><span class="p">,</span>
            <span class="o">*</span><span class="n">dx</span><span class="p">,</span>
            <span class="n">facecolor</span><span class="o">=</span><span class="n">facecolor</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span>
            <span class="n">head_length</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">_hex</span> <span class="o">=</span> <span class="n">RegularPolygon</span><span class="p">(</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">numVertices</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
            <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">orientation</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="n">central_hex_color</span><span class="p">,</span>
            <span class="n">facecolor</span><span class="o">=</span><span class="n">central_hex_color</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">_hex</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="flyvision.datasets.moving_bar.MovingBar.dt" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">dt</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

<a href="#flyvision.datasets.moving_bar.MovingBar.dt" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="n">dt</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Time step in seconds.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="flyvision.datasets.moving_bar.MovingBar.t_pre" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">t_pre</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#flyvision.datasets.moving_bar.MovingBar.t_pre" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="n">t_pre</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Time before stimulus onset in seconds.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="flyvision.datasets.moving_bar.MovingBar.t_post" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">t_post</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#flyvision.datasets.moving_bar.MovingBar.t_post" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="n">t_post</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Time after stimulus offset in seconds.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="flyvision.datasets.moving_bar.MovingBar.time" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">time</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#flyvision.datasets.moving_bar.MovingBar.time" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="n">time</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Time array for the stimulus.</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h4 id="flyvision.datasets.moving_bar.MovingBar.get_sequence_id_from_arguments" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_sequence_id_from_arguments</span>


<a href="#flyvision.datasets.moving_bar.MovingBar.get_sequence_id_from_arguments" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">get_sequence_id_from_arguments</span><span class="p">(</span>
    <span class="n">angle</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">speed</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get sequence ID from stimulus arguments.</p>

            <details class="quote">
              <summary>Source code in <code>flyvision/datasets/moving_bar.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_sequence_id_from_arguments</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">intensity</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">speed</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get sequence ID from stimulus arguments.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stimulus_index</span><span class="p">(</span><span class="nb">locals</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.datasets.moving_bar.MovingBar.get" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get</span>


<a href="#flyvision.datasets.moving_bar.MovingBar.get" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">get</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">speed</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get stimulus for specific parameters.</p>

            <details class="quote">
              <summary>Source code in <code>flyvision/datasets/moving_bar.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">intensity</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">speed</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get stimulus for specific parameters.&quot;&quot;&quot;</span>
    <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">speed</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.datasets.moving_bar.MovingBar.get_item" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_item</span>


<a href="#flyvision.datasets.moving_bar.MovingBar.get_item" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">get_item</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get stimulus for a specific key.</p>

            <details class="quote">
              <summary>Source code in <code>flyvision/datasets/moving_bar.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get stimulus for a specific key.&quot;&quot;&quot;</span>
    <span class="n">angle</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="p">[</span><span class="n">speed</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_group_key</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.datasets.moving_bar.MovingBar.mask" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">mask</span>


<a href="#flyvision.datasets.moving_bar.MovingBar.mask" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">mask</span><span class="p">(</span>
    <span class="n">angle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">intensity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">speed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">t_stim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a mask for specific stimulus parameters.</p>

            <details class="quote">
              <summary>Source code in <code>flyvision/datasets/moving_bar.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">mask</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">angle</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">intensity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">speed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">t_stim</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a mask for specific stimulus parameters.&quot;&quot;&quot;</span>
    <span class="c1"># 22x faster than df.query</span>
    <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg_df</span><span class="o">.</span><span class="n">values</span>

    <span class="k">def</span> <span class="nf">iterparam</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">and_condition</span><span class="p">):</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
                <span class="n">_new</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">p</span>
                <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span><span class="n">_new</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2"> not in dataset.&quot;</span>
                <span class="n">condition</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">_new</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_new</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">param</span>
            <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span><span class="n">_new</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> not in dataset.&quot;</span>
            <span class="n">condition</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">_new</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">condition</span> <span class="o">&amp;</span> <span class="n">and_condition</span>

    <span class="n">condition</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">angle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="n">iterparam</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="s2">&quot;angle&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">condition</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="n">iterparam</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">condition</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">intensity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="n">iterparam</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="s2">&quot;intensity&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">condition</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">t_stim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="n">iterparam</span><span class="p">(</span><span class="n">t_stim</span><span class="p">,</span> <span class="s2">&quot;t_stim&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">condition</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">speed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="n">iterparam</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span> <span class="s2">&quot;speed&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">condition</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">condition</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.datasets.moving_bar.MovingBar.stimulus" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">stimulus</span>


<a href="#flyvision.datasets.moving_bar.MovingBar.stimulus" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">stimulus</span><span class="p">(</span>
    <span class="n">angle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">intensity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">speed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">pre_stim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">post_stim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get stimulus for specific parameters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>angle</code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Angle of the bar.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>width</code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Width of the bar.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>intensity</code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Intensity of the bar.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>speed</code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Speed of the bar.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>pre_stim</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Include pre-stimulus period.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>post_stim</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Include post-stimulus period.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Stimulus array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/datasets/moving_bar.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">stimulus</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">angle</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">intensity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">speed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">pre_stim</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">post_stim</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get stimulus for specific parameters.</span>

<span class="sd">    Args:</span>
<span class="sd">        angle: Angle of the bar.</span>
<span class="sd">        width: Width of the bar.</span>
<span class="sd">        intensity: Intensity of the bar.</span>
<span class="sd">        speed: Speed of the bar.</span>
<span class="sd">        pre_stim: Include pre-stimulus period.</span>
<span class="sd">        post_stim: Include post-stimulus period.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Stimulus array.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">speed</span><span class="p">)</span>
    <span class="n">stim</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">][:,</span> <span class="mi">360</span><span class="p">]</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">post_stim</span><span class="p">:</span>
        <span class="n">stim</span> <span class="o">=</span> <span class="n">filter_post</span><span class="p">([</span><span class="n">stim</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_post</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pre_stim</span><span class="p">:</span>
        <span class="n">stim</span> <span class="o">=</span> <span class="n">filter_pre</span><span class="p">(</span><span class="n">stim</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_pre</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">stim</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.datasets.moving_bar.MovingBar.stimulus_parameters" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">stimulus_parameters</span>


<a href="#flyvision.datasets.moving_bar.MovingBar.stimulus_parameters" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">stimulus_parameters</span><span class="p">(</span>
    <span class="n">angle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">intensity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get stimulus parameters.</p>

            <details class="quote">
              <summary>Source code in <code>flyvision/datasets/moving_bar.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">stimulus_parameters</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">angle</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">intensity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">speed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get stimulus parameters.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_number_to_list</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="n">returns</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
                <span class="n">returns</span> <span class="o">+=</span> <span class="p">([</span><span class="n">arg</span><span class="p">],)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">returns</span> <span class="o">+=</span> <span class="p">(</span><span class="n">arg</span><span class="p">,)</span>
        <span class="k">return</span> <span class="n">returns</span>

    <span class="n">angle</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">intensity</span> <span class="o">=</span> <span class="n">_number_to_list</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="n">angle</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">width</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">widths</span>
    <span class="n">intensity</span> <span class="o">=</span> <span class="n">intensity</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensities</span>
    <span class="n">speed</span> <span class="o">=</span> <span class="n">speed</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">speeds</span>
    <span class="k">return</span> <span class="n">angle</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">speed</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.datasets.moving_bar.MovingBar.sample_shape" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">sample_shape</span>


<a href="#flyvision.datasets.moving_bar.MovingBar.sample_shape" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">sample_shape</span><span class="p">(</span>
    <span class="n">angle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">intensity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get shape of stimulus sample for given parameters.</p>

            <details class="quote">
              <summary>Source code in <code>flyvision/datasets/moving_bar.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sample_shape</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">angle</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">intensity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">speed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get shape of stimulus sample for given parameters.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="p">[</span><span class="n">angle</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
        <span class="n">width</span> <span class="o">=</span> <span class="p">[</span><span class="n">width</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
        <span class="n">speed</span> <span class="o">=</span> <span class="p">[</span><span class="n">speed</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
        <span class="n">intensity</span> <span class="o">=</span> <span class="p">[</span><span class="n">intensity</span><span class="p">]</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="n">angle</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">width</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">widths</span>
    <span class="n">intensity</span> <span class="o">=</span> <span class="n">intensity</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensities</span>
    <span class="n">speed</span> <span class="o">=</span> <span class="n">speed</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">speeds</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">width</span><span class="p">),</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">intensity</span><span class="p">),</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">speed</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.datasets.moving_bar.MovingBar.time_to_center" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">time_to_center</span>


<a href="#flyvision.datasets.moving_bar.MovingBar.time_to_center" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">time_to_center</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate time for bar to reach center at given speed.</p>

            <details class="quote">
              <summary>Source code in <code>flyvision/datasets/moving_bar.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">time_to_center</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate time for bar to reach center at given speed.&quot;&quot;&quot;</span>
    <span class="c1"># Note: time = distance / velocity, i.e.</span>
    <span class="c1">#     time = (n_leds * led_width) / (speed * omm_width)</span>
    <span class="c1">#     with speed in ommatidia / s.</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">offsets</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">led_width</span> <span class="o">/</span> <span class="p">(</span><span class="n">speed</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">omm_width</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.datasets.moving_bar.MovingBar.get_time_with_origin_at_onset" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_time_with_origin_at_onset</span>


<a href="#flyvision.datasets.moving_bar.MovingBar.get_time_with_origin_at_onset" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">get_time_with_origin_at_onset</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get time array with origin at stimulus onset.</p>

            <details class="quote">
              <summary>Source code in <code>flyvision/datasets/moving_bar.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_time_with_origin_at_onset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get time array with origin at stimulus onset.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
        <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">t_pre</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_stim_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_pre</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_post</span><span class="p">,</span>
        <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_stim_max</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
        <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_post</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
        <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_pre</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.datasets.moving_bar.MovingBar.get_time_with_origin_at_center" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_time_with_origin_at_center</span>


<a href="#flyvision.datasets.moving_bar.MovingBar.get_time_with_origin_at_center" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">get_time_with_origin_at_center</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get time array with origin where bar reaches central column.</p>

            <details class="quote">
              <summary>Source code in <code>flyvision/datasets/moving_bar.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_time_with_origin_at_center</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get time array with origin where bar reaches central column.&quot;&quot;&quot;</span>
    <span class="n">time_to_center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_to_center</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
    <span class="n">n_steps</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_stim_max</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
        <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_post</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
        <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_pre</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
        <span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_pre</span> <span class="o">+</span> <span class="n">time_to_center</span><span class="p">),</span>
        <span class="n">n_steps</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_pre</span> <span class="o">+</span> <span class="n">time_to_center</span><span class="p">),</span>
        <span class="n">n_steps</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.datasets.moving_bar.MovingBar.stimulus_cartoon" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">stimulus_cartoon</span>


<a href="#flyvision.datasets.moving_bar.MovingBar.stimulus_cartoon" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">stimulus_cartoon</span><span class="p">(</span>
    <span class="n">angle</span><span class="p">,</span>
    <span class="n">width</span><span class="p">,</span>
    <span class="n">intensity</span><span class="p">,</span>
    <span class="n">speed</span><span class="p">,</span>
    <span class="n">time_after_stimulus_onset</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;#000000&quot;</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
    <span class="n">central_hex_color</span><span class="o">=</span><span class="s2">&quot;#2f7cb9&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a cartoon representation of the stimulus.</p>

            <details class="quote">
              <summary>Source code in <code>flyvision/datasets/moving_bar.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">stimulus_cartoon</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">intensity</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">speed</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">time_after_stimulus_onset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">fig</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">facecolor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;#000000&quot;</span><span class="p">,</span>
    <span class="n">cmap</span><span class="p">:</span> <span class="n">Colormap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">,</span>
    <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">vmin</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">vmax</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">edgecolor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
    <span class="n">central_hex_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;#2f7cb9&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a cartoon representation of the stimulus.&quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">init_plot</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

    <span class="n">time</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t_pre</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_stim_max</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_post</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_pre</span>
    <span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">time</span> <span class="o">-</span> <span class="n">time_after_stimulus_onset</span><span class="p">))</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">quick_hex_scatter</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="n">angle</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="n">speed</span><span class="p">,</span> <span class="n">intensity</span><span class="o">=</span><span class="n">intensity</span><span class="p">)</span>
        <span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
        <span class="o">.</span><span class="n">numpy</span><span class="p">()[</span><span class="n">index</span><span class="p">],</span>
        <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
        <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">max_extent</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">rotation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span> <span class="o">-</span> <span class="mi">90</span><span class="p">)),</span>
            <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span> <span class="o">-</span> <span class="mi">90</span><span class="p">)),</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span> <span class="o">-</span> <span class="mi">90</span><span class="p">)),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span> <span class="o">-</span> <span class="mi">90</span><span class="p">)),</span>
        <span class="p">],</span>
    <span class="p">])</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">rotation</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">])</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">rotation</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span>
        <span class="o">*</span><span class="n">x</span><span class="p">,</span>
        <span class="o">*</span><span class="n">dx</span><span class="p">,</span>
        <span class="n">facecolor</span><span class="o">=</span><span class="n">facecolor</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span>
        <span class="n">head_length</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">_hex</span> <span class="o">=</span> <span class="n">RegularPolygon</span><span class="p">(</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">numVertices</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
        <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">orientation</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="n">central_hex_color</span><span class="p">,</span>
        <span class="n">facecolor</span><span class="o">=</span><span class="n">central_hex_color</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">_hex</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="flyvision.datasets.moving_bar.MovingEdge" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">flyvision.datasets.moving_bar.MovingEdge</span>


<a href="#flyvision.datasets.moving_bar.MovingEdge" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="flyvision.datasets.moving_bar.MovingBar" href="../datasets/#flyvision.datasets.moving_bar.MovingBar">MovingBar</a></code></p>


        <p>Moving edge stimulus.</p>
<p>This class creates a moving edge stimulus by using a very wide bar.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>offsets</code></td>
            <td>
                  <code>tuple[int, int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>First and last offset to the central column in half ommatidia.</p>
              </div>
            </td>
            <td>
                  <code>(-10, 11)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>intensities</code></td>
            <td>
                  <code>list[float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Intensity of the edge.</p>
              </div>
            </td>
            <td>
                  <code>[0, 1]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>speeds</code></td>
            <td>
                  <code>list[float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Speed of the edge in half ommatidia per second.</p>
              </div>
            </td>
            <td>
                  <code>[2.4, 4.8, 9.7, 13, 19, 25]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>height</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Height of the edge in half ommatidia.</p>
              </div>
            </td>
            <td>
                  <code>9</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>dt</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time step in seconds.</p>
              </div>
            </td>
            <td>
                  <code>1 / 200</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>device</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device to store the stimulus.</p>
              </div>
            </td>
            <td>
                  <code><span title="flyvision.device">device</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>post_pad_mode</code></td>
            <td>
                  <code><span title="typing_extensions.Literal">Literal</span>[&#39;continue&#39;, &#39;value&#39;, &#39;reflect&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Padding mode after the stimulus.</p>
              </div>
            </td>
            <td>
                  <code>&#39;continue&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>t_pre</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time before the stimulus in seconds.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>t_post</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time after the stimulus in seconds.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>build_stim_on_init</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Build the stimulus on initialization.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>shuffle_offsets</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shuffle the offsets to remove spatio-temporal correlation.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>seed</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Seed for the random state.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>angles</code></td>
            <td>
                  <code>list[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of angles in degrees.</p>
              </div>
            </td>
            <td>
                  <code>[0, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330]</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>This class uses a very wide bar (width=80) under the hood to render an
edge stimulus.</p>
</details>
              <details class="quote">
                <summary>Source code in <code>flyvision/datasets/moving_bar.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MovingEdge</span><span class="p">(</span><span class="n">MovingBar</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Moving edge stimulus.</span>

<span class="sd">    This class creates a moving edge stimulus by using a very wide bar.</span>

<span class="sd">    Args:</span>
<span class="sd">        offsets: First and last offset to the central column in half ommatidia.</span>
<span class="sd">        intensities: Intensity of the edge.</span>
<span class="sd">        speeds: Speed of the edge in half ommatidia per second.</span>
<span class="sd">        height: Height of the edge in half ommatidia.</span>
<span class="sd">        dt: Time step in seconds.</span>
<span class="sd">        device: Device to store the stimulus.</span>
<span class="sd">        post_pad_mode: Padding mode after the stimulus.</span>
<span class="sd">        t_pre: Time before the stimulus in seconds.</span>
<span class="sd">        t_post: Time after the stimulus in seconds.</span>
<span class="sd">        build_stim_on_init: Build the stimulus on initialization.</span>
<span class="sd">        shuffle_offsets: Shuffle the offsets to remove spatio-temporal correlation.</span>
<span class="sd">        seed: Seed for the random state.</span>
<span class="sd">        angles: List of angles in degrees.</span>

<span class="sd">    Note:</span>
<span class="sd">        This class uses a very wide bar (width=80) under the hood to render an</span>
<span class="sd">        edge stimulus.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">offsets</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
        <span class="n">intensities</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">speeds</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.4</span><span class="p">,</span> <span class="mf">4.8</span><span class="p">,</span> <span class="mf">9.7</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">25</span><span class="p">],</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span>
        <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">200</span><span class="p">,</span>
        <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">flyvision</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
        <span class="n">post_pad_mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;continue&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;reflect&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;continue&quot;</span><span class="p">,</span>
        <span class="n">t_pre</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">t_post</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">build_stim_on_init</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">shuffle_offsets</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">angles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">330</span><span class="p">],</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">widths</span><span class="o">=</span><span class="p">[</span><span class="mi">80</span><span class="p">],</span>
            <span class="n">offsets</span><span class="o">=</span><span class="n">offsets</span><span class="p">,</span>
            <span class="n">intensities</span><span class="o">=</span><span class="n">intensities</span><span class="p">,</span>
            <span class="n">speeds</span><span class="o">=</span><span class="n">speeds</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
            <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
            <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
            <span class="n">bar_loc_horizontal</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">post_pad_mode</span><span class="o">=</span><span class="n">post_pad_mode</span><span class="p">,</span>
            <span class="n">t_pre</span><span class="o">=</span><span class="n">t_pre</span><span class="p">,</span>
            <span class="n">t_post</span><span class="o">=</span><span class="n">t_post</span><span class="p">,</span>
            <span class="n">build_stim_on_init</span><span class="o">=</span><span class="n">build_stim_on_init</span><span class="p">,</span>
            <span class="n">shuffle_offsets</span><span class="o">=</span><span class="n">shuffle_offsets</span><span class="p">,</span>
            <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
            <span class="n">angles</span><span class="o">=</span><span class="n">angles</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div><h2 id="response-analysis">Response Analysis<a class="headerlink" href="#response-analysis" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<h3 id="flyvision.analysis.moving_bar_responses" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">flyvision.analysis.moving_bar_responses</span>


<a href="#flyvision.analysis.moving_bar_responses" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents first">

        <p>Analysis of responses to moving edges or bars.</p>


<details class="info" open>
  <summary>Info</summary>
  <p>Relies on xarray dataset format defined in <code>flyvision.analysis.stimulus_responses</code>.</p>
</details>


  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_bar_responses.peak_responses" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">peak_responses</span>


<a href="#flyvision.analysis.moving_bar_responses.peak_responses" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">peak_responses</span><span class="p">(</span>
    <span class="n">dataset</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">from_degree</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">to_degree</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute peak responses from rectified voltages, optionally normalized.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>dataset</code></td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input dataset containing &lsquo;responses&rsquo; and necessary coordinates.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>norm</code></td>
            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Normalization array.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>from_degree</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Starting degree for masking.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>to_degree</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Ending degree for masking.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Peak responses with reshaped and transposed dimensions.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_bar_responses.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">peak_responses</span><span class="p">(</span>
    <span class="n">dataset</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span>
    <span class="n">norm</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">from_degree</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">to_degree</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute peak responses from rectified voltages, optionally normalized.</span>

<span class="sd">    Args:</span>
<span class="sd">        dataset: Input dataset containing &#39;responses&#39; and necessary coordinates.</span>
<span class="sd">        norm: Normalization array.</span>
<span class="sd">        from_degree: Starting degree for masking.</span>
<span class="sd">        to_degree: Ending degree for masking.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Peak responses with reshaped and transposed dimensions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>
    <span class="n">from_degree</span> <span class="o">=</span> <span class="n">from_degree</span> <span class="k">if</span> <span class="n">from_degree</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;offsets&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.25</span>
    <span class="n">to_degree</span> <span class="o">=</span> <span class="n">to_degree</span> <span class="k">if</span> <span class="n">to_degree</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;offsets&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">2.25</span>

    <span class="c1"># Generate time masks</span>
    <span class="n">masks</span> <span class="o">=</span> <span class="n">get_time_masks</span><span class="p">(</span>
        <span class="n">dataset</span><span class="p">,</span> <span class="n">from_column</span><span class="o">=</span><span class="n">from_degree</span> <span class="o">/</span> <span class="mf">5.8</span><span class="p">,</span> <span class="n">to_column</span><span class="o">=</span><span class="n">to_degree</span> <span class="o">/</span> <span class="mf">5.8</span>
    <span class="p">)</span>

    <span class="c1"># Apply masks to responses and rectify</span>
    <span class="n">responses</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;responses&#39;</span><span class="p">]</span>
    <span class="n">masked</span> <span class="o">=</span> <span class="n">responses</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">masks</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">rectified</span> <span class="o">=</span> <span class="n">masked</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Rectify: max(0, response)</span>

    <span class="c1"># Normalize if provided</span>
    <span class="k">if</span> <span class="n">norm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rectified</span> <span class="o">=</span> <span class="n">rectified</span> <span class="o">/</span> <span class="n">norm</span>

    <span class="c1"># Compute peak (maximum over &#39;frame&#39;)</span>
    <span class="n">peak</span> <span class="o">=</span> <span class="n">rectified</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;frame&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">peak</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_bar_responses.get_time_masks" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_time_masks</span>


<a href="#flyvision.analysis.moving_bar_responses.get_time_masks" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">get_time_masks</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">from_column</span><span class="o">=-</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">to_column</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate time masks for each sample based on speed and column range.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>dataset</code></td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input dataset containing &lsquo;speed&rsquo; and &lsquo;time&rsquo; coordinates.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>from_column</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start of the column range.</p>
              </div>
            </td>
            <td>
                  <code>-1.5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>to_column</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End of the column range.</p>
              </div>
            </td>
            <td>
                  <code>1.5</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Boolean mask with dimensions (&lsquo;sample&rsquo;, &lsquo;frame&rsquo;).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_bar_responses.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_time_masks</span><span class="p">(</span>
    <span class="n">dataset</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">from_column</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">to_column</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate time masks for each sample based on speed and column range.</span>

<span class="sd">    Args:</span>
<span class="sd">        dataset: Input dataset containing &#39;speed&#39; and &#39;time&#39; coordinates.</span>
<span class="sd">        from_column: Start of the column range.</span>
<span class="sd">        to_column: End of the column range.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Boolean mask with dimensions (&#39;sample&#39;, &#39;frame&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">speeds</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;speed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">unique_speeds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">speeds</span><span class="p">)</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>
    <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;offsets&#39;</span><span class="p">]</span>
    <span class="n">times</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="c1"># Precompute masks for unique speeds</span>
    <span class="n">mask_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">speed</span> <span class="ow">in</span> <span class="n">unique_speeds</span><span class="p">:</span>
        <span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span> <span class="o">=</span> <span class="n">time_window</span><span class="p">(</span>
            <span class="n">speed</span><span class="p">,</span> <span class="n">from_column</span><span class="o">=</span><span class="n">from_column</span><span class="p">,</span> <span class="n">to_column</span><span class="o">=</span><span class="n">to_column</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span>
        <span class="p">)</span>
        <span class="n">mask_dict</span><span class="p">[</span><span class="n">speed</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask_between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>

    <span class="c1"># Map masks to each sample based on its speed</span>
    <span class="n">masks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mask_dict</span><span class="p">[</span><span class="n">speed</span><span class="p">]</span> <span class="k">for</span> <span class="n">speed</span> <span class="ow">in</span> <span class="n">speeds</span><span class="p">])</span>

    <span class="c1"># Create a DataArray for the masks</span>
    <span class="n">mask_da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">masks</span><span class="p">,</span>
        <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="s1">&#39;frame&#39;</span><span class="p">),</span>
        <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sample&#39;</span><span class="p">:</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;sample&#39;</span><span class="p">],</span> <span class="s1">&#39;frame&#39;</span><span class="p">:</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;frame&#39;</span><span class="p">]},</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">mask_da</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_bar_responses.peak_responses_angular" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">peak_responses_angular</span>


<a href="#flyvision.analysis.moving_bar_responses.peak_responses_angular" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">peak_responses_angular</span><span class="p">(</span>
    <span class="n">dataset</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">from_degree</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">to_degree</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute peak responses and make them complex over angles.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>dataset</code></td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>norm</code></td>
            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Normalization array.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>from_degree</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Starting degree for masking.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>to_degree</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Ending degree for masking.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Complex-valued peak responses.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_bar_responses.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">peak_responses_angular</span><span class="p">(</span>
    <span class="n">dataset</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span>
    <span class="n">norm</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">from_degree</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">to_degree</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute peak responses and make them complex over angles.</span>

<span class="sd">    Args:</span>
<span class="sd">        dataset: Input dataset.</span>
<span class="sd">        norm: Normalization array.</span>
<span class="sd">        from_degree: Starting degree for masking.</span>
<span class="sd">        to_degree: Ending degree for masking.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Complex-valued peak responses.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">peak</span> <span class="o">=</span> <span class="n">peak_responses</span><span class="p">(</span>
        <span class="n">dataset</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">from_degree</span><span class="o">=</span><span class="n">from_degree</span><span class="p">,</span> <span class="n">to_degree</span><span class="o">=</span><span class="n">to_degree</span>
    <span class="p">)</span>

    <span class="c1"># Make complex over angles</span>
    <span class="n">angles</span> <span class="o">=</span> <span class="n">peak</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">radians</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
    <span class="c1"># Expand dimensions to match broadcasting</span>
    <span class="n">radians</span> <span class="o">=</span> <span class="n">radians</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">complex_peak</span> <span class="o">=</span> <span class="n">peak</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">radians</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">complex_peak</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_bar_responses.direction_selectivity_index" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">direction_selectivity_index</span>


<a href="#flyvision.analysis.moving_bar_responses.direction_selectivity_index" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">direction_selectivity_index</span><span class="p">(</span>
    <span class="n">dataset</span><span class="p">,</span>
    <span class="n">average</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">from_degree</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">to_degree</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute Direction Selectivity Index (DSI).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>dataset</code></td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>average</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to average over &lsquo;width&rsquo; and &lsquo;speed&rsquo;.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>norm</code></td>
            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Normalization array.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>from_degree</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Starting degree for masking.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>to_degree</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Ending degree for masking.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Direction Selectivity Index.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_bar_responses.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">direction_selectivity_index</span><span class="p">(</span>
    <span class="n">dataset</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span>
    <span class="n">average</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">norm</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">from_degree</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">to_degree</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute Direction Selectivity Index (DSI).</span>

<span class="sd">    Args:</span>
<span class="sd">        dataset: Input dataset.</span>
<span class="sd">        average: Whether to average over &#39;width&#39; and &#39;speed&#39;.</span>
<span class="sd">        norm: Normalization array.</span>
<span class="sd">        from_degree: Starting degree for masking.</span>
<span class="sd">        to_degree: Ending degree for masking.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Direction Selectivity Index.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">view</span> <span class="o">=</span> <span class="n">peak_responses_angular</span><span class="p">(</span>
        <span class="n">dataset</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">from_degree</span><span class="o">=</span><span class="n">from_degree</span><span class="p">,</span> <span class="n">to_degree</span><span class="o">=</span><span class="n">to_degree</span>
    <span class="p">)</span>
    <span class="n">view</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">sample</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="s2">&quot;intensity&quot;</span><span class="p">,</span> <span class="s2">&quot;speed&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span>
        <span class="s2">&quot;sample&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Compute vector sum over &#39;angle&#39;</span>
    <span class="n">vector_sum</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;angle&#39;</span><span class="p">)</span>
    <span class="n">vector_length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vector_sum</span><span class="p">)</span>

    <span class="c1"># Normalization: sum of absolute responses</span>
    <span class="n">normalization</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">view</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;angle&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;intensity&#39;</span><span class="p">)</span>
    <span class="n">dsi</span> <span class="o">=</span> <span class="n">vector_length</span> <span class="o">/</span> <span class="p">(</span><span class="n">normalization</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">average</span><span class="p">:</span>
        <span class="c1"># Average over &#39;width&#39; and &#39;speed&#39;</span>
        <span class="n">dsi</span> <span class="o">=</span> <span class="n">dsi</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="s1">&#39;speed&#39;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">dsi</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_bar_responses.prepare_dsi_data" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">prepare_dsi_data</span>


<a href="#flyvision.analysis.moving_bar_responses.prepare_dsi_data" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">prepare_dsi_data</span><span class="p">(</span>
    <span class="n">dsis</span><span class="p">,</span>
    <span class="n">cell_types</span><span class="p">,</span>
    <span class="n">sorted_type_list</span><span class="p">,</span>
    <span class="n">known_on_off_first</span><span class="p">,</span>
    <span class="n">sort_descending</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Prepare DSI data for plotting.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>dsis</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of DSI values.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cell_types</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of cell type labels.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>sorted_type_list</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of cell types in desired order.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>known_on_off_first</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to sort known ON/OFF types first.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>sort_descending</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to sort DSIs in descending order.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of prepared DSIs and cell types.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_bar_responses.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">prepare_dsi_data</span><span class="p">(</span>
    <span class="n">dsis</span><span class="p">,</span> <span class="n">cell_types</span><span class="p">,</span> <span class="n">sorted_type_list</span><span class="p">,</span> <span class="n">known_on_off_first</span><span class="p">,</span> <span class="n">sort_descending</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prepare DSI data for plotting.</span>

<span class="sd">    Args:</span>
<span class="sd">        dsis: Array of DSI values.</span>
<span class="sd">        cell_types: Array of cell type labels.</span>
<span class="sd">        sorted_type_list: List of cell types in desired order.</span>
<span class="sd">        known_on_off_first: Whether to sort known ON/OFF types first.</span>
<span class="sd">        sort_descending: Whether to sort DSIs in descending order.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple of prepared DSIs and cell types.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">known_on_off_first</span><span class="p">:</span>
        <span class="n">sorted_type_list</span> <span class="o">=</span> <span class="n">nodes_edges_utils</span><span class="o">.</span><span class="n">nodes_list_sorting_on_off_unknown</span><span class="p">(</span><span class="n">cell_types</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sorted_type_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dsis</span> <span class="o">=</span> <span class="n">nodes_edges_utils</span><span class="o">.</span><span class="n">sort_by_mapping_lists</span><span class="p">(</span>
            <span class="n">cell_types</span><span class="p">,</span> <span class="n">sorted_type_list</span><span class="p">,</span> <span class="n">dsis</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span>
        <span class="n">cell_types</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sorted_type_list</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sort_descending</span><span class="p">:</span>
        <span class="n">medians</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">dsis</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">medians</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">dsis</span> <span class="o">=</span> <span class="n">dsis</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">cell_types</span> <span class="o">=</span> <span class="n">cell_types</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">dsis</span><span class="p">,</span> <span class="n">cell_types</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_bar_responses.dsi_violins" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dsi_violins</span>


<a href="#flyvision.analysis.moving_bar_responses.dsi_violins" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">dsi_violins</span><span class="p">(</span>
    <span class="n">dsis</span><span class="p">,</span>
    <span class="n">cell_types</span><span class="p">,</span>
    <span class="n">scatter_best</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">scatter_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">showmeans</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">showmedians</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">sorted_type_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">sort_descending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">known_on_off_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">scatter_kwargs</span><span class="o">=</span><span class="p">{},</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create violin plots for Direction Selectivity Index (DSI) data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>dsis</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of DSI values.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cell_types</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of cell type labels.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>scatter_best</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to scatter the best points.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>scatter_all</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to scatter all points.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cmap</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Colormap for the violins.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>colors</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific colors for the violins.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>color</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Default color if colors is None and cmap is None.</p>
              </div>
            </td>
            <td>
                  <code>&#39;b&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>figsize</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Figure size.</p>
              </div>
            </td>
            <td>
                  <code>[10, 1]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fontsize</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Font size for labels.</p>
              </div>
            </td>
            <td>
                  <code>6</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>showmeans</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to show means on violins.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>showmedians</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to show medians on violins.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>sorted_type_list</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of cell types in desired order.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>sort_descending</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to sort DSIs in descending order.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>known_on_off_first</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to sort known ON/OFF types first.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>**kwargs</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments for violin_groups.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of (figure, axis, colors, prepared DSIs)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_bar_responses.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">dsi_violins</span><span class="p">(</span>
    <span class="n">dsis</span><span class="p">,</span>
    <span class="n">cell_types</span><span class="p">,</span>
    <span class="n">scatter_best</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">scatter_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">showmeans</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">showmedians</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">sorted_type_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">sort_descending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">known_on_off_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">scatter_kwargs</span><span class="o">=</span><span class="p">{},</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create violin plots for Direction Selectivity Index (DSI) data.</span>

<span class="sd">    Args:</span>
<span class="sd">        dsis: Array of DSI values.</span>
<span class="sd">        cell_types: Array of cell type labels.</span>
<span class="sd">        scatter_best: Whether to scatter the best points.</span>
<span class="sd">        scatter_all: Whether to scatter all points.</span>
<span class="sd">        cmap: Colormap for the violins.</span>
<span class="sd">        colors: Specific colors for the violins.</span>
<span class="sd">        color: Default color if colors is None and cmap is None.</span>
<span class="sd">        figsize: Figure size.</span>
<span class="sd">        fontsize: Font size for labels.</span>
<span class="sd">        showmeans: Whether to show means on violins.</span>
<span class="sd">        showmedians: Whether to show medians on violins.</span>
<span class="sd">        sorted_type_list: List of cell types in desired order.</span>
<span class="sd">        sort_descending: Whether to sort DSIs in descending order.</span>
<span class="sd">        known_on_off_first: Whether to sort known ON/OFF types first.</span>
<span class="sd">        **kwargs: Additional keyword arguments for violin_groups.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple of (figure, axis, colors, prepared DSIs)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dsis</span><span class="p">,</span> <span class="n">cell_types</span> <span class="o">=</span> <span class="n">prepare_dsi_data</span><span class="p">(</span>
        <span class="n">dsis</span><span class="p">,</span> <span class="n">cell_types</span><span class="p">,</span> <span class="n">sorted_type_list</span><span class="p">,</span> <span class="n">known_on_off_first</span><span class="p">,</span> <span class="n">sort_descending</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dsis</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">dsis</span> <span class="o">=</span> <span class="n">dsis</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">dsis</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">dsis</span> <span class="o">=</span> <span class="n">dsis</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">(</span><span class="n">color</span><span class="p">,)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="n">violin_groups</span><span class="p">(</span>
        <span class="n">dsis</span><span class="p">,</span>
        <span class="n">cell_types</span><span class="p">[:],</span>
        <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
        <span class="n">scatter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
        <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
        <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
        <span class="n">showmeans</span><span class="o">=</span><span class="n">showmeans</span><span class="p">,</span>
        <span class="n">showmedians</span><span class="o">=</span><span class="n">showmedians</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">dsis</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">plt_utils</span><span class="o">.</span><span class="n">scatter_on_violins_with_best</span><span class="p">(</span>
            <span class="n">dsis</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">ax</span><span class="p">,</span> <span class="n">scatter_best</span><span class="p">,</span> <span class="n">scatter_all</span><span class="p">,</span> <span class="o">**</span><span class="n">scatter_kwargs</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">dsis</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_bar_responses.dsi_violins_on_and_off" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dsi_violins_on_and_off</span>


<a href="#flyvision.analysis.moving_bar_responses.dsi_violins_on_and_off" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">dsi_violins_on_and_off</span><span class="p">(</span>
    <span class="n">dsis</span><span class="p">,</span>
    <span class="n">cell_types</span><span class="p">,</span>
    <span class="n">scatter_best</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">scatter_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">bold_output_type_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">output_cell_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">known_on_off_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">sorted_type_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">color_known_types</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Plot Direction Selectivity Index (DSI) for ON and OFF intensities.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>dsis</code></td>
            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataArray of DSI values.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cell_types</code></td>
            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataArray of cell type labels.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>scatter_best</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to scatter the best points.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>scatter_all</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to scatter all points.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>bold_output_type_labels</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to bold output type labels.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>output_cell_types</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cell types to output.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>known_on_off_first</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to sort known ON/OFF types first.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>sorted_type_list</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of cell types in desired order.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>figsize</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Figure size.</p>
              </div>
            </td>
            <td>
                  <code>[10, 1]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ylim</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Y-axis limits.</p>
              </div>
            </td>
            <td>
                  <code>(0, 1)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>color_known_types</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to color known cell types.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fontsize</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Font size for labels.</p>
              </div>
            </td>
            <td>
                  <code>6</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fig</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Existing figure to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>axes</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Existing axes to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>**kwargs</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments for dsi_violins.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of (figure, (ax1, ax2))</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_bar_responses.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">dsi_violins_on_and_off</span><span class="p">(</span>
    <span class="n">dsis</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span>
    <span class="n">cell_types</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span>
    <span class="n">scatter_best</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">scatter_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">bold_output_type_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">output_cell_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">known_on_off_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">sorted_type_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">color_known_types</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot Direction Selectivity Index (DSI) for ON and OFF intensities.</span>

<span class="sd">    Args:</span>
<span class="sd">        dsis: DataArray of DSI values.</span>
<span class="sd">        cell_types: DataArray of cell type labels.</span>
<span class="sd">        scatter_best: Whether to scatter the best points.</span>
<span class="sd">        scatter_all: Whether to scatter all points.</span>
<span class="sd">        bold_output_type_labels: Whether to bold output type labels.</span>
<span class="sd">        output_cell_types: Cell types to output.</span>
<span class="sd">        known_on_off_first: Whether to sort known ON/OFF types first.</span>
<span class="sd">        sorted_type_list: List of cell types in desired order.</span>
<span class="sd">        figsize: Figure size.</span>
<span class="sd">        ylim: Y-axis limits.</span>
<span class="sd">        color_known_types: Whether to color known cell types.</span>
<span class="sd">        fontsize: Font size for labels.</span>
<span class="sd">        fig: Existing figure to use.</span>
<span class="sd">        axes: Existing axes to use.</span>
<span class="sd">        **kwargs: Additional keyword arguments for dsi_violins.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple of (figure, (ax1, ax2))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dsis</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">dsis</span> <span class="o">=</span> <span class="n">dsis</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>

    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt_utils</span><span class="o">.</span><span class="n">rm_spines</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">spines</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">,))</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">intensity</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]):</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">ON</span> <span class="k">if</span> <span class="n">intensity</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">OFF</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">dsi_violins</span><span class="p">(</span>
            <span class="n">dsis</span><span class="o">=</span><span class="n">dsis</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">intensity</span><span class="o">=</span><span class="n">intensity</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
            <span class="n">cell_types</span><span class="o">=</span><span class="n">cell_types</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="n">sorted_type_list</span><span class="o">=</span><span class="n">sorted_type_list</span><span class="p">,</span>
            <span class="n">scatter_best</span><span class="o">=</span><span class="n">scatter_best</span><span class="p">,</span>
            <span class="n">scatter_all</span><span class="o">=</span><span class="n">scatter_all</span><span class="p">,</span>
            <span class="n">known_on_off_first</span><span class="o">=</span><span class="n">known_on_off_first</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">*</span><span class="n">ylim</span><span class="p">)</span>
        <span class="n">plt_utils</span><span class="o">.</span><span class="n">trim_axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">plt_utils</span><span class="o">.</span><span class="n">set_spine_tick_params</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">,</span> <span class="n">tickwidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">ticklength</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ticklabelpad</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">spinewidth</span><span class="o">=</span><span class="mf">0.5</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">bold_output_type_labels</span><span class="p">:</span>
            <span class="n">plt_utils</span><span class="o">.</span><span class="n">boldify_labels</span><span class="p">(</span><span class="n">output_cell_types</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">color_known_types</span><span class="p">:</span>
            <span class="n">plt_utils</span><span class="o">.</span><span class="n">color_labels</span><span class="p">([</span><span class="s2">&quot;T4a&quot;</span><span class="p">,</span> <span class="s2">&quot;T4b&quot;</span><span class="p">,</span> <span class="s2">&quot;T4c&quot;</span><span class="p">,</span> <span class="s2">&quot;T4d&quot;</span><span class="p">],</span> <span class="n">ON</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
            <span class="n">plt_utils</span><span class="o">.</span><span class="n">color_labels</span><span class="p">([</span><span class="s2">&quot;T5a&quot;</span><span class="p">,</span> <span class="s2">&quot;T5b&quot;</span><span class="p">,</span> <span class="s2">&quot;T5c&quot;</span><span class="p">,</span> <span class="s2">&quot;T5d&quot;</span><span class="p">],</span> <span class="n">OFF</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>

    <span class="c1"># axes[0].set_xticks([])</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_bar_responses.dsi_correlation_to_known" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dsi_correlation_to_known</span>


<a href="#flyvision.analysis.moving_bar_responses.dsi_correlation_to_known" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">dsi_correlation_to_known</span><span class="p">(</span>
    <span class="n">dsis</span><span class="p">,</span> <span class="n">max_aggregate_dims</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;intensity&quot;</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute the correlation between predicted DSIs and known DSIs.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>dsis</code></td>
            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataArray containing DSIs for ON and OFF intensities.
Should have dimensions including &lsquo;intensity&rsquo; and &lsquo;neuron&rsquo;,
and a coordinate &lsquo;cell_type&rsquo;.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_aggregate_dims</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dimensions to max-aggregate before computing correlation.</p>
              </div>
            </td>
            <td>
                  <code>(&#39;intensity&#39;)</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Correlation between predicted and known DSIs.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Known DSIs are binary (0 or 1) based on whether the cell type
is known to be motion-tuned.</p>
</details>
            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_bar_responses.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">dsi_correlation_to_known</span><span class="p">(</span>
    <span class="n">dsis</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span> <span class="n">max_aggregate_dims</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;intensity&quot;</span><span class="p">,)</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the correlation between predicted DSIs and known DSIs.</span>

<span class="sd">    Args:</span>
<span class="sd">        dsis: DataArray containing DSIs for ON and OFF intensities.</span>
<span class="sd">            Should have dimensions including &#39;intensity&#39; and &#39;neuron&#39;,</span>
<span class="sd">            and a coordinate &#39;cell_type&#39;.</span>
<span class="sd">        max_aggregate_dims: Dimensions to max-aggregate before computing correlation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Correlation between predicted and known DSIs.</span>

<span class="sd">    Note:</span>
<span class="sd">        Known DSIs are binary (0 or 1) based on whether the cell type</span>
<span class="sd">        is known to be motion-tuned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Ensure the &#39;intensity&#39; dimension has length 2</span>
    <span class="k">assert</span> <span class="n">dsis</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Dimension &#39;intensity&#39; should have length 2&quot;</span>

    <span class="c1"># Retrieve ground truth motion tuning information</span>
    <span class="n">motion_tuning</span> <span class="o">=</span> <span class="n">groundtruth_utils</span><span class="o">.</span><span class="n">motion_tuning</span>
    <span class="n">known_dsi_types</span> <span class="o">=</span> <span class="n">groundtruth_utils</span><span class="o">.</span><span class="n">known_dsi_types</span>

    <span class="c1"># Select dsis for known cell types</span>
    <span class="n">dsis_for_known</span> <span class="o">=</span> <span class="n">dsis</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dsis</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">known_dsi_types</span><span class="p">),</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
        <span class="n">dim</span><span class="o">=</span><span class="n">max_aggregate_dims</span>
    <span class="p">)</span>

    <span class="c1"># Construct ground truth motion tuning array</span>
    <span class="n">groundtruth_mt</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="mf">1.0</span> <span class="k">if</span> <span class="n">ct</span> <span class="ow">in</span> <span class="n">motion_tuning</span> <span class="k">else</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">ct</span> <span class="ow">in</span> <span class="n">dsis_for_known</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="p">],</span>
        <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;neuron&#39;</span><span class="p">:</span> <span class="n">dsis_for_known</span><span class="p">[</span><span class="s1">&#39;neuron&#39;</span><span class="p">]},</span>
        <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;neuron&#39;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># Compute correlation along &#39;neuron&#39; dimension</span>
    <span class="n">corr_dsi</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">dsis_for_known</span><span class="p">,</span> <span class="n">groundtruth_mt</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;neuron&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">corr_dsi</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_bar_responses.correlation_to_known_tuning_curves" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">correlation_to_known_tuning_curves</span>


<a href="#flyvision.analysis.moving_bar_responses.correlation_to_known_tuning_curves" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">correlation_to_known_tuning_curves</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">absmax</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute correlation between predicted and known tuning curves.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>dataset</code></td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>absmax</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, maximize magnitude of correlation regardless of sign.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Correlation values for each cell type.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_bar_responses.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">correlation_to_known_tuning_curves</span><span class="p">(</span>
    <span class="n">dataset</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">absmax</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute correlation between predicted and known tuning curves.</span>

<span class="sd">    Args:</span>
<span class="sd">        dataset: Input dataset.</span>
<span class="sd">        absmax: If True, maximize magnitude of correlation regardless of sign.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Correlation values for each cell type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tuning</span> <span class="o">=</span> <span class="n">peak_responses</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
    <span class="n">gt_tuning</span> <span class="o">=</span> <span class="n">get_known_tuning_curves</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;T4a&quot;</span><span class="p">,</span> <span class="s2">&quot;T4b&quot;</span><span class="p">,</span> <span class="s2">&quot;T4c&quot;</span><span class="p">,</span> <span class="s2">&quot;T4d&quot;</span><span class="p">,</span> <span class="s2">&quot;T5a&quot;</span><span class="p">,</span> <span class="s2">&quot;T5b&quot;</span><span class="p">,</span> <span class="s2">&quot;T5c&quot;</span><span class="p">,</span> <span class="s2">&quot;T5d&quot;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">tuning</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">tuning</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">sample</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">,</span> <span class="s2">&quot;intensity&quot;</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="s2">&quot;speed&quot;</span><span class="p">])</span>
        <span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s2">&quot;sample&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cell_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;T4a&quot;</span><span class="p">,</span> <span class="s2">&quot;T4b&quot;</span><span class="p">,</span> <span class="s2">&quot;T4c&quot;</span><span class="p">,</span> <span class="s2">&quot;T4d&quot;</span><span class="p">,</span> <span class="s2">&quot;T5a&quot;</span><span class="p">,</span> <span class="s2">&quot;T5b&quot;</span><span class="p">,</span> <span class="s2">&quot;T5c&quot;</span><span class="p">,</span> <span class="s2">&quot;T5d&quot;</span><span class="p">])</span>
    <span class="p">)</span>

    <span class="c1"># reset the neuron axis to make it compatible with the ground truth tuning curves</span>
    <span class="n">tuning</span><span class="p">[</span><span class="s2">&quot;neuron&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">tuning</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;neuron&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

    <span class="n">correlation</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">tuning</span><span class="p">,</span> <span class="n">gt_tuning</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;angle&quot;</span><span class="p">)</span>
    <span class="n">correlation</span> <span class="o">=</span> <span class="n">correlation</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">absmax</span><span class="p">:</span>
        <span class="c1"># take speed and width that maximize the magnitude of the correlation, regardless</span>
        <span class="c1"># of the sign</span>
        <span class="n">argmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">correlation</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;speed&quot;</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># take speed and width that maximize the correlation as an experimentalist</span>
        <span class="c1"># would do</span>
        <span class="n">argmax</span> <span class="o">=</span> <span class="n">correlation</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;speed&quot;</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">))</span>
    <span class="n">correlation</span> <span class="o">=</span> <span class="n">correlation</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">argmax</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">correlation</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_bar_responses.get_known_tuning_curves" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_known_tuning_curves</span>


<a href="#flyvision.analysis.moving_bar_responses.get_known_tuning_curves" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">get_known_tuning_curves</span><span class="p">(</span><span class="n">cell_types</span><span class="p">,</span> <span class="n">angles</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Retrieve ground truth tuning curves for specified cell types.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>cell_types</code></td>
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of cell type names.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>angles</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of angles to interpolate curves to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataArray of interpolated ground truth tuning curves.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_bar_responses.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_known_tuning_curves</span><span class="p">(</span><span class="n">cell_types</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">angles</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve ground truth tuning curves for specified cell types.</span>

<span class="sd">    Args:</span>
<span class="sd">        cell_types: List of cell type names.</span>
<span class="sd">        angles: Array of angles to interpolate curves to.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataArray of interpolated ground truth tuning curves.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gt_angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
    <span class="n">tuning_curves</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="n">cell_types</span><span class="p">:</span>
        <span class="n">gt_tuning</span> <span class="o">=</span> <span class="n">groundtruth_utils</span><span class="o">.</span><span class="n">tuning_curves</span><span class="p">[</span><span class="n">cell_type</span><span class="p">]</span>
        <span class="n">interp_func</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
            <span class="n">gt_angles</span><span class="p">,</span> <span class="n">gt_tuning</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;extrapolate&quot;</span>
        <span class="p">)</span>
        <span class="n">gt_tuning</span> <span class="o">=</span> <span class="n">interp_func</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
        <span class="n">tuning_curves</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gt_tuning</span><span class="p">)</span>

    <span class="n">dataset</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tuning_curves</span><span class="p">),</span>
        <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;neuron&#39;</span><span class="p">,</span> <span class="s1">&#39;angle&#39;</span><span class="p">],</span>
        <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cell_type&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;neuron&quot;</span><span class="p">,</span> <span class="n">cell_types</span><span class="p">),</span> <span class="s1">&#39;angle&#39;</span><span class="p">:</span> <span class="n">angles</span><span class="p">},</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">dataset</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_bar_responses.preferred_direction" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">preferred_direction</span>


<a href="#flyvision.analysis.moving_bar_responses.preferred_direction" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">preferred_direction</span><span class="p">(</span>
    <span class="n">dataset</span><span class="p">,</span>
    <span class="n">average</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">from_degree</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">to_degree</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute the preferred direction based on peak responses.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>dataset</code></td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>average</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to average over certain dimensions.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>norm</code></td>
            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Normalization array.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>from_degree</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Starting degree for masking.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>to_degree</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Ending degree for masking.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Preferred direction angles in radians.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_bar_responses.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">preferred_direction</span><span class="p">(</span>
    <span class="n">dataset</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span>
    <span class="n">average</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">norm</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">from_degree</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">to_degree</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the preferred direction based on peak responses.</span>

<span class="sd">    Args:</span>
<span class="sd">        dataset: Input dataset.</span>
<span class="sd">        average: Whether to average over certain dimensions.</span>
<span class="sd">        norm: Normalization array.</span>
<span class="sd">        from_degree: Starting degree for masking.</span>
<span class="sd">        to_degree: Ending degree for masking.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Preferred direction angles in radians.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">view</span> <span class="o">=</span> <span class="n">peak_responses_angular</span><span class="p">(</span>
        <span class="n">dataset</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">from_degree</span><span class="o">=</span><span class="n">from_degree</span><span class="p">,</span> <span class="n">to_degree</span><span class="o">=</span><span class="n">to_degree</span>
    <span class="p">)</span>
    <span class="n">view</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">sample</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="s2">&quot;intensity&quot;</span><span class="p">,</span> <span class="s2">&quot;speed&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span>
        <span class="s2">&quot;sample&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Compute vector sum over &#39;angle&#39;</span>
    <span class="n">vector_sum</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;angle&#39;</span><span class="p">)</span>
    <span class="n">theta_pref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">vector_sum</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">average</span><span class="p">:</span>
        <span class="c1"># Sum over &#39;width&#39; and &#39;speed&#39; before computing angle</span>
        <span class="n">vector_sum</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="s1">&#39;speed&#39;</span><span class="p">,</span> <span class="s1">&#39;angle&#39;</span><span class="p">])</span>
        <span class="n">theta_pref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">vector_sum</span><span class="p">)</span>

    <span class="n">vector_sum</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">theta_pref</span>
    <span class="k">return</span> <span class="n">vector_sum</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_bar_responses.angular_distance_to_known" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">angular_distance_to_known</span>


<a href="#flyvision.analysis.moving_bar_responses.angular_distance_to_known" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">angular_distance_to_known</span><span class="p">(</span><span class="n">pds</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute angular distance between predicted and known preferred directions for T4/T5.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>pds</code></td>
            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Preferred directions for cells.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Angular distances to known preferred directions.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_bar_responses.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">angular_distance_to_known</span><span class="p">(</span><span class="n">pds</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute angular distance between predicted and known preferred directions for T4/T5.</span>

<span class="sd">    Args:</span>
<span class="sd">        pds: Preferred directions for cells.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Angular distances to known preferred directions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t4s</span> <span class="o">=</span> <span class="n">pds</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cell_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;T4a&quot;</span><span class="p">,</span> <span class="s2">&quot;T4b&quot;</span><span class="p">,</span> <span class="s2">&quot;T4c&quot;</span><span class="p">,</span> <span class="s2">&quot;T4d&quot;</span><span class="p">],</span> <span class="n">intensity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">t4_distances</span> <span class="o">=</span> <span class="n">angular_distances</span><span class="p">(</span><span class="n">t4s</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]))</span>
    <span class="n">t5s</span> <span class="o">=</span> <span class="n">pds</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cell_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;T5a&quot;</span><span class="p">,</span> <span class="s2">&quot;T5b&quot;</span><span class="p">,</span> <span class="s2">&quot;T5c&quot;</span><span class="p">,</span> <span class="s2">&quot;T5d&quot;</span><span class="p">],</span> <span class="n">intensity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">t5_distances</span> <span class="o">=</span> <span class="n">angular_distances</span><span class="p">(</span><span class="n">t5s</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]))</span>
    <span class="c1"># concatenate both xarrays again in the neuron dimension, drop intensity</span>
    <span class="k">return</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
        <span class="p">[</span><span class="n">t4_distances</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;intensity&#39;</span><span class="p">),</span> <span class="n">t5_distances</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;intensity&#39;</span><span class="p">)],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;neuron&#39;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_bar_responses.angular_distances" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">angular_distances</span>


<a href="#flyvision.analysis.moving_bar_responses.angular_distances" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">angular_distances</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute angular distances between two sets of angles.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>x</code></td>
            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>First set of angles.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>y</code></td>
            <td>
                  <code><span title="numpy.array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Second set of angles.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>upper</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Upper bound for distance calculation.</p>
              </div>
            </td>
            <td>
                  <code><span title="numpy.pi">pi</span></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Angular distances.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_bar_responses.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">angular_distances</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">upper</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute angular distances between two sets of angles.</span>

<span class="sd">    Args:</span>
<span class="sd">        x: First set of angles.</span>
<span class="sd">        y: Second set of angles.</span>
<span class="sd">        upper: Upper bound for distance calculation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Angular distances.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">x</span><span class="o">.</span><span class="n">neuron</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">y_da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;neuron&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;neuron&#39;</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;neuron&#39;</span><span class="p">]})</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">apply_ufunc</span><span class="p">(</span>
        <span class="n">simple_angle_distance</span><span class="p">,</span>
        <span class="n">x</span><span class="p">,</span>
        <span class="n">y_da</span><span class="p">,</span>
        <span class="n">input_core_dims</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;neuron&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;neuron&#39;</span><span class="p">]],</span>
        <span class="n">output_core_dims</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;neuron&#39;</span><span class="p">]],</span>
        <span class="n">vectorize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;upper&#39;</span><span class="p">:</span> <span class="n">upper</span><span class="p">},</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_bar_responses.simple_angle_distance" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">simple_angle_distance</span>


<a href="#flyvision.analysis.moving_bar_responses.simple_angle_distance" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">simple_angle_distance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate element-wise angle distance between 0 and pi radians.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>a</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>First set of angles in radians.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>b</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Second set of angles in radians.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>upper</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Upper bound for distance calculation.</p>
              </div>
            </td>
            <td>
                  <code><span title="numpy.pi">pi</span></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Distance between 0 and pi radians.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_bar_responses.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">simple_angle_distance</span><span class="p">(</span>
    <span class="n">a</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">upper</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate element-wise angle distance between 0 and pi radians.</span>

<span class="sd">    Args:</span>
<span class="sd">        a: First set of angles in radians.</span>
<span class="sd">        b: Second set of angles in radians.</span>
<span class="sd">        upper: Upper bound for distance calculation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Distance between 0 and pi radians.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="c1"># make all angles positive between 0 and 2 * pi</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">b</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="c1"># subtract the smaller angle from the larger one</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="n">b</span>
    <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">b</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
    <span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span>

    <span class="c1"># map distances between pi and 2 pi to 0 and pi</span>
    <span class="n">y</span><span class="p">[</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">]</span>

    <span class="c1"># map distances between 0 and pi to 0 and upper</span>
    <span class="k">return</span> <span class="n">y</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">upper</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_bar_responses.plot_angular_tuning" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">plot_angular_tuning</span>


<a href="#flyvision.analysis.moving_bar_responses.plot_angular_tuning" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">plot_angular_tuning</span><span class="p">(</span>
    <span class="n">dataset</span><span class="p">,</span>
    <span class="n">cell_type</span><span class="p">,</span>
    <span class="n">intensity</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">anglepad</span><span class="o">=-</span><span class="mi">7</span><span class="p">,</span>
    <span class="n">xlabelpad</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">groundtruth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">groundtruth_linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">peak_responses_da</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">weighted_average</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">average_models</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Plot angular tuning for a specific cell type and intensity.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>dataset</code></td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cell_type</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Neuron index to plot.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>intensity</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Intensity level (0 or 1).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>figsize</code></td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[float, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Figure size.</p>
              </div>
            </td>
            <td>
                  <code>(1, 1)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fontsize</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Font size.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>linewidth</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Line width.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>anglepad</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Angle padding.</p>
              </div>
            </td>
            <td>
                  <code>-7</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>xlabelpad</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>X-label padding.</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>groundtruth</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to plot ground truth.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>groundtruth_linewidth</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Line width for ground truth.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fig</code></td>
            <td>
                  <code><span title="matplotlib.pyplot.Figure">Figure</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Existing figure.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ax</code></td>
            <td>
                  <code><span title="matplotlib.pyplot.Axes">Axes</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Existing axes.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>peak_responses_da</code></td>
            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Precomputed peak responses.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>weighted_average</code></td>
            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weights for averaging models.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>average_models</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to average across models.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>colors</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Color for the plot.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>zorder</code></td>
            <td>
                  <code><span title="typing.Union">Union</span>[int, <span title="typing.Iterable">Iterable</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Z-order for plotting.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>**kwargs</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments for plotting.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="matplotlib.pyplot.Figure">Figure</span>, <span title="matplotlib.pyplot.Axes">Axes</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The figure and axes objects.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_bar_responses.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_angular_tuning</span><span class="p">(</span>
    <span class="n">dataset</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span>
    <span class="n">cell_type</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">intensity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">fontsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">anglepad</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mi">7</span><span class="p">,</span>
    <span class="n">xlabelpad</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">groundtruth</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">groundtruth_linewidth</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">fig</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">peak_responses_da</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">weighted_average</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">average_models</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">colors</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">zorder</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot angular tuning for a specific cell type and intensity.</span>

<span class="sd">    Args:</span>
<span class="sd">        dataset: Input dataset.</span>
<span class="sd">        cell_type: Neuron index to plot.</span>
<span class="sd">        intensity: Intensity level (0 or 1).</span>
<span class="sd">        figsize: Figure size.</span>
<span class="sd">        fontsize: Font size.</span>
<span class="sd">        linewidth: Line width.</span>
<span class="sd">        anglepad: Angle padding.</span>
<span class="sd">        xlabelpad: X-label padding.</span>
<span class="sd">        groundtruth: Whether to plot ground truth.</span>
<span class="sd">        groundtruth_linewidth: Line width for ground truth.</span>
<span class="sd">        fig: Existing figure.</span>
<span class="sd">        ax: Existing axes.</span>
<span class="sd">        peak_responses_da: Precomputed peak responses.</span>
<span class="sd">        weighted_average: Weights for averaging models.</span>
<span class="sd">        average_models: Whether to average across models.</span>
<span class="sd">        colors: Color for the plot.</span>
<span class="sd">        zorder: Z-order for plotting.</span>
<span class="sd">        **kwargs: Additional keyword arguments for plotting.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The figure and axes objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">peak_responses_da</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">peak_responses_da</span> <span class="o">=</span> <span class="n">peak_responses</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>

    <span class="n">peak_responses_da</span> <span class="o">=</span> <span class="n">peak_responses_da</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span>
        <span class="n">sample</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="s2">&quot;intensity&quot;</span><span class="p">,</span> <span class="s2">&quot;speed&quot;</span><span class="p">]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s2">&quot;sample&quot;</span><span class="p">)</span>

    <span class="c1"># Select the specific cell type</span>
    <span class="n">peak</span> <span class="o">=</span> <span class="n">peak_responses_da</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cell_type</span><span class="o">=</span><span class="n">cell_type</span><span class="p">,</span> <span class="n">intensity</span><span class="o">=</span><span class="n">intensity</span><span class="p">)</span>

    <span class="c1"># Squeeze irrelevant dimensions</span>
    <span class="c1"># peak = peak.squeeze(dim=[&#39;width&#39;, &#39;intensity&#39;, &#39;speed&#39;], drop=True)</span>

    <span class="c1"># Average over speeds</span>
    <span class="n">average_tuning</span> <span class="o">=</span> <span class="n">peak</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;speed&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">))</span>

    <span class="c1"># Average over models if specified</span>
    <span class="k">if</span> <span class="n">average_models</span> <span class="ow">and</span> <span class="n">weighted_average</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">average_tuning</span> <span class="o">=</span> <span class="n">average_tuning</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weighted_average</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;network_id&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">average_models</span><span class="p">:</span>
        <span class="n">average_tuning</span> <span class="o">=</span> <span class="n">average_tuning</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;network_id&#39;</span><span class="p">)</span>

    <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="n">ON</span> <span class="k">if</span> <span class="n">intensity</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">OFF</span><span class="p">)</span> <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">colors</span>

    <span class="n">average_tuning</span> <span class="o">=</span> <span class="n">average_tuning</span> <span class="o">/</span> <span class="n">average_tuning</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="n">angles</span> <span class="o">=</span> <span class="n">average_tuning</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">polar</span><span class="p">(</span>
        <span class="n">angles</span><span class="p">,</span>
        <span class="n">average_tuning</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
        <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span>
        <span class="n">anglepad</span><span class="o">=</span><span class="n">anglepad</span><span class="p">,</span>
        <span class="n">xlabelpad</span><span class="o">=</span><span class="n">xlabelpad</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
        <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">groundtruth</span> <span class="ow">and</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="n">groundtruth_utils</span><span class="o">.</span><span class="n">tuning_curves</span><span class="p">:</span>
        <span class="n">r_gt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">groundtruth_utils</span><span class="o">.</span><span class="n">tuning_curves</span><span class="p">[</span><span class="n">cell_type</span><span class="p">])</span>
        <span class="n">r_gt</span> <span class="o">=</span> <span class="n">r_gt</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">r_gt</span><span class="p">))</span>
        <span class="n">theta_gt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">360</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">r_gt</span><span class="p">))</span>
        <span class="n">polar</span><span class="p">(</span>
            <span class="n">theta_gt</span><span class="p">,</span>
            <span class="n">r_gt</span><span class="p">,</span>
            <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="n">groundtruth_linewidth</span><span class="p">,</span>
            <span class="n">anglepad</span><span class="o">=</span><span class="n">anglepad</span><span class="p">,</span>
            <span class="n">xlabelpad</span><span class="o">=</span><span class="n">xlabelpad</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="c1"># **kwargs,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_bar_responses.plot_T4_tuning" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">plot_T4_tuning</span>


<a href="#flyvision.analysis.moving_bar_responses.plot_T4_tuning" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">plot_T4_tuning</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Plot tuning curves for T4 cells.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>dataset</code></td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_bar_responses.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_T4_tuning</span><span class="p">(</span><span class="n">dataset</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot tuning curves for T4 cells.</span>

<span class="sd">    Args:</span>
<span class="sd">        dataset: Input dataset.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plt_utils</span><span class="o">.</span><span class="n">get_axis_grid</span><span class="p">(</span>
        <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
        <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;polar&quot;</span><span class="p">,</span>
        <span class="n">aspect_ratio</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mf">2.95</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">],</span>
        <span class="n">wspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;T4a&quot;</span><span class="p">,</span> <span class="s2">&quot;T4b&quot;</span><span class="p">,</span> <span class="s2">&quot;T4c&quot;</span><span class="p">,</span> <span class="s2">&quot;T4d&quot;</span><span class="p">]):</span>
        <span class="n">plot_angular_tuning</span><span class="p">(</span>
            <span class="n">dataset</span><span class="p">,</span>
            <span class="n">cell_type</span><span class="p">,</span>
            <span class="n">intensity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">groundtruth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">aggregate_models</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">cell_type</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_bar_responses.plot_T5_tuning" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">plot_T5_tuning</span>


<a href="#flyvision.analysis.moving_bar_responses.plot_T5_tuning" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">plot_T5_tuning</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Plot tuning curves for T5 cells.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>dataset</code></td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_bar_responses.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_T5_tuning</span><span class="p">(</span><span class="n">dataset</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot tuning curves for T5 cells.</span>

<span class="sd">    Args:</span>
<span class="sd">        dataset: Input dataset.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plt_utils</span><span class="o">.</span><span class="n">get_axis_grid</span><span class="p">(</span>
        <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
        <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;polar&quot;</span><span class="p">,</span>
        <span class="n">aspect_ratio</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mf">2.95</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">],</span>
        <span class="n">wspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;T5a&quot;</span><span class="p">,</span> <span class="s2">&quot;T5b&quot;</span><span class="p">,</span> <span class="s2">&quot;T5c&quot;</span><span class="p">,</span> <span class="s2">&quot;T5d&quot;</span><span class="p">]):</span>
        <span class="n">plot_angular_tuning</span><span class="p">(</span>
            <span class="n">dataset</span><span class="p">,</span>
            <span class="n">cell_type</span><span class="p">,</span>
            <span class="n">intensity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">groundtruth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">aggregate_models</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">cell_type</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_bar_responses.mask_between_seconds" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">mask_between_seconds</span>


<a href="#flyvision.analysis.moving_bar_responses.mask_between_seconds" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">mask_between_seconds</span><span class="p">(</span>
    <span class="n">t_start</span><span class="p">,</span>
    <span class="n">t_end</span><span class="p">,</span>
    <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">t_pre</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">t_stim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">t_post</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a boolean mask for time values between t_start and t_end.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>t_start</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start time for the mask.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>t_end</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End time for the mask.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>time</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of time values. If None, it will be generated using other parameters.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>t_pre</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time before stimulus onset.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>t_stim</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Stimulus duration.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>t_post</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time after stimulus offset.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>dt</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time step.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Boolean mask array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>If &lsquo;time&rsquo; is not provided, it will be generated using t_pre, t_stim, t_post,
and dt.</p>
</details>
            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_bar_responses.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">mask_between_seconds</span><span class="p">(</span>
    <span class="n">t_start</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">t_end</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">time</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">t_pre</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">t_stim</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">t_post</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a boolean mask for time values between t_start and t_end.</span>

<span class="sd">    Args:</span>
<span class="sd">        t_start: Start time for the mask.</span>
<span class="sd">        t_end: End time for the mask.</span>
<span class="sd">        time: Array of time values. If None, it will be generated using other parameters.</span>
<span class="sd">        t_pre: Time before stimulus onset.</span>
<span class="sd">        t_stim: Stimulus duration.</span>
<span class="sd">        t_post: Time after stimulus offset.</span>
<span class="sd">        dt: Time step.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Boolean mask array.</span>

<span class="sd">    Note:</span>
<span class="sd">        If &#39;time&#39; is not provided, it will be generated using t_pre, t_stim, t_post,</span>
<span class="sd">        and dt.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">time</span> <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">t_pre</span><span class="p">,</span> <span class="n">t_stim</span> <span class="o">+</span> <span class="n">t_post</span> <span class="o">-</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">time</span> <span class="o">&gt;=</span> <span class="n">t_start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">time</span> <span class="o">&lt;=</span> <span class="n">t_end</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_bar_responses.time_window" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">time_window</span>


<a href="#flyvision.analysis.moving_bar_responses.time_window" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">time_window</span><span class="p">(</span>
    <span class="n">speed</span><span class="p">,</span>
    <span class="n">from_column</span><span class="o">=-</span><span class="mf">1.5</span><span class="p">,</span>
    <span class="n">to_column</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
    <span class="n">start</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">end</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate start and end time when the bar passes from_column to to_column.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>speed</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Speed in columns/s (5.8deg/s).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>from_column</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Starting column in 5.8deg units.</p>
              </div>
            </td>
            <td>
                  <code>-1.5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>to_column</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Ending column in 5.8deg units.</p>
              </div>
            </td>
            <td>
                  <code>1.5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>start</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Starting position in LED units (2.25deg).</p>
              </div>
            </td>
            <td>
                  <code>-10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>end</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Ending position in LED units (2.25deg).</p>
              </div>
            </td>
            <td>
                  <code>11</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[float, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple containing start and end times.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>The function adjusts the to_column by adding a single LED width (2.25 deg)
to make it symmetric around the central column.</p>
</details>
            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_bar_responses.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">time_window</span><span class="p">(</span>
    <span class="n">speed</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">from_column</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span>
    <span class="n">to_column</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span>
    <span class="n">start</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">end</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">11</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate start and end time when the bar passes from_column to to_column.</span>

<span class="sd">    Args:</span>
<span class="sd">        speed: Speed in columns/s (5.8deg/s).</span>
<span class="sd">        from_column: Starting column in 5.8deg units.</span>
<span class="sd">        to_column: Ending column in 5.8deg units.</span>
<span class="sd">        start: Starting position in LED units (2.25deg).</span>
<span class="sd">        end: Ending position in LED units (2.25deg).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple containing start and end times.</span>

<span class="sd">    Note:</span>
<span class="sd">        The function adjusts the to_column by adding a single LED width (2.25 deg)</span>
<span class="sd">        to make it symmetric around the central column.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start_in_columns</span> <span class="o">=</span> <span class="n">start</span> <span class="o">*</span> <span class="mf">2.25</span> <span class="o">/</span> <span class="mf">5.8</span>  <span class="c1"># in 5.8deg</span>
    <span class="n">end_in_columns</span> <span class="o">=</span> <span class="n">end</span> <span class="o">*</span> <span class="mf">2.25</span> <span class="o">/</span> <span class="mf">5.8</span>  <span class="c1"># in 5.8deg</span>

    <span class="c1"># Make it symmetric around the central column by adding a single LED width</span>
    <span class="n">to_column</span> <span class="o">+=</span> <span class="mf">2.25</span> <span class="o">/</span> <span class="mf">5.8</span>

    <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">start_in_columns</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">from_column</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">end_in_columns</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">to_column</span><span class="p">)</span>

    <span class="c1"># Calculate when the edge is at the from_column</span>
    <span class="n">t_start</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">start_in_columns</span><span class="p">)</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">from_column</span><span class="p">))</span> <span class="o">/</span> <span class="n">speed</span>
    <span class="c1"># Calculate when it&#39;s at the to_column</span>
    <span class="n">t_end</span> <span class="o">=</span> <span class="n">t_start</span> <span class="o">+</span> <span class="p">(</span><span class="n">to_column</span> <span class="o">-</span> <span class="n">from_column</span><span class="p">)</span> <span class="o">/</span> <span class="n">speed</span>
    <span class="k">return</span> <span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="current-analysis">Current Analysis<a class="headerlink" href="#current-analysis" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h3 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents first">


        <p>Represents a view of moving edge currents for analysis and visualization.</p>
<p>This class provides methods for analyzing and visualizing currents and responses
related to moving edge stimuli in neural simulations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>ensemble</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ensemble of models.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>target_type</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The type of target cell.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>exp_data</code></td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="flyvision.analysis.stimulus_responses_currents.ExperimentData">ExperimentData</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Experimental data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>arg_df</code></td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing stimulus arguments.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>currents</code></td>
            <td>
                  <code><span title="datamate.Namespace">Namespace</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Currents for each source type.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>rfs</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="flyvision.connectome.ReceptiveFields" href="../connectome/#flyvision.connectome.connectome.ReceptiveFields">ReceptiveFields</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Receptive fields for the target cells.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>time</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time array for the simulation.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>responses</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Responses of the target cells.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.target_type">target_type</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The type of target cell.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.ensemble">ensemble</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ensemble of models.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.config">config</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration settings.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.arg_df">arg_df</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing stimulus arguments.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.rfs">rfs</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Receptive fields for the target cells.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.exp_data">exp_data</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Experimental data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.source_types">source_types</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Types of source cells.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.time">time</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time array for the simulation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.currents">currents</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Currents for each source type.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.responses">responses</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Responses of the target cells.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>This class is intended to be updated to use xarray datasets in the future.</p>
</details>
              <details class="quote">
                <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  43</span>
<span class="normal">  44</span>
<span class="normal">  45</span>
<span class="normal">  46</span>
<span class="normal">  47</span>
<span class="normal">  48</span>
<span class="normal">  49</span>
<span class="normal">  50</span>
<span class="normal">  51</span>
<span class="normal">  52</span>
<span class="normal">  53</span>
<span class="normal">  54</span>
<span class="normal">  55</span>
<span class="normal">  56</span>
<span class="normal">  57</span>
<span class="normal">  58</span>
<span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span>
<span class="normal">2288</span>
<span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span>
<span class="normal">2300</span>
<span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span>
<span class="normal">2327</span>
<span class="normal">2328</span>
<span class="normal">2329</span>
<span class="normal">2330</span>
<span class="normal">2331</span>
<span class="normal">2332</span>
<span class="normal">2333</span>
<span class="normal">2334</span>
<span class="normal">2335</span>
<span class="normal">2336</span>
<span class="normal">2337</span>
<span class="normal">2338</span>
<span class="normal">2339</span>
<span class="normal">2340</span>
<span class="normal">2341</span>
<span class="normal">2342</span>
<span class="normal">2343</span>
<span class="normal">2344</span>
<span class="normal">2345</span>
<span class="normal">2346</span>
<span class="normal">2347</span>
<span class="normal">2348</span>
<span class="normal">2349</span>
<span class="normal">2350</span>
<span class="normal">2351</span>
<span class="normal">2352</span>
<span class="normal">2353</span>
<span class="normal">2354</span>
<span class="normal">2355</span>
<span class="normal">2356</span>
<span class="normal">2357</span>
<span class="normal">2358</span>
<span class="normal">2359</span>
<span class="normal">2360</span>
<span class="normal">2361</span>
<span class="normal">2362</span>
<span class="normal">2363</span>
<span class="normal">2364</span>
<span class="normal">2365</span>
<span class="normal">2366</span>
<span class="normal">2367</span>
<span class="normal">2368</span>
<span class="normal">2369</span>
<span class="normal">2370</span>
<span class="normal">2371</span>
<span class="normal">2372</span>
<span class="normal">2373</span>
<span class="normal">2374</span>
<span class="normal">2375</span>
<span class="normal">2376</span>
<span class="normal">2377</span>
<span class="normal">2378</span>
<span class="normal">2379</span>
<span class="normal">2380</span>
<span class="normal">2381</span>
<span class="normal">2382</span>
<span class="normal">2383</span>
<span class="normal">2384</span>
<span class="normal">2385</span>
<span class="normal">2386</span>
<span class="normal">2387</span>
<span class="normal">2388</span>
<span class="normal">2389</span>
<span class="normal">2390</span>
<span class="normal">2391</span>
<span class="normal">2392</span>
<span class="normal">2393</span>
<span class="normal">2394</span>
<span class="normal">2395</span>
<span class="normal">2396</span>
<span class="normal">2397</span>
<span class="normal">2398</span>
<span class="normal">2399</span>
<span class="normal">2400</span>
<span class="normal">2401</span>
<span class="normal">2402</span>
<span class="normal">2403</span>
<span class="normal">2404</span>
<span class="normal">2405</span>
<span class="normal">2406</span>
<span class="normal">2407</span>
<span class="normal">2408</span>
<span class="normal">2409</span>
<span class="normal">2410</span>
<span class="normal">2411</span>
<span class="normal">2412</span>
<span class="normal">2413</span>
<span class="normal">2414</span>
<span class="normal">2415</span>
<span class="normal">2416</span>
<span class="normal">2417</span>
<span class="normal">2418</span>
<span class="normal">2419</span>
<span class="normal">2420</span>
<span class="normal">2421</span>
<span class="normal">2422</span>
<span class="normal">2423</span>
<span class="normal">2424</span>
<span class="normal">2425</span>
<span class="normal">2426</span>
<span class="normal">2427</span>
<span class="normal">2428</span>
<span class="normal">2429</span>
<span class="normal">2430</span>
<span class="normal">2431</span>
<span class="normal">2432</span>
<span class="normal">2433</span>
<span class="normal">2434</span>
<span class="normal">2435</span>
<span class="normal">2436</span>
<span class="normal">2437</span>
<span class="normal">2438</span>
<span class="normal">2439</span>
<span class="normal">2440</span>
<span class="normal">2441</span>
<span class="normal">2442</span>
<span class="normal">2443</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MovingEdgeCurrentView</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a view of moving edge currents for analysis and visualization.</span>

<span class="sd">    This class provides methods for analyzing and visualizing currents and responses</span>
<span class="sd">    related to moving edge stimuli in neural simulations.</span>

<span class="sd">    Args:</span>
<span class="sd">        ensemble: The ensemble of models.</span>
<span class="sd">        target_type: The type of target cell.</span>
<span class="sd">        exp_data: Experimental data.</span>
<span class="sd">        arg_df: DataFrame containing stimulus arguments.</span>
<span class="sd">        currents: Currents for each source type.</span>
<span class="sd">        rfs: Receptive fields for the target cells.</span>
<span class="sd">        time: Time array for the simulation.</span>
<span class="sd">        responses: Responses of the target cells.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        target_type: The type of target cell.</span>
<span class="sd">        ensemble: The ensemble of models.</span>
<span class="sd">        config: Configuration settings.</span>
<span class="sd">        arg_df: DataFrame containing stimulus arguments.</span>
<span class="sd">        rfs: Receptive fields for the target cells.</span>
<span class="sd">        exp_data: Experimental data.</span>
<span class="sd">        source_types: Types of source cells.</span>
<span class="sd">        time: Time array for the simulation.</span>
<span class="sd">        currents: Currents for each source type.</span>
<span class="sd">        responses: Responses of the target cells.</span>

<span class="sd">    Note:</span>
<span class="sd">        This class is intended to be updated to use xarray datasets in the future.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ensemble</span><span class="p">,</span>
        <span class="n">target_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">exp_data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ExperimentData</span><span class="p">],</span>
        <span class="n">arg_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">currents</span><span class="p">:</span> <span class="n">Namespace</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">rfs</span><span class="p">:</span> <span class="n">ReceptiveFields</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">time</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">responses</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_type</span> <span class="o">=</span> <span class="n">target_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ensemble</span> <span class="o">=</span> <span class="n">ensemble</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">exp_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">config</span>
        <span class="k">if</span> <span class="n">arg_df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">arg_df</span> <span class="o">=</span> <span class="n">MovingEdge</span><span class="p">(</span><span class="o">**</span><span class="n">exp_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">config</span><span class="p">)</span><span class="o">.</span><span class="n">arg_df</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">arg_df</span> <span class="o">=</span> <span class="n">arg_df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rfs</span> <span class="o">=</span> <span class="n">rfs</span> <span class="ow">or</span> <span class="n">reset_index</span><span class="p">(</span>
            <span class="n">ReceptiveFields</span><span class="p">(</span><span class="n">target_type</span><span class="p">,</span> <span class="n">ensemble</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">connectome</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">to_df</span><span class="p">())</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exp_data</span> <span class="o">=</span> <span class="n">exp_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfs</span><span class="o">.</span><span class="n">source_types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_currents</span><span class="p">(</span><span class="n">currents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_time</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_responses</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">init_currents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currents</span><span class="p">:</span> <span class="n">Namespace</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the currents for each source type.</span>

<span class="sd">        Args:</span>
<span class="sd">            currents: Currents for each source type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">currents</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currents</span> <span class="o">=</span> <span class="n">currents</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currents</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">source_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfs</span><span class="o">.</span><span class="n">source_types</span><span class="p">:</span>
            <span class="c1"># (on/off, n_models, n_angles, n_timesteps, n_input_cells)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="p">[</span><span class="n">source_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">target_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_type</span><span class="p">]</span><span class="o">.</span><span class="n">source_data</span><span class="p">[</span><span class="n">source_type</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp_data</span>
                <span class="p">],</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">init_responses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">responses</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the responses of the target cells.</span>

<span class="sd">        Args:</span>
<span class="sd">            responses: Responses of the target cells.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">responses</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">responses</span> <span class="o">=</span> <span class="n">responses</span>
            <span class="k">return</span>
        <span class="c1"># (on/off, n_models, n_angles, n_timesteps)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">responses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">target_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_type</span><span class="p">]</span><span class="o">.</span><span class="n">activity_central</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp_data</span>
            <span class="p">],</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">init_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the time array for the simulation.</span>

<span class="sd">        Args:</span>
<span class="sd">            time: Time array for the simulation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dt</span>
            <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">t_pre</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">on</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MovingEdgeCurrentView&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a view of the ON responses.&quot;&quot;&quot;</span>
        <span class="n">on_index</span> <span class="o">=</span> <span class="n">get_stimulus_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg_df</span><span class="p">,</span> <span class="n">intensity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">arg_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">on_index</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span>
            <span class="n">Namespace</span><span class="p">({</span>
                <span class="n">cell_type</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">on_index</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}),</span>
            <span class="n">responses</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">on_index</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">arg_df</span><span class="o">=</span><span class="n">arg_df</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">off</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MovingEdgeCurrentView&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a view of the OFF responses.&quot;&quot;&quot;</span>
        <span class="n">off_index</span> <span class="o">=</span> <span class="n">get_stimulus_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg_df</span><span class="p">,</span> <span class="n">intensity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">arg_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">off_index</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span>
            <span class="n">Namespace</span><span class="p">({</span>
                <span class="n">cell_type</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">off_index</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}),</span>
            <span class="n">responses</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">off_index</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">arg_df</span><span class="o">=</span><span class="n">arg_df</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">divide_by_given_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">norm</span><span class="p">:</span> <span class="n">CellTypeArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MovingEdgeCurrentView&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Divide currents and responses by a given norm.</span>

<span class="sd">        Args:</span>
<span class="sd">            norm: The norm to divide by.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new view with normalized currents and responses.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If norm is not a CellTypeArray.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">norm</span><span class="p">,</span> <span class="n">CellTypeArray</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>

        <span class="n">response_dims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="n">response_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
            <span class="n">norm</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_type</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">response_dims</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="mi">0</span><span class="p">]))</span>
        <span class="p">)</span>

        <span class="c1"># divide the responses by the norm</span>
        <span class="n">new_responses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="p">[:]</span> <span class="o">/</span> <span class="n">response_norm</span>

        <span class="c1"># note: we also divide by the norm of the target cell type</span>

        <span class="n">currents_dims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

        <span class="n">currents_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
            <span class="n">norm</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_type</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">currents_dims</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="mi">0</span><span class="p">]))</span>
        <span class="p">)</span>

        <span class="c1"># divide the currents by the norm</span>
        <span class="n">new_currents</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">({</span>
            <span class="n">cell_type</span><span class="p">:</span> <span class="n">c</span> <span class="o">/</span> <span class="n">currents_norm</span> <span class="k">for</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">})</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">currents</span><span class="o">=</span><span class="n">new_currents</span><span class="p">,</span> <span class="n">responses</span><span class="o">=</span><span class="n">new_responses</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">at_contrast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contrast</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MovingEdgeCurrentView&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new view filtered by contrast.</span>

<span class="sd">        Args:</span>
<span class="sd">            contrast: The contrast value to filter by.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new view with data filtered by the specified contrast.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">contrast_index</span> <span class="o">=</span> <span class="n">get_stimulus_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg_df</span><span class="p">,</span> <span class="n">intensity</span><span class="o">=</span><span class="n">contrast</span><span class="p">)</span>
        <span class="n">arg_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">contrast_index</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span>
            <span class="n">Namespace</span><span class="p">({</span>
                <span class="n">cell_type</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">contrast_index</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}),</span>
            <span class="n">responses</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">contrast_index</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">arg_df</span><span class="o">=</span><span class="n">arg_df</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">at_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MovingEdgeCurrentView&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new view filtered by angle.</span>

<span class="sd">        Args:</span>
<span class="sd">            angle: The angle value to filter by.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new view with data filtered by the specified angle.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">angle_index</span> <span class="o">=</span> <span class="n">get_stimulus_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg_df</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">arg_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">angle_index</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span>
            <span class="n">Namespace</span><span class="p">({</span>
                <span class="n">cell_type</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">angle_index</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}),</span>
            <span class="n">responses</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">angle_index</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">arg_df</span><span class="o">=</span><span class="n">arg_df</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">at_position</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">central</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MovingEdgeCurrentView&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new view filtered by position.</span>

<span class="sd">        Args:</span>
<span class="sd">            u: The u-coordinate.</span>
<span class="sd">            v: The v-coordinate.</span>
<span class="sd">            central: Whether to use central position.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new view with data filtered by the specified position.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rfs</span> <span class="o">=</span> <span class="n">at_position</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfs</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">central</span><span class="p">)</span>
        <span class="n">currents</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">({</span>
            <span class="n">cell_type</span><span class="p">:</span> <span class="n">c</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">rfs</span><span class="p">[</span><span class="n">cell_type</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">})</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">currents</span><span class="p">,</span> <span class="n">rfs</span><span class="o">=</span><span class="n">rfs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">between_seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t_start</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">t_end</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MovingEdgeCurrentView&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new view filtered by time range.</span>

<span class="sd">        Args:</span>
<span class="sd">            t_start: Start time in seconds.</span>
<span class="sd">            t_end: End time in seconds.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new view with data filtered by the specified time range.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">slice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;=</span> <span class="n">t_start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&lt;</span> <span class="n">t_end</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">newview</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[:,</span> <span class="p">:,</span> <span class="nb">slice</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">newview</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="nb">slice</span><span class="p">]</span>
        <span class="n">newview</span><span class="o">.</span><span class="n">responses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="p">[:,</span> <span class="p">:,</span> <span class="nb">slice</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">newview</span>

    <span class="k">def</span> <span class="nf">model_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MovingEdgeCurrentView&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new view with selected models.</span>

<span class="sd">        Args:</span>
<span class="sd">            mask: Boolean mask for model selection.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new view with selected models.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;MovingEdgeCurrentView&quot;</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="c1"># e.g. view.C3</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_types</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">Namespace</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="p">[</span><span class="n">key</span><span class="p">]}))</span>
        <span class="c1"># e.g. view[&quot;C3&quot;, 0, 0, 0]</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span>
            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_types</span>
            <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span>
        <span class="c1"># e.g. view[index, :, :, :]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span>
                <span class="n">Namespace</span><span class="p">({</span><span class="n">cell_type</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">items</span><span class="p">()}),</span>
                <span class="n">responses</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="p">[</span><span class="n">key</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span>
            <span class="p">)</span>
        <span class="c1"># view[:]</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">currents</span>
        <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cv</span> <span class="o">=</span> <span class="p">{</span><span class="n">ct</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span> <span class="k">for</span> <span class="n">ct</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">formatted_cv</span> <span class="o">=</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">        &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">ct</span><span class="si">}</span><span class="s2">&#39;: Array(shape=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">ct</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">cv</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;    ensemble=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ensemble</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;    target_type=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_type</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;    currents=</span><span class="se">{{\n</span><span class="s2">        </span><span class="si">{</span><span class="n">formatted_cv</span><span class="si">}</span><span class="se">\n</span><span class="s2">    </span><span class="se">}}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;    rfs=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rfs</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;)&quot;</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">.</span><span class="n">shape</span>

    <span class="k">def</span> <span class="nf">sorting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">average_over_models</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sort cell types based on their contributions.</span>

<span class="sd">        Args:</span>
<span class="sd">            average_over_models: Whether to average over models.</span>
<span class="sd">            mode: Sorting mode (&quot;all&quot;, &quot;excitatory&quot;, or &quot;inhibitory&quot;).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Sorted array of cell types.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If an invalid mode is provided.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">summed</span> <span class="o">=</span> <span class="bp">self</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_over_cells</span><span class="p">()</span>
        <span class="n">signs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signs</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">average_over_models</span><span class="p">:</span>
            <span class="n">absmax</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="o">*</span> <span class="n">signs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">valmap</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span>
                        <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                    <span class="p">),</span>
                    <span class="n">summed</span><span class="p">[:],</span>
                <span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># summing over on/off, angles and time to sort -- results in n_models sortings</span>
            <span class="n">absmax</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="o">*</span> <span class="n">signs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">valmap</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="n">summed</span><span class="p">[:]</span>
                <span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="n">cell_types</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">absmax</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">absmax</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="n">sorting</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="c1">#         if average_over_models:</span>
        <span class="c1">#             # add extra dimension here for the next operation</span>
        <span class="c1">#             sorting = sorting[None]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sorted_cell_types</span> <span class="o">=</span> <span class="n">cell_types</span><span class="p">[</span><span class="n">sorting</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

        <span class="c1"># return all excitatory and inhibitory from most excitatory to most inhibitory</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorted_cell_types</span>
        <span class="c1"># from most excitatory to least excitatory</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;excitatory&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">average_over_models</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                <span class="n">cell_type</span>
                <span class="k">for</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorted_cell_types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">signs</span><span class="p">[</span><span class="n">cell_type</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="p">])</span>
        <span class="c1"># from most inhibitory to least inhibitory</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;inhibitory&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">average_over_models</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                <span class="n">cell_type</span>
                <span class="k">for</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorted_cell_types</span><span class="p">[</span><span class="mi">0</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">signs</span><span class="p">[</span><span class="n">cell_type</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
            <span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mode </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">filter_cell_types_by_contribution</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
        <span class="n">cut_off_edge</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;above_cut_off&quot;</span><span class="p">,</span>
        <span class="n">statistic</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter cell types based on their contribution.</span>

<span class="sd">        Args:</span>
<span class="sd">            bins: Number of bins for contribution levels.</span>
<span class="sd">            cut_off_edge: Edge index for cut-off.</span>
<span class="sd">            mode: Filtering mode (&quot;above_cut_off&quot; or &quot;below_cut_off&quot;).</span>
<span class="sd">            statistic: Function to compute the statistic.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Filtered array of cell types.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If an invalid mode is provided.</span>

<span class="sd">        Info:</span>
<span class="sd">            In principle, chunks the y-axis of the current plots into excitatory and</span>
<span class="sd">            inhibitory parts and each of the parts into bins. All cell types with currents</span>
<span class="sd">            above or below, depending on the mode, the specified bin edge are discarded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sorting</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorting</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">signs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signs</span><span class="p">()</span>
        <span class="n">currents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_over_cells</span><span class="p">()</span><span class="o">.</span><span class="n">currents</span>

        <span class="n">filtered_cell_types</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">sign</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="c1"># compute the std over all inputs</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">cell_type</span><span class="p">:</span> <span class="n">statistic</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">currents</span><span class="p">[</span><span class="n">cell_type</span><span class="p">][:]))</span>
                <span class="k">for</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="n">sorting</span>
                <span class="k">if</span> <span class="n">signs</span><span class="p">[</span><span class="n">cell_type</span><span class="p">]</span> <span class="o">==</span> <span class="n">sign</span>
            <span class="p">}</span>
            <span class="c1"># bin into three bins</span>
            <span class="c1"># ala (low contribution, medium contribution, high contribution)</span>
            <span class="n">counts</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
            <span class="n">cut_off_value</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="n">cut_off_edge</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;above_cut_off&quot;</span><span class="p">:</span>
                <span class="n">filtered_cell_types</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span><span class="n">valfilter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">,</span> <span class="n">cut_off</span><span class="o">=</span><span class="n">cut_off_value</span><span class="p">:</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="n">cut_off</span><span class="p">,</span> <span class="n">values</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;below_cut_off&quot;</span><span class="p">:</span>
                <span class="n">filtered_cell_types</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span><span class="n">valfilter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">,</span> <span class="n">cut_off</span><span class="o">=</span><span class="n">cut_off_value</span><span class="p">:</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="n">cut_off</span><span class="p">,</span> <span class="n">values</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mode </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">filtered_cell_types</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">filter_source_types</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">hide_source_types</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bins</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">edge</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">statistic</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter source types based on various criteria.</span>

<span class="sd">        Args:</span>
<span class="sd">            hide_source_types: Source types to hide or &quot;auto&quot;.</span>
<span class="sd">            bins: Number of bins for contribution levels.</span>
<span class="sd">            edge: Edge index for cut-off.</span>
<span class="sd">            mode: Filtering mode.</span>
<span class="sd">            statistic: Function to compute the statistic.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Filtered array of source types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">source_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorting</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hide_source_types</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">hide_source_types</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="n">hide_source_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_cell_types_by_contribution</span><span class="p">(</span>
                <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">cut_off_edge</span><span class="o">=</span><span class="n">edge</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">statistic</span><span class="o">=</span><span class="n">statistic</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">hide_source_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">source_types</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                <span class="n">source_type</span>
                <span class="k">for</span> <span class="n">source_type</span> <span class="ow">in</span> <span class="n">source_types</span>
                <span class="k">if</span> <span class="n">source_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hide_source_types</span>
            <span class="p">])</span>
        <span class="k">return</span> <span class="n">source_types</span>

    <span class="k">def</span> <span class="nf">signs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the signs of receptive fields for each source type.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary of signs for each source type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">ct</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfs</span><span class="p">[</span><span class="n">ct</span><span class="p">]</span><span class="o">.</span><span class="n">sign</span><span class="p">)</span> <span class="k">for</span> <span class="n">ct</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfs</span><span class="o">.</span><span class="n">source_types</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">sum_over_cells</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MovingEdgeCurrentView&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sum currents over cells.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new view with currents summed over cells.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span>
            <span class="n">Namespace</span><span class="p">({</span>
                <span class="n">cell_type</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_spatial_contribution</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">source_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">t_start</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">t_end</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;peak&quot;</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{source_type}</span><span class="s2"> :→&quot;</span><span class="p">,</span>
        <span class="n">fig</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_extent</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot the spatial contribution of a source type.</span>

<span class="sd">        Args:</span>
<span class="sd">            source_type: The source type to plot.</span>
<span class="sd">            t_start: Start time for the plot.</span>
<span class="sd">            t_end: End time for the plot.</span>
<span class="sd">            mode: Mode for calculating values (&quot;peak&quot;, &quot;mean&quot;, or &quot;std&quot;).</span>
<span class="sd">            title: Title format string for the plot.</span>
<span class="sd">            fig: Existing figure to use.</span>
<span class="sd">            ax: Existing axes to use.</span>
<span class="sd">            max_extent: Maximum extent of the spatial filter.</span>
<span class="sd">            **kwargs: Additional keyword arguments for plt_utils.kernel.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Axes object containing the plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_view</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;current_view&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>  <span class="c1"># .at_contrast(contrast).at_angle(angle)</span>
        <span class="p">)</span>

        <span class="n">vmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vmin&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span>
                <span class="nb">min</span><span class="p">(</span>
                    <span class="mi">0</span><span class="p">,</span>
                    <span class="nb">min</span><span class="p">(</span>
                        <span class="n">current</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">current</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">current_view</span><span class="p">[:]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                    <span class="p">),</span>
                <span class="p">)</span>
                <span class="o">*</span> <span class="mi">100</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="mi">100</span>
        <span class="p">)</span>

        <span class="n">vmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vmax&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span>
                <span class="nb">max</span><span class="p">(</span>
                    <span class="mi">0</span><span class="p">,</span>
                    <span class="nb">max</span><span class="p">(</span>
                        <span class="n">current</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">current</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">current_view</span><span class="p">[:]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                    <span class="p">),</span>
                <span class="p">)</span>
                <span class="o">*</span> <span class="mi">100</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="mi">100</span>
        <span class="p">)</span>

        <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">current_view</span><span class="o">.</span><span class="n">rfs</span><span class="p">[</span><span class="n">source_type</span><span class="p">][[</span><span class="s2">&quot;source_u&quot;</span><span class="p">,</span> <span class="s2">&quot;source_v&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># average over models</span>
        <span class="c1"># (1, n_models, 1, n_timesteps, n_models) -&gt; (n_timesteps, n_models)</span>
        <span class="c1"># import pdb</span>

        <span class="c1"># pdb.set_trace()</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">current_view</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;peak&quot;</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="p">]</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;mean&quot;</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;std&quot;</span><span class="p">:</span>
            <span class="n">signs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signs</span><span class="p">()</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">signs</span><span class="p">[</span><span class="n">source_type</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span>
            <span class="n">u</span><span class="p">,</span>
            <span class="n">v</span><span class="p">,</span>
            <span class="n">values</span><span class="p">,</span>
            <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">max_extent</span><span class="o">=</span><span class="n">max_extent</span> <span class="ow">or</span> <span class="n">current_view</span><span class="o">.</span><span class="n">rfs</span><span class="o">.</span><span class="n">max_extent</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">title</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">source_type</span><span class="o">=</span><span class="n">source_type</span><span class="p">),</span>
            <span class="n">labelxy</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
            <span class="n">strict_sign</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">dataLim</span><span class="o">.</span><span class="n">extents</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">plt_utils</span><span class="o">.</span><span class="n">get_lims</span><span class="p">((</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">),</span> <span class="mf">0.01</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">plt_utils</span><span class="o">.</span><span class="n">get_lims</span><span class="p">((</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">),</span> <span class="mf">0.01</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">plot_spatial_contribution_grid</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">t_start</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">t_end</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">max_extent</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;peak&quot;</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{source_type}</span><span class="s2"> :→&quot;</span><span class="p">,</span>
        <span class="n">fig</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">axes</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">edgewidth</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.125</span><span class="p">,</span>
        <span class="n">title_y</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
        <span class="n">max_figure_height_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">9.271</span><span class="p">,</span>
        <span class="n">panel_height_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="n">max_figure_width_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.54</span><span class="p">,</span>
        <span class="n">panel_width_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.54</span><span class="p">,</span>
        <span class="n">annotate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">cbar</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">hide_source_types</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="n">hide_source_types_bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">hide_source_types_cut_off_edge</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">hide_source_types_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;below_cut_off&quot;</span><span class="p">,</span>
        <span class="n">max_axes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">],</span>
        <span class="nb">tuple</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Colorbar</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Colormap</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
    <span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot a grid of spatial contributions for different source types.</span>

<span class="sd">        Args:</span>
<span class="sd">            t_start: Start time for the plot.</span>
<span class="sd">            t_end: End time for the plot.</span>
<span class="sd">            max_extent: Maximum extent of the spatial filter.</span>
<span class="sd">            mode: Mode for calculating values (&quot;peak&quot;, &quot;mean&quot;, or &quot;std&quot;).</span>
<span class="sd">            title: Title format string for each subplot.</span>
<span class="sd">            fig: Existing figure to use.</span>
<span class="sd">            axes: Existing axes to use.</span>
<span class="sd">            fontsize: Font size for labels and titles.</span>
<span class="sd">            edgewidth: Width of edges in the plot.</span>
<span class="sd">            title_y: Y-position of the title.</span>
<span class="sd">            max_figure_height_cm: Maximum figure height in centimeters.</span>
<span class="sd">            panel_height_cm: Height of each panel in centimeters.</span>
<span class="sd">            max_figure_width_cm: Maximum figure width in centimeters.</span>
<span class="sd">            panel_width_cm: Width of each panel in centimeters.</span>
<span class="sd">            annotate: Whether to annotate the plots.</span>
<span class="sd">            cbar: Whether to add a colorbar.</span>
<span class="sd">            hide_source_types: Source types to hide or &quot;auto&quot;.</span>
<span class="sd">            hide_source_types_bins: Number of bins for auto-hiding.</span>
<span class="sd">            hide_source_types_cut_off_edge: Cut-off edge for auto-hiding.</span>
<span class="sd">            hide_source_types_mode: Mode for auto-hiding source types.</span>
<span class="sd">            max_axes: Maximum number of axes to create.</span>
<span class="sd">            **kwargs: Additional keyword arguments for plot_spatial_contribution.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Figure, axes, and colorbar information (cbar, cmap, norm, vmin, vmax).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>

        <span class="n">vmin</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span>
                <span class="nb">min</span><span class="p">(</span>
                    <span class="mi">0</span><span class="p">,</span>
                    <span class="nb">min</span><span class="p">(</span>
                        <span class="n">current</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">current</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">current_view</span><span class="p">[:]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                    <span class="p">),</span>
                <span class="p">)</span>
                <span class="o">*</span> <span class="mi">10</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="mi">10</span>
        <span class="p">)</span>

        <span class="n">vmax</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span>
                <span class="nb">max</span><span class="p">(</span>
                    <span class="mi">0</span><span class="p">,</span>
                    <span class="nb">max</span><span class="p">(</span>
                        <span class="n">current</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">current</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">current_view</span><span class="p">[:]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                    <span class="p">),</span>
                <span class="p">)</span>
                <span class="o">*</span> <span class="mi">10</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="mi">10</span>
        <span class="p">)</span>

        <span class="n">source_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_source_types</span><span class="p">(</span>
            <span class="n">hide_source_types</span><span class="p">,</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">hide_source_types_bins</span><span class="p">,</span>
            <span class="n">edge</span><span class="o">=</span><span class="n">hide_source_types_cut_off_edge</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">hide_source_types_mode</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize_from_n_items</span><span class="p">(</span>
                <span class="n">max_axes</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_types</span><span class="p">),</span>
                <span class="n">max_figure_height_cm</span><span class="o">=</span><span class="n">max_figure_height_cm</span><span class="p">,</span>
                <span class="n">panel_height_cm</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">max_figure_height_cm</span> <span class="o">/</span> <span class="p">(</span><span class="n">max_axes</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_types</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">panel_height_cm</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span>
                    <span class="k">else</span> <span class="n">panel_height_cm</span>
                <span class="p">),</span>
                <span class="n">max_figure_width_cm</span><span class="o">=</span><span class="n">max_figure_width_cm</span><span class="p">,</span>
                <span class="n">panel_width_cm</span><span class="o">=</span><span class="n">panel_width_cm</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">figsize</span><span class="o">.</span><span class="n">axis_grid</span><span class="p">(</span>
                <span class="n">unmask_n</span><span class="o">=</span><span class="n">max_axes</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_types</span><span class="p">),</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">max_axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_types</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_axes</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">Axes</span><span class="p">):</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">source_type</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">source_types</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_spatial_contribution</span><span class="p">(</span>
                <span class="n">source_type</span><span class="p">,</span>
                <span class="c1">#                 contrast,</span>
                <span class="c1">#                 angle,</span>
                <span class="n">t_start</span><span class="p">,</span>
                <span class="n">t_end</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="n">edgewidth</span><span class="o">=</span><span class="n">edgewidth</span><span class="p">,</span>
                <span class="n">title_y</span><span class="o">=</span><span class="n">title_y</span><span class="p">,</span>
                <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">current_view</span><span class="o">=</span><span class="n">current_view</span><span class="p">,</span>
                <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
                <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                <span class="n">annotate</span><span class="o">=</span><span class="n">annotate</span><span class="p">,</span>
                <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">max_extent</span><span class="o">=</span><span class="n">max_extent</span> <span class="ow">or</span> <span class="n">current_view</span><span class="o">.</span><span class="n">rfs</span><span class="o">.</span><span class="n">max_extent</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">seismic</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">plt_utils</span><span class="o">.</span><span class="n">get_norm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">midpoint</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cbar</span><span class="p">:</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt_utils</span><span class="o">.</span><span class="n">add_colorbar_to_fig</span><span class="p">(</span>
                <span class="n">fig</span><span class="p">,</span>
                <span class="n">width</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2"> input currents&quot;</span><span class="p">,</span>
                <span class="n">n_ticks</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                <span class="n">n_decimals</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="p">(</span><span class="n">cbar</span><span class="p">,</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_spatial_filter</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">source_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{source_type}</span><span class="s2"> :→&quot;</span><span class="p">,</span>
        <span class="n">fig</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_extent</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot the spatial filter for a given source type.</span>

<span class="sd">        Args:</span>
<span class="sd">            source_type: The source type to plot.</span>
<span class="sd">            title: Title format string for the plot.</span>
<span class="sd">            fig: Existing figure to use.</span>
<span class="sd">            ax: Existing axes to use.</span>
<span class="sd">            max_extent: Maximum extent of the spatial filter.</span>
<span class="sd">            **kwargs: Additional keyword arguments for plt_utils.kernel.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Axes object containing the plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">filter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfs</span>

        <span class="k">def</span> <span class="nf">filter_values</span><span class="p">(</span><span class="n">rf</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">rf</span><span class="o">.</span><span class="n">n_syn</span> <span class="o">*</span> <span class="n">rf</span><span class="o">.</span><span class="n">sign</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>

        <span class="n">vmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;vmin&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span>
                <span class="nb">min</span><span class="p">(</span>
                    <span class="mi">0</span><span class="p">,</span>
                    <span class="nb">min</span><span class="p">(</span>
                        <span class="nb">min</span><span class="p">(</span><span class="n">filter_values</span><span class="p">(</span><span class="nb">filter</span><span class="p">[</span><span class="n">source_type</span><span class="p">]))</span>
                        <span class="k">for</span> <span class="n">source_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_types</span>
                    <span class="p">),</span>
                <span class="p">)</span>
                <span class="o">*</span> <span class="mi">100</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="mi">100</span>
        <span class="p">)</span>

        <span class="n">vmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;vmax&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span>
                <span class="nb">max</span><span class="p">(</span>
                    <span class="mi">0</span><span class="p">,</span>
                    <span class="nb">max</span><span class="p">(</span>
                        <span class="nb">max</span><span class="p">(</span><span class="n">filter_values</span><span class="p">(</span><span class="nb">filter</span><span class="p">[</span><span class="n">source_type</span><span class="p">]))</span>
                        <span class="k">for</span> <span class="n">source_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_types</span>
                    <span class="p">),</span>
                <span class="p">)</span>
                <span class="o">*</span> <span class="mi">100</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="mi">100</span>
        <span class="p">)</span>

        <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">[</span><span class="n">source_type</span><span class="p">][[</span><span class="s2">&quot;source_u&quot;</span><span class="p">,</span> <span class="s2">&quot;source_v&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># average over models</span>
        <span class="c1"># (1, n_models, 1, n_timesteps, n_models) -&gt; (n_timesteps, n_models)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">filter_values</span><span class="p">(</span><span class="nb">filter</span><span class="p">[</span><span class="n">source_type</span><span class="p">])</span>

        <span class="n">label</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">source_type</span><span class="o">=</span><span class="n">source_type</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plt_utils</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span>
            <span class="n">u</span><span class="p">,</span>
            <span class="n">v</span><span class="p">,</span>
            <span class="n">values</span><span class="p">,</span>
            <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">max_extent</span><span class="o">=</span><span class="n">max_extent</span> <span class="ow">or</span> <span class="nb">filter</span><span class="o">.</span><span class="n">max_extent</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
            <span class="n">labelxy</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
            <span class="n">strict_sign</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
            <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">dataLim</span><span class="o">.</span><span class="n">extents</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">plt_utils</span><span class="o">.</span><span class="n">get_lims</span><span class="p">((</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">),</span> <span class="mf">0.01</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">plt_utils</span><span class="o">.</span><span class="n">get_lims</span><span class="p">((</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">),</span> <span class="mf">0.01</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">plot_spatial_filter_grid</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{source_type}</span><span class="s2"> :→&quot;</span><span class="p">,</span>
        <span class="n">fig</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">axes</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_extent</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">edgewidth</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.125</span><span class="p">,</span>
        <span class="n">title_y</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
        <span class="n">max_figure_height_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">9.271</span><span class="p">,</span>
        <span class="n">panel_height_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="n">max_figure_width_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.54</span><span class="p">,</span>
        <span class="n">panel_width_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.54</span><span class="p">,</span>
        <span class="n">annotate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">cbar</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">hide_source_types</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="n">hide_source_types_bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">hide_source_types_cut_off_edge</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">hide_source_types_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;below_cut_off&quot;</span><span class="p">,</span>
        <span class="n">max_axes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">wspace</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">hspace</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">],</span>
        <span class="nb">tuple</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Colorbar</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Colormap</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
    <span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot a grid of spatial filters for different source types.</span>

<span class="sd">        Args:</span>
<span class="sd">            title: Title format string for each subplot.</span>
<span class="sd">            fig: Existing figure to use.</span>
<span class="sd">            axes: Existing axes to use.</span>
<span class="sd">            max_extent: Maximum extent of the spatial filter.</span>
<span class="sd">            fontsize: Font size for labels and titles.</span>
<span class="sd">            edgewidth: Width of edges in the plot.</span>
<span class="sd">            title_y: Y-position of the title.</span>
<span class="sd">            max_figure_height_cm: Maximum figure height in centimeters.</span>
<span class="sd">            panel_height_cm: Height of each panel in centimeters.</span>
<span class="sd">            max_figure_width_cm: Maximum figure width in centimeters.</span>
<span class="sd">            panel_width_cm: Width of each panel in centimeters.</span>
<span class="sd">            annotate: Whether to annotate the plots.</span>
<span class="sd">            cbar: Whether to add a colorbar.</span>
<span class="sd">            hide_source_types: Source types to hide or &quot;auto&quot;.</span>
<span class="sd">            hide_source_types_bins: Number of bins for auto-hiding.</span>
<span class="sd">            hide_source_types_cut_off_edge: Cut-off edge for auto-hiding.</span>
<span class="sd">            hide_source_types_mode: Mode for auto-hiding source types.</span>
<span class="sd">            max_axes: Maximum number of axes to create.</span>
<span class="sd">            wspace: Width space between subplots.</span>
<span class="sd">            hspace: Height space between subplots.</span>
<span class="sd">            **kwargs: Additional keyword arguments for plot_spatial_filter.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Figure, axes, and colorbar information (cbar, cmap, norm, vmin, vmax).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">filter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfs</span>

        <span class="k">def</span> <span class="nf">filter_values</span><span class="p">(</span><span class="n">rf</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">rf</span><span class="o">.</span><span class="n">n_syn</span> <span class="o">*</span> <span class="n">rf</span><span class="o">.</span><span class="n">sign</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>

        <span class="n">vmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;vmin&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span>
                <span class="nb">min</span><span class="p">(</span>
                    <span class="mi">0</span><span class="p">,</span>
                    <span class="nb">min</span><span class="p">(</span>
                        <span class="nb">min</span><span class="p">(</span><span class="n">filter_values</span><span class="p">(</span><span class="nb">filter</span><span class="p">[</span><span class="n">source_type</span><span class="p">]))</span>
                        <span class="k">for</span> <span class="n">source_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_types</span>
                    <span class="p">),</span>
                <span class="p">)</span>
                <span class="o">*</span> <span class="mi">100</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="mi">100</span>
        <span class="p">)</span>

        <span class="n">vmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;vmax&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span>
                <span class="nb">max</span><span class="p">(</span>
                    <span class="mi">0</span><span class="p">,</span>
                    <span class="nb">max</span><span class="p">(</span>
                        <span class="nb">max</span><span class="p">(</span><span class="n">filter_values</span><span class="p">(</span><span class="nb">filter</span><span class="p">[</span><span class="n">source_type</span><span class="p">]))</span>
                        <span class="k">for</span> <span class="n">source_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_types</span>
                    <span class="p">),</span>
                <span class="p">)</span>
                <span class="o">*</span> <span class="mi">100</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="mi">100</span>
        <span class="p">)</span>

        <span class="n">source_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_source_types</span><span class="p">(</span>
            <span class="n">hide_source_types</span><span class="p">,</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">hide_source_types_bins</span><span class="p">,</span>
            <span class="n">edge</span><span class="o">=</span><span class="n">hide_source_types_cut_off_edge</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">hide_source_types_mode</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize_from_n_items</span><span class="p">(</span>
                <span class="n">max_axes</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_types</span><span class="p">),</span>
                <span class="n">max_figure_height_cm</span><span class="o">=</span><span class="n">max_figure_height_cm</span><span class="p">,</span>
                <span class="n">panel_height_cm</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">max_figure_height_cm</span> <span class="o">/</span> <span class="p">(</span><span class="n">max_axes</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_types</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">panel_height_cm</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span>
                    <span class="k">else</span> <span class="n">panel_height_cm</span>
                <span class="p">),</span>
                <span class="n">max_figure_width_cm</span><span class="o">=</span><span class="n">max_figure_width_cm</span><span class="p">,</span>
                <span class="n">panel_width_cm</span><span class="o">=</span><span class="n">panel_width_cm</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">figsize</span><span class="o">.</span><span class="n">axis_grid</span><span class="p">(</span>
                <span class="n">unmask_n</span><span class="o">=</span><span class="n">max_axes</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_types</span><span class="p">),</span> <span class="n">hspace</span><span class="o">=</span><span class="n">hspace</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="n">wspace</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">max_axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_types</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_axes</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">Axes</span><span class="p">):</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">source_type</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">source_types</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_spatial_filter</span><span class="p">(</span>
                <span class="n">source_type</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="n">edgewidth</span><span class="o">=</span><span class="n">edgewidth</span><span class="p">,</span>
                <span class="n">title_y</span><span class="o">=</span><span class="n">title_y</span><span class="p">,</span>
                <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
                <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                <span class="n">annotate</span><span class="o">=</span><span class="n">annotate</span><span class="p">,</span>
                <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">max_extent</span><span class="o">=</span><span class="n">max_extent</span> <span class="ow">or</span> <span class="nb">filter</span><span class="o">.</span><span class="n">max_extent</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">seismic</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">plt_utils</span><span class="o">.</span><span class="n">get_norm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">midpoint</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cbar</span><span class="p">:</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt_utils</span><span class="o">.</span><span class="n">add_colorbar_to_fig</span><span class="p">(</span>
                <span class="n">fig</span><span class="p">,</span>
                <span class="n">width</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;spatial filters&quot;</span><span class="p">,</span>
                <span class="n">n_ticks</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                <span class="n">n_decimals</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="p">(</span><span class="n">cbar</span><span class="p">,</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">view</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">currents</span><span class="p">:</span> <span class="n">Namespace</span><span class="p">,</span>
        <span class="n">rfs</span><span class="p">:</span> <span class="n">ReceptiveFields</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">time</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">responses</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">arg_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MovingEdgeCurrentView&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new view with the given currents, rfs, time, responses, and arg_df.</span>

<span class="sd">        Args:</span>
<span class="sd">            currents: Currents for each source type.</span>
<span class="sd">            rfs: Receptive fields for the target cells.</span>
<span class="sd">            time: Time array for the simulation.</span>
<span class="sd">            responses: Responses of the target cells.</span>
<span class="sd">            arg_df: DataFrame containing stimulus arguments.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new view with the given data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arg_df</span> <span class="o">=</span> <span class="n">arg_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">arg_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg_df</span>
        <span class="k">return</span> <span class="n">MovingEdgeCurrentView</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ensemble</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_type</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exp_data</span><span class="p">,</span>
            <span class="n">arg_df</span><span class="p">,</span>
            <span class="n">currents</span><span class="p">,</span>
            <span class="n">rfs</span> <span class="k">if</span> <span class="n">rfs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfs</span><span class="p">,</span>
            <span class="n">time</span> <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">responses</span> <span class="k">if</span> <span class="n">responses</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">subtract_baseline</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MovingEdgeCurrentView&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new view with baseline subtracted from the currents and responses.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new view with baseline subtracted data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span>
            <span class="n">Namespace</span><span class="p">({</span>
                <span class="n">cell_type</span><span class="p">:</span> <span class="n">c</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}),</span>
            <span class="n">responses</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">responses</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">subtract_mean</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MovingEdgeCurrentView&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new view with mean subtracted from the currents and responses.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new view with mean subtracted data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span>
            <span class="n">Namespace</span><span class="p">({</span>
                <span class="n">cell_type</span><span class="p">:</span> <span class="n">c</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}),</span>
            <span class="n">responses</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">responses</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">standardize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MovingEdgeCurrentView&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new view with standardized currents and responses.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new view with standardized data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span>
            <span class="n">Namespace</span><span class="p">({</span>
                <span class="n">cell_type</span><span class="p">:</span> <span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
                <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}),</span>
            <span class="n">responses</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">responses</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">standardize_over_time_and_pd_nd</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">t_start</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">t_end</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">pd</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MovingEdgeCurrentView&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new view with standardized currents and responses over time and PD/ND.</span>

<span class="sd">        Args:</span>
<span class="sd">            t_start: Start time for standardization.</span>
<span class="sd">            t_end: End time for standardization.</span>
<span class="sd">            pd: Preferred direction for standardization.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new view with standardized data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span><span class="o">.</span><span class="n">at_angle</span><span class="p">([</span><span class="n">pd</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span>
            <span class="n">Namespace</span><span class="p">({</span>
                <span class="n">cell_type</span><span class="p">:</span> <span class="p">(</span>
                    <span class="n">c</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">currents</span><span class="p">[</span><span class="n">cell_type</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">),</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">currents</span><span class="p">[</span><span class="n">cell_type</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">),</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}),</span>
            <span class="n">responses</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">responses</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">responses</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">responses</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">init_colors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_types</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize colors for source types.</span>

<span class="sd">        Args:</span>
<span class="sd">            source_types: List of source types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">signs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signs</span><span class="p">()</span>
        <span class="n">signs</span> <span class="o">=</span> <span class="p">{</span><span class="n">cell_type</span><span class="p">:</span> <span class="n">signs</span><span class="p">[</span><span class="n">cell_type</span><span class="p">]</span> <span class="k">for</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="n">source_types</span><span class="p">}</span>
        <span class="n">signs_reversed</span> <span class="o">=</span> <span class="p">{</span><span class="n">cell_type</span><span class="p">:</span> <span class="n">signs</span><span class="p">[</span><span class="n">cell_type</span><span class="p">]</span> <span class="k">for</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="n">source_types</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]}</span>
        <span class="n">n_exc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">signs</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">n_inh</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">signs</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">exc_colors_pd</span> <span class="o">=</span> <span class="n">cmap_iter</span><span class="p">(</span>
            <span class="n">truncate_colormap</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdBu</span><span class="p">,</span> <span class="n">minval</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">maxval</span><span class="o">=</span><span class="mf">0.45</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_exc</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">inh_cmap_pd</span> <span class="o">=</span> <span class="n">cmap_iter</span><span class="p">(</span>
            <span class="n">truncate_colormap</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdBu_r</span><span class="p">,</span> <span class="n">minval</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">maxval</span><span class="o">=</span><span class="mf">0.45</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_inh</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">exc_colors_nd</span> <span class="o">=</span> <span class="n">cmap_iter</span><span class="p">(</span>
            <span class="n">truncate_colormap</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">BrBG_r</span><span class="p">,</span> <span class="n">minval</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">maxval</span><span class="o">=</span><span class="mf">0.45</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_exc</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">inh_cmap_nd</span> <span class="o">=</span> <span class="n">cmap_iter</span><span class="p">(</span>
            <span class="n">truncate_colormap</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">BrBG</span><span class="p">,</span> <span class="n">minval</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">maxval</span><span class="o">=</span><span class="mf">0.45</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_inh</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">colors_pd</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">colors_nd</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">cell_type</span><span class="p">,</span> <span class="n">sign</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">signs</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># take the first half of the RdBu colormap, i.e. red</span>
                <span class="n">colors_pd</span><span class="p">[</span><span class="n">cell_type</span><span class="p">]</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">exc_colors_pd</span><span class="p">)</span>
                <span class="n">colors_nd</span><span class="p">[</span><span class="n">cell_type</span><span class="p">]</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">exc_colors_nd</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">cell_type</span><span class="p">,</span> <span class="n">sign</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">signs_reversed</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="c1"># take the second half of the RdBu colormap, i.e. blue</span>
                <span class="n">colors_pd</span><span class="p">[</span><span class="n">cell_type</span><span class="p">]</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">inh_cmap_pd</span><span class="p">)</span>
                <span class="n">colors_nd</span><span class="p">[</span><span class="n">cell_type</span><span class="p">]</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">inh_cmap_nd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colors_pd</span> <span class="o">=</span> <span class="n">colors_pd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colors_nd</span> <span class="o">=</span> <span class="n">colors_nd</span>

    <span class="k">def</span> <span class="nf">color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the color for a given source type.</span>

<span class="sd">        Args:</span>
<span class="sd">            source_type: The source type.</span>
<span class="sd">            pd: Whether to use PD or ND colors.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The color as an RGB tuple.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pd</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors_pd</span><span class="p">[</span><span class="n">source_type</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors_nd</span><span class="p">[</span><span class="n">source_type</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">zorder</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">source_types</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">source_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">start_exc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">start_inh</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the z-order for a given source type.</span>

<span class="sd">        Args:</span>
<span class="sd">            source_types: List of source types.</span>
<span class="sd">            source_type: The source type.</span>
<span class="sd">            start_exc: Starting z-order for excitatory cells.</span>
<span class="sd">            start_inh: Starting z-order for inhibitory cells.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The z-order for the given source type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">signs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signs</span><span class="p">()</span>
        <span class="n">signs_reversed</span> <span class="o">=</span> <span class="p">{</span><span class="n">cell_type</span><span class="p">:</span> <span class="n">signs</span><span class="p">[</span><span class="n">cell_type</span><span class="p">]</span> <span class="k">for</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="n">source_types</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]}</span>

        <span class="n">z_order</span> <span class="o">=</span> <span class="n">start_exc</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">cell_type</span><span class="p">,</span> <span class="n">sign</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">signs</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cell_type</span> <span class="o">==</span> <span class="n">source_type</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">z_order</span>
                <span class="n">z_order</span> <span class="o">-=</span> <span class="mi">10</span>

        <span class="n">z_order</span> <span class="o">=</span> <span class="n">start_inh</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">cell_type</span><span class="p">,</span> <span class="n">sign</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">signs_reversed</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cell_type</span> <span class="o">==</span> <span class="n">source_type</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">z_order</span>
                <span class="n">z_order</span> <span class="o">-=</span> <span class="mi">10</span>

    <span class="k">def</span> <span class="nf">ylims</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">source_types</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.02</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the y-limits for temporal contributions summed over cells.</span>

<span class="sd">        Args:</span>
<span class="sd">            source_types: List of source types to consider.</span>
<span class="sd">            offset: Offset for the y-limits.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Y-limits for the given source types or all source types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">source_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="n">cell_type</span><span class="p">:</span> <span class="n">plt_utils</span><span class="o">.</span><span class="n">get_lims</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_over_cells</span><span class="p">()</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="n">source_types</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="n">plt_utils</span><span class="o">.</span><span class="n">get_lims</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sum_over_cells</span><span class="p">()</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">offset</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_response</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">contrast</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">t_start</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">t_end</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">max_figure_height_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.4477</span><span class="p">,</span>
        <span class="n">panel_height_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.4477</span><span class="p">,</span>
        <span class="n">max_figure_width_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0513</span><span class="p">,</span>
        <span class="n">panel_width_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0513</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">model_average</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">color</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">legend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">hide_yaxis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">trim_axes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">quantile</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">scale_position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># &quot;lower left&quot;,</span>
        <span class="n">scale_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:.0f}</span><span class="s2"> ms&quot;</span><span class="p">,</span>
        <span class="n">scale_unit</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">hline</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">fig</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the response to a moving edge stimulus.</span>

<span class="sd">        Args:</span>
<span class="sd">            contrast: The contrast of the stimulus.</span>
<span class="sd">            angle: The angle of the stimulus.</span>
<span class="sd">            t_start: Start time for the plot.</span>
<span class="sd">            t_end: End time for the plot.</span>
<span class="sd">            max_figure_height_cm: Maximum figure height in centimeters.</span>
<span class="sd">            panel_height_cm: Height of each panel in centimeters.</span>
<span class="sd">            max_figure_width_cm: Maximum figure width in centimeters.</span>
<span class="sd">            panel_width_cm: Width of each panel in centimeters.</span>
<span class="sd">            fontsize: Font size for labels and titles.</span>
<span class="sd">            model_average: Whether to plot the model average.</span>
<span class="sd">            color: Color for the plot.</span>
<span class="sd">            legend: Whether to show the legend.</span>
<span class="sd">            hide_yaxis: Whether to hide the y-axis.</span>
<span class="sd">            trim_axes: Whether to trim the axes.</span>
<span class="sd">            quantile: Quantile for shading.</span>
<span class="sd">            scale_position: Position of the scale.</span>
<span class="sd">            scale_label: Label format for the scale.</span>
<span class="sd">            scale_unit: Unit for the scale.</span>
<span class="sd">            hline: Whether to show a horizontal line at 0.</span>
<span class="sd">            fig: Existing figure to use.</span>
<span class="sd">            ax: Existing axes to use.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Figure and axes objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r_pd</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">at_angle</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
            <span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
            <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
            <span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">r_nd</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">at_angle</span><span class="p">((</span><span class="n">angle</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>
            <span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
            <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
            <span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize_from_n_items</span><span class="p">(</span>
                <span class="mi">1</span><span class="p">,</span>
                <span class="n">max_figure_height_cm</span><span class="o">=</span><span class="n">max_figure_height_cm</span><span class="p">,</span>
                <span class="n">panel_height_cm</span><span class="o">=</span><span class="n">panel_height_cm</span><span class="p">,</span>
                <span class="n">max_figure_width_cm</span><span class="o">=</span><span class="n">max_figure_width_cm</span><span class="p">,</span>
                <span class="n">panel_width_cm</span><span class="o">=</span><span class="n">panel_width_cm</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">figsize</span><span class="o">.</span><span class="n">axis_grid</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="n">hex2color</span><span class="p">(</span><span class="n">PD</span><span class="p">),</span> <span class="n">hex2color</span><span class="p">(</span><span class="n">ND</span><span class="p">)]</span> <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="n">color</span><span class="p">,</span> <span class="n">color</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">model_average</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">traces</span><span class="p">(</span>
                <span class="p">[</span><span class="n">r_pd</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">r_nd</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)],</span>
                <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="n">null_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="s2">&quot;dashed&quot;</span><span class="p">],</span>
                <span class="n">legend</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">legend</span> <span class="k">else</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;null direction&quot;</span><span class="p">],</span>
                <span class="n">scale_pos</span><span class="o">=</span><span class="n">scale_position</span><span class="p">,</span>
                <span class="n">scale_label</span><span class="o">=</span><span class="n">scale_label</span><span class="p">,</span>
                <span class="n">scale_unit</span><span class="o">=</span><span class="n">scale_unit</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">traces</span><span class="p">(</span>
                <span class="n">r_pd</span><span class="p">,</span>
                <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">mean_color</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">color</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.5</span><span class="p">),</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                <span class="n">zorder_traces</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">zorder_mean</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="n">null_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">highlight_mean</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">plots</span><span class="o">.</span><span class="n">traces</span><span class="p">(</span>
                <span class="n">r_nd</span><span class="p">,</span>
                <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">mean_color</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">color</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.5</span><span class="p">),</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                <span class="n">zorder_traces</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">zorder_mean</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="n">null_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">highlight_mean</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">quantile</span><span class="p">:</span>
            <span class="n">quantile_pd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">r_pd</span><span class="p">,</span> <span class="n">quantile</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">quantile_nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">r_nd</span><span class="p">,</span> <span class="n">quantile</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">quantile_pd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">quantile_pd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">facecolor</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.1</span><span class="p">),</span>
                <span class="n">edgecolor</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">quantile_nd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">quantile_nd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">facecolor</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.1</span><span class="p">),</span>
                <span class="n">edgecolor</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">hline</span><span class="p">:</span>
            <span class="c1"># horizontal line at 0</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">hide_yaxis</span><span class="p">:</span>
            <span class="n">plt_utils</span><span class="o">.</span><span class="n">rm_spines</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,))</span>
        <span class="k">if</span> <span class="n">trim_axes</span><span class="p">:</span>
            <span class="n">plt_utils</span><span class="o">.</span><span class="n">trim_axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
                <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">plot_response_pc_nc</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">contrast</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">t_start</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">t_end</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">max_figure_height_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.4477</span><span class="p">,</span>
        <span class="n">panel_height_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.4477</span><span class="p">,</span>
        <span class="n">max_figure_width_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0513</span><span class="p">,</span>
        <span class="n">panel_width_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0513</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">model_average</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">color</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">legend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">hide_yaxis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">trim_axes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">quantile</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">scale_position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">scale_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:.0f}</span><span class="s2"> ms&quot;</span><span class="p">,</span>
        <span class="n">scale_unit</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">fig</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">hline</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the response to a moving edge stimulus with positive and negative contrasts.</span>

<span class="sd">        Args:</span>
<span class="sd">            contrast: The contrast of the stimulus.</span>
<span class="sd">            angle: The angle of the stimulus.</span>
<span class="sd">            t_start: Start time for the plot.</span>
<span class="sd">            t_end: End time for the plot.</span>
<span class="sd">            max_figure_height_cm: Maximum figure height in centimeters.</span>
<span class="sd">            panel_height_cm: Height of each panel in centimeters.</span>
<span class="sd">            max_figure_width_cm: Maximum figure width in centimeters.</span>
<span class="sd">            panel_width_cm: Width of each panel in centimeters.</span>
<span class="sd">            fontsize: Font size for labels and titles.</span>
<span class="sd">            model_average: Whether to plot the model average.</span>
<span class="sd">            color: Color for the plot.</span>
<span class="sd">            legend: Whether to show the legend.</span>
<span class="sd">            hide_yaxis: Whether to hide the y-axis.</span>
<span class="sd">            trim_axes: Whether to trim the axes.</span>
<span class="sd">            quantile: Quantile for shading.</span>
<span class="sd">            scale_position: Position of the scale.</span>
<span class="sd">            scale_label: Label format for the scale.</span>
<span class="sd">            scale_unit: Unit for the scale.</span>
<span class="sd">            fig: Existing figure to use.</span>
<span class="sd">            ax: Existing axes to use.</span>
<span class="sd">            hline: Whether to show a horizontal line at 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Figure and axes objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r_pc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">at_angle</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
            <span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
            <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
            <span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">r_nc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">at_angle</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
            <span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="n">contrast</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
            <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
            <span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize_from_n_items</span><span class="p">(</span>
                <span class="mi">1</span><span class="p">,</span>
                <span class="n">max_figure_height_cm</span><span class="o">=</span><span class="n">max_figure_height_cm</span><span class="p">,</span>
                <span class="n">panel_height_cm</span><span class="o">=</span><span class="n">panel_height_cm</span><span class="p">,</span>
                <span class="n">max_figure_width_cm</span><span class="o">=</span><span class="n">max_figure_width_cm</span><span class="p">,</span>
                <span class="n">panel_width_cm</span><span class="o">=</span><span class="n">panel_width_cm</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">figsize</span><span class="o">.</span><span class="n">axis_grid</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="n">hex2color</span><span class="p">(</span><span class="n">PD</span><span class="p">),</span> <span class="n">hex2color</span><span class="p">(</span><span class="n">ND</span><span class="p">)]</span> <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="n">color</span><span class="p">,</span> <span class="n">color</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">model_average</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">traces</span><span class="p">(</span>
                <span class="p">[</span><span class="n">r_pc</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">r_nc</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)],</span>
                <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="n">null_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="s2">&quot;dotted&quot;</span><span class="p">],</span>
                <span class="n">legend</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">legend</span> <span class="k">else</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;null contrast&quot;</span><span class="p">],</span>
                <span class="n">scale_pos</span><span class="o">=</span><span class="n">scale_position</span><span class="p">,</span>
                <span class="n">scale_label</span><span class="o">=</span><span class="n">scale_label</span><span class="p">,</span>
                <span class="n">scale_unit</span><span class="o">=</span><span class="n">scale_unit</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">traces</span><span class="p">(</span>
                <span class="n">r_pc</span><span class="p">,</span>
                <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">mean_color</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">color</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.5</span><span class="p">),</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                <span class="n">zorder_traces</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">zorder_mean</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="n">null_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">highlight_mean</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">plots</span><span class="o">.</span><span class="n">traces</span><span class="p">(</span>
                <span class="n">r_nc</span><span class="p">,</span>
                <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">mean_color</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">color</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.5</span><span class="p">),</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                <span class="n">zorder_traces</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">zorder_mean</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="n">null_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">highlight_mean</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">quantile</span><span class="p">:</span>
            <span class="n">quantile_pd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">r_pc</span><span class="p">,</span> <span class="n">quantile</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">quantile_nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">r_nc</span><span class="p">,</span> <span class="n">quantile</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">quantile_pd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">quantile_pd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">facecolor</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.1</span><span class="p">),</span>
                <span class="n">edgecolor</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">quantile_nd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">quantile_nd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">facecolor</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.1</span><span class="p">),</span>
                <span class="n">edgecolor</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># horizontal line at 0</span>
        <span class="k">if</span> <span class="n">hline</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">hide_yaxis</span><span class="p">:</span>
            <span class="n">plt_utils</span><span class="o">.</span><span class="n">rm_spines</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,))</span>
        <span class="k">if</span> <span class="n">trim_axes</span><span class="p">:</span>
            <span class="n">plt_utils</span><span class="o">.</span><span class="n">trim_axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
                <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">plot_temporal_contributions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">contrast</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">t_start</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">t_end</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span>
        <span class="n">legend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">legend_standalone</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">legend_figsize_cm</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">4.0572</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">legend_n_rows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_figure_height_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.3941</span><span class="p">,</span>
        <span class="n">panel_height_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.3941</span><span class="p">,</span>
        <span class="n">max_figure_width_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0572</span><span class="p">,</span>
        <span class="n">panel_width_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0572</span><span class="p">,</span>
        <span class="n">model_average</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">highlight_mean</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># only applies if model_average is False</span>
        <span class="n">sum_exc_inh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">only_sum</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">hide_source_types</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="n">hide_source_types_bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">hide_source_types_cut_off_edge</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">hide_source_types_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;below_cut_off&quot;</span><span class="p">,</span>
        <span class="n">hide_yaxis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">trim_axes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">quantile</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fig</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">legend_ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">hline</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">legend_n_cols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">baseline_color</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">colors</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot temporal contributions of different source types.</span>

<span class="sd">        Args:</span>
<span class="sd">            contrast: The contrast of the stimulus.</span>
<span class="sd">            angle: The angle of the stimulus.</span>
<span class="sd">            t_start: Start time for the plot.</span>
<span class="sd">            t_end: End time for the plot.</span>
<span class="sd">            fontsize: Font size for labels and titles.</span>
<span class="sd">            linewidth: Line width for traces.</span>
<span class="sd">            legend: Whether to show the legend.</span>
<span class="sd">            legend_standalone: Whether to create a standalone legend.</span>
<span class="sd">            legend_figsize_cm: Figure size for the standalone legend.</span>
<span class="sd">            legend_n_rows: Number of rows for the standalone legend.</span>
<span class="sd">            max_figure_height_cm: Maximum figure height in centimeters.</span>
<span class="sd">            panel_height_cm: Height of each panel in centimeters.</span>
<span class="sd">            max_figure_width_cm: Maximum figure width in centimeters.</span>
<span class="sd">            panel_width_cm: Width of each panel in centimeters.</span>
<span class="sd">            model_average: Whether to plot the model average.</span>
<span class="sd">            highlight_mean: Whether to highlight the mean trace.</span>
<span class="sd">            sum_exc_inh: Whether to sum excitatory and inhibitory contributions.</span>
<span class="sd">            only_sum: Whether to only plot the summed contributions.</span>
<span class="sd">            hide_source_types: Source types to hide or &quot;auto&quot;.</span>
<span class="sd">            hide_source_types_bins: Number of bins for auto-hiding.</span>
<span class="sd">            hide_source_types_cut_off_edge: Cut-off edge for auto-hiding.</span>
<span class="sd">            hide_source_types_mode: Mode for auto-hiding source types.</span>
<span class="sd">            hide_yaxis: Whether to hide the y-axis.</span>
<span class="sd">            trim_axes: Whether to trim the axes.</span>
<span class="sd">            quantile: Quantile for shading.</span>
<span class="sd">            fig: Existing figure to use.</span>
<span class="sd">            ax: Existing axes to use.</span>
<span class="sd">            legend_ax: Existing axes for the standalone legend.</span>
<span class="sd">            hline: Whether to show a horizontal line at 0.</span>
<span class="sd">            legend_n_cols: Number of columns for the standalone legend.</span>
<span class="sd">            baseline_color: Color for the baseline.</span>
<span class="sd">            colors: Colors for each source type.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Figure, axes, and legend axes objects.</span>

<span class="sd">        Example:</span>
<span class="sd">            ```</span>
<span class="sd">            view = MovingEdgeCurrentView(...)</span>
<span class="sd">            fig, ax = view.plot_temporal_contributions(</span>
<span class="sd">                contrast=1.0,</span>
<span class="sd">                angle=0,</span>
<span class="sd">                t_start=0,</span>
<span class="sd">                t_end=1,</span>
<span class="sd">                fontsize=5,</span>
<span class="sd">                linewidth=0.25,</span>
<span class="sd">                legend=True</span>
<span class="sd">            )</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize_from_n_items</span><span class="p">(</span>
                <span class="mi">1</span><span class="p">,</span>
                <span class="n">max_figure_height_cm</span><span class="o">=</span><span class="n">max_figure_height_cm</span><span class="p">,</span>
                <span class="n">panel_height_cm</span><span class="o">=</span><span class="n">panel_height_cm</span><span class="p">,</span>
                <span class="n">max_figure_width_cm</span><span class="o">=</span><span class="n">max_figure_width_cm</span><span class="p">,</span>
                <span class="n">panel_width_cm</span><span class="o">=</span><span class="n">panel_width_cm</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">figsize</span><span class="o">.</span><span class="n">axis_grid</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cv_pd</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
            <span class="o">.</span><span class="n">at_angle</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
            <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
            <span class="o">.</span><span class="n">sum_over_cells</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">cv_nd</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
            <span class="o">.</span><span class="n">at_angle</span><span class="p">((</span><span class="n">angle</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>
            <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
            <span class="o">.</span><span class="n">sum_over_cells</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="n">source_types</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
            <span class="o">.</span><span class="n">at_angle</span><span class="p">([</span><span class="n">angle</span><span class="p">,</span> <span class="p">(</span><span class="n">angle</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">])</span>
            <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
            <span class="o">.</span><span class="n">filter_source_types</span><span class="p">(</span>
                <span class="n">hide_source_types</span><span class="p">,</span>
                <span class="n">hide_source_types_bins</span><span class="p">,</span>
                <span class="n">hide_source_types_cut_off_edge</span><span class="p">,</span>
                <span class="n">hide_source_types_mode</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">color_source_types</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
            <span class="o">.</span><span class="n">at_angle</span><span class="p">([</span><span class="n">angle</span><span class="p">,</span> <span class="p">(</span><span class="n">angle</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">])</span>
            <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
            <span class="o">.</span><span class="n">filter_source_types</span><span class="p">(</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="n">hide_source_types_bins</span><span class="p">,</span>
                <span class="n">hide_source_types_cut_off_edge</span><span class="p">,</span>
                <span class="n">hide_source_types_mode</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">cv_pd</span><span class="o">.</span><span class="n">init_colors</span><span class="p">(</span><span class="n">color_source_types</span><span class="p">)</span>
        <span class="n">cv_nd</span><span class="o">.</span><span class="n">init_colors</span><span class="p">(</span><span class="n">color_source_types</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">plot_mean_trace</span><span class="p">(</span>
            <span class="n">time</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">zorder</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">time</span><span class="p">,</span>
                <span class="n">trace</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">def</span> <span class="nf">plot_individual_traces</span><span class="p">(</span>
            <span class="n">traces</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">zorder</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">only_sum</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">model_average</span><span class="p">:</span>
                <span class="n">plots</span><span class="o">.</span><span class="n">traces</span><span class="p">(</span>
                    <span class="n">traces</span><span class="p">,</span>
                    <span class="n">time</span><span class="p">,</span>
                    <span class="n">mean_color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span>
                    <span class="n">zorder_traces</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">zorder_mean</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                    <span class="n">null_line</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">highlight_mean</span><span class="o">=</span><span class="n">highlight_mean</span><span class="p">,</span>
                    <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                    <span class="n">legend</span><span class="o">=</span><span class="n">legend</span> <span class="ow">or</span> <span class="n">label</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">def</span> <span class="nf">plot_quantile</span><span class="p">(</span><span class="n">traces</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">zorder</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">quantile</span><span class="p">:</span>
                <span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">traces</span><span class="p">,</span> <span class="n">quantile</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
                    <span class="n">time</span><span class="p">,</span>
                    <span class="n">Q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">Q</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">facecolor</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
                    <span class="n">edgecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">def</span> <span class="nf">plot_summed_trace</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">zorder</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">trace</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">time</span><span class="p">,</span>
                    <span class="n">trace</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">def</span> <span class="nf">get_summed_traces</span><span class="p">(</span><span class="n">signs</span><span class="p">,</span> <span class="n">source_types</span><span class="p">,</span> <span class="n">cv_pd</span><span class="p">,</span> <span class="n">cv_nd</span><span class="p">):</span>
            <span class="c1"># sum over cell types then average over models</span>
            <span class="n">exc_pd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">cv_pd</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">inh_pd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">cv_pd</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">exc_nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">cv_nd</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">inh_nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">cv_nd</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="c1"># sum over cell types</span>
            <span class="k">for</span> <span class="n">source_type</span> <span class="ow">in</span> <span class="n">source_types</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">signs</span><span class="p">[</span><span class="n">source_type</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">exc_pd</span> <span class="o">+=</span> <span class="n">cv_pd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span>  <span class="c1"># (1, n_models, 1, n_timesteps)</span>
                    <span class="n">exc_nd</span> <span class="o">+=</span> <span class="n">cv_nd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">inh_pd</span> <span class="o">+=</span> <span class="n">cv_pd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span>
                    <span class="n">inh_nd</span> <span class="o">+=</span> <span class="n">cv_nd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span>
            <span class="c1"># (n_models, n_timesteps)</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">exc_pd</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span>
                <span class="n">inh_pd</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span>
                <span class="n">exc_nd</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span>
                <span class="n">inh_nd</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">source_type</span> <span class="ow">in</span> <span class="n">source_types</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">model_average</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">only_sum</span><span class="p">:</span>
                <span class="c1"># mean traces solid for PD and dashed for ND</span>
                <span class="k">if</span> <span class="n">baseline_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">baseline_color</span>
                <span class="k">elif</span> <span class="n">colors</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">source_type</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">cv_pd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">source_type</span><span class="p">)</span>

                <span class="n">plot_mean_trace</span><span class="p">(</span>
                    <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                    <span class="n">cv_pd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                    <span class="n">source_type</span><span class="p">,</span>
                    <span class="n">color</span><span class="p">,</span>
                    <span class="n">cv_pd</span><span class="o">.</span><span class="n">zorder</span><span class="p">(</span><span class="n">source_types</span><span class="p">,</span> <span class="n">source_type</span><span class="p">),</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                    <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">plot_mean_trace</span><span class="p">(</span>
                    <span class="n">cv_nd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                    <span class="n">cv_nd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                    <span class="n">source_type</span><span class="p">,</span>
                    <span class="n">color</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="n">cv_pd</span><span class="o">.</span><span class="n">zorder</span><span class="p">(</span><span class="n">source_types</span><span class="p">,</span> <span class="n">source_type</span><span class="p">),</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                    <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="ow">not</span> <span class="n">model_average</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">only_sum</span><span class="p">:</span>
                <span class="c1"># individual traces</span>
                <span class="n">plot_individual_traces</span><span class="p">(</span>
                    <span class="n">cv_pd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">),</span>
                    <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                    <span class="n">cv_pd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">source_type</span><span class="p">),</span>
                    <span class="n">cv_pd</span><span class="o">.</span><span class="n">zorder</span><span class="p">(</span><span class="n">source_types</span><span class="p">,</span> <span class="n">source_type</span><span class="p">),</span>
                    <span class="n">source_type</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">plot_individual_traces</span><span class="p">(</span>
                    <span class="n">cv_nd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">),</span>
                    <span class="n">cv_nd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                    <span class="n">cv_pd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">source_type</span><span class="p">),</span>
                    <span class="n">cv_pd</span><span class="o">.</span><span class="n">zorder</span><span class="p">(</span><span class="n">source_types</span><span class="p">,</span> <span class="n">source_type</span><span class="p">),</span>
                    <span class="n">source_type</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
                    <span class="n">legend</span><span class="o">=</span><span class="s2">&quot;null direction&quot;</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># quantiles</span>
            <span class="n">plot_quantile</span><span class="p">(</span>
                <span class="n">cv_pd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">),</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">source_type</span><span class="p">),</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">zorder</span><span class="p">(</span><span class="n">source_types</span><span class="p">,</span> <span class="n">source_type</span><span class="p">),</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">plot_quantile</span><span class="p">(</span>
                <span class="n">cv_nd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">),</span>
                <span class="n">cv_nd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">source_type</span><span class="p">),</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">zorder</span><span class="p">(</span><span class="n">source_types</span><span class="p">,</span> <span class="n">source_type</span><span class="p">),</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">sum_exc_inh</span> <span class="ow">or</span> <span class="n">only_sum</span><span class="p">:</span>
            <span class="c1"># plot summed traces</span>
            <span class="n">signs</span> <span class="o">=</span> <span class="n">cv_pd</span><span class="o">.</span><span class="n">signs</span><span class="p">()</span>
            <span class="n">exc_pd</span><span class="p">,</span> <span class="n">inh_pd</span><span class="p">,</span> <span class="n">exc_nd</span><span class="p">,</span> <span class="n">inh_nd</span> <span class="o">=</span> <span class="n">get_summed_traces</span><span class="p">(</span>
                <span class="n">signs</span><span class="p">,</span> <span class="n">source_types</span><span class="p">,</span> <span class="n">cv_pd</span><span class="p">,</span> <span class="n">cv_nd</span>
            <span class="p">)</span>
            <span class="n">plot_summed_trace</span><span class="p">(</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">exc_pd</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;excitatory&quot;</span><span class="p">,</span>
                <span class="p">(</span><span class="mf">0.931</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                <span class="n">zorder</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">plot_quantile</span><span class="p">(</span>
                <span class="n">exc_pd</span><span class="p">,</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="p">(</span><span class="mf">0.931</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">plot_summed_trace</span><span class="p">(</span>
                <span class="n">cv_nd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">exc_nd</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;excitatory&quot;</span><span class="p">,</span>
                <span class="p">(</span><span class="mf">0.931</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                <span class="n">zorder</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">plot_quantile</span><span class="p">(</span>
                <span class="n">exc_nd</span><span class="p">,</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="p">(</span><span class="mf">0.931</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">plot_summed_trace</span><span class="p">(</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">inh_pd</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;inhibitory&quot;</span><span class="p">,</span>
                <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.849</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                <span class="n">zorder</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">plot_quantile</span><span class="p">(</span>
                <span class="n">inh_pd</span><span class="p">,</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.849</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">plot_summed_trace</span><span class="p">(</span>
                <span class="n">cv_nd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">inh_nd</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;inhibitory&quot;</span><span class="p">,</span>
                <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.849</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                <span class="n">zorder</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">plot_quantile</span><span class="p">(</span>
                <span class="n">inh_nd</span><span class="p">,</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.849</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">hline</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
                <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;time (s)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="c1">#         ax.set_ylabel(&quot;current (a.u.)&quot;, fontsize=fontsize)</span>

        <span class="k">if</span> <span class="n">hide_yaxis</span><span class="p">:</span>
            <span class="n">plt_utils</span><span class="o">.</span><span class="n">rm_spines</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,))</span>

        <span class="k">if</span> <span class="n">trim_axes</span><span class="p">:</span>
            <span class="n">plt_utils</span><span class="o">.</span><span class="n">trim_axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">legend_standalone</span><span class="p">:</span>
            <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
            <span class="n">nd_handle</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">(</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;null direction&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span>
            <span class="p">)</span>
            <span class="n">legend_n_rows</span> <span class="o">=</span> <span class="n">legend_n_rows</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="c1"># legend_n_cols = (len(labels) + 1) // legend_n_rows</span>
            <span class="n">legend_fig</span><span class="p">,</span> <span class="n">legend_ax</span> <span class="o">=</span> <span class="n">plt_utils</span><span class="o">.</span><span class="n">standalone_legend</span><span class="p">(</span>
                <span class="p">[</span><span class="o">*</span><span class="n">labels</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;null direction&quot;</span><span class="p">],</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="p">[</span><span class="o">*</span><span class="n">handles</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span> <span class="n">nd_handle</span><span class="p">],</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="n">n_cols</span><span class="o">=</span><span class="n">legend_n_cols</span><span class="p">,</span>
                <span class="n">handlelength</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">columnspacing</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                <span class="n">figsize</span><span class="o">=</span><span class="n">cm_to_inch</span><span class="p">(</span><span class="n">legend_figsize_cm</span><span class="p">),</span>
                <span class="n">fig</span><span class="o">=</span><span class="n">fig</span> <span class="k">if</span> <span class="n">legend_ax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">legend_ax</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">legend_fig</span><span class="p">,</span> <span class="n">legend_ax</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">plot_temporal_contributions_pc_nc</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">contrast</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">t_start</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">t_end</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span>
        <span class="n">legend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">legend_standalone</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">legend_figsize_cm</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">4.0572</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">legend_n_rows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_figure_height_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.3941</span><span class="p">,</span>
        <span class="n">panel_height_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.3941</span><span class="p">,</span>
        <span class="n">max_figure_width_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0572</span><span class="p">,</span>
        <span class="n">panel_width_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0572</span><span class="p">,</span>
        <span class="n">model_average</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">highlight_mean</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">sum_exc_inh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">only_sum</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">hide_source_types</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="n">hide_source_types_bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">hide_source_types_cut_off_edge</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">hide_source_types_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;below_cut_off&quot;</span><span class="p">,</span>
        <span class="n">hide_yaxis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">trim_axes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">quantile</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fig</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">legend_ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">null_linestyle</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;dotted&quot;</span><span class="p">,</span>
        <span class="n">legend_n_cols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Temporal contributions of different source types for positive/negative contrasts.</span>

<span class="sd">        Args:</span>
<span class="sd">            contrast: The contrast of the stimulus.</span>
<span class="sd">            angle: The angle of the stimulus.</span>
<span class="sd">            t_start: Start time for the plot.</span>
<span class="sd">            t_end: End time for the plot.</span>
<span class="sd">            fontsize: Font size for labels and titles.</span>
<span class="sd">            linewidth: Line width for traces.</span>
<span class="sd">            legend: Whether to show the legend.</span>
<span class="sd">            legend_standalone: Whether to create a standalone legend.</span>
<span class="sd">            legend_figsize_cm: Figure size for the standalone legend.</span>
<span class="sd">            legend_n_rows: Number of rows for the standalone legend.</span>
<span class="sd">            max_figure_height_cm: Maximum figure height in centimeters.</span>
<span class="sd">            panel_height_cm: Height of each panel in centimeters.</span>
<span class="sd">            max_figure_width_cm: Maximum figure width in centimeters.</span>
<span class="sd">            panel_width_cm: Width of each panel in centimeters.</span>
<span class="sd">            model_average: Whether to plot the model average.</span>
<span class="sd">            highlight_mean: Whether to highlight the mean trace.</span>
<span class="sd">            sum_exc_inh: Whether to sum excitatory and inhibitory contributions.</span>
<span class="sd">            only_sum: Whether to only plot the summed contributions.</span>
<span class="sd">            hide_source_types: Source types to hide or &quot;auto&quot;.</span>
<span class="sd">            hide_source_types_bins: Number of bins for auto-hiding.</span>
<span class="sd">            hide_source_types_cut_off_edge: Cut-off edge for auto-hiding.</span>
<span class="sd">            hide_source_types_mode: Mode for auto-hiding source types.</span>
<span class="sd">            hide_yaxis: Whether to hide the y-axis.</span>
<span class="sd">            trim_axes: Whether to trim the axes.</span>
<span class="sd">            quantile: Quantile for shading.</span>
<span class="sd">            fig: Existing figure to use.</span>
<span class="sd">            ax: Existing axes to use.</span>
<span class="sd">            legend_ax: Existing axes for the standalone legend.</span>
<span class="sd">            null_linestyle: Linestyle for null direction traces.</span>
<span class="sd">            legend_n_cols: Number of columns for the standalone legend.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Figure, axes, and legend axes objects.</span>

<span class="sd">        Example:</span>
<span class="sd">            ```</span>
<span class="sd">            view = MovingEdgeCurrentView(...)</span>
<span class="sd">            fig, ax = view.plot_temporal_contributions_pc_nc(</span>
<span class="sd">                contrast=1.0,</span>
<span class="sd">                angle=0,</span>
<span class="sd">                t_start=0,</span>
<span class="sd">                t_end=1,</span>
<span class="sd">                fontsize=5,</span>
<span class="sd">                linewidth=0.25,</span>
<span class="sd">                legend=True</span>
<span class="sd">            )</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize_from_n_items</span><span class="p">(</span>
                <span class="mi">1</span><span class="p">,</span>
                <span class="n">max_figure_height_cm</span><span class="o">=</span><span class="n">max_figure_height_cm</span><span class="p">,</span>
                <span class="n">panel_height_cm</span><span class="o">=</span><span class="n">panel_height_cm</span><span class="p">,</span>
                <span class="n">max_figure_width_cm</span><span class="o">=</span><span class="n">max_figure_width_cm</span><span class="p">,</span>
                <span class="n">panel_width_cm</span><span class="o">=</span><span class="n">panel_width_cm</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">figsize</span><span class="o">.</span><span class="n">axis_grid</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cv_pd</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
            <span class="o">.</span><span class="n">at_angle</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
            <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
            <span class="o">.</span><span class="n">sum_over_cells</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">cv_nd</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
            <span class="o">.</span><span class="n">at_angle</span><span class="p">((</span><span class="n">angle</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>
            <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
            <span class="o">.</span><span class="n">sum_over_cells</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="n">source_types</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
            <span class="o">.</span><span class="n">at_angle</span><span class="p">([</span><span class="n">angle</span><span class="p">,</span> <span class="p">(</span><span class="n">angle</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">])</span>
            <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
            <span class="o">.</span><span class="n">filter_source_types</span><span class="p">(</span>
                <span class="n">hide_source_types</span><span class="p">,</span>
                <span class="n">hide_source_types_bins</span><span class="p">,</span>
                <span class="n">hide_source_types_cut_off_edge</span><span class="p">,</span>
                <span class="n">hide_source_types_mode</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">color_source_types</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
            <span class="o">.</span><span class="n">at_angle</span><span class="p">([</span><span class="n">angle</span><span class="p">,</span> <span class="p">(</span><span class="n">angle</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">])</span>
            <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
            <span class="o">.</span><span class="n">filter_source_types</span><span class="p">(</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="n">hide_source_types_bins</span><span class="p">,</span>
                <span class="n">hide_source_types_cut_off_edge</span><span class="p">,</span>
                <span class="n">hide_source_types_mode</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">cv_pd</span><span class="o">.</span><span class="n">init_colors</span><span class="p">(</span><span class="n">color_source_types</span><span class="p">)</span>
        <span class="n">cv_nd</span><span class="o">.</span><span class="n">init_colors</span><span class="p">(</span><span class="n">color_source_types</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">plot_mean_trace</span><span class="p">(</span>
            <span class="n">time</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">zorder</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">time</span><span class="p">,</span>
                <span class="n">trace</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">def</span> <span class="nf">plot_individual_traces</span><span class="p">(</span>
            <span class="n">traces</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">zorder</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">only_sum</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">model_average</span><span class="p">:</span>
                <span class="n">plots</span><span class="o">.</span><span class="n">traces</span><span class="p">(</span>
                    <span class="n">traces</span><span class="p">,</span>
                    <span class="n">time</span><span class="p">,</span>
                    <span class="n">mean_color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span>
                    <span class="n">zorder_traces</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">zorder_mean</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                    <span class="n">null_line</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">highlight_mean</span><span class="o">=</span><span class="n">highlight_mean</span><span class="p">,</span>
                    <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                    <span class="n">legend</span><span class="o">=</span><span class="n">legend</span> <span class="ow">or</span> <span class="n">label</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">def</span> <span class="nf">plot_quantile</span><span class="p">(</span><span class="n">traces</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">zorder</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">quantile</span><span class="p">:</span>
                <span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">traces</span><span class="p">,</span> <span class="n">quantile</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
                    <span class="n">time</span><span class="p">,</span>
                    <span class="n">Q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">Q</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">facecolor</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
                    <span class="n">edgecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">def</span> <span class="nf">plot_summed_trace</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">zorder</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">trace</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">time</span><span class="p">,</span>
                    <span class="n">trace</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">def</span> <span class="nf">get_summed_traces</span><span class="p">(</span><span class="n">signs</span><span class="p">,</span> <span class="n">source_types</span><span class="p">,</span> <span class="n">cv_pd</span><span class="p">,</span> <span class="n">cv_nd</span><span class="p">):</span>
            <span class="c1"># sum over cell types then average over models</span>
            <span class="n">exc_pd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">cv_pd</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">inh_pd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">cv_pd</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">exc_nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">cv_nd</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">inh_nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">cv_nd</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="c1"># sum over cell types</span>
            <span class="k">for</span> <span class="n">source_type</span> <span class="ow">in</span> <span class="n">source_types</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">signs</span><span class="p">[</span><span class="n">source_type</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">exc_pd</span> <span class="o">+=</span> <span class="n">cv_pd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span>  <span class="c1"># (1, n_models, 1, n_timesteps)</span>
                    <span class="n">exc_nd</span> <span class="o">+=</span> <span class="n">cv_nd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">inh_pd</span> <span class="o">+=</span> <span class="n">cv_pd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span>
                    <span class="n">inh_nd</span> <span class="o">+=</span> <span class="n">cv_nd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span>
            <span class="c1"># (n_models, n_timesteps)</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">exc_pd</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span>
                <span class="n">inh_pd</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span>
                <span class="n">exc_nd</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span>
                <span class="n">inh_nd</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">source_type</span> <span class="ow">in</span> <span class="n">source_types</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">model_average</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">only_sum</span><span class="p">:</span>
                <span class="c1"># mean traces solid for PD and dashed for ND</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">cv_pd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">source_type</span><span class="p">)</span>

                <span class="n">plot_mean_trace</span><span class="p">(</span>
                    <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                    <span class="n">cv_pd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                    <span class="n">source_type</span><span class="p">,</span>
                    <span class="n">color</span><span class="p">,</span>
                    <span class="n">cv_pd</span><span class="o">.</span><span class="n">zorder</span><span class="p">(</span><span class="n">source_types</span><span class="p">,</span> <span class="n">source_type</span><span class="p">),</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                    <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">plot_mean_trace</span><span class="p">(</span>
                    <span class="n">cv_nd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                    <span class="n">cv_nd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                    <span class="n">source_type</span><span class="p">,</span>
                    <span class="n">color</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="n">null_linestyle</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="n">cv_pd</span><span class="o">.</span><span class="n">zorder</span><span class="p">(</span><span class="n">source_types</span><span class="p">,</span> <span class="n">source_type</span><span class="p">),</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                    <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="ow">not</span> <span class="n">model_average</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">only_sum</span><span class="p">:</span>
                <span class="c1"># individual traces</span>
                <span class="n">plot_individual_traces</span><span class="p">(</span>
                    <span class="n">cv_pd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">),</span>
                    <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                    <span class="n">cv_pd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">source_type</span><span class="p">),</span>
                    <span class="n">cv_pd</span><span class="o">.</span><span class="n">zorder</span><span class="p">(</span><span class="n">source_types</span><span class="p">,</span> <span class="n">source_type</span><span class="p">),</span>
                    <span class="n">source_type</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">plot_individual_traces</span><span class="p">(</span>
                    <span class="n">cv_nd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">),</span>
                    <span class="n">cv_nd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                    <span class="n">cv_pd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">source_type</span><span class="p">),</span>
                    <span class="n">cv_pd</span><span class="o">.</span><span class="n">zorder</span><span class="p">(</span><span class="n">source_types</span><span class="p">,</span> <span class="n">source_type</span><span class="p">),</span>
                    <span class="n">source_type</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="n">null_linestyle</span><span class="p">,</span>
                    <span class="n">legend</span><span class="o">=</span><span class="s2">&quot;null direction&quot;</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># quantiles</span>
            <span class="n">plot_quantile</span><span class="p">(</span>
                <span class="n">cv_pd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">),</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">source_type</span><span class="p">),</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">zorder</span><span class="p">(</span><span class="n">source_types</span><span class="p">,</span> <span class="n">source_type</span><span class="p">),</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">plot_quantile</span><span class="p">(</span>
                <span class="n">cv_nd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">),</span>
                <span class="n">cv_nd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">source_type</span><span class="p">),</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">zorder</span><span class="p">(</span><span class="n">source_types</span><span class="p">,</span> <span class="n">source_type</span><span class="p">),</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="n">null_linestyle</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">sum_exc_inh</span> <span class="ow">or</span> <span class="n">only_sum</span><span class="p">:</span>
            <span class="c1"># plot summed traces</span>
            <span class="n">signs</span> <span class="o">=</span> <span class="n">cv_pd</span><span class="o">.</span><span class="n">signs</span><span class="p">()</span>
            <span class="n">exc_pd</span><span class="p">,</span> <span class="n">inh_pd</span><span class="p">,</span> <span class="n">exc_nd</span><span class="p">,</span> <span class="n">inh_nd</span> <span class="o">=</span> <span class="n">get_summed_traces</span><span class="p">(</span>
                <span class="n">signs</span><span class="p">,</span> <span class="n">source_types</span><span class="p">,</span> <span class="n">cv_pd</span><span class="p">,</span> <span class="n">cv_nd</span>
            <span class="p">)</span>
            <span class="n">plot_summed_trace</span><span class="p">(</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">exc_pd</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;excitatory&quot;</span><span class="p">,</span>
                <span class="p">(</span><span class="mf">0.931</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                <span class="n">zorder</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">plot_quantile</span><span class="p">(</span>
                <span class="n">exc_pd</span><span class="p">,</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="p">(</span><span class="mf">0.931</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">plot_summed_trace</span><span class="p">(</span>
                <span class="n">cv_nd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">exc_nd</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;excitatory&quot;</span><span class="p">,</span>
                <span class="p">(</span><span class="mf">0.931</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                <span class="n">zorder</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="n">null_linestyle</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">plot_quantile</span><span class="p">(</span>
                <span class="n">exc_nd</span><span class="p">,</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="p">(</span><span class="mf">0.931</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="n">null_linestyle</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">plot_summed_trace</span><span class="p">(</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">inh_pd</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;inhibitory&quot;</span><span class="p">,</span>
                <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.849</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                <span class="n">zorder</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">plot_quantile</span><span class="p">(</span>
                <span class="n">inh_pd</span><span class="p">,</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.849</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">plot_summed_trace</span><span class="p">(</span>
                <span class="n">cv_nd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">inh_nd</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;inhibitory&quot;</span><span class="p">,</span>
                <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.849</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                <span class="n">zorder</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="n">null_linestyle</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">plot_quantile</span><span class="p">(</span>
                <span class="n">inh_nd</span><span class="p">,</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.849</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="n">null_linestyle</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
                <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;time (s)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="c1">#         ax.set_ylabel(&quot;current (a.u.)&quot;, fontsize=fontsize)</span>

        <span class="k">if</span> <span class="n">hide_yaxis</span><span class="p">:</span>
            <span class="n">plt_utils</span><span class="o">.</span><span class="n">rm_spines</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,))</span>

        <span class="k">if</span> <span class="n">trim_axes</span><span class="p">:</span>
            <span class="n">plt_utils</span><span class="o">.</span><span class="n">trim_axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">legend_standalone</span><span class="p">:</span>
            <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
            <span class="n">nd_handle</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">(</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;null direction&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">null_linestyle</span>
            <span class="p">)</span>
            <span class="n">legend_n_rows</span> <span class="o">=</span> <span class="n">legend_n_rows</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="c1"># legend_n_cols = (len(labels) + 1) // legend_n_rows</span>
            <span class="n">legend_fig</span><span class="p">,</span> <span class="n">legend_ax</span> <span class="o">=</span> <span class="n">plt_utils</span><span class="o">.</span><span class="n">standalone_legend</span><span class="p">(</span>
                <span class="p">[</span><span class="o">*</span><span class="n">labels</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;null direction&quot;</span><span class="p">],</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="p">[</span><span class="o">*</span><span class="n">handles</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span> <span class="n">nd_handle</span><span class="p">],</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="n">n_cols</span><span class="o">=</span><span class="n">legend_n_cols</span><span class="p">,</span>
                <span class="n">handlelength</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">columnspacing</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                <span class="n">figsize</span><span class="o">=</span><span class="n">cm_to_inch</span><span class="p">(</span><span class="n">legend_figsize_cm</span><span class="p">),</span>
                <span class="n">fig</span><span class="o">=</span><span class="n">fig</span> <span class="k">if</span> <span class="n">legend_ax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">legend_ax</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">legend_fig</span><span class="p">,</span> <span class="n">legend_ax</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">get_temporal_contributions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">contrast</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">t_start</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">t_end</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">hide_source_types</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="n">hide_source_types_bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">hide_source_types_cut_off_edge</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">hide_source_types_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;below_cut_off&quot;</span><span class="p">,</span>
        <span class="n">summed_traces</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span>
        <span class="s2">&quot;MovingEdgeCurrentView&quot;</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="s2">&quot;MovingEdgeCurrentView&quot;</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="p">]:</span>
        <span class="n">cv_pd</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
            <span class="o">.</span><span class="n">at_angle</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
            <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
            <span class="o">.</span><span class="n">sum_over_cells</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">cv_nd</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
            <span class="o">.</span><span class="n">at_angle</span><span class="p">((</span><span class="n">angle</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>
            <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
            <span class="o">.</span><span class="n">sum_over_cells</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="n">source_types</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
            <span class="o">.</span><span class="n">at_angle</span><span class="p">([</span><span class="n">angle</span><span class="p">,</span> <span class="p">(</span><span class="n">angle</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">])</span>
            <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
            <span class="o">.</span><span class="n">filter_source_types</span><span class="p">(</span>
                <span class="n">hide_source_types</span><span class="p">,</span>
                <span class="n">hide_source_types_bins</span><span class="p">,</span>
                <span class="n">hide_source_types_cut_off_edge</span><span class="p">,</span>
                <span class="n">hide_source_types_mode</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">color_source_types</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
            <span class="o">.</span><span class="n">at_angle</span><span class="p">([</span><span class="n">angle</span><span class="p">,</span> <span class="p">(</span><span class="n">angle</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">])</span>
            <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
            <span class="o">.</span><span class="n">filter_source_types</span><span class="p">(</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="n">hide_source_types_bins</span><span class="p">,</span>
                <span class="n">hide_source_types_cut_off_edge</span><span class="p">,</span>
                <span class="n">hide_source_types_mode</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">cv_pd</span><span class="o">.</span><span class="n">init_colors</span><span class="p">(</span><span class="n">color_source_types</span><span class="p">)</span>
        <span class="n">cv_nd</span><span class="o">.</span><span class="n">init_colors</span><span class="p">(</span><span class="n">color_source_types</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">get_summed_traces</span><span class="p">(</span><span class="n">signs</span><span class="p">,</span> <span class="n">source_types</span><span class="p">,</span> <span class="n">cv_pd</span><span class="p">,</span> <span class="n">cv_nd</span><span class="p">):</span>
            <span class="c1"># sum over cell types then average over models</span>
            <span class="n">exc_pd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">cv_pd</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">inh_pd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">cv_pd</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">exc_nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">cv_nd</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">inh_nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">cv_nd</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="c1"># sum over cell types</span>
            <span class="k">for</span> <span class="n">source_type</span> <span class="ow">in</span> <span class="n">source_types</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">signs</span><span class="p">[</span><span class="n">source_type</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">exc_pd</span> <span class="o">+=</span> <span class="n">cv_pd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span>  <span class="c1"># (1, n_models, 1, n_timesteps)</span>
                    <span class="n">exc_nd</span> <span class="o">+=</span> <span class="n">cv_nd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">inh_pd</span> <span class="o">+=</span> <span class="n">cv_pd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span>
                    <span class="n">inh_nd</span> <span class="o">+=</span> <span class="n">cv_nd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span>
            <span class="c1"># (n_models, n_timesteps)</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">exc_pd</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span>
                <span class="n">inh_pd</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span>
                <span class="n">exc_nd</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span>
                <span class="n">inh_nd</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">summed_traces</span><span class="p">:</span>
            <span class="n">exc_pd</span><span class="p">,</span> <span class="n">inh_pd</span><span class="p">,</span> <span class="n">exc_nd</span><span class="p">,</span> <span class="n">inh_nd</span> <span class="o">=</span> <span class="n">get_summed_traces</span><span class="p">(</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">signs</span><span class="p">(),</span> <span class="n">source_types</span><span class="p">,</span> <span class="n">cv_pd</span><span class="p">,</span> <span class="n">cv_nd</span>
            <span class="p">)</span>
            <span class="c1"># return exc_pd, inh_pd, exc_nd, inh_nd, source_types, color_source_types</span>
            <span class="k">return</span> <span class="n">exc_pd</span><span class="p">,</span> <span class="n">inh_pd</span><span class="p">,</span> <span class="n">exc_nd</span><span class="p">,</span> <span class="n">inh_nd</span>

        <span class="k">return</span> <span class="n">cv_pd</span><span class="p">,</span> <span class="n">cv_nd</span><span class="p">,</span> <span class="n">source_types</span><span class="p">,</span> <span class="n">color_source_types</span>

    <span class="k">def</span> <span class="nf">get_response</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">contrast</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">t_start</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">t_end</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">model_average</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
        <span class="n">r_pd</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">at_angle</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
            <span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
            <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
            <span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">r_nd</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">at_angle</span><span class="p">((</span><span class="n">angle</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>
            <span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
            <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
            <span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">model_average</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">r_pd</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                <span class="n">r_nd</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">r_pd</span><span class="p">,</span> <span class="n">r_nd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span><span class="o">.</span><span class="n">time</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.on" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">on</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.on" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="n">on</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return a view of the ON responses.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.off" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">off</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.off" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="n">off</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return a view of the OFF responses.</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.init_currents" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">init_currents</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.init_currents" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">init_currents</span><span class="p">(</span><span class="n">currents</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize the currents for each source type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>currents</code></td>
            <td>
                  <code><span title="datamate.Namespace">Namespace</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Currents for each source type.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">init_currents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currents</span><span class="p">:</span> <span class="n">Namespace</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the currents for each source type.</span>

<span class="sd">    Args:</span>
<span class="sd">        currents: Currents for each source type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">currents</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currents</span> <span class="o">=</span> <span class="n">currents</span>
        <span class="k">return</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">currents</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">source_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfs</span><span class="o">.</span><span class="n">source_types</span><span class="p">:</span>
        <span class="c1"># (on/off, n_models, n_angles, n_timesteps, n_input_cells)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="p">[</span><span class="n">source_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">target_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_type</span><span class="p">]</span><span class="o">.</span><span class="n">source_data</span><span class="p">[</span><span class="n">source_type</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp_data</span>
            <span class="p">],</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.init_responses" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">init_responses</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.init_responses" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">init_responses</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize the responses of the target cells.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>responses</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Responses of the target cells.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">init_responses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">responses</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the responses of the target cells.</span>

<span class="sd">    Args:</span>
<span class="sd">        responses: Responses of the target cells.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">responses</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">responses</span> <span class="o">=</span> <span class="n">responses</span>
        <span class="k">return</span>
    <span class="c1"># (on/off, n_models, n_angles, n_timesteps)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">responses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">target_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_type</span><span class="p">]</span><span class="o">.</span><span class="n">activity_central</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp_data</span>
        <span class="p">],</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.init_time" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">init_time</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.init_time" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">init_time</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize the time array for the simulation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>time</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time array for the simulation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">init_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the time array for the simulation.</span>

<span class="sd">    Args:</span>
<span class="sd">        time: Time array for the simulation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time</span>
        <span class="k">return</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dt</span>
        <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">t_pre</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.divide_by_given_norm" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">divide_by_given_norm</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.divide_by_given_norm" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">divide_by_given_norm</span><span class="p">(</span><span class="n">norm</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Divide currents and responses by a given norm.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>norm</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="flyvision.utils.nodes_edges_utils.CellTypeArray" href="../utils/#flyvision.utils.nodes_edges_utils.CellTypeArray">CellTypeArray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The norm to divide by.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>&#39;MovingEdgeCurrentView&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new view with normalized currents and responses.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If norm is not a CellTypeArray.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">divide_by_given_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">norm</span><span class="p">:</span> <span class="n">CellTypeArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MovingEdgeCurrentView&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Divide currents and responses by a given norm.</span>

<span class="sd">    Args:</span>
<span class="sd">        norm: The norm to divide by.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A new view with normalized currents and responses.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If norm is not a CellTypeArray.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">norm</span><span class="p">,</span> <span class="n">CellTypeArray</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span>

    <span class="n">response_dims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
    <span class="n">response_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
        <span class="n">norm</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_type</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">response_dims</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="mi">0</span><span class="p">]))</span>
    <span class="p">)</span>

    <span class="c1"># divide the responses by the norm</span>
    <span class="n">new_responses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="p">[:]</span> <span class="o">/</span> <span class="n">response_norm</span>

    <span class="c1"># note: we also divide by the norm of the target cell type</span>

    <span class="n">currents_dims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

    <span class="n">currents_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
        <span class="n">norm</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_type</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">currents_dims</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="mi">0</span><span class="p">]))</span>
    <span class="p">)</span>

    <span class="c1"># divide the currents by the norm</span>
    <span class="n">new_currents</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">({</span>
        <span class="n">cell_type</span><span class="p">:</span> <span class="n">c</span> <span class="o">/</span> <span class="n">currents_norm</span> <span class="k">for</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">})</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">currents</span><span class="o">=</span><span class="n">new_currents</span><span class="p">,</span> <span class="n">responses</span><span class="o">=</span><span class="n">new_responses</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.at_contrast" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">at_contrast</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.at_contrast" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a new view filtered by contrast.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>contrast</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The contrast value to filter by.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>&#39;MovingEdgeCurrentView&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new view with data filtered by the specified contrast.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">at_contrast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contrast</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MovingEdgeCurrentView&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new view filtered by contrast.</span>

<span class="sd">    Args:</span>
<span class="sd">        contrast: The contrast value to filter by.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A new view with data filtered by the specified contrast.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">contrast_index</span> <span class="o">=</span> <span class="n">get_stimulus_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg_df</span><span class="p">,</span> <span class="n">intensity</span><span class="o">=</span><span class="n">contrast</span><span class="p">)</span>
    <span class="n">arg_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">contrast_index</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span>
        <span class="n">Namespace</span><span class="p">({</span>
            <span class="n">cell_type</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">contrast_index</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}),</span>
        <span class="n">responses</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">contrast_index</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
        <span class="n">arg_df</span><span class="o">=</span><span class="n">arg_df</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.at_angle" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">at_angle</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.at_angle" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">at_angle</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a new view filtered by angle.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>angle</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The angle value to filter by.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>&#39;MovingEdgeCurrentView&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new view with data filtered by the specified angle.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">at_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MovingEdgeCurrentView&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new view filtered by angle.</span>

<span class="sd">    Args:</span>
<span class="sd">        angle: The angle value to filter by.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A new view with data filtered by the specified angle.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">angle_index</span> <span class="o">=</span> <span class="n">get_stimulus_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg_df</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">angle</span><span class="p">)</span>
    <span class="n">arg_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">angle_index</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span>
        <span class="n">Namespace</span><span class="p">({</span>
            <span class="n">cell_type</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">angle_index</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}),</span>
        <span class="n">responses</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">angle_index</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
        <span class="n">arg_df</span><span class="o">=</span><span class="n">arg_df</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.at_position" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">at_position</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.at_position" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">at_position</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">central</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a new view filtered by position.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>u</code></td>
            <td>
                  <code>float | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The u-coordinate.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>v</code></td>
            <td>
                  <code>float | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The v-coordinate.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>central</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use central position.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>&#39;MovingEdgeCurrentView&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new view with data filtered by the specified position.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">at_position</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">central</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MovingEdgeCurrentView&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new view filtered by position.</span>

<span class="sd">    Args:</span>
<span class="sd">        u: The u-coordinate.</span>
<span class="sd">        v: The v-coordinate.</span>
<span class="sd">        central: Whether to use central position.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A new view with data filtered by the specified position.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rfs</span> <span class="o">=</span> <span class="n">at_position</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfs</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">central</span><span class="p">)</span>
    <span class="n">currents</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">({</span>
        <span class="n">cell_type</span><span class="p">:</span> <span class="n">c</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">rfs</span><span class="p">[</span><span class="n">cell_type</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">})</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">currents</span><span class="p">,</span> <span class="n">rfs</span><span class="o">=</span><span class="n">rfs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.between_seconds" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">between_seconds</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.between_seconds" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a new view filtered by time range.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>t_start</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start time in seconds.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>t_end</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End time in seconds.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>&#39;MovingEdgeCurrentView&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new view with data filtered by the specified time range.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">between_seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t_start</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">t_end</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MovingEdgeCurrentView&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new view filtered by time range.</span>

<span class="sd">    Args:</span>
<span class="sd">        t_start: Start time in seconds.</span>
<span class="sd">        t_end: End time in seconds.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A new view with data filtered by the specified time range.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">slice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;=</span> <span class="n">t_start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&lt;</span> <span class="n">t_end</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">newview</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[:,</span> <span class="p">:,</span> <span class="nb">slice</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">newview</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="nb">slice</span><span class="p">]</span>
    <span class="n">newview</span><span class="o">.</span><span class="n">responses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="p">[:,</span> <span class="p">:,</span> <span class="nb">slice</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">newview</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.model_selection" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">model_selection</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.model_selection" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">model_selection</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a new view with selected models.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>mask</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Boolean mask for model selection.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>&#39;MovingEdgeCurrentView&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new view with selected models.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">model_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MovingEdgeCurrentView&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new view with selected models.</span>

<span class="sd">    Args:</span>
<span class="sd">        mask: Boolean mask for model selection.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A new view with selected models.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.sorting" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">sorting</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.sorting" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">sorting</span><span class="p">(</span><span class="n">average_over_models</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Sort cell types based on their contributions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>average_over_models</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to average over models.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>mode</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sorting mode (&ldquo;all&rdquo;, &ldquo;excitatory&rdquo;, or &ldquo;inhibitory&rdquo;).</p>
              </div>
            </td>
            <td>
                  <code>&#39;all&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sorted array of cell types.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If an invalid mode is provided.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sorting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">average_over_models</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sort cell types based on their contributions.</span>

<span class="sd">    Args:</span>
<span class="sd">        average_over_models: Whether to average over models.</span>
<span class="sd">        mode: Sorting mode (&quot;all&quot;, &quot;excitatory&quot;, or &quot;inhibitory&quot;).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Sorted array of cell types.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If an invalid mode is provided.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">summed</span> <span class="o">=</span> <span class="bp">self</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_over_cells</span><span class="p">()</span>
    <span class="n">signs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signs</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">average_over_models</span><span class="p">:</span>
        <span class="n">absmax</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="o">*</span> <span class="n">signs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">valmap</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="n">summed</span><span class="p">[:],</span>
            <span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># summing over on/off, angles and time to sort -- results in n_models sortings</span>
        <span class="n">absmax</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="o">*</span> <span class="n">signs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">valmap</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="n">summed</span><span class="p">[:]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="n">cell_types</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">absmax</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">absmax</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="n">sorting</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="c1">#         if average_over_models:</span>
    <span class="c1">#             # add extra dimension here for the next operation</span>
    <span class="c1">#             sorting = sorting[None]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sorted_cell_types</span> <span class="o">=</span> <span class="n">cell_types</span><span class="p">[</span><span class="n">sorting</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="c1"># return all excitatory and inhibitory from most excitatory to most inhibitory</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorted_cell_types</span>
    <span class="c1"># from most excitatory to least excitatory</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;excitatory&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">average_over_models</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="n">cell_type</span>
            <span class="k">for</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorted_cell_types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">signs</span><span class="p">[</span><span class="n">cell_type</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="p">])</span>
    <span class="c1"># from most inhibitory to least inhibitory</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;inhibitory&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">average_over_models</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="n">cell_type</span>
            <span class="k">for</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorted_cell_types</span><span class="p">[</span><span class="mi">0</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">signs</span><span class="p">[</span><span class="n">cell_type</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
        <span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mode </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.filter_cell_types_by_contribution" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">filter_cell_types_by_contribution</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.filter_cell_types_by_contribution" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">filter_cell_types_by_contribution</span><span class="p">(</span>
    <span class="n">bins</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">cut_off_edge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;above_cut_off&quot;</span><span class="p">,</span>
    <span class="n">statistic</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Filter cell types based on their contribution.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>bins</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of bins for contribution levels.</p>
              </div>
            </td>
            <td>
                  <code>3</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cut_off_edge</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Edge index for cut-off.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>mode</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filtering mode (&ldquo;above_cut_off&rdquo; or &ldquo;below_cut_off&rdquo;).</p>
              </div>
            </td>
            <td>
                  <code>&#39;above_cut_off&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>statistic</code></td>
            <td>
                  <code><span title="typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function to compute the statistic.</p>
              </div>
            </td>
            <td>
                  <code><span title="numpy.max">max</span></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filtered array of cell types.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If an invalid mode is provided.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="info" open>
  <summary>Info</summary>
  <p>In principle, chunks the y-axis of the current plots into excitatory and
inhibitory parts and each of the parts into bins. All cell types with currents
above or below, depending on the mode, the specified bin edge are discarded.</p>
</details>
            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter_cell_types_by_contribution</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">cut_off_edge</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;above_cut_off&quot;</span><span class="p">,</span>
    <span class="n">statistic</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter cell types based on their contribution.</span>

<span class="sd">    Args:</span>
<span class="sd">        bins: Number of bins for contribution levels.</span>
<span class="sd">        cut_off_edge: Edge index for cut-off.</span>
<span class="sd">        mode: Filtering mode (&quot;above_cut_off&quot; or &quot;below_cut_off&quot;).</span>
<span class="sd">        statistic: Function to compute the statistic.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Filtered array of cell types.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If an invalid mode is provided.</span>

<span class="sd">    Info:</span>
<span class="sd">        In principle, chunks the y-axis of the current plots into excitatory and</span>
<span class="sd">        inhibitory parts and each of the parts into bins. All cell types with currents</span>
<span class="sd">        above or below, depending on the mode, the specified bin edge are discarded.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sorting</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorting</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">signs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signs</span><span class="p">()</span>
    <span class="n">currents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_over_cells</span><span class="p">()</span><span class="o">.</span><span class="n">currents</span>

    <span class="n">filtered_cell_types</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">sign</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="c1"># compute the std over all inputs</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">cell_type</span><span class="p">:</span> <span class="n">statistic</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">currents</span><span class="p">[</span><span class="n">cell_type</span><span class="p">][:]))</span>
            <span class="k">for</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="n">sorting</span>
            <span class="k">if</span> <span class="n">signs</span><span class="p">[</span><span class="n">cell_type</span><span class="p">]</span> <span class="o">==</span> <span class="n">sign</span>
        <span class="p">}</span>
        <span class="c1"># bin into three bins</span>
        <span class="c1"># ala (low contribution, medium contribution, high contribution)</span>
        <span class="n">counts</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
        <span class="n">cut_off_value</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="n">cut_off_edge</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;above_cut_off&quot;</span><span class="p">:</span>
            <span class="n">filtered_cell_types</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="n">valfilter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">,</span> <span class="n">cut_off</span><span class="o">=</span><span class="n">cut_off_value</span><span class="p">:</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="n">cut_off</span><span class="p">,</span> <span class="n">values</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;below_cut_off&quot;</span><span class="p">:</span>
            <span class="n">filtered_cell_types</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="n">valfilter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">,</span> <span class="n">cut_off</span><span class="o">=</span><span class="n">cut_off_value</span><span class="p">:</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="n">cut_off</span><span class="p">,</span> <span class="n">values</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mode </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">filtered_cell_types</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.filter_source_types" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">filter_source_types</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.filter_source_types" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">filter_source_types</span><span class="p">(</span>
    <span class="n">hide_source_types</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">statistic</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Filter source types based on various criteria.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>hide_source_types</code></td>
            <td>
                  <code>str | list | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source types to hide or &ldquo;auto&rdquo;.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>bins</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of bins for contribution levels.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>edge</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Edge index for cut-off.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>mode</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filtering mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>statistic</code></td>
            <td>
                  <code><span title="typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function to compute the statistic.</p>
              </div>
            </td>
            <td>
                  <code><span title="numpy.max">max</span></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filtered array of source types.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter_source_types</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">hide_source_types</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">bins</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">edge</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">statistic</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter source types based on various criteria.</span>

<span class="sd">    Args:</span>
<span class="sd">        hide_source_types: Source types to hide or &quot;auto&quot;.</span>
<span class="sd">        bins: Number of bins for contribution levels.</span>
<span class="sd">        edge: Edge index for cut-off.</span>
<span class="sd">        mode: Filtering mode.</span>
<span class="sd">        statistic: Function to compute the statistic.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Filtered array of source types.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">source_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorting</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hide_source_types</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">hide_source_types</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
        <span class="n">hide_source_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_cell_types_by_contribution</span><span class="p">(</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">cut_off_edge</span><span class="o">=</span><span class="n">edge</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">statistic</span><span class="o">=</span><span class="n">statistic</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">hide_source_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">source_types</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="n">source_type</span>
            <span class="k">for</span> <span class="n">source_type</span> <span class="ow">in</span> <span class="n">source_types</span>
            <span class="k">if</span> <span class="n">source_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hide_source_types</span>
        <span class="p">])</span>
    <span class="k">return</span> <span class="n">source_types</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.signs" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">signs</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.signs" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">signs</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute the signs of receptive fields for each source type.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>dict[str, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of signs for each source type.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">signs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the signs of receptive fields for each source type.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary of signs for each source type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">ct</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfs</span><span class="p">[</span><span class="n">ct</span><span class="p">]</span><span class="o">.</span><span class="n">sign</span><span class="p">)</span> <span class="k">for</span> <span class="n">ct</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfs</span><span class="o">.</span><span class="n">source_types</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.sum_over_cells" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">sum_over_cells</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.sum_over_cells" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">sum_over_cells</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Sum currents over cells.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>&#39;MovingEdgeCurrentView&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new view with currents summed over cells.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sum_over_cells</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MovingEdgeCurrentView&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sum currents over cells.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A new view with currents summed over cells.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span>
        <span class="n">Namespace</span><span class="p">({</span>
            <span class="n">cell_type</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_spatial_contribution" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">plot_spatial_contribution</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_spatial_contribution" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">plot_spatial_contribution</span><span class="p">(</span>
    <span class="n">source_type</span><span class="p">,</span>
    <span class="n">t_start</span><span class="p">,</span>
    <span class="n">t_end</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;peak&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{source_type}</span><span class="s2"> :→&quot;</span><span class="p">,</span>
    <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">max_extent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Plot the spatial contribution of a source type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>source_type</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The source type to plot.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>t_start</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start time for the plot.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>t_end</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End time for the plot.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>mode</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mode for calculating values (&ldquo;peak&rdquo;, &ldquo;mean&rdquo;, or &ldquo;std&rdquo;).</p>
              </div>
            </td>
            <td>
                  <code>&#39;peak&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>title</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Title format string for the plot.</p>
              </div>
            </td>
            <td>
                  <code>&#39;{source_type} :→&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fig</code></td>
            <td>
                  <code><span title="matplotlib.pyplot.Figure">Figure</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Existing figure to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ax</code></td>
            <td>
                  <code><span title="matplotlib.pyplot.Axes">Axes</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Existing axes to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_extent</code></td>
            <td>
                  <code>float | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum extent of the spatial filter.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>**kwargs</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments for plt_utils.kernel.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="matplotlib.pyplot.Axes">Axes</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Axes object containing the plot.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_spatial_contribution</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">source_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">t_start</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">t_end</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;peak&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{source_type}</span><span class="s2"> :→&quot;</span><span class="p">,</span>
    <span class="n">fig</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_extent</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot the spatial contribution of a source type.</span>

<span class="sd">    Args:</span>
<span class="sd">        source_type: The source type to plot.</span>
<span class="sd">        t_start: Start time for the plot.</span>
<span class="sd">        t_end: End time for the plot.</span>
<span class="sd">        mode: Mode for calculating values (&quot;peak&quot;, &quot;mean&quot;, or &quot;std&quot;).</span>
<span class="sd">        title: Title format string for the plot.</span>
<span class="sd">        fig: Existing figure to use.</span>
<span class="sd">        ax: Existing axes to use.</span>
<span class="sd">        max_extent: Maximum extent of the spatial filter.</span>
<span class="sd">        **kwargs: Additional keyword arguments for plt_utils.kernel.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Axes object containing the plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_view</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;current_view&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>  <span class="c1"># .at_contrast(contrast).at_angle(angle)</span>
    <span class="p">)</span>

    <span class="n">vmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vmin&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span>
            <span class="nb">min</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="nb">min</span><span class="p">(</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">current</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">current_view</span><span class="p">[:]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">*</span> <span class="mi">100</span>
        <span class="p">)</span>
        <span class="o">/</span> <span class="mi">100</span>
    <span class="p">)</span>

    <span class="n">vmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vmax&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span>
            <span class="nb">max</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="nb">max</span><span class="p">(</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">current</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">current_view</span><span class="p">[:]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">*</span> <span class="mi">100</span>
        <span class="p">)</span>
        <span class="o">/</span> <span class="mi">100</span>
    <span class="p">)</span>

    <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">current_view</span><span class="o">.</span><span class="n">rfs</span><span class="p">[</span><span class="n">source_type</span><span class="p">][[</span><span class="s2">&quot;source_u&quot;</span><span class="p">,</span> <span class="s2">&quot;source_v&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
    <span class="c1"># average over models</span>
    <span class="c1"># (1, n_models, 1, n_timesteps, n_models) -&gt; (n_timesteps, n_models)</span>
    <span class="c1"># import pdb</span>

    <span class="c1"># pdb.set_trace()</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">current_view</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;peak&quot;</span><span class="p">:</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="p">]</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;mean&quot;</span><span class="p">:</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;std&quot;</span><span class="p">:</span>
        <span class="n">signs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signs</span><span class="p">()</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">signs</span><span class="p">[</span><span class="n">source_type</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span>
        <span class="n">u</span><span class="p">,</span>
        <span class="n">v</span><span class="p">,</span>
        <span class="n">values</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">max_extent</span><span class="o">=</span><span class="n">max_extent</span> <span class="ow">or</span> <span class="n">current_view</span><span class="o">.</span><span class="n">rfs</span><span class="o">.</span><span class="n">max_extent</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">title</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">source_type</span><span class="o">=</span><span class="n">source_type</span><span class="p">),</span>
        <span class="n">labelxy</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="n">strict_sign</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">dataLim</span><span class="o">.</span><span class="n">extents</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">plt_utils</span><span class="o">.</span><span class="n">get_lims</span><span class="p">((</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">),</span> <span class="mf">0.01</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">plt_utils</span><span class="o">.</span><span class="n">get_lims</span><span class="p">((</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">),</span> <span class="mf">0.01</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_spatial_contribution_grid" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">plot_spatial_contribution_grid</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_spatial_contribution_grid" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">plot_spatial_contribution_grid</span><span class="p">(</span>
    <span class="n">t_start</span><span class="p">,</span>
    <span class="n">t_end</span><span class="p">,</span>
    <span class="n">max_extent</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;peak&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{source_type}</span><span class="s2"> :→&quot;</span><span class="p">,</span>
    <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">edgewidth</span><span class="o">=</span><span class="mf">0.125</span><span class="p">,</span>
    <span class="n">title_y</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">max_figure_height_cm</span><span class="o">=</span><span class="mf">9.271</span><span class="p">,</span>
    <span class="n">panel_height_cm</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="n">max_figure_width_cm</span><span class="o">=</span><span class="mf">2.54</span><span class="p">,</span>
    <span class="n">panel_width_cm</span><span class="o">=</span><span class="mf">2.54</span><span class="p">,</span>
    <span class="n">annotate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">hide_source_types</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="n">hide_source_types_bins</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">hide_source_types_cut_off_edge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">hide_source_types_mode</span><span class="o">=</span><span class="s2">&quot;below_cut_off&quot;</span><span class="p">,</span>
    <span class="n">max_axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Plot a grid of spatial contributions for different source types.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>t_start</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start time for the plot.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>t_end</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End time for the plot.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_extent</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum extent of the spatial filter.</p>
              </div>
            </td>
            <td>
                  <code>3</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>mode</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mode for calculating values (&ldquo;peak&rdquo;, &ldquo;mean&rdquo;, or &ldquo;std&rdquo;).</p>
              </div>
            </td>
            <td>
                  <code>&#39;peak&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>title</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Title format string for each subplot.</p>
              </div>
            </td>
            <td>
                  <code>&#39;{source_type} :→&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fig</code></td>
            <td>
                  <code><span title="matplotlib.pyplot.Figure">Figure</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Existing figure to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>axes</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="matplotlib.pyplot.Axes">Axes</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Existing axes to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fontsize</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Font size for labels and titles.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>edgewidth</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Width of edges in the plot.</p>
              </div>
            </td>
            <td>
                  <code>0.125</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>title_y</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Y-position of the title.</p>
              </div>
            </td>
            <td>
                  <code>0.8</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_figure_height_cm</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum figure height in centimeters.</p>
              </div>
            </td>
            <td>
                  <code>9.271</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>panel_height_cm</code></td>
            <td>
                  <code>float | str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Height of each panel in centimeters.</p>
              </div>
            </td>
            <td>
                  <code>&#39;auto&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_figure_width_cm</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum figure width in centimeters.</p>
              </div>
            </td>
            <td>
                  <code>2.54</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>panel_width_cm</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Width of each panel in centimeters.</p>
              </div>
            </td>
            <td>
                  <code>2.54</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>annotate</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to annotate the plots.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cbar</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to add a colorbar.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hide_source_types</code></td>
            <td>
                  <code>str | list | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source types to hide or &ldquo;auto&rdquo;.</p>
              </div>
            </td>
            <td>
                  <code>&#39;auto&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hide_source_types_bins</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of bins for auto-hiding.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hide_source_types_cut_off_edge</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cut-off edge for auto-hiding.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hide_source_types_mode</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mode for auto-hiding source types.</p>
              </div>
            </td>
            <td>
                  <code>&#39;below_cut_off&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_axes</code></td>
            <td>
                  <code>int | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of axes to create.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>**kwargs</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments for plot_spatial_contribution.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[<span title="matplotlib.pyplot.Figure">Figure</span>, <span title="numpy.ndarray">ndarray</span>[<span title="matplotlib.pyplot.Axes">Axes</span>], tuple[<span title="matplotlib.pyplot.Colorbar">Colorbar</span>, <span title="matplotlib.pyplot.Colormap">Colormap</span>, <span title="matplotlib.pyplot.Normalize">Normalize</span>, float, float]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Figure, axes, and colorbar information (cbar, cmap, norm, vmin, vmax).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_spatial_contribution_grid</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">t_start</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">t_end</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">max_extent</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;peak&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{source_type}</span><span class="s2"> :→&quot;</span><span class="p">,</span>
    <span class="n">fig</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">axes</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">edgewidth</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.125</span><span class="p">,</span>
    <span class="n">title_y</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
    <span class="n">max_figure_height_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">9.271</span><span class="p">,</span>
    <span class="n">panel_height_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="n">max_figure_width_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.54</span><span class="p">,</span>
    <span class="n">panel_width_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.54</span><span class="p">,</span>
    <span class="n">annotate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">cbar</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">hide_source_types</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="n">hide_source_types_bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">hide_source_types_cut_off_edge</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">hide_source_types_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;below_cut_off&quot;</span><span class="p">,</span>
    <span class="n">max_axes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">],</span>
    <span class="nb">tuple</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Colorbar</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Colormap</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
<span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot a grid of spatial contributions for different source types.</span>

<span class="sd">    Args:</span>
<span class="sd">        t_start: Start time for the plot.</span>
<span class="sd">        t_end: End time for the plot.</span>
<span class="sd">        max_extent: Maximum extent of the spatial filter.</span>
<span class="sd">        mode: Mode for calculating values (&quot;peak&quot;, &quot;mean&quot;, or &quot;std&quot;).</span>
<span class="sd">        title: Title format string for each subplot.</span>
<span class="sd">        fig: Existing figure to use.</span>
<span class="sd">        axes: Existing axes to use.</span>
<span class="sd">        fontsize: Font size for labels and titles.</span>
<span class="sd">        edgewidth: Width of edges in the plot.</span>
<span class="sd">        title_y: Y-position of the title.</span>
<span class="sd">        max_figure_height_cm: Maximum figure height in centimeters.</span>
<span class="sd">        panel_height_cm: Height of each panel in centimeters.</span>
<span class="sd">        max_figure_width_cm: Maximum figure width in centimeters.</span>
<span class="sd">        panel_width_cm: Width of each panel in centimeters.</span>
<span class="sd">        annotate: Whether to annotate the plots.</span>
<span class="sd">        cbar: Whether to add a colorbar.</span>
<span class="sd">        hide_source_types: Source types to hide or &quot;auto&quot;.</span>
<span class="sd">        hide_source_types_bins: Number of bins for auto-hiding.</span>
<span class="sd">        hide_source_types_cut_off_edge: Cut-off edge for auto-hiding.</span>
<span class="sd">        hide_source_types_mode: Mode for auto-hiding source types.</span>
<span class="sd">        max_axes: Maximum number of axes to create.</span>
<span class="sd">        **kwargs: Additional keyword arguments for plot_spatial_contribution.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Figure, axes, and colorbar information (cbar, cmap, norm, vmin, vmax).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>

    <span class="n">vmin</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span>
            <span class="nb">min</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="nb">min</span><span class="p">(</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">current</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">current_view</span><span class="p">[:]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">*</span> <span class="mi">10</span>
        <span class="p">)</span>
        <span class="o">/</span> <span class="mi">10</span>
    <span class="p">)</span>

    <span class="n">vmax</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span>
            <span class="nb">max</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="nb">max</span><span class="p">(</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">current</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">current_view</span><span class="p">[:]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">*</span> <span class="mi">10</span>
        <span class="p">)</span>
        <span class="o">/</span> <span class="mi">10</span>
    <span class="p">)</span>

    <span class="n">source_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_source_types</span><span class="p">(</span>
        <span class="n">hide_source_types</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="n">hide_source_types_bins</span><span class="p">,</span>
        <span class="n">edge</span><span class="o">=</span><span class="n">hide_source_types_cut_off_edge</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="n">hide_source_types_mode</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize_from_n_items</span><span class="p">(</span>
            <span class="n">max_axes</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_types</span><span class="p">),</span>
            <span class="n">max_figure_height_cm</span><span class="o">=</span><span class="n">max_figure_height_cm</span><span class="p">,</span>
            <span class="n">panel_height_cm</span><span class="o">=</span><span class="p">(</span>
                <span class="n">max_figure_height_cm</span> <span class="o">/</span> <span class="p">(</span><span class="n">max_axes</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_types</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">panel_height_cm</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span>
                <span class="k">else</span> <span class="n">panel_height_cm</span>
            <span class="p">),</span>
            <span class="n">max_figure_width_cm</span><span class="o">=</span><span class="n">max_figure_width_cm</span><span class="p">,</span>
            <span class="n">panel_width_cm</span><span class="o">=</span><span class="n">panel_width_cm</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">figsize</span><span class="o">.</span><span class="n">axis_grid</span><span class="p">(</span>
            <span class="n">unmask_n</span><span class="o">=</span><span class="n">max_axes</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_types</span><span class="p">),</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">max_axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_types</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_axes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">Axes</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">source_type</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">source_types</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_spatial_contribution</span><span class="p">(</span>
            <span class="n">source_type</span><span class="p">,</span>
            <span class="c1">#                 contrast,</span>
            <span class="c1">#                 angle,</span>
            <span class="n">t_start</span><span class="p">,</span>
            <span class="n">t_end</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="n">edgewidth</span><span class="o">=</span><span class="n">edgewidth</span><span class="p">,</span>
            <span class="n">title_y</span><span class="o">=</span><span class="n">title_y</span><span class="p">,</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">current_view</span><span class="o">=</span><span class="n">current_view</span><span class="p">,</span>
            <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
            <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
            <span class="n">annotate</span><span class="o">=</span><span class="n">annotate</span><span class="p">,</span>
            <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">max_extent</span><span class="o">=</span><span class="n">max_extent</span> <span class="ow">or</span> <span class="n">current_view</span><span class="o">.</span><span class="n">rfs</span><span class="o">.</span><span class="n">max_extent</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">seismic</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">plt_utils</span><span class="o">.</span><span class="n">get_norm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">midpoint</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cbar</span><span class="p">:</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt_utils</span><span class="o">.</span><span class="n">add_colorbar_to_fig</span><span class="p">(</span>
            <span class="n">fig</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
            <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2"> input currents&quot;</span><span class="p">,</span>
            <span class="n">n_ticks</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">n_decimals</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="p">(</span><span class="n">cbar</span><span class="p">,</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_spatial_filter" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">plot_spatial_filter</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_spatial_filter" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">plot_spatial_filter</span><span class="p">(</span>
    <span class="n">source_type</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{source_type}</span><span class="s2"> :→&quot;</span><span class="p">,</span>
    <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">max_extent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Plot the spatial filter for a given source type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>source_type</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The source type to plot.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>title</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Title format string for the plot.</p>
              </div>
            </td>
            <td>
                  <code>&#39;{source_type} :→&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fig</code></td>
            <td>
                  <code><span title="matplotlib.pyplot.Figure">Figure</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Existing figure to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ax</code></td>
            <td>
                  <code><span title="matplotlib.pyplot.Axes">Axes</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Existing axes to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_extent</code></td>
            <td>
                  <code>float | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum extent of the spatial filter.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>**kwargs</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments for plt_utils.kernel.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="matplotlib.pyplot.Axes">Axes</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Axes object containing the plot.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_spatial_filter</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">source_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{source_type}</span><span class="s2"> :→&quot;</span><span class="p">,</span>
    <span class="n">fig</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_extent</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot the spatial filter for a given source type.</span>

<span class="sd">    Args:</span>
<span class="sd">        source_type: The source type to plot.</span>
<span class="sd">        title: Title format string for the plot.</span>
<span class="sd">        fig: Existing figure to use.</span>
<span class="sd">        ax: Existing axes to use.</span>
<span class="sd">        max_extent: Maximum extent of the spatial filter.</span>
<span class="sd">        **kwargs: Additional keyword arguments for plt_utils.kernel.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Axes object containing the plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">filter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfs</span>

    <span class="k">def</span> <span class="nf">filter_values</span><span class="p">(</span><span class="n">rf</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">rf</span><span class="o">.</span><span class="n">n_syn</span> <span class="o">*</span> <span class="n">rf</span><span class="o">.</span><span class="n">sign</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>

    <span class="n">vmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;vmin&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span>
            <span class="nb">min</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="nb">min</span><span class="p">(</span>
                    <span class="nb">min</span><span class="p">(</span><span class="n">filter_values</span><span class="p">(</span><span class="nb">filter</span><span class="p">[</span><span class="n">source_type</span><span class="p">]))</span>
                    <span class="k">for</span> <span class="n">source_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_types</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">*</span> <span class="mi">100</span>
        <span class="p">)</span>
        <span class="o">/</span> <span class="mi">100</span>
    <span class="p">)</span>

    <span class="n">vmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;vmax&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span>
            <span class="nb">max</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="nb">max</span><span class="p">(</span>
                    <span class="nb">max</span><span class="p">(</span><span class="n">filter_values</span><span class="p">(</span><span class="nb">filter</span><span class="p">[</span><span class="n">source_type</span><span class="p">]))</span>
                    <span class="k">for</span> <span class="n">source_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_types</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">*</span> <span class="mi">100</span>
        <span class="p">)</span>
        <span class="o">/</span> <span class="mi">100</span>
    <span class="p">)</span>

    <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">[</span><span class="n">source_type</span><span class="p">][[</span><span class="s2">&quot;source_u&quot;</span><span class="p">,</span> <span class="s2">&quot;source_v&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
    <span class="c1"># average over models</span>
    <span class="c1"># (1, n_models, 1, n_timesteps, n_models) -&gt; (n_timesteps, n_models)</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">filter_values</span><span class="p">(</span><span class="nb">filter</span><span class="p">[</span><span class="n">source_type</span><span class="p">])</span>

    <span class="n">label</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">source_type</span><span class="o">=</span><span class="n">source_type</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plt_utils</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span>
        <span class="n">u</span><span class="p">,</span>
        <span class="n">v</span><span class="p">,</span>
        <span class="n">values</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">max_extent</span><span class="o">=</span><span class="n">max_extent</span> <span class="ow">or</span> <span class="nb">filter</span><span class="o">.</span><span class="n">max_extent</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
        <span class="n">labelxy</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="n">strict_sign</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">dataLim</span><span class="o">.</span><span class="n">extents</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">plt_utils</span><span class="o">.</span><span class="n">get_lims</span><span class="p">((</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">),</span> <span class="mf">0.01</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">plt_utils</span><span class="o">.</span><span class="n">get_lims</span><span class="p">((</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">),</span> <span class="mf">0.01</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ax</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_spatial_filter_grid" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">plot_spatial_filter_grid</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_spatial_filter_grid" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">plot_spatial_filter_grid</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{source_type}</span><span class="s2"> :→&quot;</span><span class="p">,</span>
    <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">max_extent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">edgewidth</span><span class="o">=</span><span class="mf">0.125</span><span class="p">,</span>
    <span class="n">title_y</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">max_figure_height_cm</span><span class="o">=</span><span class="mf">9.271</span><span class="p">,</span>
    <span class="n">panel_height_cm</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="n">max_figure_width_cm</span><span class="o">=</span><span class="mf">2.54</span><span class="p">,</span>
    <span class="n">panel_width_cm</span><span class="o">=</span><span class="mf">2.54</span><span class="p">,</span>
    <span class="n">annotate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">hide_source_types</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="n">hide_source_types_bins</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">hide_source_types_cut_off_edge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">hide_source_types_mode</span><span class="o">=</span><span class="s2">&quot;below_cut_off&quot;</span><span class="p">,</span>
    <span class="n">max_axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">wspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">hspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Plot a grid of spatial filters for different source types.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>title</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Title format string for each subplot.</p>
              </div>
            </td>
            <td>
                  <code>&#39;{source_type} :→&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fig</code></td>
            <td>
                  <code><span title="matplotlib.pyplot.Figure">Figure</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Existing figure to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>axes</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="matplotlib.pyplot.Axes">Axes</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Existing axes to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_extent</code></td>
            <td>
                  <code>float | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum extent of the spatial filter.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fontsize</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Font size for labels and titles.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>edgewidth</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Width of edges in the plot.</p>
              </div>
            </td>
            <td>
                  <code>0.125</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>title_y</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Y-position of the title.</p>
              </div>
            </td>
            <td>
                  <code>0.8</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_figure_height_cm</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum figure height in centimeters.</p>
              </div>
            </td>
            <td>
                  <code>9.271</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>panel_height_cm</code></td>
            <td>
                  <code>float | str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Height of each panel in centimeters.</p>
              </div>
            </td>
            <td>
                  <code>&#39;auto&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_figure_width_cm</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum figure width in centimeters.</p>
              </div>
            </td>
            <td>
                  <code>2.54</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>panel_width_cm</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Width of each panel in centimeters.</p>
              </div>
            </td>
            <td>
                  <code>2.54</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>annotate</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to annotate the plots.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cbar</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to add a colorbar.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hide_source_types</code></td>
            <td>
                  <code>str | list | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source types to hide or &ldquo;auto&rdquo;.</p>
              </div>
            </td>
            <td>
                  <code>&#39;auto&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hide_source_types_bins</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of bins for auto-hiding.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hide_source_types_cut_off_edge</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cut-off edge for auto-hiding.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hide_source_types_mode</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mode for auto-hiding source types.</p>
              </div>
            </td>
            <td>
                  <code>&#39;below_cut_off&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_axes</code></td>
            <td>
                  <code>int | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of axes to create.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>wspace</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Width space between subplots.</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hspace</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Height space between subplots.</p>
              </div>
            </td>
            <td>
                  <code>0.1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>**kwargs</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments for plot_spatial_filter.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[<span title="matplotlib.pyplot.Figure">Figure</span>, <span title="numpy.ndarray">ndarray</span>[<span title="matplotlib.pyplot.Axes">Axes</span>], tuple[<span title="matplotlib.pyplot.Colorbar">Colorbar</span>, <span title="matplotlib.pyplot.Colormap">Colormap</span>, <span title="matplotlib.pyplot.Normalize">Normalize</span>, float, float]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Figure, axes, and colorbar information (cbar, cmap, norm, vmin, vmax).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span>
<span class="normal">991</span>
<span class="normal">992</span>
<span class="normal">993</span>
<span class="normal">994</span>
<span class="normal">995</span>
<span class="normal">996</span>
<span class="normal">997</span>
<span class="normal">998</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_spatial_filter_grid</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{source_type}</span><span class="s2"> :→&quot;</span><span class="p">,</span>
    <span class="n">fig</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">axes</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_extent</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">edgewidth</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.125</span><span class="p">,</span>
    <span class="n">title_y</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
    <span class="n">max_figure_height_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">9.271</span><span class="p">,</span>
    <span class="n">panel_height_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="n">max_figure_width_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.54</span><span class="p">,</span>
    <span class="n">panel_width_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.54</span><span class="p">,</span>
    <span class="n">annotate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">cbar</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">hide_source_types</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="n">hide_source_types_bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">hide_source_types_cut_off_edge</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">hide_source_types_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;below_cut_off&quot;</span><span class="p">,</span>
    <span class="n">max_axes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">wspace</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">hspace</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">],</span>
    <span class="nb">tuple</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Colorbar</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Colormap</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
<span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot a grid of spatial filters for different source types.</span>

<span class="sd">    Args:</span>
<span class="sd">        title: Title format string for each subplot.</span>
<span class="sd">        fig: Existing figure to use.</span>
<span class="sd">        axes: Existing axes to use.</span>
<span class="sd">        max_extent: Maximum extent of the spatial filter.</span>
<span class="sd">        fontsize: Font size for labels and titles.</span>
<span class="sd">        edgewidth: Width of edges in the plot.</span>
<span class="sd">        title_y: Y-position of the title.</span>
<span class="sd">        max_figure_height_cm: Maximum figure height in centimeters.</span>
<span class="sd">        panel_height_cm: Height of each panel in centimeters.</span>
<span class="sd">        max_figure_width_cm: Maximum figure width in centimeters.</span>
<span class="sd">        panel_width_cm: Width of each panel in centimeters.</span>
<span class="sd">        annotate: Whether to annotate the plots.</span>
<span class="sd">        cbar: Whether to add a colorbar.</span>
<span class="sd">        hide_source_types: Source types to hide or &quot;auto&quot;.</span>
<span class="sd">        hide_source_types_bins: Number of bins for auto-hiding.</span>
<span class="sd">        hide_source_types_cut_off_edge: Cut-off edge for auto-hiding.</span>
<span class="sd">        hide_source_types_mode: Mode for auto-hiding source types.</span>
<span class="sd">        max_axes: Maximum number of axes to create.</span>
<span class="sd">        wspace: Width space between subplots.</span>
<span class="sd">        hspace: Height space between subplots.</span>
<span class="sd">        **kwargs: Additional keyword arguments for plot_spatial_filter.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Figure, axes, and colorbar information (cbar, cmap, norm, vmin, vmax).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">filter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfs</span>

    <span class="k">def</span> <span class="nf">filter_values</span><span class="p">(</span><span class="n">rf</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">rf</span><span class="o">.</span><span class="n">n_syn</span> <span class="o">*</span> <span class="n">rf</span><span class="o">.</span><span class="n">sign</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>

    <span class="n">vmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;vmin&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span>
            <span class="nb">min</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="nb">min</span><span class="p">(</span>
                    <span class="nb">min</span><span class="p">(</span><span class="n">filter_values</span><span class="p">(</span><span class="nb">filter</span><span class="p">[</span><span class="n">source_type</span><span class="p">]))</span>
                    <span class="k">for</span> <span class="n">source_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_types</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">*</span> <span class="mi">100</span>
        <span class="p">)</span>
        <span class="o">/</span> <span class="mi">100</span>
    <span class="p">)</span>

    <span class="n">vmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;vmax&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span>
            <span class="nb">max</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="nb">max</span><span class="p">(</span>
                    <span class="nb">max</span><span class="p">(</span><span class="n">filter_values</span><span class="p">(</span><span class="nb">filter</span><span class="p">[</span><span class="n">source_type</span><span class="p">]))</span>
                    <span class="k">for</span> <span class="n">source_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_types</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">*</span> <span class="mi">100</span>
        <span class="p">)</span>
        <span class="o">/</span> <span class="mi">100</span>
    <span class="p">)</span>

    <span class="n">source_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_source_types</span><span class="p">(</span>
        <span class="n">hide_source_types</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="n">hide_source_types_bins</span><span class="p">,</span>
        <span class="n">edge</span><span class="o">=</span><span class="n">hide_source_types_cut_off_edge</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="n">hide_source_types_mode</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize_from_n_items</span><span class="p">(</span>
            <span class="n">max_axes</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_types</span><span class="p">),</span>
            <span class="n">max_figure_height_cm</span><span class="o">=</span><span class="n">max_figure_height_cm</span><span class="p">,</span>
            <span class="n">panel_height_cm</span><span class="o">=</span><span class="p">(</span>
                <span class="n">max_figure_height_cm</span> <span class="o">/</span> <span class="p">(</span><span class="n">max_axes</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_types</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">panel_height_cm</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span>
                <span class="k">else</span> <span class="n">panel_height_cm</span>
            <span class="p">),</span>
            <span class="n">max_figure_width_cm</span><span class="o">=</span><span class="n">max_figure_width_cm</span><span class="p">,</span>
            <span class="n">panel_width_cm</span><span class="o">=</span><span class="n">panel_width_cm</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">figsize</span><span class="o">.</span><span class="n">axis_grid</span><span class="p">(</span>
            <span class="n">unmask_n</span><span class="o">=</span><span class="n">max_axes</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_types</span><span class="p">),</span> <span class="n">hspace</span><span class="o">=</span><span class="n">hspace</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="n">wspace</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">max_axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_types</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_axes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">Axes</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">source_type</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">source_types</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_spatial_filter</span><span class="p">(</span>
            <span class="n">source_type</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="n">edgewidth</span><span class="o">=</span><span class="n">edgewidth</span><span class="p">,</span>
            <span class="n">title_y</span><span class="o">=</span><span class="n">title_y</span><span class="p">,</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
            <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
            <span class="n">annotate</span><span class="o">=</span><span class="n">annotate</span><span class="p">,</span>
            <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">max_extent</span><span class="o">=</span><span class="n">max_extent</span> <span class="ow">or</span> <span class="nb">filter</span><span class="o">.</span><span class="n">max_extent</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">seismic</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">plt_utils</span><span class="o">.</span><span class="n">get_norm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">midpoint</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cbar</span><span class="p">:</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt_utils</span><span class="o">.</span><span class="n">add_colorbar_to_fig</span><span class="p">(</span>
            <span class="n">fig</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
            <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;spatial filters&quot;</span><span class="p">,</span>
            <span class="n">n_ticks</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">n_decimals</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="p">(</span><span class="n">cbar</span><span class="p">,</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.view" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">view</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.view" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">view</span><span class="p">(</span>
    <span class="n">currents</span><span class="p">,</span>
    <span class="n">rfs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">responses</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">arg_df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a new view with the given currents, rfs, time, responses, and arg_df.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>currents</code></td>
            <td>
                  <code><span title="datamate.Namespace">Namespace</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Currents for each source type.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>rfs</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="flyvision.connectome.ReceptiveFields" href="../connectome/#flyvision.connectome.connectome.ReceptiveFields">ReceptiveFields</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Receptive fields for the target cells.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>time</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time array for the simulation.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>responses</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Responses of the target cells.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>arg_df</code></td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing stimulus arguments.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>&#39;MovingEdgeCurrentView&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new view with the given data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">view</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">currents</span><span class="p">:</span> <span class="n">Namespace</span><span class="p">,</span>
    <span class="n">rfs</span><span class="p">:</span> <span class="n">ReceptiveFields</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">time</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">responses</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">arg_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MovingEdgeCurrentView&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new view with the given currents, rfs, time, responses, and arg_df.</span>

<span class="sd">    Args:</span>
<span class="sd">        currents: Currents for each source type.</span>
<span class="sd">        rfs: Receptive fields for the target cells.</span>
<span class="sd">        time: Time array for the simulation.</span>
<span class="sd">        responses: Responses of the target cells.</span>
<span class="sd">        arg_df: DataFrame containing stimulus arguments.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A new view with the given data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">arg_df</span> <span class="o">=</span> <span class="n">arg_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">arg_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg_df</span>
    <span class="k">return</span> <span class="n">MovingEdgeCurrentView</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ensemble</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_type</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exp_data</span><span class="p">,</span>
        <span class="n">arg_df</span><span class="p">,</span>
        <span class="n">currents</span><span class="p">,</span>
        <span class="n">rfs</span> <span class="k">if</span> <span class="n">rfs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfs</span><span class="p">,</span>
        <span class="n">time</span> <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
        <span class="n">responses</span> <span class="k">if</span> <span class="n">responses</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.subtract_baseline" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">subtract_baseline</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.subtract_baseline" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">subtract_baseline</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a new view with baseline subtracted from the currents and responses.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>&#39;MovingEdgeCurrentView&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new view with baseline subtracted data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">subtract_baseline</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MovingEdgeCurrentView&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new view with baseline subtracted from the currents and responses.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A new view with baseline subtracted data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span>
        <span class="n">Namespace</span><span class="p">({</span>
            <span class="n">cell_type</span><span class="p">:</span> <span class="n">c</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}),</span>
        <span class="n">responses</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">responses</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.subtract_mean" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">subtract_mean</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.subtract_mean" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">subtract_mean</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a new view with mean subtracted from the currents and responses.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>&#39;MovingEdgeCurrentView&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new view with mean subtracted data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">subtract_mean</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MovingEdgeCurrentView&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new view with mean subtracted from the currents and responses.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A new view with mean subtracted data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span>
        <span class="n">Namespace</span><span class="p">({</span>
            <span class="n">cell_type</span><span class="p">:</span> <span class="n">c</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}),</span>
        <span class="n">responses</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">responses</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.standardize" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">standardize</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.standardize" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">standardize</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a new view with standardized currents and responses.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>&#39;MovingEdgeCurrentView&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new view with standardized data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">standardize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MovingEdgeCurrentView&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new view with standardized currents and responses.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A new view with standardized data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span>
        <span class="n">Namespace</span><span class="p">({</span>
            <span class="n">cell_type</span><span class="p">:</span> <span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}),</span>
        <span class="n">responses</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">responses</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.standardize_over_time_and_pd_nd" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">standardize_over_time_and_pd_nd</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.standardize_over_time_and_pd_nd" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">standardize_over_time_and_pd_nd</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">,</span> <span class="n">pd</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a new view with standardized currents and responses over time and PD/ND.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>t_start</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start time for standardization.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>t_end</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End time for standardization.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>pd</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Preferred direction for standardization.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>&#39;MovingEdgeCurrentView&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new view with standardized data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">standardize_over_time_and_pd_nd</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">t_start</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">t_end</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">pd</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MovingEdgeCurrentView&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new view with standardized currents and responses over time and PD/ND.</span>

<span class="sd">    Args:</span>
<span class="sd">        t_start: Start time for standardization.</span>
<span class="sd">        t_end: End time for standardization.</span>
<span class="sd">        pd: Preferred direction for standardization.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A new view with standardized data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span><span class="o">.</span><span class="n">at_angle</span><span class="p">([</span><span class="n">pd</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">])</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span>
        <span class="n">Namespace</span><span class="p">({</span>
            <span class="n">cell_type</span><span class="p">:</span> <span class="p">(</span>
                <span class="n">c</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">currents</span><span class="p">[</span><span class="n">cell_type</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">),</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">currents</span><span class="p">[</span><span class="n">cell_type</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">),</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}),</span>
        <span class="n">responses</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">responses</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">responses</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">responses</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.init_colors" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">init_colors</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.init_colors" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">init_colors</span><span class="p">(</span><span class="n">source_types</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize colors for source types.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>source_types</code></td>
            <td>
                  <code>list[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of source types.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">init_colors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_types</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize colors for source types.</span>

<span class="sd">    Args:</span>
<span class="sd">        source_types: List of source types.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">signs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signs</span><span class="p">()</span>
    <span class="n">signs</span> <span class="o">=</span> <span class="p">{</span><span class="n">cell_type</span><span class="p">:</span> <span class="n">signs</span><span class="p">[</span><span class="n">cell_type</span><span class="p">]</span> <span class="k">for</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="n">source_types</span><span class="p">}</span>
    <span class="n">signs_reversed</span> <span class="o">=</span> <span class="p">{</span><span class="n">cell_type</span><span class="p">:</span> <span class="n">signs</span><span class="p">[</span><span class="n">cell_type</span><span class="p">]</span> <span class="k">for</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="n">source_types</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]}</span>
    <span class="n">n_exc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">signs</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">n_inh</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">signs</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">exc_colors_pd</span> <span class="o">=</span> <span class="n">cmap_iter</span><span class="p">(</span>
        <span class="n">truncate_colormap</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdBu</span><span class="p">,</span> <span class="n">minval</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">maxval</span><span class="o">=</span><span class="mf">0.45</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_exc</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">inh_cmap_pd</span> <span class="o">=</span> <span class="n">cmap_iter</span><span class="p">(</span>
        <span class="n">truncate_colormap</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdBu_r</span><span class="p">,</span> <span class="n">minval</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">maxval</span><span class="o">=</span><span class="mf">0.45</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_inh</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">exc_colors_nd</span> <span class="o">=</span> <span class="n">cmap_iter</span><span class="p">(</span>
        <span class="n">truncate_colormap</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">BrBG_r</span><span class="p">,</span> <span class="n">minval</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">maxval</span><span class="o">=</span><span class="mf">0.45</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_exc</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">inh_cmap_nd</span> <span class="o">=</span> <span class="n">cmap_iter</span><span class="p">(</span>
        <span class="n">truncate_colormap</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">BrBG</span><span class="p">,</span> <span class="n">minval</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">maxval</span><span class="o">=</span><span class="mf">0.45</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_inh</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">colors_pd</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">colors_nd</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">cell_type</span><span class="p">,</span> <span class="n">sign</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">signs</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># take the first half of the RdBu colormap, i.e. red</span>
            <span class="n">colors_pd</span><span class="p">[</span><span class="n">cell_type</span><span class="p">]</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">exc_colors_pd</span><span class="p">)</span>
            <span class="n">colors_nd</span><span class="p">[</span><span class="n">cell_type</span><span class="p">]</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">exc_colors_nd</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">cell_type</span><span class="p">,</span> <span class="n">sign</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">signs_reversed</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c1"># take the second half of the RdBu colormap, i.e. blue</span>
            <span class="n">colors_pd</span><span class="p">[</span><span class="n">cell_type</span><span class="p">]</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">inh_cmap_pd</span><span class="p">)</span>
            <span class="n">colors_nd</span><span class="p">[</span><span class="n">cell_type</span><span class="p">]</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">inh_cmap_nd</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">colors_pd</span> <span class="o">=</span> <span class="n">colors_pd</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">colors_nd</span> <span class="o">=</span> <span class="n">colors_nd</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.color" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">color</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.color" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">color</span><span class="p">(</span><span class="n">source_type</span><span class="p">,</span> <span class="n">pd</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the color for a given source type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>source_type</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The source type.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>pd</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use PD or ND colors.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[float, float, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The color as an RGB tuple.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the color for a given source type.</span>

<span class="sd">    Args:</span>
<span class="sd">        source_type: The source type.</span>
<span class="sd">        pd: Whether to use PD or ND colors.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The color as an RGB tuple.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pd</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors_pd</span><span class="p">[</span><span class="n">source_type</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors_nd</span><span class="p">[</span><span class="n">source_type</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.zorder" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">zorder</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.zorder" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">zorder</span><span class="p">(</span>
    <span class="n">source_types</span><span class="p">,</span>
    <span class="n">source_type</span><span class="p">,</span>
    <span class="n">start_exc</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">start_inh</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the z-order for a given source type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>source_types</code></td>
            <td>
                  <code>list[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of source types.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>source_type</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The source type.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>start_exc</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Starting z-order for excitatory cells.</p>
              </div>
            </td>
            <td>
                  <code>1000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>start_inh</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Starting z-order for inhibitory cells.</p>
              </div>
            </td>
            <td>
                  <code>1000</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The z-order for the given source type.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">zorder</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">source_types</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">source_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">start_exc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">start_inh</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the z-order for a given source type.</span>

<span class="sd">    Args:</span>
<span class="sd">        source_types: List of source types.</span>
<span class="sd">        source_type: The source type.</span>
<span class="sd">        start_exc: Starting z-order for excitatory cells.</span>
<span class="sd">        start_inh: Starting z-order for inhibitory cells.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The z-order for the given source type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">signs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signs</span><span class="p">()</span>
    <span class="n">signs_reversed</span> <span class="o">=</span> <span class="p">{</span><span class="n">cell_type</span><span class="p">:</span> <span class="n">signs</span><span class="p">[</span><span class="n">cell_type</span><span class="p">]</span> <span class="k">for</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="n">source_types</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]}</span>

    <span class="n">z_order</span> <span class="o">=</span> <span class="n">start_exc</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">cell_type</span><span class="p">,</span> <span class="n">sign</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">signs</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cell_type</span> <span class="o">==</span> <span class="n">source_type</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">z_order</span>
            <span class="n">z_order</span> <span class="o">-=</span> <span class="mi">10</span>

    <span class="n">z_order</span> <span class="o">=</span> <span class="n">start_inh</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">cell_type</span><span class="p">,</span> <span class="n">sign</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">signs_reversed</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cell_type</span> <span class="o">==</span> <span class="n">source_type</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">z_order</span>
            <span class="n">z_order</span> <span class="o">-=</span> <span class="mi">10</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.ylims" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">ylims</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.ylims" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">ylims</span><span class="p">(</span><span class="n">source_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the y-limits for temporal contributions summed over cells.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>source_types</code></td>
            <td>
                  <code>list[str] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of source types to consider.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>offset</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Offset for the y-limits.</p>
              </div>
            </td>
            <td>
                  <code>0.02</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>dict[str, tuple[float, float]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Y-limits for the given source types or all source types.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ylims</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">source_types</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.02</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the y-limits for temporal contributions summed over cells.</span>

<span class="sd">    Args:</span>
<span class="sd">        source_types: List of source types to consider.</span>
<span class="sd">        offset: Offset for the y-limits.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Y-limits for the given source types or all source types.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">source_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="n">cell_type</span><span class="p">:</span> <span class="n">plt_utils</span><span class="o">.</span><span class="n">get_lims</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_over_cells</span><span class="p">()</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="n">source_types</span>
        <span class="p">}</span>
    <span class="k">return</span> <span class="n">plt_utils</span><span class="o">.</span><span class="n">get_lims</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sum_over_cells</span><span class="p">()</span><span class="o">.</span><span class="n">currents</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">offset</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_response" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">plot_response</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_response" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">plot_response</span><span class="p">(</span>
    <span class="n">contrast</span><span class="p">,</span>
    <span class="n">angle</span><span class="p">,</span>
    <span class="n">t_start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">t_end</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">max_figure_height_cm</span><span class="o">=</span><span class="mf">1.4477</span><span class="p">,</span>
    <span class="n">panel_height_cm</span><span class="o">=</span><span class="mf">1.4477</span><span class="p">,</span>
    <span class="n">max_figure_width_cm</span><span class="o">=</span><span class="mf">4.0513</span><span class="p">,</span>
    <span class="n">panel_width_cm</span><span class="o">=</span><span class="mf">4.0513</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">model_average</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">hide_yaxis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">trim_axes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">quantile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">scale_position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">scale_label</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:.0f}</span><span class="s2"> ms&quot;</span><span class="p">,</span>
    <span class="n">scale_unit</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">hline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Plot the response to a moving edge stimulus.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>contrast</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The contrast of the stimulus.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>angle</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The angle of the stimulus.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>t_start</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start time for the plot.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>t_end</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End time for the plot.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_figure_height_cm</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum figure height in centimeters.</p>
              </div>
            </td>
            <td>
                  <code>1.4477</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>panel_height_cm</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Height of each panel in centimeters.</p>
              </div>
            </td>
            <td>
                  <code>1.4477</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_figure_width_cm</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum figure width in centimeters.</p>
              </div>
            </td>
            <td>
                  <code>4.0513</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>panel_width_cm</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Width of each panel in centimeters.</p>
              </div>
            </td>
            <td>
                  <code>4.0513</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fontsize</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Font size for labels and titles.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>model_average</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to plot the model average.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>color</code></td>
            <td>
                  <code>tuple[float, float, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Color for the plot.</p>
              </div>
            </td>
            <td>
                  <code>(0, 0, 0)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>legend</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to show the legend.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hide_yaxis</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to hide the y-axis.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>trim_axes</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to trim the axes.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>quantile</code></td>
            <td>
                  <code>float | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Quantile for shading.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>scale_position</code></td>
            <td>
                  <code>str | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Position of the scale.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>scale_label</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Label format for the scale.</p>
              </div>
            </td>
            <td>
                  <code>&#39;{:.0f} ms&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>scale_unit</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unit for the scale.</p>
              </div>
            </td>
            <td>
                  <code>1000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hline</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to show a horizontal line at 0.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fig</code></td>
            <td>
                  <code><span title="matplotlib.pyplot.Figure">Figure</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Existing figure to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ax</code></td>
            <td>
                  <code><span title="matplotlib.pyplot.Axes">Axes</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Existing axes to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Figure and axes objects.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_response</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">contrast</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">t_start</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">t_end</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">max_figure_height_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.4477</span><span class="p">,</span>
    <span class="n">panel_height_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.4477</span><span class="p">,</span>
    <span class="n">max_figure_width_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0513</span><span class="p">,</span>
    <span class="n">panel_width_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0513</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">model_average</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">color</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">legend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">hide_yaxis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">trim_axes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">quantile</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">scale_position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># &quot;lower left&quot;,</span>
    <span class="n">scale_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:.0f}</span><span class="s2"> ms&quot;</span><span class="p">,</span>
    <span class="n">scale_unit</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">hline</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">fig</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the response to a moving edge stimulus.</span>

<span class="sd">    Args:</span>
<span class="sd">        contrast: The contrast of the stimulus.</span>
<span class="sd">        angle: The angle of the stimulus.</span>
<span class="sd">        t_start: Start time for the plot.</span>
<span class="sd">        t_end: End time for the plot.</span>
<span class="sd">        max_figure_height_cm: Maximum figure height in centimeters.</span>
<span class="sd">        panel_height_cm: Height of each panel in centimeters.</span>
<span class="sd">        max_figure_width_cm: Maximum figure width in centimeters.</span>
<span class="sd">        panel_width_cm: Width of each panel in centimeters.</span>
<span class="sd">        fontsize: Font size for labels and titles.</span>
<span class="sd">        model_average: Whether to plot the model average.</span>
<span class="sd">        color: Color for the plot.</span>
<span class="sd">        legend: Whether to show the legend.</span>
<span class="sd">        hide_yaxis: Whether to hide the y-axis.</span>
<span class="sd">        trim_axes: Whether to trim the axes.</span>
<span class="sd">        quantile: Quantile for shading.</span>
<span class="sd">        scale_position: Position of the scale.</span>
<span class="sd">        scale_label: Label format for the scale.</span>
<span class="sd">        scale_unit: Unit for the scale.</span>
<span class="sd">        hline: Whether to show a horizontal line at 0.</span>
<span class="sd">        fig: Existing figure to use.</span>
<span class="sd">        ax: Existing axes to use.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Figure and axes objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r_pd</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">at_angle</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
        <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
        <span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">r_nd</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">at_angle</span><span class="p">((</span><span class="n">angle</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>
        <span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
        <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
        <span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize_from_n_items</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="n">max_figure_height_cm</span><span class="o">=</span><span class="n">max_figure_height_cm</span><span class="p">,</span>
            <span class="n">panel_height_cm</span><span class="o">=</span><span class="n">panel_height_cm</span><span class="p">,</span>
            <span class="n">max_figure_width_cm</span><span class="o">=</span><span class="n">max_figure_width_cm</span><span class="p">,</span>
            <span class="n">panel_width_cm</span><span class="o">=</span><span class="n">panel_width_cm</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">figsize</span><span class="o">.</span><span class="n">axis_grid</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="n">hex2color</span><span class="p">(</span><span class="n">PD</span><span class="p">),</span> <span class="n">hex2color</span><span class="p">(</span><span class="n">ND</span><span class="p">)]</span> <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="n">color</span><span class="p">,</span> <span class="n">color</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">model_average</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">traces</span><span class="p">(</span>
            <span class="p">[</span><span class="n">r_pd</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">r_nd</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)],</span>
            <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="n">null_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="s2">&quot;dashed&quot;</span><span class="p">],</span>
            <span class="n">legend</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">legend</span> <span class="k">else</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;null direction&quot;</span><span class="p">],</span>
            <span class="n">scale_pos</span><span class="o">=</span><span class="n">scale_position</span><span class="p">,</span>
            <span class="n">scale_label</span><span class="o">=</span><span class="n">scale_label</span><span class="p">,</span>
            <span class="n">scale_unit</span><span class="o">=</span><span class="n">scale_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">traces</span><span class="p">(</span>
            <span class="n">r_pd</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">mean_color</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.5</span><span class="p">),</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
            <span class="n">zorder_traces</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">zorder_mean</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="n">null_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">highlight_mean</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plots</span><span class="o">.</span><span class="n">traces</span><span class="p">(</span>
            <span class="n">r_nd</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">mean_color</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.5</span><span class="p">),</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
            <span class="n">zorder_traces</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">zorder_mean</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="n">null_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">highlight_mean</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">quantile</span><span class="p">:</span>
        <span class="n">quantile_pd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">r_pd</span><span class="p">,</span> <span class="n">quantile</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">quantile_nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">r_nd</span><span class="p">,</span> <span class="n">quantile</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">quantile_pd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">quantile_pd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">facecolor</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.1</span><span class="p">),</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">quantile_nd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">quantile_nd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">facecolor</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.1</span><span class="p">),</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">hline</span><span class="p">:</span>
        <span class="c1"># horizontal line at 0</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">hide_yaxis</span><span class="p">:</span>
        <span class="n">plt_utils</span><span class="o">.</span><span class="n">rm_spines</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,))</span>
    <span class="k">if</span> <span class="n">trim_axes</span><span class="p">:</span>
        <span class="n">plt_utils</span><span class="o">.</span><span class="n">trim_axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
            <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_response_pc_nc" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">plot_response_pc_nc</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_response_pc_nc" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">plot_response_pc_nc</span><span class="p">(</span>
    <span class="n">contrast</span><span class="p">,</span>
    <span class="n">angle</span><span class="p">,</span>
    <span class="n">t_start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">t_end</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">max_figure_height_cm</span><span class="o">=</span><span class="mf">1.4477</span><span class="p">,</span>
    <span class="n">panel_height_cm</span><span class="o">=</span><span class="mf">1.4477</span><span class="p">,</span>
    <span class="n">max_figure_width_cm</span><span class="o">=</span><span class="mf">4.0513</span><span class="p">,</span>
    <span class="n">panel_width_cm</span><span class="o">=</span><span class="mf">4.0513</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">model_average</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">hide_yaxis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">trim_axes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">quantile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">scale_position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">scale_label</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:.0f}</span><span class="s2"> ms&quot;</span><span class="p">,</span>
    <span class="n">scale_unit</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">hline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Plot the response to a moving edge stimulus with positive and negative contrasts.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>contrast</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The contrast of the stimulus.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>angle</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The angle of the stimulus.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>t_start</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start time for the plot.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>t_end</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End time for the plot.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_figure_height_cm</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum figure height in centimeters.</p>
              </div>
            </td>
            <td>
                  <code>1.4477</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>panel_height_cm</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Height of each panel in centimeters.</p>
              </div>
            </td>
            <td>
                  <code>1.4477</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_figure_width_cm</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum figure width in centimeters.</p>
              </div>
            </td>
            <td>
                  <code>4.0513</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>panel_width_cm</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Width of each panel in centimeters.</p>
              </div>
            </td>
            <td>
                  <code>4.0513</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fontsize</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Font size for labels and titles.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>model_average</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to plot the model average.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>color</code></td>
            <td>
                  <code>tuple[float, float, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Color for the plot.</p>
              </div>
            </td>
            <td>
                  <code>(0, 0, 0)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>legend</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to show the legend.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hide_yaxis</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to hide the y-axis.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>trim_axes</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to trim the axes.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>quantile</code></td>
            <td>
                  <code>float | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Quantile for shading.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>scale_position</code></td>
            <td>
                  <code>str | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Position of the scale.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>scale_label</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Label format for the scale.</p>
              </div>
            </td>
            <td>
                  <code>&#39;{:.0f} ms&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>scale_unit</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unit for the scale.</p>
              </div>
            </td>
            <td>
                  <code>1000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fig</code></td>
            <td>
                  <code><span title="matplotlib.pyplot.Figure">Figure</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Existing figure to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ax</code></td>
            <td>
                  <code><span title="matplotlib.pyplot.Axes">Axes</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Existing axes to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hline</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to show a horizontal line at 0.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[<span title="matplotlib.pyplot.Figure">Figure</span>, <span title="matplotlib.pyplot.Axes">Axes</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Figure and axes objects.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_response_pc_nc</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">contrast</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">t_start</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">t_end</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">max_figure_height_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.4477</span><span class="p">,</span>
    <span class="n">panel_height_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.4477</span><span class="p">,</span>
    <span class="n">max_figure_width_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0513</span><span class="p">,</span>
    <span class="n">panel_width_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0513</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">model_average</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">color</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">legend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">hide_yaxis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">trim_axes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">quantile</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">scale_position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">scale_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:.0f}</span><span class="s2"> ms&quot;</span><span class="p">,</span>
    <span class="n">scale_unit</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">fig</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">hline</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the response to a moving edge stimulus with positive and negative contrasts.</span>

<span class="sd">    Args:</span>
<span class="sd">        contrast: The contrast of the stimulus.</span>
<span class="sd">        angle: The angle of the stimulus.</span>
<span class="sd">        t_start: Start time for the plot.</span>
<span class="sd">        t_end: End time for the plot.</span>
<span class="sd">        max_figure_height_cm: Maximum figure height in centimeters.</span>
<span class="sd">        panel_height_cm: Height of each panel in centimeters.</span>
<span class="sd">        max_figure_width_cm: Maximum figure width in centimeters.</span>
<span class="sd">        panel_width_cm: Width of each panel in centimeters.</span>
<span class="sd">        fontsize: Font size for labels and titles.</span>
<span class="sd">        model_average: Whether to plot the model average.</span>
<span class="sd">        color: Color for the plot.</span>
<span class="sd">        legend: Whether to show the legend.</span>
<span class="sd">        hide_yaxis: Whether to hide the y-axis.</span>
<span class="sd">        trim_axes: Whether to trim the axes.</span>
<span class="sd">        quantile: Quantile for shading.</span>
<span class="sd">        scale_position: Position of the scale.</span>
<span class="sd">        scale_label: Label format for the scale.</span>
<span class="sd">        scale_unit: Unit for the scale.</span>
<span class="sd">        fig: Existing figure to use.</span>
<span class="sd">        ax: Existing axes to use.</span>
<span class="sd">        hline: Whether to show a horizontal line at 0.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Figure and axes objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r_pc</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">at_angle</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
        <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
        <span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">r_nc</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">at_angle</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="n">contrast</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
        <span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize_from_n_items</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="n">max_figure_height_cm</span><span class="o">=</span><span class="n">max_figure_height_cm</span><span class="p">,</span>
            <span class="n">panel_height_cm</span><span class="o">=</span><span class="n">panel_height_cm</span><span class="p">,</span>
            <span class="n">max_figure_width_cm</span><span class="o">=</span><span class="n">max_figure_width_cm</span><span class="p">,</span>
            <span class="n">panel_width_cm</span><span class="o">=</span><span class="n">panel_width_cm</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">figsize</span><span class="o">.</span><span class="n">axis_grid</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="n">hex2color</span><span class="p">(</span><span class="n">PD</span><span class="p">),</span> <span class="n">hex2color</span><span class="p">(</span><span class="n">ND</span><span class="p">)]</span> <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="n">color</span><span class="p">,</span> <span class="n">color</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">model_average</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">traces</span><span class="p">(</span>
            <span class="p">[</span><span class="n">r_pc</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">r_nc</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)],</span>
            <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="n">null_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="s2">&quot;dotted&quot;</span><span class="p">],</span>
            <span class="n">legend</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">legend</span> <span class="k">else</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;null contrast&quot;</span><span class="p">],</span>
            <span class="n">scale_pos</span><span class="o">=</span><span class="n">scale_position</span><span class="p">,</span>
            <span class="n">scale_label</span><span class="o">=</span><span class="n">scale_label</span><span class="p">,</span>
            <span class="n">scale_unit</span><span class="o">=</span><span class="n">scale_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">traces</span><span class="p">(</span>
            <span class="n">r_pc</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">mean_color</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.5</span><span class="p">),</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
            <span class="n">zorder_traces</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">zorder_mean</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="n">null_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">highlight_mean</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plots</span><span class="o">.</span><span class="n">traces</span><span class="p">(</span>
            <span class="n">r_nc</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">mean_color</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.5</span><span class="p">),</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
            <span class="n">zorder_traces</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">zorder_mean</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="n">null_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">highlight_mean</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">quantile</span><span class="p">:</span>
        <span class="n">quantile_pd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">r_pc</span><span class="p">,</span> <span class="n">quantile</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">quantile_nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">r_nc</span><span class="p">,</span> <span class="n">quantile</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">quantile_pd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">quantile_pd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">facecolor</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.1</span><span class="p">),</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">quantile_nd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">quantile_nd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">facecolor</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.1</span><span class="p">),</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># horizontal line at 0</span>
    <span class="k">if</span> <span class="n">hline</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">hide_yaxis</span><span class="p">:</span>
        <span class="n">plt_utils</span><span class="o">.</span><span class="n">rm_spines</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,))</span>
    <span class="k">if</span> <span class="n">trim_axes</span><span class="p">:</span>
        <span class="n">plt_utils</span><span class="o">.</span><span class="n">trim_axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
            <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_temporal_contributions" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">plot_temporal_contributions</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_temporal_contributions" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">plot_temporal_contributions</span><span class="p">(</span>
    <span class="n">contrast</span><span class="p">,</span>
    <span class="n">angle</span><span class="p">,</span>
    <span class="n">t_start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">t_end</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">legend_standalone</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">legend_figsize_cm</span><span class="o">=</span><span class="p">(</span><span class="mf">4.0572</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">legend_n_rows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">max_figure_height_cm</span><span class="o">=</span><span class="mf">3.3941</span><span class="p">,</span>
    <span class="n">panel_height_cm</span><span class="o">=</span><span class="mf">3.3941</span><span class="p">,</span>
    <span class="n">max_figure_width_cm</span><span class="o">=</span><span class="mf">4.0572</span><span class="p">,</span>
    <span class="n">panel_width_cm</span><span class="o">=</span><span class="mf">4.0572</span><span class="p">,</span>
    <span class="n">model_average</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">highlight_mean</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">sum_exc_inh</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">only_sum</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">hide_source_types</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="n">hide_source_types_bins</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">hide_source_types_cut_off_edge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">hide_source_types_mode</span><span class="o">=</span><span class="s2">&quot;below_cut_off&quot;</span><span class="p">,</span>
    <span class="n">hide_yaxis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">trim_axes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">quantile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">legend_ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">hline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">legend_n_cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">baseline_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Plot temporal contributions of different source types.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>contrast</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The contrast of the stimulus.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>angle</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The angle of the stimulus.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>t_start</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start time for the plot.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>t_end</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End time for the plot.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fontsize</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Font size for labels and titles.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>linewidth</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Line width for traces.</p>
              </div>
            </td>
            <td>
                  <code>0.25</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>legend</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to show the legend.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>legend_standalone</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to create a standalone legend.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>legend_figsize_cm</code></td>
            <td>
                  <code>tuple[float, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Figure size for the standalone legend.</p>
              </div>
            </td>
            <td>
                  <code>(4.0572, 1)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>legend_n_rows</code></td>
            <td>
                  <code>int | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of rows for the standalone legend.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_figure_height_cm</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum figure height in centimeters.</p>
              </div>
            </td>
            <td>
                  <code>3.3941</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>panel_height_cm</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Height of each panel in centimeters.</p>
              </div>
            </td>
            <td>
                  <code>3.3941</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_figure_width_cm</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum figure width in centimeters.</p>
              </div>
            </td>
            <td>
                  <code>4.0572</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>panel_width_cm</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Width of each panel in centimeters.</p>
              </div>
            </td>
            <td>
                  <code>4.0572</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>model_average</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to plot the model average.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>highlight_mean</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to highlight the mean trace.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>sum_exc_inh</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to sum excitatory and inhibitory contributions.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>only_sum</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to only plot the summed contributions.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hide_source_types</code></td>
            <td>
                  <code>str | list | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source types to hide or &ldquo;auto&rdquo;.</p>
              </div>
            </td>
            <td>
                  <code>&#39;auto&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hide_source_types_bins</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of bins for auto-hiding.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hide_source_types_cut_off_edge</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cut-off edge for auto-hiding.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hide_source_types_mode</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mode for auto-hiding source types.</p>
              </div>
            </td>
            <td>
                  <code>&#39;below_cut_off&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hide_yaxis</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to hide the y-axis.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>trim_axes</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to trim the axes.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>quantile</code></td>
            <td>
                  <code>float | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Quantile for shading.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fig</code></td>
            <td>
                  <code><span title="matplotlib.pyplot.Figure">Figure</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Existing figure to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ax</code></td>
            <td>
                  <code><span title="matplotlib.pyplot.Axes">Axes</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Existing axes to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>legend_ax</code></td>
            <td>
                  <code><span title="matplotlib.pyplot.Axes">Axes</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Existing axes for the standalone legend.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hline</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to show a horizontal line at 0.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>legend_n_cols</code></td>
            <td>
                  <code>int | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of columns for the standalone legend.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>baseline_color</code></td>
            <td>
                  <code>tuple[float, float, float, float] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Color for the baseline.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>colors</code></td>
            <td>
                  <code>dict[str, tuple[float, float, float, float]] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Colors for each source type.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Figure, axes, and legend axes objects.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code>view = MovingEdgeCurrentView(...)
fig, ax = view.plot_temporal_contributions(
    contrast=1.0,
    angle=0,
    t_start=0,
    t_end=1,
    fontsize=5,
    linewidth=0.25,
    legend=True
)
</code></pre></div>
</details>
            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_temporal_contributions</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">contrast</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">t_start</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">t_end</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span>
    <span class="n">legend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">legend_standalone</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">legend_figsize_cm</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">4.0572</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">legend_n_rows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_figure_height_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.3941</span><span class="p">,</span>
    <span class="n">panel_height_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.3941</span><span class="p">,</span>
    <span class="n">max_figure_width_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0572</span><span class="p">,</span>
    <span class="n">panel_width_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0572</span><span class="p">,</span>
    <span class="n">model_average</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">highlight_mean</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># only applies if model_average is False</span>
    <span class="n">sum_exc_inh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">only_sum</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">hide_source_types</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="n">hide_source_types_bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">hide_source_types_cut_off_edge</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">hide_source_types_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;below_cut_off&quot;</span><span class="p">,</span>
    <span class="n">hide_yaxis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">trim_axes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">quantile</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">fig</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">legend_ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">hline</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">legend_n_cols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">baseline_color</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">colors</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot temporal contributions of different source types.</span>

<span class="sd">    Args:</span>
<span class="sd">        contrast: The contrast of the stimulus.</span>
<span class="sd">        angle: The angle of the stimulus.</span>
<span class="sd">        t_start: Start time for the plot.</span>
<span class="sd">        t_end: End time for the plot.</span>
<span class="sd">        fontsize: Font size for labels and titles.</span>
<span class="sd">        linewidth: Line width for traces.</span>
<span class="sd">        legend: Whether to show the legend.</span>
<span class="sd">        legend_standalone: Whether to create a standalone legend.</span>
<span class="sd">        legend_figsize_cm: Figure size for the standalone legend.</span>
<span class="sd">        legend_n_rows: Number of rows for the standalone legend.</span>
<span class="sd">        max_figure_height_cm: Maximum figure height in centimeters.</span>
<span class="sd">        panel_height_cm: Height of each panel in centimeters.</span>
<span class="sd">        max_figure_width_cm: Maximum figure width in centimeters.</span>
<span class="sd">        panel_width_cm: Width of each panel in centimeters.</span>
<span class="sd">        model_average: Whether to plot the model average.</span>
<span class="sd">        highlight_mean: Whether to highlight the mean trace.</span>
<span class="sd">        sum_exc_inh: Whether to sum excitatory and inhibitory contributions.</span>
<span class="sd">        only_sum: Whether to only plot the summed contributions.</span>
<span class="sd">        hide_source_types: Source types to hide or &quot;auto&quot;.</span>
<span class="sd">        hide_source_types_bins: Number of bins for auto-hiding.</span>
<span class="sd">        hide_source_types_cut_off_edge: Cut-off edge for auto-hiding.</span>
<span class="sd">        hide_source_types_mode: Mode for auto-hiding source types.</span>
<span class="sd">        hide_yaxis: Whether to hide the y-axis.</span>
<span class="sd">        trim_axes: Whether to trim the axes.</span>
<span class="sd">        quantile: Quantile for shading.</span>
<span class="sd">        fig: Existing figure to use.</span>
<span class="sd">        ax: Existing axes to use.</span>
<span class="sd">        legend_ax: Existing axes for the standalone legend.</span>
<span class="sd">        hline: Whether to show a horizontal line at 0.</span>
<span class="sd">        legend_n_cols: Number of columns for the standalone legend.</span>
<span class="sd">        baseline_color: Color for the baseline.</span>
<span class="sd">        colors: Colors for each source type.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Figure, axes, and legend axes objects.</span>

<span class="sd">    Example:</span>
<span class="sd">        ```</span>
<span class="sd">        view = MovingEdgeCurrentView(...)</span>
<span class="sd">        fig, ax = view.plot_temporal_contributions(</span>
<span class="sd">            contrast=1.0,</span>
<span class="sd">            angle=0,</span>
<span class="sd">            t_start=0,</span>
<span class="sd">            t_end=1,</span>
<span class="sd">            fontsize=5,</span>
<span class="sd">            linewidth=0.25,</span>
<span class="sd">            legend=True</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize_from_n_items</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="n">max_figure_height_cm</span><span class="o">=</span><span class="n">max_figure_height_cm</span><span class="p">,</span>
            <span class="n">panel_height_cm</span><span class="o">=</span><span class="n">panel_height_cm</span><span class="p">,</span>
            <span class="n">max_figure_width_cm</span><span class="o">=</span><span class="n">max_figure_width_cm</span><span class="p">,</span>
            <span class="n">panel_width_cm</span><span class="o">=</span><span class="n">panel_width_cm</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">figsize</span><span class="o">.</span><span class="n">axis_grid</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">cv_pd</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
        <span class="o">.</span><span class="n">at_angle</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
        <span class="o">.</span><span class="n">sum_over_cells</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">cv_nd</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
        <span class="o">.</span><span class="n">at_angle</span><span class="p">((</span><span class="n">angle</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>
        <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
        <span class="o">.</span><span class="n">sum_over_cells</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="n">source_types</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
        <span class="o">.</span><span class="n">at_angle</span><span class="p">([</span><span class="n">angle</span><span class="p">,</span> <span class="p">(</span><span class="n">angle</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">])</span>
        <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
        <span class="o">.</span><span class="n">filter_source_types</span><span class="p">(</span>
            <span class="n">hide_source_types</span><span class="p">,</span>
            <span class="n">hide_source_types_bins</span><span class="p">,</span>
            <span class="n">hide_source_types_cut_off_edge</span><span class="p">,</span>
            <span class="n">hide_source_types_mode</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">color_source_types</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
        <span class="o">.</span><span class="n">at_angle</span><span class="p">([</span><span class="n">angle</span><span class="p">,</span> <span class="p">(</span><span class="n">angle</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">])</span>
        <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
        <span class="o">.</span><span class="n">filter_source_types</span><span class="p">(</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="n">hide_source_types_bins</span><span class="p">,</span>
            <span class="n">hide_source_types_cut_off_edge</span><span class="p">,</span>
            <span class="n">hide_source_types_mode</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">cv_pd</span><span class="o">.</span><span class="n">init_colors</span><span class="p">(</span><span class="n">color_source_types</span><span class="p">)</span>
    <span class="n">cv_nd</span><span class="o">.</span><span class="n">init_colors</span><span class="p">(</span><span class="n">color_source_types</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_mean_trace</span><span class="p">(</span>
        <span class="n">time</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">zorder</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">time</span><span class="p">,</span>
            <span class="n">trace</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_individual_traces</span><span class="p">(</span>
        <span class="n">traces</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">zorder</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">only_sum</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">model_average</span><span class="p">:</span>
            <span class="n">plots</span><span class="o">.</span><span class="n">traces</span><span class="p">(</span>
                <span class="n">traces</span><span class="p">,</span>
                <span class="n">time</span><span class="p">,</span>
                <span class="n">mean_color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span>
                <span class="n">zorder_traces</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">zorder_mean</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="n">null_line</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">highlight_mean</span><span class="o">=</span><span class="n">highlight_mean</span><span class="p">,</span>
                <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">legend</span><span class="o">=</span><span class="n">legend</span> <span class="ow">or</span> <span class="n">label</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_quantile</span><span class="p">(</span><span class="n">traces</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">zorder</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">quantile</span><span class="p">:</span>
            <span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">traces</span><span class="p">,</span> <span class="n">quantile</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
                <span class="n">time</span><span class="p">,</span>
                <span class="n">Q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">Q</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">facecolor</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
                <span class="n">edgecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_summed_trace</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">zorder</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">trace</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">time</span><span class="p">,</span>
                <span class="n">trace</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_summed_traces</span><span class="p">(</span><span class="n">signs</span><span class="p">,</span> <span class="n">source_types</span><span class="p">,</span> <span class="n">cv_pd</span><span class="p">,</span> <span class="n">cv_nd</span><span class="p">):</span>
        <span class="c1"># sum over cell types then average over models</span>
        <span class="n">exc_pd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">cv_pd</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">inh_pd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">cv_pd</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">exc_nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">cv_nd</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">inh_nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">cv_nd</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="c1"># sum over cell types</span>
        <span class="k">for</span> <span class="n">source_type</span> <span class="ow">in</span> <span class="n">source_types</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">signs</span><span class="p">[</span><span class="n">source_type</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">exc_pd</span> <span class="o">+=</span> <span class="n">cv_pd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span>  <span class="c1"># (1, n_models, 1, n_timesteps)</span>
                <span class="n">exc_nd</span> <span class="o">+=</span> <span class="n">cv_nd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">inh_pd</span> <span class="o">+=</span> <span class="n">cv_pd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span>
                <span class="n">inh_nd</span> <span class="o">+=</span> <span class="n">cv_nd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span>
        <span class="c1"># (n_models, n_timesteps)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">exc_pd</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span>
            <span class="n">inh_pd</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span>
            <span class="n">exc_nd</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span>
            <span class="n">inh_nd</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">source_type</span> <span class="ow">in</span> <span class="n">source_types</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">model_average</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">only_sum</span><span class="p">:</span>
            <span class="c1"># mean traces solid for PD and dashed for ND</span>
            <span class="k">if</span> <span class="n">baseline_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">baseline_color</span>
            <span class="k">elif</span> <span class="n">colors</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">source_type</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">cv_pd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">source_type</span><span class="p">)</span>

            <span class="n">plot_mean_trace</span><span class="p">(</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">cv_pd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">source_type</span><span class="p">,</span>
                <span class="n">color</span><span class="p">,</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">zorder</span><span class="p">(</span><span class="n">source_types</span><span class="p">,</span> <span class="n">source_type</span><span class="p">),</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">plot_mean_trace</span><span class="p">(</span>
                <span class="n">cv_nd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">cv_nd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">source_type</span><span class="p">,</span>
                <span class="n">color</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="n">cv_pd</span><span class="o">.</span><span class="n">zorder</span><span class="p">(</span><span class="n">source_types</span><span class="p">,</span> <span class="n">source_type</span><span class="p">),</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="n">model_average</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">only_sum</span><span class="p">:</span>
            <span class="c1"># individual traces</span>
            <span class="n">plot_individual_traces</span><span class="p">(</span>
                <span class="n">cv_pd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">),</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">source_type</span><span class="p">),</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">zorder</span><span class="p">(</span><span class="n">source_types</span><span class="p">,</span> <span class="n">source_type</span><span class="p">),</span>
                <span class="n">source_type</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">plot_individual_traces</span><span class="p">(</span>
                <span class="n">cv_nd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">),</span>
                <span class="n">cv_nd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">source_type</span><span class="p">),</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">zorder</span><span class="p">(</span><span class="n">source_types</span><span class="p">,</span> <span class="n">source_type</span><span class="p">),</span>
                <span class="n">source_type</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
                <span class="n">legend</span><span class="o">=</span><span class="s2">&quot;null direction&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># quantiles</span>
        <span class="n">plot_quantile</span><span class="p">(</span>
            <span class="n">cv_pd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">),</span>
            <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">cv_pd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">source_type</span><span class="p">),</span>
            <span class="n">cv_pd</span><span class="o">.</span><span class="n">zorder</span><span class="p">(</span><span class="n">source_types</span><span class="p">,</span> <span class="n">source_type</span><span class="p">),</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plot_quantile</span><span class="p">(</span>
            <span class="n">cv_nd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">),</span>
            <span class="n">cv_nd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">cv_pd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">source_type</span><span class="p">),</span>
            <span class="n">cv_pd</span><span class="o">.</span><span class="n">zorder</span><span class="p">(</span><span class="n">source_types</span><span class="p">,</span> <span class="n">source_type</span><span class="p">),</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">sum_exc_inh</span> <span class="ow">or</span> <span class="n">only_sum</span><span class="p">:</span>
        <span class="c1"># plot summed traces</span>
        <span class="n">signs</span> <span class="o">=</span> <span class="n">cv_pd</span><span class="o">.</span><span class="n">signs</span><span class="p">()</span>
        <span class="n">exc_pd</span><span class="p">,</span> <span class="n">inh_pd</span><span class="p">,</span> <span class="n">exc_nd</span><span class="p">,</span> <span class="n">inh_nd</span> <span class="o">=</span> <span class="n">get_summed_traces</span><span class="p">(</span>
            <span class="n">signs</span><span class="p">,</span> <span class="n">source_types</span><span class="p">,</span> <span class="n">cv_pd</span><span class="p">,</span> <span class="n">cv_nd</span>
        <span class="p">)</span>
        <span class="n">plot_summed_trace</span><span class="p">(</span>
            <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">exc_pd</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;excitatory&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="mf">0.931</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plot_quantile</span><span class="p">(</span>
            <span class="n">exc_pd</span><span class="p">,</span>
            <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="p">(</span><span class="mf">0.931</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plot_summed_trace</span><span class="p">(</span>
            <span class="n">cv_nd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">exc_nd</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;excitatory&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="mf">0.931</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plot_quantile</span><span class="p">(</span>
            <span class="n">exc_nd</span><span class="p">,</span>
            <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="p">(</span><span class="mf">0.931</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plot_summed_trace</span><span class="p">(</span>
            <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">inh_pd</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;inhibitory&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.849</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plot_quantile</span><span class="p">(</span>
            <span class="n">inh_pd</span><span class="p">,</span>
            <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.849</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plot_summed_trace</span><span class="p">(</span>
            <span class="n">cv_nd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">inh_nd</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;inhibitory&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.849</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plot_quantile</span><span class="p">(</span>
            <span class="n">inh_nd</span><span class="p">,</span>
            <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.849</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">hline</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
            <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
            <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
            <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;time (s)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="c1">#         ax.set_ylabel(&quot;current (a.u.)&quot;, fontsize=fontsize)</span>

    <span class="k">if</span> <span class="n">hide_yaxis</span><span class="p">:</span>
        <span class="n">plt_utils</span><span class="o">.</span><span class="n">rm_spines</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,))</span>

    <span class="k">if</span> <span class="n">trim_axes</span><span class="p">:</span>
        <span class="n">plt_utils</span><span class="o">.</span><span class="n">trim_axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">legend_standalone</span><span class="p">:</span>
        <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
        <span class="n">nd_handle</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;null direction&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span>
        <span class="p">)</span>
        <span class="n">legend_n_rows</span> <span class="o">=</span> <span class="n">legend_n_rows</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="c1"># legend_n_cols = (len(labels) + 1) // legend_n_rows</span>
        <span class="n">legend_fig</span><span class="p">,</span> <span class="n">legend_ax</span> <span class="o">=</span> <span class="n">plt_utils</span><span class="o">.</span><span class="n">standalone_legend</span><span class="p">(</span>
            <span class="p">[</span><span class="o">*</span><span class="n">labels</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;null direction&quot;</span><span class="p">],</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="p">[</span><span class="o">*</span><span class="n">handles</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span> <span class="n">nd_handle</span><span class="p">],</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="n">n_cols</span><span class="o">=</span><span class="n">legend_n_cols</span><span class="p">,</span>
            <span class="n">handlelength</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">columnspacing</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
            <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
            <span class="n">figsize</span><span class="o">=</span><span class="n">cm_to_inch</span><span class="p">(</span><span class="n">legend_figsize_cm</span><span class="p">),</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">fig</span> <span class="k">if</span> <span class="n">legend_ax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">legend_ax</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">legend_fig</span><span class="p">,</span> <span class="n">legend_ax</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_temporal_contributions_pc_nc" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">plot_temporal_contributions_pc_nc</span>


<a href="#flyvision.analysis.moving_edge_currents.MovingEdgeCurrentView.plot_temporal_contributions_pc_nc" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">plot_temporal_contributions_pc_nc</span><span class="p">(</span>
    <span class="n">contrast</span><span class="p">,</span>
    <span class="n">angle</span><span class="p">,</span>
    <span class="n">t_start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">t_end</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">legend_standalone</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">legend_figsize_cm</span><span class="o">=</span><span class="p">(</span><span class="mf">4.0572</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">legend_n_rows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">max_figure_height_cm</span><span class="o">=</span><span class="mf">3.3941</span><span class="p">,</span>
    <span class="n">panel_height_cm</span><span class="o">=</span><span class="mf">3.3941</span><span class="p">,</span>
    <span class="n">max_figure_width_cm</span><span class="o">=</span><span class="mf">4.0572</span><span class="p">,</span>
    <span class="n">panel_width_cm</span><span class="o">=</span><span class="mf">4.0572</span><span class="p">,</span>
    <span class="n">model_average</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">highlight_mean</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">sum_exc_inh</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">only_sum</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">hide_source_types</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="n">hide_source_types_bins</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">hide_source_types_cut_off_edge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">hide_source_types_mode</span><span class="o">=</span><span class="s2">&quot;below_cut_off&quot;</span><span class="p">,</span>
    <span class="n">hide_yaxis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">trim_axes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">quantile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">legend_ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">null_linestyle</span><span class="o">=</span><span class="s2">&quot;dotted&quot;</span><span class="p">,</span>
    <span class="n">legend_n_cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Temporal contributions of different source types for positive/negative contrasts.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>contrast</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The contrast of the stimulus.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>angle</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The angle of the stimulus.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>t_start</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start time for the plot.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>t_end</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End time for the plot.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fontsize</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Font size for labels and titles.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>linewidth</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Line width for traces.</p>
              </div>
            </td>
            <td>
                  <code>0.25</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>legend</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to show the legend.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>legend_standalone</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to create a standalone legend.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>legend_figsize_cm</code></td>
            <td>
                  <code>tuple[float, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Figure size for the standalone legend.</p>
              </div>
            </td>
            <td>
                  <code>(4.0572, 1)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>legend_n_rows</code></td>
            <td>
                  <code>int | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of rows for the standalone legend.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_figure_height_cm</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum figure height in centimeters.</p>
              </div>
            </td>
            <td>
                  <code>3.3941</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>panel_height_cm</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Height of each panel in centimeters.</p>
              </div>
            </td>
            <td>
                  <code>3.3941</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_figure_width_cm</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum figure width in centimeters.</p>
              </div>
            </td>
            <td>
                  <code>4.0572</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>panel_width_cm</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Width of each panel in centimeters.</p>
              </div>
            </td>
            <td>
                  <code>4.0572</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>model_average</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to plot the model average.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>highlight_mean</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to highlight the mean trace.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>sum_exc_inh</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to sum excitatory and inhibitory contributions.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>only_sum</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to only plot the summed contributions.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hide_source_types</code></td>
            <td>
                  <code>str | list | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source types to hide or &ldquo;auto&rdquo;.</p>
              </div>
            </td>
            <td>
                  <code>&#39;auto&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hide_source_types_bins</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of bins for auto-hiding.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hide_source_types_cut_off_edge</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cut-off edge for auto-hiding.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hide_source_types_mode</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mode for auto-hiding source types.</p>
              </div>
            </td>
            <td>
                  <code>&#39;below_cut_off&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hide_yaxis</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to hide the y-axis.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>trim_axes</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to trim the axes.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>quantile</code></td>
            <td>
                  <code>float | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Quantile for shading.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fig</code></td>
            <td>
                  <code><span title="matplotlib.pyplot.Figure">Figure</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Existing figure to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ax</code></td>
            <td>
                  <code><span title="matplotlib.pyplot.Axes">Axes</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Existing axes to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>legend_ax</code></td>
            <td>
                  <code><span title="matplotlib.pyplot.Axes">Axes</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Existing axes for the standalone legend.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>null_linestyle</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Linestyle for null direction traces.</p>
              </div>
            </td>
            <td>
                  <code>&#39;dotted&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>legend_n_cols</code></td>
            <td>
                  <code>int | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of columns for the standalone legend.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[<span title="matplotlib.pyplot.Figure">Figure</span>, <span title="matplotlib.pyplot.Axes">Axes</span>, <span title="matplotlib.pyplot.Figure">Figure</span> | None, <span title="matplotlib.pyplot.Axes">Axes</span> | None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Figure, axes, and legend axes objects.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code>view = MovingEdgeCurrentView(...)
fig, ax = view.plot_temporal_contributions_pc_nc(
    contrast=1.0,
    angle=0,
    t_start=0,
    t_end=1,
    fontsize=5,
    linewidth=0.25,
    legend=True
)
</code></pre></div>
</details>
            <details class="quote">
              <summary>Source code in <code>flyvision/analysis/moving_edge_currents.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span>
<span class="normal">2288</span>
<span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span>
<span class="normal">2300</span>
<span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_temporal_contributions_pc_nc</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">contrast</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">t_start</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">t_end</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span>
    <span class="n">legend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">legend_standalone</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">legend_figsize_cm</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">4.0572</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">legend_n_rows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_figure_height_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.3941</span><span class="p">,</span>
    <span class="n">panel_height_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.3941</span><span class="p">,</span>
    <span class="n">max_figure_width_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0572</span><span class="p">,</span>
    <span class="n">panel_width_cm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0572</span><span class="p">,</span>
    <span class="n">model_average</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">highlight_mean</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">sum_exc_inh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">only_sum</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">hide_source_types</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="n">hide_source_types_bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">hide_source_types_cut_off_edge</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">hide_source_types_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;below_cut_off&quot;</span><span class="p">,</span>
    <span class="n">hide_yaxis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">trim_axes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">quantile</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">fig</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">legend_ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">null_linestyle</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;dotted&quot;</span><span class="p">,</span>
    <span class="n">legend_n_cols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Temporal contributions of different source types for positive/negative contrasts.</span>

<span class="sd">    Args:</span>
<span class="sd">        contrast: The contrast of the stimulus.</span>
<span class="sd">        angle: The angle of the stimulus.</span>
<span class="sd">        t_start: Start time for the plot.</span>
<span class="sd">        t_end: End time for the plot.</span>
<span class="sd">        fontsize: Font size for labels and titles.</span>
<span class="sd">        linewidth: Line width for traces.</span>
<span class="sd">        legend: Whether to show the legend.</span>
<span class="sd">        legend_standalone: Whether to create a standalone legend.</span>
<span class="sd">        legend_figsize_cm: Figure size for the standalone legend.</span>
<span class="sd">        legend_n_rows: Number of rows for the standalone legend.</span>
<span class="sd">        max_figure_height_cm: Maximum figure height in centimeters.</span>
<span class="sd">        panel_height_cm: Height of each panel in centimeters.</span>
<span class="sd">        max_figure_width_cm: Maximum figure width in centimeters.</span>
<span class="sd">        panel_width_cm: Width of each panel in centimeters.</span>
<span class="sd">        model_average: Whether to plot the model average.</span>
<span class="sd">        highlight_mean: Whether to highlight the mean trace.</span>
<span class="sd">        sum_exc_inh: Whether to sum excitatory and inhibitory contributions.</span>
<span class="sd">        only_sum: Whether to only plot the summed contributions.</span>
<span class="sd">        hide_source_types: Source types to hide or &quot;auto&quot;.</span>
<span class="sd">        hide_source_types_bins: Number of bins for auto-hiding.</span>
<span class="sd">        hide_source_types_cut_off_edge: Cut-off edge for auto-hiding.</span>
<span class="sd">        hide_source_types_mode: Mode for auto-hiding source types.</span>
<span class="sd">        hide_yaxis: Whether to hide the y-axis.</span>
<span class="sd">        trim_axes: Whether to trim the axes.</span>
<span class="sd">        quantile: Quantile for shading.</span>
<span class="sd">        fig: Existing figure to use.</span>
<span class="sd">        ax: Existing axes to use.</span>
<span class="sd">        legend_ax: Existing axes for the standalone legend.</span>
<span class="sd">        null_linestyle: Linestyle for null direction traces.</span>
<span class="sd">        legend_n_cols: Number of columns for the standalone legend.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Figure, axes, and legend axes objects.</span>

<span class="sd">    Example:</span>
<span class="sd">        ```</span>
<span class="sd">        view = MovingEdgeCurrentView(...)</span>
<span class="sd">        fig, ax = view.plot_temporal_contributions_pc_nc(</span>
<span class="sd">            contrast=1.0,</span>
<span class="sd">            angle=0,</span>
<span class="sd">            t_start=0,</span>
<span class="sd">            t_end=1,</span>
<span class="sd">            fontsize=5,</span>
<span class="sd">            linewidth=0.25,</span>
<span class="sd">            legend=True</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize_from_n_items</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="n">max_figure_height_cm</span><span class="o">=</span><span class="n">max_figure_height_cm</span><span class="p">,</span>
            <span class="n">panel_height_cm</span><span class="o">=</span><span class="n">panel_height_cm</span><span class="p">,</span>
            <span class="n">max_figure_width_cm</span><span class="o">=</span><span class="n">max_figure_width_cm</span><span class="p">,</span>
            <span class="n">panel_width_cm</span><span class="o">=</span><span class="n">panel_width_cm</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">figsize</span><span class="o">.</span><span class="n">axis_grid</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">cv_pd</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
        <span class="o">.</span><span class="n">at_angle</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
        <span class="o">.</span><span class="n">sum_over_cells</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">cv_nd</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
        <span class="o">.</span><span class="n">at_angle</span><span class="p">((</span><span class="n">angle</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>
        <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
        <span class="o">.</span><span class="n">sum_over_cells</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="n">source_types</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
        <span class="o">.</span><span class="n">at_angle</span><span class="p">([</span><span class="n">angle</span><span class="p">,</span> <span class="p">(</span><span class="n">angle</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">])</span>
        <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
        <span class="o">.</span><span class="n">filter_source_types</span><span class="p">(</span>
            <span class="n">hide_source_types</span><span class="p">,</span>
            <span class="n">hide_source_types_bins</span><span class="p">,</span>
            <span class="n">hide_source_types_cut_off_edge</span><span class="p">,</span>
            <span class="n">hide_source_types_mode</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">color_source_types</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">at_contrast</span><span class="p">(</span><span class="n">contrast</span><span class="p">)</span>
        <span class="o">.</span><span class="n">at_angle</span><span class="p">([</span><span class="n">angle</span><span class="p">,</span> <span class="p">(</span><span class="n">angle</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">])</span>
        <span class="o">.</span><span class="n">between_seconds</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">)</span>
        <span class="o">.</span><span class="n">filter_source_types</span><span class="p">(</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="n">hide_source_types_bins</span><span class="p">,</span>
            <span class="n">hide_source_types_cut_off_edge</span><span class="p">,</span>
            <span class="n">hide_source_types_mode</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">cv_pd</span><span class="o">.</span><span class="n">init_colors</span><span class="p">(</span><span class="n">color_source_types</span><span class="p">)</span>
    <span class="n">cv_nd</span><span class="o">.</span><span class="n">init_colors</span><span class="p">(</span><span class="n">color_source_types</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_mean_trace</span><span class="p">(</span>
        <span class="n">time</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">zorder</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">time</span><span class="p">,</span>
            <span class="n">trace</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_individual_traces</span><span class="p">(</span>
        <span class="n">traces</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">zorder</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">only_sum</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">model_average</span><span class="p">:</span>
            <span class="n">plots</span><span class="o">.</span><span class="n">traces</span><span class="p">(</span>
                <span class="n">traces</span><span class="p">,</span>
                <span class="n">time</span><span class="p">,</span>
                <span class="n">mean_color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span>
                <span class="n">zorder_traces</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">zorder_mean</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="n">null_line</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">highlight_mean</span><span class="o">=</span><span class="n">highlight_mean</span><span class="p">,</span>
                <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">legend</span><span class="o">=</span><span class="n">legend</span> <span class="ow">or</span> <span class="n">label</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_quantile</span><span class="p">(</span><span class="n">traces</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">zorder</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">quantile</span><span class="p">:</span>
            <span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">traces</span><span class="p">,</span> <span class="n">quantile</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
                <span class="n">time</span><span class="p">,</span>
                <span class="n">Q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">Q</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">facecolor</span><span class="o">=</span><span class="n">adapt_color_alpha</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
                <span class="n">edgecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_summed_trace</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">zorder</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">trace</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">time</span><span class="p">,</span>
                <span class="n">trace</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_summed_traces</span><span class="p">(</span><span class="n">signs</span><span class="p">,</span> <span class="n">source_types</span><span class="p">,</span> <span class="n">cv_pd</span><span class="p">,</span> <span class="n">cv_nd</span><span class="p">):</span>
        <span class="c1"># sum over cell types then average over models</span>
        <span class="n">exc_pd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">cv_pd</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">inh_pd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">cv_pd</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">exc_nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">cv_nd</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">inh_nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">cv_nd</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="c1"># sum over cell types</span>
        <span class="k">for</span> <span class="n">source_type</span> <span class="ow">in</span> <span class="n">source_types</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">signs</span><span class="p">[</span><span class="n">source_type</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">exc_pd</span> <span class="o">+=</span> <span class="n">cv_pd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span>  <span class="c1"># (1, n_models, 1, n_timesteps)</span>
                <span class="n">exc_nd</span> <span class="o">+=</span> <span class="n">cv_nd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">inh_pd</span> <span class="o">+=</span> <span class="n">cv_pd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span>
                <span class="n">inh_nd</span> <span class="o">+=</span> <span class="n">cv_nd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span>
        <span class="c1"># (n_models, n_timesteps)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">exc_pd</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span>
            <span class="n">inh_pd</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span>
            <span class="n">exc_nd</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span>
            <span class="n">inh_nd</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">source_type</span> <span class="ow">in</span> <span class="n">source_types</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">model_average</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">only_sum</span><span class="p">:</span>
            <span class="c1"># mean traces solid for PD and dashed for ND</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">cv_pd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">source_type</span><span class="p">)</span>

            <span class="n">plot_mean_trace</span><span class="p">(</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">cv_pd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">source_type</span><span class="p">,</span>
                <span class="n">color</span><span class="p">,</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">zorder</span><span class="p">(</span><span class="n">source_types</span><span class="p">,</span> <span class="n">source_type</span><span class="p">),</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">plot_mean_trace</span><span class="p">(</span>
                <span class="n">cv_nd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">cv_nd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">source_type</span><span class="p">,</span>
                <span class="n">color</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="n">null_linestyle</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="n">cv_pd</span><span class="o">.</span><span class="n">zorder</span><span class="p">(</span><span class="n">source_types</span><span class="p">,</span> <span class="n">source_type</span><span class="p">),</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="n">model_average</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">only_sum</span><span class="p">:</span>
            <span class="c1"># individual traces</span>
            <span class="n">plot_individual_traces</span><span class="p">(</span>
                <span class="n">cv_pd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">),</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">source_type</span><span class="p">),</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">zorder</span><span class="p">(</span><span class="n">source_types</span><span class="p">,</span> <span class="n">source_type</span><span class="p">),</span>
                <span class="n">source_type</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">plot_individual_traces</span><span class="p">(</span>
                <span class="n">cv_nd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">),</span>
                <span class="n">cv_nd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">source_type</span><span class="p">),</span>
                <span class="n">cv_pd</span><span class="o">.</span><span class="n">zorder</span><span class="p">(</span><span class="n">source_types</span><span class="p">,</span> <span class="n">source_type</span><span class="p">),</span>
                <span class="n">source_type</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="n">null_linestyle</span><span class="p">,</span>
                <span class="n">legend</span><span class="o">=</span><span class="s2">&quot;null direction&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># quantiles</span>
        <span class="n">plot_quantile</span><span class="p">(</span>
            <span class="n">cv_pd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">),</span>
            <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">cv_pd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">source_type</span><span class="p">),</span>
            <span class="n">cv_pd</span><span class="o">.</span><span class="n">zorder</span><span class="p">(</span><span class="n">source_types</span><span class="p">,</span> <span class="n">source_type</span><span class="p">),</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plot_quantile</span><span class="p">(</span>
            <span class="n">cv_nd</span><span class="p">[</span><span class="n">source_type</span><span class="p">][:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">),</span>
            <span class="n">cv_nd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">cv_pd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">source_type</span><span class="p">),</span>
            <span class="n">cv_pd</span><span class="o">.</span><span class="n">zorder</span><span class="p">(</span><span class="n">source_types</span><span class="p">,</span> <span class="n">source_type</span><span class="p">),</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="n">null_linestyle</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">sum_exc_inh</span> <span class="ow">or</span> <span class="n">only_sum</span><span class="p">:</span>
        <span class="c1"># plot summed traces</span>
        <span class="n">signs</span> <span class="o">=</span> <span class="n">cv_pd</span><span class="o">.</span><span class="n">signs</span><span class="p">()</span>
        <span class="n">exc_pd</span><span class="p">,</span> <span class="n">inh_pd</span><span class="p">,</span> <span class="n">exc_nd</span><span class="p">,</span> <span class="n">inh_nd</span> <span class="o">=</span> <span class="n">get_summed_traces</span><span class="p">(</span>
            <span class="n">signs</span><span class="p">,</span> <span class="n">source_types</span><span class="p">,</span> <span class="n">cv_pd</span><span class="p">,</span> <span class="n">cv_nd</span>
        <span class="p">)</span>
        <span class="n">plot_summed_trace</span><span class="p">(</span>
            <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">exc_pd</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;excitatory&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="mf">0.931</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plot_quantile</span><span class="p">(</span>
            <span class="n">exc_pd</span><span class="p">,</span>
            <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="p">(</span><span class="mf">0.931</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plot_summed_trace</span><span class="p">(</span>
            <span class="n">cv_nd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">exc_nd</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;excitatory&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="mf">0.931</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="n">null_linestyle</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plot_quantile</span><span class="p">(</span>
            <span class="n">exc_nd</span><span class="p">,</span>
            <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="p">(</span><span class="mf">0.931</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="n">null_linestyle</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plot_summed_trace</span><span class="p">(</span>
            <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">inh_pd</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;inhibitory&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.849</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plot_quantile</span><span class="p">(</span>
            <span class="n">inh_pd</span><span class="p">,</span>
            <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.849</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plot_summed_trace</span><span class="p">(</span>
            <span class="n">cv_nd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">inh_nd</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;inhibitory&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.849</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="n">null_linestyle</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plot_quantile</span><span class="p">(</span>
            <span class="n">inh_nd</span><span class="p">,</span>
            <span class="n">cv_pd</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.849</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="n">null_linestyle</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
            <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;time (s)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="c1">#         ax.set_ylabel(&quot;current (a.u.)&quot;, fontsize=fontsize)</span>

    <span class="k">if</span> <span class="n">hide_yaxis</span><span class="p">:</span>
        <span class="n">plt_utils</span><span class="o">.</span><span class="n">rm_spines</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,))</span>

    <span class="k">if</span> <span class="n">trim_axes</span><span class="p">:</span>
        <span class="n">plt_utils</span><span class="o">.</span><span class="n">trim_axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">legend_standalone</span><span class="p">:</span>
        <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
        <span class="n">nd_handle</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;null direction&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">null_linestyle</span>
        <span class="p">)</span>
        <span class="n">legend_n_rows</span> <span class="o">=</span> <span class="n">legend_n_rows</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="c1"># legend_n_cols = (len(labels) + 1) // legend_n_rows</span>
        <span class="n">legend_fig</span><span class="p">,</span> <span class="n">legend_ax</span> <span class="o">=</span> <span class="n">plt_utils</span><span class="o">.</span><span class="n">standalone_legend</span><span class="p">(</span>
            <span class="p">[</span><span class="o">*</span><span class="n">labels</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;null direction&quot;</span><span class="p">],</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="p">[</span><span class="o">*</span><span class="n">handles</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span> <span class="n">nd_handle</span><span class="p">],</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="n">n_cols</span><span class="o">=</span><span class="n">legend_n_cols</span><span class="p">,</span>
            <span class="n">handlelength</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">columnspacing</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
            <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
            <span class="n">figsize</span><span class="o">=</span><span class="n">cm_to_inch</span><span class="p">(</span><span class="n">legend_figsize_cm</span><span class="p">),</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">fig</span> <span class="k">if</span> <span class="n">legend_ax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">legend_ax</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">legend_fig</span><span class="p">,</span> <span class="n">legend_ax</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
    
    <div class="md-footer-meta md-typeset">
        <div class="md-footer-meta__inner md-grid">
            <div class="md-copyright">
    
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
        Material for MkDocs
    </a>
    
    
    <div class="md-copyright__highlight">
        Lappalainen &copy 2024
    </div>
    
</div>
        </div>
    </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "navigation.instant", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.top"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.d6f25eb3.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>