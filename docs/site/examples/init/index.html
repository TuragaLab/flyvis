
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://flyvis.github.io/examples/init/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.38">
    
    
      
        <title>Init - Flyvis</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8c3ca2c6.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#restingpotential" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Flyvis" class="md-header__button md-logo" aria-label="Flyvis" data-md-component="logo">
      
  <img src="../../images/logo_hexagon.jpg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Flyvis
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Init
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Flyvis" class="md-nav__button md-logo" aria-label="Flyvis" data-md-component="logo">
      
  <img src="../../images/logo_hexagon.jpg" alt="logo">

    </a>
    Flyvis
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_flyvision_connectome/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Explore the connectome
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02_flyvision_optic_flow_task/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Train the network
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03_flyvision_flash_responses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flash responses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04_flyvision_moving_edge_responses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Moving edge responses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05_flyvision_umap_and_clustering_models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ensemble clustering
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06_flyvision_maximally_excitatory_stimuli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Maximally excitatory stimuli
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07_flyvision_providing_custom_stimuli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom stimuli
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contribute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/connectome/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    flyvision.connectome
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/network/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    flyvision.network
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/initialization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    flyvision.initialization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/decoder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    flyvision.decoder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/objectives/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    flyvision.objectives
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/tasks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    flyvision.tasks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/solver/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    flyvision.solver
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/network_view/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    flyvision.networkview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/ensemble/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    flyvision.ensemble
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/ensemble_view/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    flyvision.ensembleview
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../acknowledgements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Acknowledgements
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvision.initialization</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Parameter</span><span class="p">,</span>
    <span class="n">deepcopy_config</span><span class="p">,</span>
    <span class="n">RestingPotential</span><span class="p">,</span>
    <span class="n">TimeConstant</span><span class="p">,</span>
    <span class="n">SynapseCount</span><span class="p">,</span>
    <span class="n">SynapseCountScaling</span><span class="p">,</span>
    <span class="n">SynapseSign</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">flyvision.connectome</span> <span class="kn">import</span> <span class="n">ConnectomeDir</span>
<span class="kn">from</span> <span class="nn">datamate</span> <span class="kn">import</span> <span class="n">Namespace</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">torch</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvision</span> <span class="kn">import</span> <span class="n">connectome_file</span>
<span class="kn">from</span> <span class="nn">flyvision.initialization</span> <span class="kn">import</span> <span class="n">symmetry_mask_for_edges</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">cast</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_scatter_indices</span><span class="p">(</span>
    <span class="n">dataframe</span><span class="p">,</span> <span class="n">grouped_dataframe</span><span class="p">,</span> <span class="n">groupby</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the grouped dataframe and the reference indices for shared parameters.</span>

<span class="sd">    Args:</span>
<span class="sd">        dataframe (pd.DataFrame): dataframe of nodes or edges, can also</span>
<span class="sd">                contain synapse counts and signs.</span>
<span class="sd">        groupby (list): list of columns to group the dataframe by.</span>
<span class="sd">        group (method): groupby method, e.g. first, mean, sum.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: first entries per group.</span>
<span class="sd">        tensor: indices for parameter sharing</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ungrouped_elements</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">dataframe</span><span class="p">[</span><span class="n">k</span><span class="p">][:]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">])</span>
    <span class="n">grouped_elements</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">grouped_dataframe</span><span class="p">[</span><span class="n">k</span><span class="p">][:]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">])</span>
    <span class="n">to_index</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">grouped_elements</span><span class="p">)}</span>
    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">to_index</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ungrouped_elements</span><span class="p">])</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">numbers</span> <span class="kn">import</span> <span class="n">Number</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">byte_to_str</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="p">[</span><span class="n">byte_to_str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">obj</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">byte_to_str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">obj</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Number</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">obj</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">compare_param</span><span class="p">(</span><span class="n">param1</span><span class="p">,</span> <span class="n">param2</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;comparing </span><span class="si">{</span><span class="n">param1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">param2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">raw_v</span> <span class="o">=</span> <span class="p">(</span><span class="n">param1</span><span class="o">.</span><span class="n">raw_values</span> <span class="o">==</span> <span class="n">param2</span><span class="o">.</span><span class="n">raw_values</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;raw values </span><span class="si">{</span><span class="n">raw_v</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">param2</span><span class="o">.</span><span class="n">raw_values</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="p">(</span><span class="n">param1</span><span class="o">.</span><span class="n">indices</span> <span class="o">==</span> <span class="n">param2</span><span class="o">.</span><span class="n">indices</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;indices </span><span class="si">{</span><span class="n">ind</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">param2</span><span class="o">.</span><span class="n">indices</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="n">byte_to_str</span><span class="p">(</span><span class="n">param1</span><span class="o">.</span><span class="n">keys</span><span class="p">)</span> <span class="o">==</span> <span class="n">byte_to_str</span><span class="p">(</span><span class="n">param2</span><span class="o">.</span><span class="n">keys</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;keys </span><span class="si">{</span><span class="n">keys</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">param2</span><span class="o">.</span><span class="n">keys</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">masks</span> <span class="o">=</span> <span class="nb">all</span><span class="p">([</span>
        <span class="nb">all</span><span class="p">([</span><span class="n">a</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="n">a</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)])</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">param1</span><span class="o">.</span><span class="n">symmetry_masks</span><span class="p">,</span> <span class="n">param2</span><span class="o">.</span><span class="n">symmetry_masks</span><span class="p">)</span>
    <span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;masks </span><span class="si">{</span><span class="n">masks</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">param2</span><span class="o">.</span><span class="n">symmetry_masks</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">raw_v</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">masks</span><span class="p">]):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;all passed&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvision.initialization</span> <span class="kn">import</span> <span class="n">InitialDistribution</span><span class="p">,</span> <span class="n">symmetry_mask_for_nodes</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">connectome</span> <span class="o">=</span> <span class="n">ConnectomeDir</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">connectome_file</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">n_syn_fill</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">numpy.typing</span> <span class="kn">import</span> <span class="n">NDArray</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;|S64&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>array([[b&#39;-0.9409330618360031&#39;, b&#39;1.0359303347565043&#39;,
        b&#39;0.7579351187895884&#39;, b&#39;1.4303009058439506&#39;],
       [b&#39;1.6960079452744552&#39;, b&#39;0.36587744106980996&#39;,
        b&#39;0.36973241134944446&#39;, b&#39;-0.4087418488265296&#39;],
       [b&#39;0.1919436271958159&#39;, b&#39;-0.7850875645753341&#39;,
        b&#39;-0.6310774064104027&#39;, b&#39;0.5065377202272231&#39;],
       [b&#39;1.1692414813317535&#39;, b&#39;1.041828059256901&#39;,
        b&#39;1.2154525911366734&#39;, b&#39;-1.1017525548382592&#39;]], dtype=&#39;|S64&#39;)
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">atleast_column_vector</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">array</span>


<span class="k">def</span> <span class="nf">matrix_mask_by_sub</span><span class="p">(</span><span class="n">sub_matrix</span><span class="p">,</span> <span class="n">matrix</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mask of rows in matrix that are contained in sub_matrix.</span>

<span class="sd">    Args:</span>
<span class="sd">        sub_matrix (array): shape (#rows1, #columns)</span>
<span class="sd">        matrix (array): shape (#rows2, #columns)</span>

<span class="sd">    Returns:</span>
<span class="sd">        array: 1D boolean array of length #rows2</span>

<span class="sd">    Note: #rows1 !&lt;= #rows2</span>

<span class="sd">    Example:</span>
<span class="sd">        sub_matrix = np.array([[1, 2, 3],</span>
<span class="sd">                                [4, 3, 1]])</span>
<span class="sd">        matrix = np.array([[3, 4, 1],</span>
<span class="sd">                            [4, 3, 1],</span>
<span class="sd">                            [1, 2, 3]])</span>
<span class="sd">        matrix_mask_by_sub(sub_matrix, matrix)</span>
<span class="sd">        array([False, True, True])</span>

<span class="sd">    Typically, indexing a tensor with indices instead of booleans is</span>
<span class="sd">    faster. Therefore, see also where_equal_rows.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">reduce</span>

    <span class="n">n_rows</span><span class="p">,</span> <span class="n">n_columns</span> <span class="o">=</span> <span class="n">sub_matrix</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">n_rows2</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">n_rows</span> <span class="o">&lt;=</span> <span class="n">n_rows2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span>
    <span class="n">row_mask</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">):</span>
        <span class="n">column_mask</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_columns</span><span class="p">):</span>
            <span class="n">column_mask</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">matrix</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span>
        <span class="n">row_mask</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reduce</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">,</span> <span class="n">column_mask</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">,</span> <span class="n">row_mask</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">where_equal_rows</span><span class="p">(</span><span class="n">matrix1</span><span class="p">,</span> <span class="n">matrix2</span><span class="p">,</span> <span class="n">as_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">astype</span><span class="o">=</span><span class="s1">&#39;|S64&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Indices where matrix1 rows are in matrix2.</span>

<span class="sd">    Example:</span>
<span class="sd">        matrix1 = np.array([[1, 2, 3],</span>
<span class="sd">                            [4, 3, 1]])</span>
<span class="sd">        matrix2 = np.array([[3, 4, 1],</span>
<span class="sd">                            [4, 3, 1],</span>
<span class="sd">                            [1, 2, 3],</span>
<span class="sd">                            [0, 0, 0]])</span>
<span class="sd">        where_equal_rows(matrix1, matrix2)</span>
<span class="sd">        array([2, 1])</span>
<span class="sd">        matrix2[where_equal_rows(matrix1, matrix2)]</span>
<span class="sd">        array([[1, 2, 3],</span>
<span class="sd">               [4, 3, 1]])</span>

<span class="sd">    See also: matrix_mask_by_sub.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">matrix1</span> <span class="o">=</span> <span class="n">atleast_column_vector</span><span class="p">(</span><span class="n">matrix1</span><span class="p">)</span>
    <span class="n">matrix2</span> <span class="o">=</span> <span class="n">atleast_column_vector</span><span class="p">(</span><span class="n">matrix2</span><span class="p">)</span>
    <span class="n">matrix1</span> <span class="o">=</span> <span class="n">matrix1</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">astype</span><span class="p">)</span>
    <span class="n">matrix2</span> <span class="o">=</span> <span class="n">matrix2</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">astype</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">as_mask</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">matrix_mask_by_sub</span><span class="p">(</span><span class="n">matrix1</span><span class="p">,</span> <span class="n">matrix2</span><span class="p">)</span>

    <span class="n">n_rows1</span><span class="p">,</span> <span class="n">n_cols1</span> <span class="o">=</span> <span class="n">matrix1</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">n_rows2</span><span class="p">,</span> <span class="n">n_cols2</span> <span class="o">=</span> <span class="n">matrix2</span><span class="o">.</span><span class="n">shape</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">n_rows1</span> <span class="o">&lt;=</span> <span class="n">n_rows2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;matrix1 must have less or&quot;</span> <span class="s2">&quot; equal as many rows as matrix2&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">n_cols1</span> <span class="o">==</span> <span class="n">n_cols2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cannot compare matrices with different number of columns&quot;</span><span class="p">)</span>

    <span class="n">where</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">matrix2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">matrix1</span><span class="p">:</span>
        <span class="n">equal_rows</span> <span class="o">=</span> <span class="p">(</span><span class="n">row</span> <span class="o">==</span> <span class="n">matrix2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">[</span><span class="n">equal_rows</span><span class="p">]:</span>
            <span class="n">where</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">where</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">symmetry_masks</span><span class="p">(</span><span class="n">symmetric</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">as_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;One additional way to constrain network elements to have the same</span>
<span class="sd">    parameter values.</span>

<span class="sd">    Note, this method stores one mask per shared tuple of the size of the</span>
<span class="sd">    parameter and should thus be used sparsely because its not very memory</span>
<span class="sd">    friendly. The bulk part of parameter sharing is achieved through scatter</span>
<span class="sd">    and gather operations.</span>

<span class="sd">    Args:</span>
<span class="sd">        symmetric: list of tuples of cell types that share parameters.</span>
<span class="sd">        nodes: DataFrame containing &#39;cell_type&#39; column.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list of masks List[torch.BoolTensor]</span>

<span class="sd">    Example:</span>
<span class="sd">        symmetric = [[&quot;T4a&quot;, &quot;T4b&quot;, &quot;T4c&quot;, &quot;T4d&quot;], [&quot;T5a&quot;, &quot;T5b&quot;, &quot;T5c&quot;, &quot;T5d&quot;]]</span>
<span class="sd">        would return two masks, one to constrain all T4 subtypes to the same</span>
<span class="sd">        parameter and another to constrain all T5 subtypes to the same parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">symmetric</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">symmetry_masks</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[torch.Tensor]</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="n">atleast_column_vector</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">identifiers</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">symmetric</span><span class="p">):</span>
        <span class="n">identifiers</span> <span class="o">=</span> <span class="n">atleast_column_vector</span><span class="p">(</span><span class="n">identifiers</span><span class="p">)</span>
        <span class="c1"># to allow identifiers like [None, &quot;A&quot;, None, 0]</span>
        <span class="c1"># for parameters that have multi-keys</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">identifiers</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">identifiers</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">symmetry_masks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
                    <span class="n">where_equal_rows</span><span class="p">(</span><span class="n">identifiers</span><span class="p">[:,</span> <span class="n">columns</span><span class="p">],</span>
                                     <span class="n">keys</span><span class="p">[:,</span> <span class="n">columns</span><span class="p">],</span> <span class="n">as_mask</span><span class="o">=</span><span class="n">as_mask</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">identifiers</span><span class="si">}</span><span class="s2"> cannot be a symmetry constraint&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; for parameter with keys </span><span class="si">{</span><span class="n">keys</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
    <span class="k">return</span> <span class="n">symmetry_masks</span>
</code></pre></div>
<h1 id="restingpotential">RestingPotential<a class="headerlink" href="#restingpotential" title="Permanent link">&para;</a></h1>
<div class="highlight"><pre><span></span><code><span class="n">config</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;RestingPotential&quot;</span><span class="p">,</span>
                <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
                <span class="n">initial_dist</span><span class="o">=</span><span class="s2">&quot;Normal&quot;</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span>
                <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">mean</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">std</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
                <span class="n">penalize</span><span class="o">=</span><span class="n">Namespace</span><span class="p">(</span><span class="n">activity</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">symmetric</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;T4a&quot;</span><span class="p">,</span> <span class="s2">&quot;T4b&quot;</span><span class="p">,</span> <span class="s2">&quot;T4c&quot;</span><span class="p">,</span> <span class="s2">&quot;T4d&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;T5a&quot;</span><span class="p">,</span> <span class="s2">&quot;T5b&quot;</span><span class="p">,</span> <span class="s2">&quot;T5c&quot;</span><span class="p">,</span> <span class="s2">&quot;T5d&quot;</span><span class="p">]]</span>
            <span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvision.initialization</span> <span class="kn">import</span> <span class="n">Parameter</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">RestingPotentialv2</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize resting potentials a.k.a. biases for cell types.&quot;&quot;&quot;</span>

    <span class="nd">@deepcopy_config</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_config</span><span class="p">:</span> <span class="n">Namespace</span><span class="p">,</span> <span class="n">connectome</span><span class="p">:</span> <span class="n">ConnectomeDir</span><span class="p">):</span>
        <span class="n">nodes_dir</span> <span class="o">=</span> <span class="n">connectome</span><span class="o">.</span><span class="n">nodes</span>

        <span class="n">nodes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">byte_to_str</span><span class="p">(</span><span class="n">nodes_dir</span><span class="p">[</span><span class="n">k</span><span class="p">][:])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">param_config</span><span class="o">.</span><span class="n">groupby</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="n">grouped_nodes</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
            <span class="n">param_config</span><span class="o">.</span><span class="n">groupby</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

        <span class="n">param_config</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grouped_nodes</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">param_config</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">param_config</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">grouped_nodes</span><span class="p">))</span>
        <span class="n">param_config</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">param_config</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">grouped_nodes</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parameter</span> <span class="o">=</span> <span class="n">InitialDistribution</span><span class="p">(</span><span class="n">param_config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indices</span> <span class="o">=</span> <span class="n">get_scatter_indices</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">grouped_nodes</span><span class="p">,</span> <span class="n">param_config</span><span class="o">.</span><span class="n">groupby</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="o">=</span> <span class="n">param_config</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symmetry_masks</span> <span class="o">=</span> <span class="n">symmetry_masks</span><span class="p">(</span>
            <span class="n">param_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;symmetric&quot;</span><span class="p">,</span> <span class="p">[]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span>
        <span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">param</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">connectome</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">keys</span><span class="p">)[</span><span class="n">param</span><span class="o">.</span><span class="n">symmetry_masks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()]</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>array([&#39;T4a&#39;, &#39;T4b&#39;, &#39;T4c&#39;, &#39;T4d&#39;], dtype=&#39;&lt;U8&#39;)
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">config2</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;RestingPotentialv2&quot;</span><span class="p">,</span>
                <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
                <span class="n">initial_dist</span><span class="o">=</span><span class="s2">&quot;Normal&quot;</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span>
                <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">mean</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">std</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
                <span class="n">penalize</span><span class="o">=</span><span class="n">Namespace</span><span class="p">(</span><span class="n">activity</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">symmetric</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;T4a&quot;</span><span class="p">,</span> <span class="s2">&quot;T4b&quot;</span><span class="p">,</span> <span class="s2">&quot;T4c&quot;</span><span class="p">,</span> <span class="s2">&quot;T4d&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;T5a&quot;</span><span class="p">,</span> <span class="s2">&quot;T5b&quot;</span><span class="p">,</span> <span class="s2">&quot;T5c&quot;</span><span class="p">,</span> <span class="s2">&quot;T5d&quot;</span><span class="p">]]</span>
            <span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">nodes</span> <span class="o">=</span> <span class="n">connectome</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">to_df</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">param2</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">config2</span><span class="p">,</span> <span class="n">connectome</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">param</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>&#39;R1&#39;
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">param2</span><span class="o">.</span><span class="n">symmetry_masks</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[tensor([35, 36, 37, 38]), tensor([39, 40, 41, 42])]
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">compare_param</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">param2</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>comparing RestingPotential(Namespace(
  type = &#39;RestingPotential&#39;,
  groupby = [&#39;type&#39;],
  initial_dist = &#39;Normal&#39;,
  mode = &#39;sample&#39;,
  requires_grad = True,
  mean = 0.5,
  std = 0.05,
  penalize = Namespace(activity=True),
  seed = 0,
  symmetric = [[&#39;T4a&#39;, &#39;T4b&#39;, &#39;T4c&#39;, &#39;T4d&#39;], [&#39;T5a&#39;, &#39;T5b&#39;, &#39;T5c&#39;, &#39;T5d&#39;]]
), ConnectomeDir), RestingPotentialv2(Namespace(
  type = &#39;RestingPotentialv2&#39;,
  groupby = [&#39;type&#39;],
  initial_dist = &#39;Normal&#39;,
  mode = &#39;sample&#39;,
  requires_grad = True,
  mean = 0.5,
  std = 0.05,
  penalize = Namespace(activity=True),
  seed = 0,
  symmetric = [[&#39;T4a&#39;, &#39;T4b&#39;, &#39;T4c&#39;, &#39;T4d&#39;], [&#39;T5a&#39;, &#39;T5b&#39;, &#39;T5c&#39;, &#39;T5d&#39;]]
), ConnectomeDir)
raw values True, torch.Size([65])
indices True, tensor([ 0,  0,  0,  ..., 64, 64, 64])
keys True, (65,)
masks True, 2
all passed





True
</code></pre></div>

<h1 id="time-constants">Time constants<a class="headerlink" href="#time-constants" title="Permanent link">&para;</a></h1>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvision.initialization</span> <span class="kn">import</span> <span class="n">Parameter</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">TimeConstantv2</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize time constants for cell types.&quot;&quot;&quot;</span>

    <span class="nd">@deepcopy_config</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_config</span><span class="p">:</span> <span class="n">Namespace</span><span class="p">,</span> <span class="n">connectome</span><span class="p">:</span> <span class="n">ConnectomeDir</span><span class="p">):</span>
        <span class="n">nodes_dir</span> <span class="o">=</span> <span class="n">connectome</span><span class="o">.</span><span class="n">nodes</span>

        <span class="n">nodes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">byte_to_str</span><span class="p">(</span><span class="n">nodes_dir</span><span class="p">[</span><span class="n">k</span><span class="p">][:])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">param_config</span><span class="o">.</span><span class="n">groupby</span><span class="p">})</span>
        <span class="n">grouped_nodes</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">param_config</span><span class="o">.</span><span class="n">groupby</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

        <span class="n">param_config</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grouped_nodes</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">param_config</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">param_config</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">grouped_nodes</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">indices</span> <span class="o">=</span> <span class="n">get_scatter_indices</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">grouped_nodes</span><span class="p">,</span> <span class="n">param_config</span><span class="o">.</span><span class="n">groupby</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter</span> <span class="o">=</span> <span class="n">InitialDistribution</span><span class="p">(</span><span class="n">param_config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="o">=</span> <span class="n">param_config</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symmetry_masks</span> <span class="o">=</span> <span class="n">symmetry_masks</span><span class="p">(</span>
            <span class="n">param_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;symmetric&quot;</span><span class="p">,</span> <span class="p">[]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span>
        <span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">config1</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;TimeConstant&quot;</span><span class="p">,</span>
                <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
                <span class="n">initial_dist</span><span class="o">=</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
                <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">symmetric</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;T4a&quot;</span><span class="p">,</span> <span class="s2">&quot;T4b&quot;</span><span class="p">,</span> <span class="s2">&quot;T4c&quot;</span><span class="p">,</span> <span class="s2">&quot;T4d&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;T5a&quot;</span><span class="p">,</span> <span class="s2">&quot;T5b&quot;</span><span class="p">,</span> <span class="s2">&quot;T5c&quot;</span><span class="p">,</span> <span class="s2">&quot;T5d&quot;</span><span class="p">]]</span>

            <span class="p">)</span>

<span class="n">config2</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;TimeConstantv2&quot;</span><span class="p">,</span>
                <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
                <span class="n">initial_dist</span><span class="o">=</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
                <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">symmetric</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;T4a&quot;</span><span class="p">,</span> <span class="s2">&quot;T4b&quot;</span><span class="p">,</span> <span class="s2">&quot;T4c&quot;</span><span class="p">,</span> <span class="s2">&quot;T4d&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;T5a&quot;</span><span class="p">,</span> <span class="s2">&quot;T5b&quot;</span><span class="p">,</span> <span class="s2">&quot;T5c&quot;</span><span class="p">,</span> <span class="s2">&quot;T5d&quot;</span><span class="p">]]</span>

            <span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">param</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">config1</span><span class="p">,</span> <span class="n">connectome</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">param2</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">config2</span><span class="p">,</span> <span class="n">connectome</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">param2</span><span class="o">.</span><span class="n">symmetry_masks</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[tensor([35, 36, 37, 38]), tensor([39, 40, 41, 42])]
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">compare_param</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">param2</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>comparing TimeConstant(Namespace(
  type = &#39;TimeConstant&#39;,
  groupby = [&#39;type&#39;],
  initial_dist = &#39;Value&#39;,
  value = 0.05,
  requires_grad = True,
  symmetric = [[&#39;T4a&#39;, &#39;T4b&#39;, &#39;T4c&#39;, &#39;T4d&#39;], [&#39;T5a&#39;, &#39;T5b&#39;, &#39;T5c&#39;, &#39;T5d&#39;]]
), ConnectomeDir), TimeConstantv2(Namespace(
  type = &#39;TimeConstantv2&#39;,
  groupby = [&#39;type&#39;],
  initial_dist = &#39;Value&#39;,
  value = 0.05,
  requires_grad = True,
  symmetric = [[&#39;T4a&#39;, &#39;T4b&#39;, &#39;T4c&#39;, &#39;T4d&#39;], [&#39;T5a&#39;, &#39;T5b&#39;, &#39;T5c&#39;, &#39;T5d&#39;]]
), ConnectomeDir)
raw values True, torch.Size([65])
indices True, tensor([ 0,  0,  0,  ..., 64, 64, 64])
keys True, (65,)
masks True, 2
all passed





True
</code></pre></div>

<h1 id="synapsesign">SynapseSign<a class="headerlink" href="#synapsesign" title="Permanent link">&para;</a></h1>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">SynapseSignv2</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize synapse signs for edge types.&quot;&quot;&quot;</span>

    <span class="nd">@deepcopy_config</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_config</span><span class="p">:</span> <span class="n">Namespace</span><span class="p">,</span> <span class="n">connectome</span><span class="p">:</span> <span class="n">ConnectomeDir</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">edges_dir</span> <span class="o">=</span> <span class="n">connectome</span><span class="o">.</span><span class="n">edges</span>

        <span class="n">edges</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">byte_to_str</span><span class="p">(</span><span class="n">edges_dir</span><span class="p">[</span><span class="n">k</span><span class="p">][:])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="n">param_config</span><span class="o">.</span><span class="n">groupby</span><span class="p">,</span> <span class="s2">&quot;sign&quot;</span><span class="p">]}</span>
        <span class="p">)</span>
        <span class="n">grouped_edges</span> <span class="o">=</span> <span class="n">edges</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">param_config</span><span class="o">.</span><span class="n">groupby</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

        <span class="n">param_config</span><span class="o">.</span><span class="n">source_type</span> <span class="o">=</span> <span class="n">grouped_edges</span><span class="o">.</span><span class="n">source_type</span><span class="o">.</span><span class="n">values</span>
        <span class="n">param_config</span><span class="o">.</span><span class="n">target_type</span> <span class="o">=</span> <span class="n">grouped_edges</span><span class="o">.</span><span class="n">target_type</span><span class="o">.</span><span class="n">values</span>
        <span class="n">param_config</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">grouped_edges</span><span class="o">.</span><span class="n">sign</span><span class="o">.</span><span class="n">values</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">indices</span> <span class="o">=</span> <span class="n">get_scatter_indices</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">grouped_edges</span><span class="p">,</span> <span class="n">param_config</span><span class="o">.</span><span class="n">groupby</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter</span> <span class="o">=</span> <span class="n">InitialDistribution</span><span class="p">(</span><span class="n">param_config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span>
                <span class="n">param_config</span><span class="o">.</span><span class="n">source_type</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="n">param_config</span><span class="o">.</span><span class="n">target_type</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symmetry_masks</span> <span class="o">=</span> <span class="n">symmetry_masks</span><span class="p">(</span>
            <span class="n">param_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;symmetric&quot;</span><span class="p">,</span> <span class="p">[]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span>
        <span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">config</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;SynapseSign&quot;</span><span class="p">,</span>
    <span class="n">initial_dist</span><span class="o">=</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span>
    <span class="n">requires_grad</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;source_type&quot;</span><span class="p">,</span> <span class="s2">&quot;target_type&quot;</span><span class="p">],</span>
    <span class="n">attributes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sign&quot;</span><span class="p">],</span>
    <span class="n">symmetric</span><span class="o">=</span><span class="p">[[(</span><span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="s2">&quot;L1&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;R4&quot;</span><span class="p">,</span> <span class="s2">&quot;L1&quot;</span><span class="p">)]],</span>
<span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">param</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">connectome</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">param</span><span class="o">.</span><span class="n">symmetry_masks</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[]
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">config2</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;SynapseSignv2&quot;</span><span class="p">,</span>
                <span class="n">initial_dist</span><span class="o">=</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span>
                <span class="n">requires_grad</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;source_type&quot;</span><span class="p">,</span> <span class="s2">&quot;target_type&quot;</span><span class="p">],</span>
                <span class="n">attributes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sign&quot;</span><span class="p">],</span>
    <span class="n">symmetric</span><span class="o">=</span><span class="p">[[(</span><span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="s2">&quot;L1&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;R4&quot;</span><span class="p">,</span> <span class="s2">&quot;L1&quot;</span><span class="p">)],</span>
              <span class="p">[(</span><span class="s2">&quot;Mi9&quot;</span><span class="p">,</span> <span class="s2">&quot;T4a&quot;</span><span class="p">),</span>
              <span class="p">(</span><span class="s2">&quot;Mi9&quot;</span><span class="p">,</span> <span class="s2">&quot;T4b&quot;</span><span class="p">)]],</span>
            <span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">param2</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">config2</span><span class="p">,</span> <span class="n">connectome</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">compare_param</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">param2</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>comparing SynapseSign(Namespace(
  type = &#39;SynapseSign&#39;,
  initial_dist = &#39;Value&#39;,
  requires_grad = False,
  groupby = [&#39;source_type&#39;, &#39;target_type&#39;],
  attributes = [&#39;sign&#39;],
  symmetric = [[(&#39;R1&#39;, &#39;L1&#39;), (&#39;R4&#39;, &#39;L1&#39;)]]
), ConnectomeDir), SynapseSignv2(Namespace(
  type = &#39;SynapseSignv2&#39;,
  initial_dist = &#39;Value&#39;,
  requires_grad = False,
  groupby = [&#39;source_type&#39;, &#39;target_type&#39;],
  attributes = [&#39;sign&#39;],
  symmetric = [[(&#39;R1&#39;, &#39;L1&#39;), (&#39;R4&#39;, &#39;L1&#39;)], [(&#39;Mi9&#39;, &#39;T4a&#39;), (&#39;Mi9&#39;, &#39;T4b&#39;)]]
), ConnectomeDir)
raw values True, torch.Size([604])
indices True, tensor([  0,   0,   0,  ..., 603, 603, 603])
keys True, (604, 2)
masks True, 2
all passed





True
</code></pre></div>

<h1 id="synapsecount">SynapseCount<a class="headerlink" href="#synapsecount" title="Permanent link">&para;</a></h1>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">SynapseCountv2</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize synapse counts for edge types.&quot;&quot;&quot;</span>

    <span class="nd">@deepcopy_config</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_config</span><span class="p">:</span> <span class="n">Namespace</span><span class="p">,</span> <span class="n">connectome</span><span class="p">:</span> <span class="n">ConnectomeDir</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">param_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">!=</span> <span class="s2">&quot;mean&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;SynapseCount does not implement </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">. Implement &quot;</span>
                <span class="s2">&quot;a custom Parameter subclass.&quot;</span>
            <span class="p">)</span>

        <span class="n">edges_dir</span> <span class="o">=</span> <span class="n">connectome</span><span class="o">.</span><span class="n">edges</span>

        <span class="n">edges</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">byte_to_str</span><span class="p">(</span><span class="n">edges_dir</span><span class="p">[</span><span class="n">k</span><span class="p">][:])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="n">param_config</span><span class="o">.</span><span class="n">groupby</span><span class="p">,</span> <span class="s2">&quot;n_syn&quot;</span><span class="p">]}</span>
        <span class="p">)</span>
        <span class="n">grouped_edges</span> <span class="o">=</span> <span class="n">edges</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
            <span class="n">param_config</span><span class="o">.</span><span class="n">groupby</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="n">param_config</span><span class="o">.</span><span class="n">source_type</span> <span class="o">=</span> <span class="n">grouped_edges</span><span class="o">.</span><span class="n">source_type</span><span class="o">.</span><span class="n">values</span>
        <span class="n">param_config</span><span class="o">.</span><span class="n">target_type</span> <span class="o">=</span> <span class="n">grouped_edges</span><span class="o">.</span><span class="n">target_type</span><span class="o">.</span><span class="n">values</span>
        <span class="n">param_config</span><span class="o">.</span><span class="n">du</span> <span class="o">=</span> <span class="n">grouped_edges</span><span class="o">.</span><span class="n">du</span><span class="o">.</span><span class="n">values</span>
        <span class="n">param_config</span><span class="o">.</span><span class="n">dv</span> <span class="o">=</span> <span class="n">grouped_edges</span><span class="o">.</span><span class="n">dv</span><span class="o">.</span><span class="n">values</span>

        <span class="n">param_config</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;mean&quot;</span>
        <span class="n">param_config</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">grouped_edges</span><span class="o">.</span><span class="n">n_syn</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">indices</span> <span class="o">=</span> <span class="n">get_scatter_indices</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">grouped_edges</span><span class="p">,</span> <span class="n">param_config</span><span class="o">.</span><span class="n">groupby</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter</span> <span class="o">=</span> <span class="n">InitialDistribution</span><span class="p">(</span><span class="n">param_config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span>
                <span class="n">param_config</span><span class="o">.</span><span class="n">source_type</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="n">param_config</span><span class="o">.</span><span class="n">target_type</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="n">param_config</span><span class="o">.</span><span class="n">du</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="n">param_config</span><span class="o">.</span><span class="n">dv</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symmetry_masks</span> <span class="o">=</span> <span class="n">symmetry_masks</span><span class="p">(</span>
            <span class="n">param_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;symmetric&quot;</span><span class="p">,</span> <span class="p">[]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">symmetry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">mask</span><span class="o">.</span><span class="n">cpu</span><span class="p">()]</span> <span class="k">for</span> <span class="n">mask</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetry_masks</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">config</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;SynapseCount&quot;</span><span class="p">,</span>
                <span class="n">initial_dist</span><span class="o">=</span><span class="s2">&quot;Lognormal&quot;</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
                <span class="n">requires_grad</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">std</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;source_type&quot;</span><span class="p">,</span> <span class="s2">&quot;target_type&quot;</span><span class="p">,</span> <span class="s2">&quot;dv&quot;</span><span class="p">,</span> <span class="s2">&quot;du&quot;</span><span class="p">],</span>
<span class="c1">#         symmetric=[[(&quot;R1&quot;, &quot;L1&quot;),</span>
<span class="c1">#                 (&quot;R4&quot;, &quot;L1&quot;)],</span>
<span class="c1">#               [(&quot;Mi9&quot;, &quot;T4a&quot;),</span>
<span class="c1">#               (&quot;Mi9&quot;, &quot;T4b&quot;)]],</span>
            <span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">param</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">connectome</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">config2</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;SynapseCountv2&quot;</span><span class="p">,</span>
    <span class="n">initial_dist</span><span class="o">=</span><span class="s2">&quot;Lognormal&quot;</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
    <span class="n">requires_grad</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">std</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;source_type&quot;</span><span class="p">,</span> <span class="s2">&quot;target_type&quot;</span><span class="p">,</span> <span class="s2">&quot;du&quot;</span><span class="p">,</span> <span class="s2">&quot;dv&quot;</span><span class="p">],</span>
    <span class="n">attributes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;n_syn&quot;</span><span class="p">],</span>
<span class="c1">#     symmetric=[[(&quot;R1&quot;, &quot;L1&quot;),</span>
<span class="c1">#                 (&quot;R4&quot;, &quot;L1&quot;)],</span>
<span class="c1">#               [(&quot;Mi9&quot;, &quot;T4a&quot;),</span>
<span class="c1">#               (&quot;Mi9&quot;, &quot;T4b&quot;)], </span>
<span class="c1">#               [(None, None, 0, 0),</span>
<span class="c1">#               (None, None, 0, 0)]],</span>
<span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">config2</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;SynapseCountv2&quot;</span><span class="p">,</span>
    <span class="n">initial_dist</span><span class="o">=</span><span class="s2">&quot;Lognormal&quot;</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
    <span class="n">requires_grad</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">std</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;source_type&quot;</span><span class="p">,</span> <span class="s2">&quot;target_type&quot;</span><span class="p">,</span> <span class="s2">&quot;dv&quot;</span><span class="p">,</span> <span class="s2">&quot;du&quot;</span><span class="p">],</span>
    <span class="n">attributes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;n_syn&quot;</span><span class="p">],</span>
    <span class="n">symmetric</span><span class="o">=</span><span class="p">[</span>
        <span class="p">[(</span><span class="s2">&quot;R2&quot;</span><span class="p">,),</span> <span class="p">(</span><span class="s2">&quot;R3&quot;</span><span class="p">,)],</span>
        <span class="p">[(</span><span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="s2">&quot;L1&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;R4&quot;</span><span class="p">,</span> <span class="s2">&quot;L1&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
        <span class="p">[(</span><span class="s2">&quot;Mi9&quot;</span><span class="p">,</span> <span class="s2">&quot;T4a&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Mi9&quot;</span><span class="p">,</span> <span class="s2">&quot;T4b&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
        <span class="p">[(</span><span class="s2">&quot;Mi9&quot;</span><span class="p">,</span> <span class="s2">&quot;T4a&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Mi9&quot;</span><span class="p">,</span> <span class="s2">&quot;T4b&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
    <span class="p">],</span>
<span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">param2</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">config2</span><span class="p">,</span> <span class="n">connectome</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">compare_param</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">param2</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>comparing SynapseCount(Namespace(
  type = &#39;SynapseCount&#39;,
  initial_dist = &#39;Lognormal&#39;,
  mode = &#39;mean&#39;,
  requires_grad = False,
  std = 1.0,
  groupby = [&#39;source_type&#39;, &#39;target_type&#39;, &#39;dv&#39;, &#39;du&#39;]
), ConnectomeDir), SynapseCountv2(Namespace(
  type = &#39;SynapseCountv2&#39;,
  initial_dist = &#39;Lognormal&#39;,
  mode = &#39;mean&#39;,
  requires_grad = False,
  std = 1.0,
  groupby = [&#39;source_type&#39;, &#39;target_type&#39;, &#39;du&#39;, &#39;dv&#39;],
  attributes = [&#39;n_syn&#39;]
), ConnectomeDir)
raw values True, torch.Size([2355])
indices True, tensor([   0,    0,    0,  ..., 2354, 2354, 2354])
keys True, (2355, 4)
masks True, 0
all passed





True
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">param2</span><span class="o">.</span><span class="n">symmetry</span><span class="p">()</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[array([[&#39;R1&#39;, &#39;L1&#39;, &#39;0&#39;, &#39;0&#39;],
        [&#39;R4&#39;, &#39;L1&#39;, &#39;0&#39;, &#39;0&#39;]], dtype=&#39;&lt;U21&#39;),
 array([[&#39;Mi9&#39;, &#39;T4a&#39;, &#39;-1&#39;, &#39;0&#39;],
        [&#39;Mi9&#39;, &#39;T4a&#39;, &#39;0&#39;, &#39;1&#39;],
        [&#39;Mi9&#39;, &#39;T4a&#39;, &#39;-1&#39;, &#39;1&#39;],
        [&#39;Mi9&#39;, &#39;T4a&#39;, &#39;-1&#39;, &#39;-1&#39;],
        [&#39;Mi9&#39;, &#39;T4a&#39;, &#39;0&#39;, &#39;-1&#39;],
        [&#39;Mi9&#39;, &#39;T4a&#39;, &#39;0&#39;, &#39;-2&#39;],
        [&#39;Mi9&#39;, &#39;T4a&#39;, &#39;1&#39;, &#39;-2&#39;],
        [&#39;Mi9&#39;, &#39;T4a&#39;, &#39;1&#39;, &#39;-1&#39;],
        [&#39;Mi9&#39;, &#39;T4a&#39;, &#39;0&#39;, &#39;0&#39;],
        [&#39;Mi9&#39;, &#39;T4a&#39;, &#39;2&#39;, &#39;2&#39;],
        [&#39;Mi9&#39;, &#39;T4a&#39;, &#39;-4&#39;, &#39;0&#39;],
        [&#39;Mi9&#39;, &#39;T4a&#39;, &#39;-3&#39;, &#39;0&#39;],
        [&#39;Mi9&#39;, &#39;T4a&#39;, &#39;-2&#39;, &#39;-1&#39;],
        [&#39;Mi9&#39;, &#39;T4a&#39;, &#39;-2&#39;, &#39;0&#39;],
        [&#39;Mi9&#39;, &#39;T4a&#39;, &#39;1&#39;, &#39;0&#39;],
        [&#39;Mi9&#39;, &#39;T4a&#39;, &#39;1&#39;, &#39;1&#39;],
        [&#39;Mi9&#39;, &#39;T4b&#39;, &#39;0&#39;, &#39;1&#39;],
        [&#39;Mi9&#39;, &#39;T4b&#39;, &#39;-1&#39;, &#39;1&#39;],
        [&#39;Mi9&#39;, &#39;T4b&#39;, &#39;-1&#39;, &#39;2&#39;],
        [&#39;Mi9&#39;, &#39;T4b&#39;, &#39;0&#39;, &#39;-1&#39;],
        [&#39;Mi9&#39;, &#39;T4b&#39;, &#39;0&#39;, &#39;0&#39;]], dtype=&#39;&lt;U21&#39;),
 array([[&#39;R1&#39;, &#39;L1&#39;, &#39;0&#39;, &#39;0&#39;],
        [&#39;R1&#39;, &#39;L2&#39;, &#39;0&#39;, &#39;0&#39;],
        [&#39;R1&#39;, &#39;L3&#39;, &#39;0&#39;, &#39;0&#39;],
        ...,
        [&#39;TmY18&#39;, &#39;TmY5a&#39;, &#39;0&#39;, &#39;0&#39;],
        [&#39;TmY18&#39;, &#39;TmY15&#39;, &#39;0&#39;, &#39;0&#39;],
        [&#39;TmY18&#39;, &#39;TmY18&#39;, &#39;0&#39;, &#39;0&#39;]], dtype=&#39;&lt;U21&#39;)]
</code></pre></div>

<h1 id="synapsecountscaling">SynapseCountScaling<a class="headerlink" href="#synapsecountscaling" title="Permanent link">&para;</a></h1>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">SynapseCountScalingv2</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize synapse count scaling for edge types.&quot;&quot;&quot;</span>

    <span class="nd">@deepcopy_config</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_config</span><span class="p">:</span> <span class="n">Namespace</span><span class="p">,</span> <span class="n">connectome</span><span class="p">:</span> <span class="n">ConnectomeDir</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">edges_dir</span> <span class="o">=</span> <span class="n">connectome</span><span class="o">.</span><span class="n">edges</span>

        <span class="n">edges</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="n">k</span><span class="p">:</span> <span class="n">byte_to_str</span><span class="p">(</span><span class="n">edges_dir</span><span class="p">[</span><span class="n">k</span><span class="p">][:])</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="n">param_config</span><span class="o">.</span><span class="n">groupby</span><span class="p">,</span> <span class="s2">&quot;n_syn&quot;</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">grouped_edges</span> <span class="o">=</span> <span class="n">edges</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
            <span class="n">param_config</span><span class="o">.</span><span class="n">groupby</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="c1"># to initialize synapse strengths with 1/&lt;N&gt;_rf</span>
        <span class="n">syn_strength</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">grouped_edges</span><span class="o">.</span><span class="n">n_syn</span><span class="o">.</span><span class="n">values</span>  <span class="c1"># 1/&lt;N&gt;_rf</span>

        <span class="c1"># scale synapse strengths of chemical and electrical synapses</span>
        <span class="c1"># individually</span>
        <span class="n">syn_strength</span><span class="p">[</span><span class="n">grouped_edges</span><span class="p">[</span><span class="n">grouped_edges</span><span class="o">.</span><span class="n">edge_type</span> <span class="o">==</span> <span class="s2">&quot;chem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">*=</span> <span class="nb">getattr</span><span class="p">(</span>
            <span class="n">param_config</span><span class="p">,</span> <span class="s2">&quot;scale_chem&quot;</span><span class="p">,</span> <span class="mf">0.01</span>
        <span class="p">)</span>
        <span class="n">syn_strength</span><span class="p">[</span><span class="n">grouped_edges</span><span class="p">[</span><span class="n">grouped_edges</span><span class="o">.</span><span class="n">edge_type</span> <span class="o">==</span> <span class="s2">&quot;elec&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">*=</span> <span class="nb">getattr</span><span class="p">(</span>
            <span class="n">param_config</span><span class="p">,</span> <span class="s2">&quot;scale_elec&quot;</span><span class="p">,</span> <span class="mf">0.01</span>
        <span class="p">)</span>

        <span class="n">param_config</span><span class="o">.</span><span class="n">target_type</span> <span class="o">=</span> <span class="n">grouped_edges</span><span class="o">.</span><span class="n">target_type</span><span class="o">.</span><span class="n">values</span>
        <span class="n">param_config</span><span class="o">.</span><span class="n">source_type</span> <span class="o">=</span> <span class="n">grouped_edges</span><span class="o">.</span><span class="n">source_type</span><span class="o">.</span><span class="n">values</span>
        <span class="n">param_config</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">syn_strength</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">indices</span> <span class="o">=</span> <span class="n">get_scatter_indices</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">grouped_edges</span><span class="p">,</span> <span class="n">param_config</span><span class="o">.</span><span class="n">groupby</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter</span> <span class="o">=</span> <span class="n">InitialDistribution</span><span class="p">(</span><span class="n">param_config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span>
                <span class="n">param_config</span><span class="o">.</span><span class="n">source_type</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="n">param_config</span><span class="o">.</span><span class="n">target_type</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symmetry_masks</span> <span class="o">=</span> <span class="n">symmetry_masks</span><span class="p">(</span>
            <span class="n">param_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;symmetric&quot;</span><span class="p">,</span> <span class="p">[]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span>
        <span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">config</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;SynapseCountScaling&quot;</span><span class="p">,</span>
                <span class="n">initial_dist</span><span class="o">=</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span>
                <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">scale_elec</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                <span class="n">scale_chem</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                <span class="n">clamp</span><span class="o">=</span><span class="s2">&quot;non_negative&quot;</span><span class="p">,</span>
                <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;source_type&quot;</span><span class="p">,</span> <span class="s2">&quot;target_type&quot;</span><span class="p">],</span>
                <span class="n">attributes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;edge_type&quot;</span><span class="p">,</span> <span class="s2">&quot;n_syn&quot;</span><span class="p">],</span>
            <span class="n">symmetric</span><span class="o">=</span><span class="p">[[(</span><span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="s2">&quot;L1&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;R4&quot;</span><span class="p">,</span> <span class="s2">&quot;L1&quot;</span><span class="p">)],</span>
              <span class="p">[(</span><span class="s2">&quot;Mi9&quot;</span><span class="p">,</span> <span class="s2">&quot;T4a&quot;</span><span class="p">),</span>
              <span class="p">(</span><span class="s2">&quot;Mi9&quot;</span><span class="p">,</span> <span class="s2">&quot;T4b&quot;</span><span class="p">)]],</span>
            <span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">param</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">connectome</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">config2</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;SynapseCountScalingv2&quot;</span><span class="p">,</span>
                <span class="n">initial_dist</span><span class="o">=</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span>
                <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">scale_elec</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                <span class="n">scale_chem</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                <span class="n">clamp</span><span class="o">=</span><span class="s2">&quot;non_negative&quot;</span><span class="p">,</span>
                <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;source_type&quot;</span><span class="p">,</span> <span class="s2">&quot;target_type&quot;</span><span class="p">,</span> <span class="s2">&quot;edge_type&quot;</span><span class="p">],</span>
                <span class="n">attributes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;n_syn&quot;</span><span class="p">],</span>
            <span class="n">symmetric</span><span class="o">=</span><span class="p">[[(</span><span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="s2">&quot;L1&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;R4&quot;</span><span class="p">,</span> <span class="s2">&quot;L1&quot;</span><span class="p">)],</span>
              <span class="p">[(</span><span class="s2">&quot;Mi9&quot;</span><span class="p">,</span> <span class="s2">&quot;T4a&quot;</span><span class="p">),</span>
              <span class="p">(</span><span class="s2">&quot;Mi9&quot;</span><span class="p">,</span> <span class="s2">&quot;T4b&quot;</span><span class="p">)]],</span>
            <span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">compare_param</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">param2</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>comparing SynapseCountScaling(Namespace(
  type = &#39;SynapseCountScaling&#39;,
  initial_dist = &#39;Value&#39;,
  requires_grad = True,
  scale_elec = 0.01,
  scale_chem = 0.01,
  clamp = &#39;non_negative&#39;,
  groupby = [&#39;source_type&#39;, &#39;target_type&#39;],
  attributes = [&#39;edge_type&#39;, &#39;n_syn&#39;],
  symmetric = [[(&#39;R1&#39;, &#39;L1&#39;), (&#39;R4&#39;, &#39;L1&#39;)], [(&#39;Mi9&#39;, &#39;T4a&#39;), (&#39;Mi9&#39;, &#39;T4b&#39;)]]
), ConnectomeDir), SynapseCountScalingv2(Namespace(
  type = &#39;SynapseCountScalingv2&#39;,
  initial_dist = &#39;Value&#39;,
  requires_grad = True,
  scale_elec = 0.01,
  scale_chem = 0.01,
  clamp = &#39;non_negative&#39;,
  groupby = [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;],
  attributes = [&#39;n_syn&#39;],
  symmetric = [[(&#39;R1&#39;, &#39;L1&#39;), (&#39;R4&#39;, &#39;L1&#39;)], [(&#39;Mi9&#39;, &#39;T4a&#39;), (&#39;Mi9&#39;, &#39;T4b&#39;)]]
), ConnectomeDir)
raw values True, torch.Size([604])
indices True, tensor([  0,   0,   0,  ..., 603, 603, 603])
keys True, (604, 2)
masks False, 2





False
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Mapping</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">byte_to_str</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Cast byte elements to string types.</span>

<span class="sd">    Note, this function is recursive and will cast all byte elements in a nested</span>
<span class="sd">    list or tuple.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)({</span><span class="n">k</span><span class="p">:</span> <span class="n">byte_to_str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="p">[</span><span class="n">byte_to_str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">obj</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">byte_to_str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">obj</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Number</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">obj</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;can&#39;t cast </span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s2"> of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="si">}</span><span class="s2"> to str&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">a</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">Namespace</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">Namespace</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="sa">b</span><span class="s2">&quot;a&quot;</span><span class="p">)))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">a</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>Namespace(a=Namespace(a=Namespace(a=b&#39;a&#39;)))
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">byte_to_str</span><span class="p">([[[[[(</span><span class="sa">b</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;b&quot;</span><span class="p">)]]]]])</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[[[[[(&#39;a&#39;, &#39;b&#39;)]]]]]
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">edges</span> <span class="o">=</span> <span class="n">connectome</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">to_df</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">edges</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;source_type&quot;</span><span class="p">,</span> <span class="s2">&quot;target_type&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="s2">&quot;n_syn&quot;</span><span class="p">])</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>source_type</th>
      <th>target_type</th>
      <th>source_u</th>
      <th>target_u</th>
      <th>n_syn</th>
      <th>du</th>
      <th>source_index</th>
      <th>dv</th>
      <th>source_v</th>
      <th>target_index</th>
      <th>target_v</th>
      <th>sign</th>
      <th>n_syn_certainty</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>R1</td>
      <td>L1</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>40.000000</td>
      <td>0.000000</td>
      <td>360.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>6128.000000</td>
      <td>0.000000</td>
      <td>-1.0</td>
      <td>5.859477</td>
    </tr>
    <tr>
      <th>1</th>
      <td>R1</td>
      <td>L2</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>46.000000</td>
      <td>0.000000</td>
      <td>360.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>6849.000000</td>
      <td>0.000000</td>
      <td>-1.0</td>
      <td>5.859477</td>
    </tr>
    <tr>
      <th>2</th>
      <td>R1</td>
      <td>L3</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>11.000000</td>
      <td>0.000000</td>
      <td>360.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>7570.000000</td>
      <td>0.000000</td>
      <td>-1.0</td>
      <td>5.859477</td>
    </tr>
    <tr>
      <th>3</th>
      <td>R1</td>
      <td>Am</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>36.000000</td>
      <td>0.000000</td>
      <td>360.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>9979.000000</td>
      <td>0.000000</td>
      <td>-1.0</td>
      <td>5.859477</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R1</td>
      <td>T1</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2.000000</td>
      <td>0.000000</td>
      <td>360.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>21515.000000</td>
      <td>0.000000</td>
      <td>-1.0</td>
      <td>5.859477</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>599</th>
      <td>TmY18</td>
      <td>T2</td>
      <td>0.244507</td>
      <td>-0.244507</td>
      <td>2.364281</td>
      <td>-0.489015</td>
      <td>45313.822112</td>
      <td>0.489015</td>
      <td>-0.244507</td>
      <td>22230.177888</td>
      <td>0.244507</td>
      <td>1.0</td>
      <td>1.587606</td>
    </tr>
    <tr>
      <th>600</th>
      <td>TmY18</td>
      <td>TmY5a</td>
      <td>-0.244507</td>
      <td>0.244507</td>
      <td>1.656361</td>
      <td>0.489015</td>
      <td>45302.177888</td>
      <td>-0.489015</td>
      <td>0.244507</td>
      <td>40987.822112</td>
      <td>-0.244507</td>
      <td>1.0</td>
      <td>5.517218</td>
    </tr>
    <tr>
      <th>601</th>
      <td>TmY18</td>
      <td>TmY9</td>
      <td>1.500000</td>
      <td>-1.500000</td>
      <td>1.000000</td>
      <td>-3.000000</td>
      <td>45344.787302</td>
      <td>2.000000</td>
      <td>-1.000000</td>
      <td>41666.212698</td>
      <td>1.000000</td>
      <td>1.0</td>
      <td>2.782612</td>
    </tr>
    <tr>
      <th>602</th>
      <td>TmY18</td>
      <td>TmY15</td>
      <td>-0.220461</td>
      <td>0.220461</td>
      <td>2.230947</td>
      <td>0.440922</td>
      <td>45302.296781</td>
      <td>0.426213</td>
      <td>-0.213107</td>
      <td>44592.703219</td>
      <td>0.213107</td>
      <td>1.0</td>
      <td>0.864511</td>
    </tr>
    <tr>
      <th>603</th>
      <td>TmY18</td>
      <td>TmY18</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.292609</td>
      <td>0.000000</td>
      <td>45308.099109</td>
      <td>-0.198219</td>
      <td>0.099109</td>
      <td>45307.900891</td>
      <td>-0.099109</td>
      <td>1.0</td>
      <td>2.239571</td>
    </tr>
  </tbody>
</table>
<p>604 rows  13 columns</p>
</div>
<div class="highlight"><pre><span></span><code><span class="n">edges</span><span class="o">.</span><span class="n">columns</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>Index([&#39;source_u&#39;, &#39;target_u&#39;, &#39;n_syn&#39;, &#39;du&#39;, &#39;source_type&#39;, &#39;target_type&#39;,
       &#39;edge_type&#39;, &#39;source_index&#39;, &#39;dv&#39;, &#39;source_v&#39;, &#39;target_index&#39;,
       &#39;target_v&#39;, &#39;sign&#39;, &#39;n_syn_certainty&#39;],
      dtype=&#39;object&#39;)
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">edges</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>source_u</th>
      <th>target_u</th>
      <th>n_syn</th>
      <th>du</th>
      <th>source_type</th>
      <th>target_type</th>
      <th>edge_type</th>
      <th>source_index</th>
      <th>dv</th>
      <th>source_v</th>
      <th>target_index</th>
      <th>target_v</th>
      <th>sign</th>
      <th>n_syn_certainty</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-15</td>
      <td>-15</td>
      <td>40.0</td>
      <td>0</td>
      <td>R1</td>
      <td>L1</td>
      <td>chem</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5768</td>
      <td>0</td>
      <td>-1.0</td>
      <td>5.859477</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-15</td>
      <td>-15</td>
      <td>40.0</td>
      <td>0</td>
      <td>R1</td>
      <td>L1</td>
      <td>chem</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>5769</td>
      <td>1</td>
      <td>-1.0</td>
      <td>5.859477</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-15</td>
      <td>-15</td>
      <td>40.0</td>
      <td>0</td>
      <td>R1</td>
      <td>L1</td>
      <td>chem</td>
      <td>2</td>
      <td>0</td>
      <td>2</td>
      <td>5770</td>
      <td>2</td>
      <td>-1.0</td>
      <td>5.859477</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-15</td>
      <td>-15</td>
      <td>40.0</td>
      <td>0</td>
      <td>R1</td>
      <td>L1</td>
      <td>chem</td>
      <td>3</td>
      <td>0</td>
      <td>3</td>
      <td>5771</td>
      <td>3</td>
      <td>-1.0</td>
      <td>5.859477</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-15</td>
      <td>-15</td>
      <td>40.0</td>
      <td>0</td>
      <td>R1</td>
      <td>L1</td>
      <td>chem</td>
      <td>4</td>
      <td>0</td>
      <td>4</td>
      <td>5772</td>
      <td>4</td>
      <td>-1.0</td>
      <td>5.859477</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1513226</th>
      <td>15</td>
      <td>15</td>
      <td>1.0</td>
      <td>0</td>
      <td>TmY18</td>
      <td>TmY18</td>
      <td>chem</td>
      <td>45664</td>
      <td>0</td>
      <td>-4</td>
      <td>45664</td>
      <td>-4</td>
      <td>1.0</td>
      <td>2.239571</td>
    </tr>
    <tr>
      <th>1513227</th>
      <td>15</td>
      <td>15</td>
      <td>1.0</td>
      <td>0</td>
      <td>TmY18</td>
      <td>TmY18</td>
      <td>chem</td>
      <td>45665</td>
      <td>0</td>
      <td>-3</td>
      <td>45665</td>
      <td>-3</td>
      <td>1.0</td>
      <td>2.239571</td>
    </tr>
    <tr>
      <th>1513228</th>
      <td>15</td>
      <td>15</td>
      <td>1.0</td>
      <td>0</td>
      <td>TmY18</td>
      <td>TmY18</td>
      <td>chem</td>
      <td>45666</td>
      <td>0</td>
      <td>-2</td>
      <td>45666</td>
      <td>-2</td>
      <td>1.0</td>
      <td>2.239571</td>
    </tr>
    <tr>
      <th>1513229</th>
      <td>15</td>
      <td>15</td>
      <td>1.0</td>
      <td>0</td>
      <td>TmY18</td>
      <td>TmY18</td>
      <td>chem</td>
      <td>45667</td>
      <td>0</td>
      <td>-1</td>
      <td>45667</td>
      <td>-1</td>
      <td>1.0</td>
      <td>2.239571</td>
    </tr>
    <tr>
      <th>1513230</th>
      <td>15</td>
      <td>15</td>
      <td>1.0</td>
      <td>0</td>
      <td>TmY18</td>
      <td>TmY18</td>
      <td>chem</td>
      <td>45668</td>
      <td>0</td>
      <td>0</td>
      <td>45668</td>
      <td>0</td>
      <td>1.0</td>
      <td>2.239571</td>
    </tr>
  </tbody>
</table>
<p>1513231 rows  14 columns</p>
</div>

<div class="highlight"><pre><span></span><code><span class="n">elements</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">]</span>
<span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">]</span>
<span class="n">parameter</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="c1"># get_scatter_indices would return</span>
<span class="n">scatter_indices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">scattered_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="n">parameter</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">scatter_indices</span><span class="p">]</span> 
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">scattered_parameters</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[1, 1, 1, 2, 2, 3, 4, 4, 5]
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">param2</span><span class="o">.</span><span class="n">keys</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[(&#39;R1&#39;, &#39;L1&#39;),
 (&#39;R1&#39;, &#39;L2&#39;),
 (&#39;R1&#39;, &#39;L3&#39;),
 (&#39;R1&#39;, &#39;Am&#39;),
 (&#39;R1&#39;, &#39;T1&#39;),
 (&#39;R2&#39;, &#39;L1&#39;),
 (&#39;R2&#39;, &#39;L2&#39;),
 (&#39;R2&#39;, &#39;L3&#39;),
 (&#39;R2&#39;, &#39;Am&#39;),
 (&#39;R2&#39;, &#39;T1&#39;),
 (&#39;R3&#39;, &#39;L1&#39;),
 (&#39;R3&#39;, &#39;L2&#39;),
 (&#39;R3&#39;, &#39;L3&#39;),
 (&#39;R3&#39;, &#39;Am&#39;),
 (&#39;R3&#39;, &#39;T1&#39;),
 (&#39;R4&#39;, &#39;L1&#39;),
 (&#39;R4&#39;, &#39;L2&#39;),
 (&#39;R4&#39;, &#39;L3&#39;),
 (&#39;R4&#39;, &#39;Am&#39;),
 (&#39;R4&#39;, &#39;T1&#39;),
 (&#39;R5&#39;, &#39;L1&#39;),
 (&#39;R5&#39;, &#39;L2&#39;),
 (&#39;R5&#39;, &#39;L3&#39;),
 (&#39;R5&#39;, &#39;Am&#39;),
 (&#39;R5&#39;, &#39;T1&#39;),
 (&#39;R6&#39;, &#39;L1&#39;),
 (&#39;R6&#39;, &#39;L2&#39;),
 (&#39;R6&#39;, &#39;L3&#39;),
 (&#39;R6&#39;, &#39;Am&#39;),
 (&#39;R6&#39;, &#39;T1&#39;),
 (&#39;R7&#39;, &#39;R8&#39;),
 (&#39;R7&#39;, &#39;Mi9&#39;),
 (&#39;R7&#39;, &#39;Mi15&#39;),
 (&#39;R7&#39;, &#39;Tm5a&#39;),
 (&#39;R7&#39;, &#39;Tm5b&#39;),
 (&#39;R8&#39;, &#39;R7&#39;),
 (&#39;R8&#39;, &#39;L1&#39;),
 (&#39;R8&#39;, &#39;L3&#39;),
 (&#39;R8&#39;, &#39;Mi1&#39;),
 (&#39;R8&#39;, &#39;Mi4&#39;),
 (&#39;R8&#39;, &#39;Mi9&#39;),
 (&#39;R8&#39;, &#39;Mi15&#39;),
 (&#39;R8&#39;, &#39;Tm5c&#39;),
 (&#39;R8&#39;, &#39;Tm20&#39;),
 (&#39;L1&#39;, &#39;L5&#39;),
 (&#39;L1&#39;, &#39;Lawf2&#39;),
 (&#39;L1&#39;, &#39;C2&#39;),
 (&#39;L1&#39;, &#39;C3&#39;),
 (&#39;L1&#39;, &#39;Mi1&#39;),
 (&#39;L1&#39;, &#39;Tm3&#39;),
 (&#39;L2&#39;, &#39;R1&#39;),
 (&#39;L2&#39;, &#39;R2&#39;),
 (&#39;L2&#39;, &#39;L1&#39;),
 (&#39;L2&#39;, &#39;L4&#39;),
 (&#39;L2&#39;, &#39;L5&#39;),
 (&#39;L2&#39;, &#39;Lawf2&#39;),
 (&#39;L2&#39;, &#39;C3&#39;),
 (&#39;L2&#39;, &#39;Mi1&#39;),
 (&#39;L2&#39;, &#39;Mi4&#39;),
 (&#39;L2&#39;, &#39;Mi9&#39;),
 (&#39;L2&#39;, &#39;T1&#39;),
 (&#39;L2&#39;, &#39;Tm1&#39;),
 (&#39;L2&#39;, &#39;Tm2&#39;),
 (&#39;L2&#39;, &#39;Tm4&#39;),
 (&#39;L2&#39;, &#39;Tm20&#39;),
 (&#39;L2&#39;, &#39;TmY3&#39;),
 (&#39;L3&#39;, &#39;Lawf1&#39;),
 (&#39;L3&#39;, &#39;C3&#39;),
 (&#39;L3&#39;, &#39;Mi1&#39;),
 (&#39;L3&#39;, &#39;Mi2&#39;),
 (&#39;L3&#39;, &#39;Mi9&#39;),
 (&#39;L3&#39;, &#39;Mi13&#39;),
 (&#39;L3&#39;, &#39;Mi15&#39;),
 (&#39;L3&#39;, &#39;Tm3&#39;),
 (&#39;L3&#39;, &#39;Tm5Y&#39;),
 (&#39;L3&#39;, &#39;Tm5a&#39;),
 (&#39;L3&#39;, &#39;Tm5c&#39;),
 (&#39;L3&#39;, &#39;Tm9&#39;),
 (&#39;L3&#39;, &#39;Tm20&#39;),
 (&#39;L3&#39;, &#39;Tm28&#39;),
 (&#39;L3&#39;, &#39;TmY9&#39;),
 (&#39;L3&#39;, &#39;TmY10&#39;),
 (&#39;L4&#39;, &#39;R1&#39;),
 (&#39;L4&#39;, &#39;R2&#39;),
 (&#39;L4&#39;, &#39;R3&#39;),
 (&#39;L4&#39;, &#39;R4&#39;),
 (&#39;L4&#39;, &#39;R5&#39;),
 (&#39;L4&#39;, &#39;R6&#39;),
 (&#39;L4&#39;, &#39;L2&#39;),
 (&#39;L4&#39;, &#39;L3&#39;),
 (&#39;L4&#39;, &#39;L4&#39;),
 (&#39;L4&#39;, &#39;L5&#39;),
 (&#39;L4&#39;, &#39;Am&#39;),
 (&#39;L4&#39;, &#39;Mi9&#39;),
 (&#39;L4&#39;, &#39;T2&#39;),
 (&#39;L4&#39;, &#39;Tm2&#39;),
 (&#39;L4&#39;, &#39;Tm4&#39;),
 (&#39;L4&#39;, &#39;Tm9&#39;),
 (&#39;L4&#39;, &#39;TmY3&#39;),
 (&#39;L4&#39;, &#39;TmY13&#39;),
 (&#39;L5&#39;, &#39;L1&#39;),
 (&#39;L5&#39;, &#39;L2&#39;),
 (&#39;L5&#39;, &#39;L5&#39;),
 (&#39;L5&#39;, &#39;C2&#39;),
 (&#39;L5&#39;, &#39;C3&#39;),
 (&#39;L5&#39;, &#39;Mi1&#39;),
 (&#39;L5&#39;, &#39;Mi2&#39;),
 (&#39;L5&#39;, &#39;Mi4&#39;),
 (&#39;L5&#39;, &#39;Mi15&#39;),
 (&#39;L5&#39;, &#39;T1&#39;),
 (&#39;L5&#39;, &#39;T2&#39;),
 (&#39;L5&#39;, &#39;Tm3&#39;),
 (&#39;L5&#39;, &#39;Tm20&#39;),
 (&#39;L5&#39;, &#39;TmY3&#39;),
 (&#39;L5&#39;, &#39;TmY13&#39;),
 (&#39;L5&#39;, &#39;TmY14&#39;),
 (&#39;L5&#39;, &#39;TmY18&#39;),
 (&#39;Lawf1&#39;, &#39;Tm3&#39;),
 (&#39;Lawf2&#39;, &#39;L3&#39;),
 (&#39;Lawf2&#39;, &#39;Lawf2&#39;),
 (&#39;Lawf2&#39;, &#39;Am&#39;),
 (&#39;Am&#39;, &#39;R1&#39;),
 (&#39;Am&#39;, &#39;R2&#39;),
 (&#39;Am&#39;, &#39;R4&#39;),
 (&#39;Am&#39;, &#39;R5&#39;),
 (&#39;Am&#39;, &#39;L1&#39;),
 (&#39;Am&#39;, &#39;L2&#39;),
 (&#39;Am&#39;, &#39;L3&#39;),
 (&#39;Am&#39;, &#39;L4&#39;),
 (&#39;Am&#39;, &#39;C2&#39;),
 (&#39;Am&#39;, &#39;C3&#39;),
 (&#39;Am&#39;, &#39;T1&#39;),
 (&#39;C2&#39;, &#39;L1&#39;),
 (&#39;C2&#39;, &#39;L2&#39;),
 (&#39;C2&#39;, &#39;L3&#39;),
 (&#39;C2&#39;, &#39;L4&#39;),
 (&#39;C2&#39;, &#39;L5&#39;),
 (&#39;C2&#39;, &#39;Lawf2&#39;),
 (&#39;C2&#39;, &#39;Am&#39;),
 (&#39;C2&#39;, &#39;Mi1&#39;),
 (&#39;C2&#39;, &#39;T1&#39;),
 (&#39;C2&#39;, &#39;T2&#39;),
 (&#39;C2&#39;, &#39;T4a&#39;),
 (&#39;C2&#39;, &#39;Tm1&#39;),
 (&#39;C2&#39;, &#39;Tm9&#39;),
 (&#39;C2&#39;, &#39;TmY14&#39;),
 (&#39;C3&#39;, &#39;R3&#39;),
 (&#39;C3&#39;, &#39;L1&#39;),
 (&#39;C3&#39;, &#39;L2&#39;),
 (&#39;C3&#39;, &#39;L3&#39;),
 (&#39;C3&#39;, &#39;L5&#39;),
 (&#39;C3&#39;, &#39;Lawf2&#39;),
 (&#39;C3&#39;, &#39;Am&#39;),
 (&#39;C3&#39;, &#39;CT1(M10)&#39;),
 (&#39;C3&#39;, &#39;Mi1&#39;),
 (&#39;C3&#39;, &#39;Mi4&#39;),
 (&#39;C3&#39;, &#39;Mi9&#39;),
 (&#39;C3&#39;, &#39;T1&#39;),
 (&#39;C3&#39;, &#39;T2&#39;),
 (&#39;C3&#39;, &#39;T4a&#39;),
 (&#39;C3&#39;, &#39;T4b&#39;),
 (&#39;C3&#39;, &#39;T4c&#39;),
 (&#39;C3&#39;, &#39;T4d&#39;),
 (&#39;C3&#39;, &#39;Tm1&#39;),
 (&#39;C3&#39;, &#39;Tm2&#39;),
 (&#39;C3&#39;, &#39;Tm4&#39;),
 (&#39;C3&#39;, &#39;Tm9&#39;),
 (&#39;C3&#39;, &#39;Tm20&#39;),
 (&#39;CT1(Lo1)&#39;, &#39;T5a&#39;),
 (&#39;CT1(Lo1)&#39;, &#39;T5b&#39;),
 (&#39;CT1(Lo1)&#39;, &#39;T5c&#39;),
 (&#39;CT1(Lo1)&#39;, &#39;T5d&#39;),
 (&#39;CT1(Lo1)&#39;, &#39;Tm1&#39;),
 (&#39;CT1(Lo1)&#39;, &#39;Tm9&#39;),
 (&#39;CT1(M10)&#39;, &#39;C3&#39;),
 (&#39;CT1(M10)&#39;, &#39;Mi1&#39;),
 (&#39;CT1(M10)&#39;, &#39;T4a&#39;),
 (&#39;CT1(M10)&#39;, &#39;T4b&#39;),
 (&#39;CT1(M10)&#39;, &#39;T4c&#39;),
 (&#39;CT1(M10)&#39;, &#39;T4d&#39;),
 (&#39;Mi1&#39;, &#39;L1&#39;),
 (&#39;Mi1&#39;, &#39;L5&#39;),
 (&#39;Mi1&#39;, &#39;C2&#39;),
 (&#39;Mi1&#39;, &#39;C3&#39;),
 (&#39;Mi1&#39;, &#39;CT1(M10)&#39;),
 (&#39;Mi1&#39;, &#39;Mi2&#39;),
 (&#39;Mi1&#39;, &#39;Mi4&#39;),
 (&#39;Mi1&#39;, &#39;Mi9&#39;),
 (&#39;Mi1&#39;, &#39;Mi10&#39;),
 (&#39;Mi1&#39;, &#39;Mi12&#39;),
 (&#39;Mi1&#39;, &#39;Mi13&#39;),
 (&#39;Mi1&#39;, &#39;Mi14&#39;),
 (&#39;Mi1&#39;, &#39;Mi15&#39;),
 (&#39;Mi1&#39;, &#39;T2&#39;),
 (&#39;Mi1&#39;, &#39;T2a&#39;),
 (&#39;Mi1&#39;, &#39;T3&#39;),
 (&#39;Mi1&#39;, &#39;T4a&#39;),
 (&#39;Mi1&#39;, &#39;T4b&#39;),
 (&#39;Mi1&#39;, &#39;T4c&#39;),
 (&#39;Mi1&#39;, &#39;T4d&#39;),
 (&#39;Mi1&#39;, &#39;Tm1&#39;),
 (&#39;Mi1&#39;, &#39;Tm3&#39;),
 (&#39;Mi1&#39;, &#39;Tm20&#39;),
 (&#39;Mi1&#39;, &#39;TmY3&#39;),
 (&#39;Mi1&#39;, &#39;TmY9&#39;),
 (&#39;Mi1&#39;, &#39;TmY13&#39;),
 (&#39;Mi1&#39;, &#39;TmY14&#39;),
 (&#39;Mi1&#39;, &#39;TmY15&#39;),
 (&#39;Mi1&#39;, &#39;TmY18&#39;),
 (&#39;Mi2&#39;, &#39;Mi1&#39;),
 (&#39;Mi2&#39;, &#39;T2&#39;),
 (&#39;Mi2&#39;, &#39;T2a&#39;),
 (&#39;Mi2&#39;, &#39;T3&#39;),
 (&#39;Mi2&#39;, &#39;Tm1&#39;),
 (&#39;Mi2&#39;, &#39;TmY18&#39;),
 (&#39;Mi3&#39;, &#39;T2&#39;),
 (&#39;Mi3&#39;, &#39;Tm5b&#39;),
 (&#39;Mi4&#39;, &#39;L2&#39;),
 (&#39;Mi4&#39;, &#39;C3&#39;),
 (&#39;Mi4&#39;, &#39;Mi1&#39;),
 (&#39;Mi4&#39;, &#39;Mi4&#39;),
 (&#39;Mi4&#39;, &#39;Mi9&#39;),
 (&#39;Mi4&#39;, &#39;T1&#39;),
 (&#39;Mi4&#39;, &#39;T4a&#39;),
 (&#39;Mi4&#39;, &#39;T4b&#39;),
 (&#39;Mi4&#39;, &#39;T4c&#39;),
 (&#39;Mi4&#39;, &#39;T4d&#39;),
 (&#39;Mi4&#39;, &#39;Tm1&#39;),
 (&#39;Mi4&#39;, &#39;Tm2&#39;),
 (&#39;Mi4&#39;, &#39;Tm5Y&#39;),
 (&#39;Mi4&#39;, &#39;Tm5a&#39;),
 (&#39;Mi4&#39;, &#39;Tm5b&#39;),
 (&#39;Mi4&#39;, &#39;Tm5c&#39;),
 (&#39;Mi4&#39;, &#39;Tm9&#39;),
 (&#39;Mi4&#39;, &#39;Tm16&#39;),
 (&#39;Mi4&#39;, &#39;Tm20&#39;),
 (&#39;Mi4&#39;, &#39;Tm28&#39;),
 (&#39;Mi4&#39;, &#39;TmY3&#39;),
 (&#39;Mi4&#39;, &#39;TmY4&#39;),
 (&#39;Mi4&#39;, &#39;TmY5a&#39;),
 (&#39;Mi4&#39;, &#39;TmY10&#39;),
 (&#39;Mi4&#39;, &#39;TmY13&#39;),
 (&#39;Mi4&#39;, &#39;TmY15&#39;),
 (&#39;Mi4&#39;, &#39;TmY18&#39;),
 (&#39;Mi9&#39;, &#39;L3&#39;),
 (&#39;Mi9&#39;, &#39;Lawf1&#39;),
 (&#39;Mi9&#39;, &#39;C3&#39;),
 (&#39;Mi9&#39;, &#39;CT1(M10)&#39;),
 (&#39;Mi9&#39;, &#39;Mi1&#39;),
 (&#39;Mi9&#39;, &#39;Mi4&#39;),
 (&#39;Mi9&#39;, &#39;Mi10&#39;),
 (&#39;Mi9&#39;, &#39;Mi15&#39;),
 (&#39;Mi9&#39;, &#39;T2&#39;),
 (&#39;Mi9&#39;, &#39;T2a&#39;),
 (&#39;Mi9&#39;, &#39;T4a&#39;),
 (&#39;Mi9&#39;, &#39;T4b&#39;),
 (&#39;Mi9&#39;, &#39;T4c&#39;),
 (&#39;Mi9&#39;, &#39;T4d&#39;),
 (&#39;Mi9&#39;, &#39;Tm1&#39;),
 (&#39;Mi9&#39;, &#39;Tm2&#39;),
 (&#39;Mi9&#39;, &#39;Tm4&#39;),
 (&#39;Mi9&#39;, &#39;Tm5a&#39;),
 (&#39;Mi9&#39;, &#39;Tm5b&#39;),
 (&#39;Mi9&#39;, &#39;Tm16&#39;),
 (&#39;Mi9&#39;, &#39;TmY3&#39;),
 (&#39;Mi9&#39;, &#39;TmY4&#39;),
 (&#39;Mi9&#39;, &#39;TmY5a&#39;),
 (&#39;Mi9&#39;, &#39;TmY13&#39;),
 (&#39;Mi9&#39;, &#39;TmY18&#39;),
 (&#39;Mi10&#39;, &#39;Lawf1&#39;),
 (&#39;Mi10&#39;, &#39;Mi9&#39;),
 (&#39;Mi10&#39;, &#39;Mi14&#39;),
 (&#39;Mi10&#39;, &#39;T4a&#39;),
 (&#39;Mi10&#39;, &#39;T4b&#39;),
 (&#39;Mi10&#39;, &#39;T4c&#39;),
 (&#39;Mi10&#39;, &#39;T4d&#39;),
 (&#39;Mi10&#39;, &#39;Tm5b&#39;),
 (&#39;Mi10&#39;, &#39;TmY3&#39;),
 (&#39;Mi10&#39;, &#39;TmY5a&#39;),
 (&#39;Mi10&#39;, &#39;TmY14&#39;),
 (&#39;Mi12&#39;, &#39;Mi1&#39;),
 (&#39;Mi12&#39;, &#39;Mi9&#39;),
 (&#39;Mi12&#39;, &#39;Tm1&#39;),
 (&#39;Mi12&#39;, &#39;Tm2&#39;),
 (&#39;Mi12&#39;, &#39;Tm3&#39;),
 (&#39;Mi12&#39;, &#39;Tm4&#39;),
 (&#39;Mi13&#39;, &#39;L5&#39;),
 (&#39;Mi13&#39;, &#39;Mi1&#39;),
 (&#39;Mi13&#39;, &#39;T2&#39;),
 (&#39;Mi13&#39;, &#39;Tm1&#39;),
 (&#39;Mi13&#39;, &#39;Tm2&#39;),
 (&#39;Mi13&#39;, &#39;Tm3&#39;),
 (&#39;Mi13&#39;, &#39;Tm4&#39;),
 (&#39;Mi13&#39;, &#39;Tm9&#39;),
 (&#39;Mi14&#39;, &#39;Tm1&#39;),
 (&#39;Mi14&#39;, &#39;Tm4&#39;),
 (&#39;Mi14&#39;, &#39;TmY3&#39;),
 (&#39;Mi15&#39;, &#39;C3&#39;),
 (&#39;Mi15&#39;, &#39;Mi4&#39;),
 (&#39;Mi15&#39;, &#39;Mi10&#39;),
 (&#39;Mi15&#39;, &#39;Mi15&#39;),
 (&#39;Mi15&#39;, &#39;Tm5c&#39;),
 (&#39;T1&#39;, &#39;L2&#39;),
 (&#39;T1&#39;, &#39;L5&#39;),
 (&#39;T1&#39;, &#39;Tm20&#39;),
 (&#39;T2&#39;, &#39;Lawf2&#39;),
 (&#39;T2&#39;, &#39;Mi1&#39;),
 (&#39;T2&#39;, &#39;T2&#39;),
 (&#39;T2&#39;, &#39;Tm5c&#39;),
 (&#39;T2&#39;, &#39;TmY5a&#39;),
 (&#39;T2&#39;, &#39;TmY15&#39;),
 (&#39;T2a&#39;, &#39;Mi1&#39;),
 (&#39;T2a&#39;, &#39;T3&#39;),
 (&#39;T2a&#39;, &#39;Tm3&#39;),
 (&#39;T2a&#39;, &#39;Tm5Y&#39;),
 (&#39;T2a&#39;, &#39;Tm5b&#39;),
 (&#39;T2a&#39;, &#39;Tm28&#39;),
 (&#39;T2a&#39;, &#39;TmY4&#39;),
 (&#39;T2a&#39;, &#39;TmY5a&#39;),
 (&#39;T2a&#39;, &#39;TmY9&#39;),
 (&#39;T3&#39;, &#39;T2&#39;),
 (&#39;T3&#39;, &#39;T2a&#39;),
 (&#39;T3&#39;, &#39;Tm3&#39;),
 (&#39;T4a&#39;, &#39;C3&#39;),
 (&#39;T4a&#39;, &#39;CT1(M10)&#39;),
 (&#39;T4a&#39;, &#39;Mi9&#39;),
 (&#39;T4a&#39;, &#39;Mi12&#39;),
 (&#39;T4a&#39;, &#39;T4a&#39;),
 (&#39;T4a&#39;, &#39;T4c&#39;),
 (&#39;T4a&#39;, &#39;T5a&#39;),
 (&#39;T4a&#39;, &#39;TmY14&#39;),
 (&#39;T4a&#39;, &#39;TmY18&#39;),
 (&#39;T4b&#39;, &#39;CT1(M10)&#39;),
 (&#39;T4b&#39;, &#39;Mi9&#39;),
 (&#39;T4b&#39;, &#39;T4b&#39;),
 (&#39;T4b&#39;, &#39;T4c&#39;),
 (&#39;T4b&#39;, &#39;T5b&#39;),
 (&#39;T4b&#39;, &#39;TmY15&#39;),
 (&#39;T4c&#39;, &#39;CT1(M10)&#39;),
 (&#39;T4c&#39;, &#39;Mi9&#39;),
 (&#39;T4c&#39;, &#39;T4c&#39;),
 (&#39;T4c&#39;, &#39;T5c&#39;),
 (&#39;T4c&#39;, &#39;TmY4&#39;),
 (&#39;T4c&#39;, &#39;TmY14&#39;),
 (&#39;T4c&#39;, &#39;TmY15&#39;),
 (&#39;T4d&#39;, &#39;CT1(M10)&#39;),
 (&#39;T4d&#39;, &#39;T4a&#39;),
 (&#39;T4d&#39;, &#39;T4d&#39;),
 (&#39;T4d&#39;, &#39;T5d&#39;),
 (&#39;T4d&#39;, &#39;TmY4&#39;),
 (&#39;T4d&#39;, &#39;TmY15&#39;),
 (&#39;T5a&#39;, &#39;CT1(Lo1)&#39;),
 (&#39;T5a&#39;, &#39;T4a&#39;),
 (&#39;T5a&#39;, &#39;T5a&#39;),
 (&#39;T5a&#39;, &#39;T5b&#39;),
 (&#39;T5a&#39;, &#39;TmY9&#39;),
 (&#39;T5a&#39;, &#39;TmY14&#39;),
 (&#39;T5a&#39;, &#39;TmY15&#39;),
 (&#39;T5b&#39;, &#39;CT1(Lo1)&#39;),
 (&#39;T5b&#39;, &#39;T2&#39;),
 (&#39;T5b&#39;, &#39;T4b&#39;),
 (&#39;T5b&#39;, &#39;T5b&#39;),
 (&#39;T5b&#39;, &#39;T5d&#39;),
 (&#39;T5b&#39;, &#39;Tm2&#39;),
 (&#39;T5b&#39;, &#39;TmY14&#39;),
 (&#39;T5b&#39;, &#39;TmY15&#39;),
 (&#39;T5c&#39;, &#39;CT1(Lo1)&#39;),
 (&#39;T5c&#39;, &#39;T4c&#39;),
 (&#39;T5c&#39;, &#39;T5c&#39;),
 (&#39;T5c&#39;, &#39;Tm2&#39;),
 (&#39;T5c&#39;, &#39;TmY4&#39;),
 (&#39;T5c&#39;, &#39;TmY14&#39;),
 (&#39;T5c&#39;, &#39;TmY15&#39;),
 (&#39;T5d&#39;, &#39;CT1(Lo1)&#39;),
 (&#39;T5d&#39;, &#39;T2&#39;),
 (&#39;T5d&#39;, &#39;T4d&#39;),
 (&#39;T5d&#39;, &#39;T5d&#39;),
 (&#39;T5d&#39;, &#39;TmY4&#39;),
 (&#39;T5d&#39;, &#39;TmY15&#39;),
 (&#39;Tm1&#39;, &#39;L2&#39;),
 (&#39;Tm1&#39;, &#39;L5&#39;),
 (&#39;Tm1&#39;, &#39;Lawf2&#39;),
 (&#39;Tm1&#39;, &#39;C3&#39;),
 (&#39;Tm1&#39;, &#39;CT1(Lo1)&#39;),
 (&#39;Tm1&#39;, &#39;Mi1&#39;),
 (&#39;Tm1&#39;, &#39;Mi2&#39;),
 (&#39;Tm1&#39;, &#39;Mi4&#39;),
 (&#39;Tm1&#39;, &#39;Mi9&#39;),
 (&#39;Tm1&#39;, &#39;Mi12&#39;),
 (&#39;Tm1&#39;, &#39;Mi13&#39;),
 (&#39;Tm1&#39;, &#39;T1&#39;),
 (&#39;Tm1&#39;, &#39;T2&#39;),
 (&#39;Tm1&#39;, &#39;T2a&#39;),
 (&#39;Tm1&#39;, &#39;T3&#39;),
 (&#39;Tm1&#39;, &#39;T5a&#39;),
 (&#39;Tm1&#39;, &#39;T5b&#39;),
 (&#39;Tm1&#39;, &#39;T5c&#39;),
 (&#39;Tm1&#39;, &#39;T5d&#39;),
 (&#39;Tm1&#39;, &#39;Tm2&#39;),
 (&#39;Tm1&#39;, &#39;Tm4&#39;),
 (&#39;Tm1&#39;, &#39;Tm5Y&#39;),
 (&#39;Tm1&#39;, &#39;Tm9&#39;),
 (&#39;Tm1&#39;, &#39;Tm20&#39;),
 (&#39;Tm1&#39;, &#39;Tm28&#39;),
 (&#39;Tm1&#39;, &#39;TmY4&#39;),
 (&#39;Tm1&#39;, &#39;TmY9&#39;),
 (&#39;Tm1&#39;, &#39;TmY15&#39;),
 (&#39;Tm2&#39;, &#39;L2&#39;),
 (&#39;Tm2&#39;, &#39;L5&#39;),
 (&#39;Tm2&#39;, &#39;Lawf1&#39;),
 (&#39;Tm2&#39;, &#39;C3&#39;),
 (&#39;Tm2&#39;, &#39;CT1(Lo1)&#39;),
 (&#39;Tm2&#39;, &#39;Mi4&#39;),
 (&#39;Tm2&#39;, &#39;Mi9&#39;),
 (&#39;Tm2&#39;, &#39;T2&#39;),
 (&#39;Tm2&#39;, &#39;T2a&#39;),
 (&#39;Tm2&#39;, &#39;T5a&#39;),
 (&#39;Tm2&#39;, &#39;T5b&#39;),
 (&#39;Tm2&#39;, &#39;T5c&#39;),
 (&#39;Tm2&#39;, &#39;T5d&#39;),
 (&#39;Tm2&#39;, &#39;Tm1&#39;),
 (&#39;Tm2&#39;, &#39;Tm4&#39;),
 (&#39;Tm2&#39;, &#39;Tm9&#39;),
 (&#39;Tm2&#39;, &#39;Tm28&#39;),
 (&#39;Tm2&#39;, &#39;TmY3&#39;),
 (&#39;Tm2&#39;, &#39;TmY4&#39;),
 (&#39;Tm2&#39;, &#39;TmY13&#39;),
 (&#39;Tm2&#39;, &#39;TmY15&#39;),
 (&#39;Tm2&#39;, &#39;TmY18&#39;),
 (&#39;Tm3&#39;, &#39;L1&#39;),
 (&#39;Tm3&#39;, &#39;Lawf1&#39;),
 (&#39;Tm3&#39;, &#39;Lawf2&#39;),
 (&#39;Tm3&#39;, &#39;Mi1&#39;),
 (&#39;Tm3&#39;, &#39;Mi11&#39;),
 (&#39;Tm3&#39;, &#39;Mi14&#39;),
 (&#39;Tm3&#39;, &#39;T2&#39;),
 (&#39;Tm3&#39;, &#39;T2a&#39;),
 (&#39;Tm3&#39;, &#39;T3&#39;),
 (&#39;Tm3&#39;, &#39;T4a&#39;),
 (&#39;Tm3&#39;, &#39;T4b&#39;),
 (&#39;Tm3&#39;, &#39;T4c&#39;),
 (&#39;Tm3&#39;, &#39;T4d&#39;),
 (&#39;Tm3&#39;, &#39;Tm3&#39;),
 (&#39;Tm3&#39;, &#39;Tm4&#39;),
 (&#39;Tm3&#39;, &#39;Tm30&#39;),
 (&#39;Tm3&#39;, &#39;TmY3&#39;),
 (&#39;Tm3&#39;, &#39;TmY5a&#39;),
 (&#39;Tm3&#39;, &#39;TmY13&#39;),
 (&#39;Tm3&#39;, &#39;TmY14&#39;),
 (&#39;Tm3&#39;, &#39;TmY15&#39;),
 (&#39;Tm3&#39;, &#39;TmY18&#39;),
 (&#39;Tm4&#39;, &#39;Lawf2&#39;),
 (&#39;Tm4&#39;, &#39;C3&#39;),
 (&#39;Tm4&#39;, &#39;Mi4&#39;),
 (&#39;Tm4&#39;, &#39;Mi10&#39;),
 (&#39;Tm4&#39;, &#39;Mi12&#39;),
 (&#39;Tm4&#39;, &#39;Mi13&#39;),
 (&#39;Tm4&#39;, &#39;Mi14&#39;),
 (&#39;Tm4&#39;, &#39;T2&#39;),
 (&#39;Tm4&#39;, &#39;T2a&#39;),
 (&#39;Tm4&#39;, &#39;T3&#39;),
 (&#39;Tm4&#39;, &#39;T5a&#39;),
 (&#39;Tm4&#39;, &#39;T5b&#39;),
 (&#39;Tm4&#39;, &#39;T5c&#39;),
 (&#39;Tm4&#39;, &#39;T5d&#39;),
 (&#39;Tm4&#39;, &#39;Tm3&#39;),
 (&#39;Tm4&#39;, &#39;Tm4&#39;),
 (&#39;Tm4&#39;, &#39;TmY3&#39;),
 (&#39;Tm4&#39;, &#39;TmY4&#39;),
 (&#39;Tm4&#39;, &#39;TmY5a&#39;),
 (&#39;Tm4&#39;, &#39;TmY13&#39;),
 (&#39;Tm4&#39;, &#39;TmY14&#39;),
 (&#39;Tm4&#39;, &#39;TmY15&#39;),
 (&#39;Tm5Y&#39;, &#39;Tm5a&#39;),
 (&#39;Tm5Y&#39;, &#39;Tm5b&#39;),
 (&#39;Tm5Y&#39;, &#39;Tm20&#39;),
 (&#39;Tm5Y&#39;, &#39;TmY5a&#39;),
 (&#39;Tm5Y&#39;, &#39;TmY10&#39;),
 (&#39;Tm5a&#39;, &#39;Tm5a&#39;),
 (&#39;Tm5a&#39;, &#39;Tm5b&#39;),
 (&#39;Tm5b&#39;, &#39;Mi3&#39;),
 (&#39;Tm5b&#39;, &#39;Mi10&#39;),
 (&#39;Tm5b&#39;, &#39;Tm5a&#39;),
 (&#39;Tm5b&#39;, &#39;Tm5b&#39;),
 (&#39;Tm5b&#39;, &#39;Tm5c&#39;),
 (&#39;Tm5c&#39;, &#39;Mi4&#39;),
 (&#39;Tm5c&#39;, &#39;Mi15&#39;),
 (&#39;Tm5c&#39;, &#39;Tm5Y&#39;),
 (&#39;Tm5c&#39;, &#39;Tm5b&#39;),
 (&#39;Tm5c&#39;, &#39;Tm16&#39;),
 (&#39;Tm9&#39;, &#39;CT1(Lo1)&#39;),
 (&#39;Tm9&#39;, &#39;Mi9&#39;),
 (&#39;Tm9&#39;, &#39;T5a&#39;),
 (&#39;Tm9&#39;, &#39;T5b&#39;),
 (&#39;Tm9&#39;, &#39;T5c&#39;),
 (&#39;Tm9&#39;, &#39;T5d&#39;),
 (&#39;Tm9&#39;, &#39;Tm1&#39;),
 (&#39;Tm9&#39;, &#39;Tm2&#39;),
 (&#39;Tm9&#39;, &#39;Tm5Y&#39;),
 (&#39;Tm9&#39;, &#39;Tm28&#39;),
 (&#39;Tm9&#39;, &#39;TmY4&#39;),
 (&#39;Tm9&#39;, &#39;TmY9&#39;),
 (&#39;Tm9&#39;, &#39;TmY15&#39;),
 (&#39;Tm16&#39;, &#39;Lawf1&#39;),
 (&#39;Tm16&#39;, &#39;Lawf2&#39;),
 (&#39;Tm16&#39;, &#39;Mi9&#39;),
 (&#39;Tm16&#39;, &#39;T2&#39;),
 (&#39;Tm16&#39;, &#39;Tm1&#39;),
 (&#39;Tm16&#39;, &#39;Tm2&#39;),
 (&#39;Tm16&#39;, &#39;Tm4&#39;),
 (&#39;Tm16&#39;, &#39;Tm5Y&#39;),
 (&#39;Tm16&#39;, &#39;Tm5c&#39;),
 (&#39;Tm16&#39;, &#39;Tm9&#39;),
 (&#39;Tm16&#39;, &#39;TmY3&#39;),
 (&#39;Tm16&#39;, &#39;TmY5a&#39;),
 (&#39;Tm16&#39;, &#39;TmY10&#39;),
 (&#39;Tm16&#39;, &#39;TmY13&#39;),
 (&#39;Tm16&#39;, &#39;TmY14&#39;),
 (&#39;Tm20&#39;, &#39;Mi2&#39;),
 (&#39;Tm20&#39;, &#39;Mi9&#39;),
 (&#39;Tm20&#39;, &#39;Tm5Y&#39;),
 (&#39;Tm20&#39;, &#39;Tm9&#39;),
 (&#39;Tm20&#39;, &#39;Tm20&#39;),
 (&#39;Tm28&#39;, &#39;Tm5Y&#39;),
 (&#39;Tm28&#39;, &#39;TmY4&#39;),
 (&#39;Tm28&#39;, &#39;TmY9&#39;),
 (&#39;TmY3&#39;, &#39;T2&#39;),
 (&#39;TmY3&#39;, &#39;Tm4&#39;),
 (&#39;TmY3&#39;, &#39;TmY3&#39;),
 (&#39;TmY3&#39;, &#39;TmY4&#39;),
 (&#39;TmY3&#39;, &#39;TmY5a&#39;),
 (&#39;TmY3&#39;, &#39;TmY13&#39;),
 (&#39;TmY3&#39;, &#39;TmY14&#39;),
 (&#39;TmY3&#39;, &#39;TmY15&#39;),
 (&#39;TmY4&#39;, &#39;Mi3&#39;),
 (&#39;TmY4&#39;, &#39;Mi4&#39;),
 (&#39;TmY4&#39;, &#39;Mi13&#39;),
 (&#39;TmY4&#39;, &#39;T2&#39;),
 (&#39;TmY4&#39;, &#39;T5d&#39;),
 (&#39;TmY4&#39;, &#39;TmY4&#39;),
 (&#39;TmY4&#39;, &#39;TmY5a&#39;),
 (&#39;TmY4&#39;, &#39;TmY9&#39;),
 (&#39;TmY4&#39;, &#39;TmY14&#39;),
 (&#39;TmY5a&#39;, &#39;Mi2&#39;),
 (&#39;TmY5a&#39;, &#39;Mi3&#39;),
 (&#39;TmY5a&#39;, &#39;T2&#39;),
 (&#39;TmY5a&#39;, &#39;T2a&#39;),
 (&#39;TmY5a&#39;, &#39;Tm16&#39;),
 (&#39;TmY5a&#39;, &#39;TmY3&#39;),
 (&#39;TmY5a&#39;, &#39;TmY4&#39;),
 (&#39;TmY5a&#39;, &#39;TmY14&#39;),
 (&#39;TmY5a&#39;, &#39;TmY15&#39;),
 (&#39;TmY5a&#39;, &#39;TmY18&#39;),
 (&#39;TmY9&#39;, &#39;Mi13&#39;),
 (&#39;TmY9&#39;, &#39;TmY4&#39;),
 (&#39;TmY9&#39;, &#39;TmY9&#39;),
 (&#39;TmY10&#39;, &#39;Mi4&#39;),
 (&#39;TmY10&#39;, &#39;T2a&#39;),
 (&#39;TmY10&#39;, &#39;Tm5b&#39;),
 (&#39;TmY10&#39;, &#39;Tm5c&#39;),
 (&#39;TmY10&#39;, &#39;Tm9&#39;),
 (&#39;TmY10&#39;, &#39;Tm16&#39;),
 (&#39;TmY10&#39;, &#39;Tm20&#39;),
 (&#39;TmY10&#39;, &#39;Tm28&#39;),
 (&#39;TmY10&#39;, &#39;TmY4&#39;),
 (&#39;TmY10&#39;, &#39;TmY9&#39;),
 (&#39;TmY13&#39;, &#39;Mi4&#39;),
 (&#39;TmY13&#39;, &#39;T2&#39;),
 (&#39;TmY13&#39;, &#39;Tm5b&#39;),
 (&#39;TmY13&#39;, &#39;Tm16&#39;),
 (&#39;TmY13&#39;, &#39;TmY5a&#39;),
 (&#39;TmY14&#39;, &#39;C3&#39;),
 (&#39;TmY14&#39;, &#39;Mi12&#39;),
 (&#39;TmY14&#39;, &#39;Mi13&#39;),
 (&#39;TmY14&#39;, &#39;Tm9&#39;),
 (&#39;TmY14&#39;, &#39;Tm16&#39;),
 (&#39;TmY14&#39;, &#39;TmY4&#39;),
 (&#39;TmY15&#39;, &#39;Mi4&#39;),
 (&#39;TmY15&#39;, &#39;Mi9&#39;),
 (&#39;TmY15&#39;, &#39;T2&#39;),
 (&#39;TmY15&#39;, &#39;T2a&#39;),
 (&#39;TmY15&#39;, &#39;T4a&#39;),
 (&#39;TmY15&#39;, &#39;T4b&#39;),
 (&#39;TmY15&#39;, &#39;T4c&#39;),
 (&#39;TmY15&#39;, &#39;T4d&#39;),
 (&#39;TmY15&#39;, &#39;T5a&#39;),
 (&#39;TmY15&#39;, &#39;T5b&#39;),
 (&#39;TmY15&#39;, &#39;T5c&#39;),
 (&#39;TmY15&#39;, &#39;T5d&#39;),
 (&#39;TmY15&#39;, &#39;Tm1&#39;),
 (&#39;TmY15&#39;, &#39;Tm2&#39;),
 (&#39;TmY15&#39;, &#39;Tm3&#39;),
 (&#39;TmY15&#39;, &#39;Tm4&#39;),
 (&#39;TmY15&#39;, &#39;Tm9&#39;),
 (&#39;TmY15&#39;, &#39;TmY3&#39;),
 (&#39;TmY15&#39;, &#39;TmY14&#39;),
 (&#39;TmY15&#39;, &#39;TmY18&#39;),
 (&#39;TmY18&#39;, &#39;Mi4&#39;),
 (&#39;TmY18&#39;, &#39;Mi10&#39;),
 (&#39;TmY18&#39;, &#39;T2&#39;),
 (&#39;TmY18&#39;, &#39;TmY5a&#39;),
 (&#39;TmY18&#39;, &#39;TmY9&#39;),
 (&#39;TmY18&#39;, &#39;TmY15&#39;),
 (&#39;TmY18&#39;, &#39;TmY18&#39;)]
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvision.utils.tensor_utils</span> <span class="kn">import</span> <span class="n">matrix_mask_by_sub</span><span class="p">,</span> <span class="n">where_equal_rows</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">keys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">param2</span><span class="o">.</span><span class="n">keys</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">keys</span><span class="p">[</span><span class="n">matrix_mask_by_sub</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="s2">&quot;R4&quot;</span><span class="p">,</span> <span class="s2">&quot;Am&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Mi9&quot;</span><span class="p">,</span> <span class="s2">&quot;T4a&quot;</span><span class="p">)]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">param2</span><span class="o">.</span><span class="n">keys</span><span class="p">))]</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>array([[&#39;R4&#39;, &#39;Am&#39;],
       [&#39;Mi9&#39;, &#39;T4a&#39;]], dtype=&#39;&lt;U8&#39;)
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">matrix_mask_by_sub</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="s2">&quot;R4&quot;</span><span class="p">,</span> <span class="s2">&quot;Am&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Mi9&quot;</span><span class="p">,</span> <span class="s2">&quot;T4a&quot;</span><span class="p">)]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">param2</span><span class="o">.</span><span class="n">keys</span><span class="p">))</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>array([False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
        True, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False,  True, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False])
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="s2">&quot;R4&quot;</span><span class="p">,</span> <span class="s2">&quot;Am&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Mi9&quot;</span><span class="p">,</span> <span class="s2">&quot;T4a&quot;</span><span class="p">)])</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>(2, 2)
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">param2</span><span class="o">.</span><span class="n">keys</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>(65,)
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">param2</span><span class="o">.</span><span class="n">keys</span><span class="p">)[</span><span class="n">where_equal_rows</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="s2">&quot;R4&quot;</span><span class="p">,</span> <span class="s2">&quot;Am&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Mi9&quot;</span><span class="p">,</span> <span class="s2">&quot;T4a&quot;</span><span class="p">)]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">param2</span><span class="o">.</span><span class="n">keys</span><span class="p">))]</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>array([[&#39;R4&#39;, &#39;Am&#39;],
       [&#39;Mi9&#39;, &#39;T4a&#39;]], dtype=&#39;&lt;U8&#39;)
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">where_equal_rows</span><span class="err">??</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">edges</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;source_type&quot;</span><span class="p">,</span> <span class="s2">&quot;target_type&quot;</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">group_keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;source_type&quot;</span><span class="p">,</span> <span class="s2">&quot;target_type&quot;</span><span class="p">],</span> <span class="n">observed</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;source_type&quot;</span><span class="p">,</span> <span class="s2">&quot;target_type&quot;</span><span class="p">,</span> <span class="s2">&quot;edge_type&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="s2">&quot;n_syn&quot;</span><span class="p">])</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>source_type</th>
      <th>target_type</th>
      <th>source_u</th>
      <th>target_u</th>
      <th>n_syn</th>
      <th>du</th>
      <th>source_index</th>
      <th>dv</th>
      <th>source_v</th>
      <th>target_index</th>
      <th>target_v</th>
      <th>sign</th>
      <th>n_syn_certainty</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>R1</td>
      <td>L1</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>40.000000</td>
      <td>0.000000</td>
      <td>360.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>6128.000000</td>
      <td>0.000000</td>
      <td>-1.0</td>
      <td>5.859477</td>
    </tr>
    <tr>
      <th>1</th>
      <td>R1</td>
      <td>L2</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>46.000000</td>
      <td>0.000000</td>
      <td>360.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>6849.000000</td>
      <td>0.000000</td>
      <td>-1.0</td>
      <td>5.859477</td>
    </tr>
    <tr>
      <th>2</th>
      <td>R1</td>
      <td>L3</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>11.000000</td>
      <td>0.000000</td>
      <td>360.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>7570.000000</td>
      <td>0.000000</td>
      <td>-1.0</td>
      <td>5.859477</td>
    </tr>
    <tr>
      <th>3</th>
      <td>R1</td>
      <td>Am</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>36.000000</td>
      <td>0.000000</td>
      <td>360.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>9979.000000</td>
      <td>0.000000</td>
      <td>-1.0</td>
      <td>5.859477</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R1</td>
      <td>T1</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2.000000</td>
      <td>0.000000</td>
      <td>360.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>21515.000000</td>
      <td>0.000000</td>
      <td>-1.0</td>
      <td>5.859477</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>599</th>
      <td>TmY18</td>
      <td>T2</td>
      <td>0.244507</td>
      <td>-0.244507</td>
      <td>2.364281</td>
      <td>-0.489015</td>
      <td>45313.822112</td>
      <td>0.489015</td>
      <td>-0.244507</td>
      <td>22230.177888</td>
      <td>0.244507</td>
      <td>1.0</td>
      <td>1.587606</td>
    </tr>
    <tr>
      <th>600</th>
      <td>TmY18</td>
      <td>TmY5a</td>
      <td>-0.244507</td>
      <td>0.244507</td>
      <td>1.656361</td>
      <td>0.489015</td>
      <td>45302.177888</td>
      <td>-0.489015</td>
      <td>0.244507</td>
      <td>40987.822112</td>
      <td>-0.244507</td>
      <td>1.0</td>
      <td>5.517218</td>
    </tr>
    <tr>
      <th>601</th>
      <td>TmY18</td>
      <td>TmY9</td>
      <td>1.500000</td>
      <td>-1.500000</td>
      <td>1.000000</td>
      <td>-3.000000</td>
      <td>45344.787302</td>
      <td>2.000000</td>
      <td>-1.000000</td>
      <td>41666.212698</td>
      <td>1.000000</td>
      <td>1.0</td>
      <td>2.782612</td>
    </tr>
    <tr>
      <th>602</th>
      <td>TmY18</td>
      <td>TmY15</td>
      <td>-0.220461</td>
      <td>0.220461</td>
      <td>2.230947</td>
      <td>0.440922</td>
      <td>45302.296781</td>
      <td>0.426213</td>
      <td>-0.213107</td>
      <td>44592.703219</td>
      <td>0.213107</td>
      <td>1.0</td>
      <td>0.864511</td>
    </tr>
    <tr>
      <th>603</th>
      <td>TmY18</td>
      <td>TmY18</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.292609</td>
      <td>0.000000</td>
      <td>45308.099109</td>
      <td>-0.198219</td>
      <td>0.099109</td>
      <td>45307.900891</td>
      <td>-0.099109</td>
      <td>1.0</td>
      <td>2.239571</td>
    </tr>
  </tbody>
</table>
<p>604 rows  13 columns</p>
</div>
<div class="highlight"><pre><span></span><code><span class="n">Parameter</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[flyvision.initialization.RestingPotential,
 flyvision.initialization.TimeConstant,
 flyvision.initialization.SynapseSign,
 flyvision.initialization.SynapseCount,
 flyvision.initialization.SynapseCountScaling,
 __main__.RestingPotentialv2,
 __main__.RestingPotentialv2,
 __main__.RestingPotentialv2,
 __main__.TimeConstantv2,
 __main__.TimeConstantv2,
 __main__.TimeConstantv2]
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="k">pass</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="k">pass</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">():</span>
    <span class="bp">cls</span><span class="o">.</span><span class="vm">__bases__</span> <span class="o">=</span> <span class="p">(</span><span class="n">B</span><span class="p">,)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">Parameter</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[]
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvision</span> <span class="kn">import</span> <span class="n">results_dir</span>
<span class="kn">from</span> <span class="nn">flyvision.ensemble</span> <span class="kn">import</span> <span class="n">EnsembleView</span><span class="p">,</span> <span class="n">EnsembleDir</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">ensemble</span> <span class="o">=</span> <span class="n">EnsembleDir</span><span class="p">(</span><span class="n">results_dir</span> <span class="o">/</span> <span class="s2">&quot;opticflow/000&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">old_config</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
  <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;NetworkDir&#39;</span><span class="p">,</span>
  <span class="n">network</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="n">connectome</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
      <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;ConnectomeDir&#39;</span><span class="p">,</span>
      <span class="n">file</span> <span class="o">=</span> <span class="s1">&#39;fib25-fib19_v2.2.json&#39;</span><span class="p">,</span>
      <span class="n">extent</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
      <span class="n">n_syn_fill</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="p">),</span>
    <span class="n">dynamics</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
      <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;PPNeuronIGRSynapses&#39;</span><span class="p">,</span>
      <span class="n">activation</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)</span>
    <span class="p">),</span>
    <span class="n">node_config</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
      <span class="n">bias</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;RestingPotential&#39;</span><span class="p">,</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span>
        <span class="n">initial_dist</span> <span class="o">=</span> <span class="s1">&#39;Normal&#39;</span><span class="p">,</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;sample&#39;</span><span class="p">,</span>
        <span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">std</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
        <span class="n">penalize</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="n">activity</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">seed</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="p">),</span>
      <span class="n">time_const</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;TimeConstant&#39;</span><span class="p">,</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span>
        <span class="n">initial_dist</span> <span class="o">=</span> <span class="s1">&#39;Value&#39;</span><span class="p">,</span>
        <span class="n">value</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
        <span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">True</span>
      <span class="p">)</span>
    <span class="p">),</span>
    <span class="n">edge_config</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
      <span class="n">sign</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;SynapseSign&#39;</span><span class="p">,</span>
        <span class="n">initial_dist</span> <span class="o">=</span> <span class="s1">&#39;Value&#39;</span><span class="p">,</span>
        <span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">False</span>
      <span class="p">),</span>
      <span class="n">syn_count</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;SynapseCount&#39;</span><span class="p">,</span>
        <span class="n">initial_dist</span> <span class="o">=</span> <span class="s1">&#39;Lognormal&#39;</span><span class="p">,</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span>
        <span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">std</span> <span class="o">=</span> <span class="mf">1.0</span>
      <span class="p">),</span>
      <span class="n">syn_strength</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;SynapseCountScaling&#39;</span><span class="p">,</span>
        <span class="n">initial_dist</span> <span class="o">=</span> <span class="s1">&#39;Value&#39;</span><span class="p">,</span>
        <span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">scale_elec</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
        <span class="n">scale_chem</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
        <span class="n">clamp</span> <span class="o">=</span> <span class="s1">&#39;non_negative&#39;</span>
      <span class="p">)</span>
    <span class="p">)</span>
  <span class="p">),</span>
  <span class="n">task_dataset</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;MultiTaskSintel&#39;</span><span class="p">,</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;flow&#39;</span><span class="p">],</span>
    <span class="n">n_frames</span> <span class="o">=</span> <span class="mi">19</span><span class="p">,</span>
    <span class="n">dt_sampling</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">interpolate</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">boxfilter</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">13</span><span class="p">),</span>
    <span class="n">vertical_splits</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">p_flip</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">p_rot</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">contrast</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
    <span class="n">brightness</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="mf">0.08</span><span class="p">,</span>
    <span class="n">cache</span> <span class="o">=</span> <span class="s1">&#39;gpu&#39;</span><span class="p">,</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="mf">1.0</span>
  <span class="p">),</span>
  <span class="n">task_decoder</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;DecoderGAVP&#39;</span><span class="p">,</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="n">kernel_size</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">const_weight</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
    <span class="n">n_out_features</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">p_dropout</span> <span class="o">=</span> <span class="mf">0.5</span>
  <span class="p">),</span>
  <span class="n">task_loss</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;mean_root_norm&#39;</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">new_config</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
  <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;NetworkDir&#39;</span><span class="p">,</span>
  <span class="n">network</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="n">connectome</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
      <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;ConnectomeDir&#39;</span><span class="p">,</span>
      <span class="n">file</span> <span class="o">=</span> <span class="s1">&#39;fib25-fib19_v2.2.json&#39;</span><span class="p">,</span>
      <span class="n">extent</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
      <span class="n">n_syn_fill</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="p">),</span>
    <span class="n">dynamics</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
      <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;PPNeuronIGRSynapses&#39;</span><span class="p">,</span>
      <span class="n">activation</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)</span>
    <span class="p">),</span>
    <span class="n">node_config</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
      <span class="n">bias</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;RestingPotential&#39;</span><span class="p">,</span>
        <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
        <span class="n">initial_dist</span> <span class="o">=</span> <span class="s1">&#39;Normal&#39;</span><span class="p">,</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;sample&#39;</span><span class="p">,</span>
        <span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">std</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
        <span class="n">penalize</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="n">activity</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">seed</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="p">),</span>
      <span class="n">time_const</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;TimeConstant&#39;</span><span class="p">,</span>
        <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
        <span class="n">initial_dist</span> <span class="o">=</span> <span class="s1">&#39;Value&#39;</span><span class="p">,</span>
        <span class="n">value</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
        <span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">True</span>
      <span class="p">)</span>
    <span class="p">),</span>
    <span class="n">edge_config</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
      <span class="n">sign</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;SynapseSign&#39;</span><span class="p">,</span>
        <span class="n">initial_dist</span> <span class="o">=</span> <span class="s1">&#39;Value&#39;</span><span class="p">,</span>
        <span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;source_type&quot;</span><span class="p">,</span> <span class="s2">&quot;target_type&quot;</span><span class="p">],</span>
      <span class="p">),</span>
      <span class="n">syn_count</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;SynapseCount&#39;</span><span class="p">,</span>
        <span class="n">initial_dist</span> <span class="o">=</span> <span class="s1">&#39;Lognormal&#39;</span><span class="p">,</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span>
        <span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">std</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;source_type&quot;</span><span class="p">,</span> <span class="s2">&quot;target_type&quot;</span><span class="p">,</span> <span class="s2">&quot;du&quot;</span><span class="p">,</span> <span class="s2">&quot;dv&quot;</span><span class="p">],</span>
      <span class="p">),</span>
      <span class="n">syn_strength</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;SynapseCountScaling&#39;</span><span class="p">,</span>
        <span class="n">initial_dist</span> <span class="o">=</span> <span class="s1">&#39;Value&#39;</span><span class="p">,</span>
        <span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">scale_elec</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
        <span class="n">scale_chem</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
        <span class="n">clamp</span> <span class="o">=</span> <span class="s1">&#39;non_negative&#39;</span><span class="p">,</span>
        <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;source_type&quot;</span><span class="p">,</span> <span class="s2">&quot;target_type&quot;</span><span class="p">,</span> <span class="s2">&quot;edge_type&quot;</span><span class="p">],</span>
      <span class="p">)</span>
    <span class="p">)</span>
  <span class="p">),</span>
  <span class="n">task_dataset</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;MultiTaskSintel&#39;</span><span class="p">,</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;flow&#39;</span><span class="p">],</span>
    <span class="n">n_frames</span> <span class="o">=</span> <span class="mi">19</span><span class="p">,</span>
    <span class="n">dt_sampling</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">interpolate</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">boxfilter</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">13</span><span class="p">),</span>
    <span class="n">vertical_splits</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">p_flip</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">p_rot</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">contrast</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
    <span class="n">brightness</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="mf">0.08</span><span class="p">,</span>
    <span class="n">cache</span> <span class="o">=</span> <span class="s1">&#39;gpu&#39;</span><span class="p">,</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="mf">1.0</span>
  <span class="p">),</span>
  <span class="n">task_decoder</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;DecoderGAVP&#39;</span><span class="p">,</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="n">kernel_size</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">const_weight</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
    <span class="n">n_out_features</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">p_dropout</span> <span class="o">=</span> <span class="mf">0.5</span>
  <span class="p">),</span>
  <span class="n">task_loss</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;norm&#39;</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">config</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">_dir</span> <span class="ow">in</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">_dir</span><span class="o">.</span><span class="n">config</span>
        <span class="k">assert</span> <span class="n">_dir</span><span class="o">.</span><span class="n">config</span> <span class="o">==</span> <span class="n">config</span>
        <span class="n">_dir</span><span class="o">.</span><span class="n">_override_config</span><span class="p">(</span><span class="n">new_config</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>0003
0004
0032
0035
0034
0033
0005
0002
0020
0018
0027
0011
0029
0016
0042
0045
0028
0017
0010
0019
0026
0021
0044
0043
0007
0038
0000
0036
0009
0031
0030
0037
0008
0001
0006
0039
0046
0041
0048
0024
0023
0015
0012
0049
0040
0047
0013
0014
0022
0025


/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
/var/folders/b1/s01d0fxj4r56mc22xx01vnd9c7405m/T/ipykernel_70259/2707961450.py:8: ConfigWarning: Overriding config. Diff is:Namespace(
  passed = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]&quot;
  ],
  stored = [
    &quot;network.edge_config.syn_strength.groupby: [&#39;source_type&#39;, &#39;target_type&#39;]&quot;
  ]
)
  _dir._override_config(new_config)
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">_dir</span><span class="o">.</span><span class="n">_override_config</span><span class="p">()</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>0025/ - Last modified: March 23, 2023 11:22:29
 _meta.yaml
 best_chkpt
 validation_loss.h5

displaying: 1 directory, 3 files
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">x</span><span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>array([9])
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">x</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[]
</code></pre></div>

<div class="highlight"><pre><span></span><code>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>slice(-1, -2, -1)
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">wget</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>---------------------------------------------------------------------------

ModuleNotFoundError                       Traceback (most recent call last)

Input In [164], in &lt;cell line: 1&gt;()
----&gt; 1 import wget


ModuleNotFoundError: No module named &#39;wget&#39;
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">tqdm</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.d6f25eb3.min.js"></script>
      
    
  </body>
</html>